<!DOCTYPE html><html><head><title>Help for package pems.utils</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {pems.utils}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#1.1.make.import.data'>
<p>making and importing data</p></a></li>
<li><a href='#1.2.export.data'>
<p>exporting PEMS data</p></a></li>
<li><a href='#2.1.pems.structure'>
<p>'pems' object structure</p></a></li>
<li><a href='#3.1.generic.pems.handlers'><p> Generic handling of pems objects</p></a></li>
<li><a href='#3.2.generic.pems.element.handlers'><p> Generic handling of pems.element objects</p></a></li>
<li><a href='#4.1.merge.data.pems'>
<p>Merging data and pems objects</p></a></li>
<li><a href='#4.2.referencing.pems.data'>
<p>Data Referencing Functions.</p></a></li>
<li><a href='#4.3.time.handlers'>
<p>pems Data Time Handlers</p></a></li>
<li><a href='#4.4.unit.handlers'>
<p>data unit handlers</p></a></li>
<li><a href='#5.1.pems.plots'>
<p>Various plots for pems.utils</p></a></li>
<li><a href='#6.1.common.calculations'>
<p>Common calculations</p></a></li>
<li><a href='#6.2.common.check.functions'>
<p>common check... functions</p></a></li>
<li><a href='#6.3.corrections'>
<p>Corrections</p></a></li>
<li><a href='#6.4.analysis.summary.reports'>
<p>Generating summary reports</p></a></li>
<li><a href='#7.1.vsp.code'>
<p>Vehicle Specific Power (VSP) related code</p></a></li>
<li><a href='#7.2.emissions.calculations'>
<p>Emission calculations</p></a></li>
<li><a href='#7.3.coldstart.code'>
<p>Cold Start Emissions related code</p></a></li>
<li><a href='#7.4.speed.em.code'>
<p>Speed Emissions related code</p></a></li>
<li><a href='#8.1.pems.tidyverse.tools'>
<p>Functions to use tidyverse code with pems.utils outputs</p></a></li>
<li><a href='#9.1.example.data'>
<p>example data for use with pems.utils</p></a></li>
<li><a href='#9.2.look-up.tables'>
<p>reference data for use with pems.utils</p></a></li>
<li><a href='#pems.utils-package'>
<p>pems.utils</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Portable Emissions (and Other Mobile) Measurement System
Utilities</td>
</tr>
<tr>
<td>Version:</td>
<td>0.2.29.1</td>
</tr>
<tr>
<td>Date:</td>
<td>2021-04-20</td>
</tr>
<tr>
<td>Author:</td>
<td>Karl Ropkins [aut, cre],
  Adrian Felipe Ortega Calle [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Karl Ropkins &lt;karl.ropkins@gmail.com&gt;</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="http://pems.r-forge.r-project.org/">http://pems.r-forge.r-project.org/</a></td>
</tr>
<tr>
<td>Description:</td>
<td>Utility functions for the handling, analysis and visualisation 
    of data from portable emissions measurement systems ('PEMS') and other 
    similar mobile activity monitoring devices. The package includes a dedicated 
    'pems' data class that manages many of the quality control, unit handling 
    and data archiving issues that can hinder efforts to standardise 'PEMS' 
    research.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10.0), lattice, loa</td>
</tr>
<tr>
<td>Imports:</td>
<td>methods, utils, grid, RColorBrewer, latticeExtra, baseline,
ggplot2, rlang, dplyr, Rcpp (&ge; 0.12.19)</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>LazyLoad:</td>
<td>yes</td>
</tr>
<tr>
<td>LazyData:</td>
<td>yes</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.1</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2021-04-20 17:07:31 UTC; Karl</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2021-04-25 06:40:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='1.1.make.import.data'>
making and importing data
</h2><span id='topic+1.1.make.import.data'></span><span id='topic+pems.objects'></span><span id='topic+is.pems'></span><span id='topic+isPEMS'></span><span id='topic+pems'></span><span id='topic+makePEMS'></span><span id='topic+rebuildPEMS'></span><span id='topic+pems.element'></span><span id='topic+as.pems'></span><span id='topic+as.pems.default'></span><span id='topic+as.pems.data.frame'></span><span id='topic+makePEMSElement'></span><span id='topic+import2PEMS'></span><span id='topic+importTAB2PEMS'></span><span id='topic+importCSV2PEMS'></span><span id='topic+importOBS2PEMS'></span><span id='topic+importOB12PEMS'></span><span id='topic+importParSYNC2PEMS'></span><span id='topic+importCAGE2PEMS'></span><span id='topic+importRoyalTek2PEMS'></span><span id='topic+importKML2PEMS'></span><span id='topic+importSEMTECH2PEMS'></span>

<h3>Description</h3>

<p>Various pems.utils functions to make and import data as 
pems objects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>
#making pems objects
 
is.pems(x, full.test = TRUE, ...)

pems(x, units = NULL, constants = NULL, history = NULL,  
          ...)

pems.element(x, name = NULL, units = NULL,   
          ...)

#associated 

isPEMS(...)
makePEMS(...)
makePEMSElement(...)
rebuildPEMS(x, ...)

## S3 method for class 'data.frame'
as.pems(x, ...)

#importing data as pems objects

#general

import2PEMS(file.name = file.choose(), ..., 
          file.reader = read.delim, 
          output="pems")

importTAB2PEMS(..., file.reader = read.delim)

importCSV2PEMS(..., file.reader = read.csv)

#Horiba OBS

importOBS2PEMS(file.name = file.choose(), 
          pems = "Horiba OBS", 
          constants = NULL, history = NULL, 
          analytes = c("co", "co2", "nox", "hc"),  
          fuel = c("petrol", "diesel", "gasoline"), ...)

importOB12PEMS(file.name = file.choose(), 
          pems = "Horiba OBS", 
          constants = NULL, history = NULL, 
          analytes = c("co", "co2", "nox", "hc"),  
          fuel = c("petrol", "diesel", "gasoline"), ...)

#3DATX parSYNC

importParSYNC2PEMS(file.name = file.choose(), 
          reset.signals = TRUE, 
          history = NULL, constants = NULL, 
          pm.analyzer = "parSYNC", ... )

#3DATX CAGE
importCAGE2PEMS(..., calibrator = "CAGE")

#Sensors Inc SEMTECH

importSEMTECH2PEMS(file.name = file.choose(), 
          history = NULL, constants = NULL, 
          pems = "SEMTECH", ...)


#RoyalTek GPS

importRoyalTek2PEMS(file.name = file.choose(), 
          file.type = c("special", "txt", "nmea"),
          vbox = "RoyalTEk", history = NULL, 
          constants = NULL, ...) 


#KML files

importKML2PEMS(file.name = file.choose(), history = NULL, 
          constants = NULL, source = "Unknown", ...) 

</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="1.1.make.import.data_+3A_x">x</code></td>
<td>

<p>(A required object) For <code>is.pems</code>, any object to 
be tested as a <code>pems</code> object. 
For <code>pems</code>, an object to be used as the starting 
point to make a <code>pems</code> object, so typically a 
<code>data.frame</code> or another <code>pems</code> object. For 
<code>pems.element</code>, an object to be used as the starting 
point to make a <code>pems.element</code>. 
For <code>rebuildPEMS</code>, a <code>pems</code> object to be 
rebuilt.
</p>
</td></tr> 
<tr><td><code id="1.1.make.import.data_+3A_full.test">full.test</code></td>
<td>

<p>(Logical) For <code>is.pems</code>, should the full pems 
test be applied and the <code>pems</code> structure 
confirmed?  
</p>
</td></tr> 
<tr><td><code id="1.1.make.import.data_+3A_...">...</code></td>
<td>

<p>(Optional) Other arguments, handling varies. For 
<code>is.pems</code> these are ignored. For <code>pems</code> 
these are added to the pems object unmodified. For 
<code>import...</code> functions, these are passed on and 
added to the <code>constants</code> component of the 
<code>pems</code> object. Note: This different handling 
is experimental and may be subject to change in future. 
</p>
</td></tr>
<tr><td><code id="1.1.make.import.data_+3A_units">units</code>, <code id="1.1.make.import.data_+3A_constants">constants</code>, <code id="1.1.make.import.data_+3A_history">history</code></td>
<td>

<p>(Default pems arguments) These are arguments that are routinely generated for 
<code>pems</code> objects. <code>units</code> holds unit ids for unit management, <code>constants</code> holds 
constants that should used specifically with data in the <code>pems</code> object, and <code>history</code> 
holds the <code>pems</code> object modification history.   
</p>
</td></tr>
<tr><td><code id="1.1.make.import.data_+3A_name">name</code></td>
<td>

<p>(Default pems.element argument) <code>name</code> (and <code>units</code>) are arguments that are routinely 
generated for <code>pems.element</code> objects.    
</p>
</td></tr>
<tr><td><code id="1.1.make.import.data_+3A_file.name">file.name</code></td>
<td>

<p>(file connection, etc.) For <code>import...</code> functions, the file/source to be imported. Note: the 
default, <code>file.name = file.choose()</code>, automatically opens a file browser if this argument is 
not supplied.   
</p>
</td></tr>







<tr><td><code id="1.1.make.import.data_+3A_file.type">file.type</code>, <code id="1.1.make.import.data_+3A_file.reader">file.reader</code></td>
<td>

<p>Data reader parameters for some <code>import...</code> functions. <code>file.type</code> is the type of file 
to be imported. Note: Some <code>import...</code> functions can handle more than one file type, and 
<code>file.type = "[option]"</code> should be used to identify these. (Note: <code>file.type</code> options 
are typically file type identifiers, such as the file extensions, and a default <code>'special'</code>, 
which leaves the choice to the function. This way this option can typically be ignored unless, e.g. 
the function does not recognise the file type but the user knows it and wants to force the method.) 
<code>file.reader</code> identifies the R method/function that should be used to read data from the supplied 
file. For example, for <code>importTAB2PEMS</code> and <code>importCSV2PEMS</code>, by default, these are the 
standard <code>R</code> <code>read...</code> functions <code><a href="utils.html#topic+read.delim">read.delim</a></code> and <code><a href="utils.html#topic+read.csv">read.csv</a></code>, 
respectively.   
</p>
</td></tr>
<tr><td><code id="1.1.make.import.data_+3A_output">output</code></td>
<td>

<p>Where included in formal arguments, an option to control function output.
</p>
</td></tr>
<tr><td><code id="1.1.make.import.data_+3A_pems">pems</code>, <code id="1.1.make.import.data_+3A_vbox">vbox</code>, <code id="1.1.make.import.data_+3A_pm.analyzer">pm.analyzer</code>, <code id="1.1.make.import.data_+3A_calibrator">calibrator</code>, <code id="1.1.make.import.data_+3A_source">source</code></td>
<td>

<p>(Character vectors) For some <code>import...</code> functions, data source descriptions may be automatically 
added to the <code>pems</code> object. <code>pems</code> and <code>vbox</code> are two examples, but others, such as 
vehicle and fuel descritpions can also be added in a similar fashion. Note: These are for user-reference, 
so can say whatever you want.
</p>
</td></tr>
<tr><td><code id="1.1.make.import.data_+3A_analytes">analytes</code></td>
<td>

<p>(Character vector) For <code>import...</code> functions, the names of any pems elements to be tagged as 
analyte concentrations. Note: If the PEMS unit reports concentrations rather than emissions it is 
often useful to identify these at import to avoid confusion, and to simplify later handling. So, if 
encountered, analyte names are prefixed with the term <code>'conc.'</code>.    
</p>
</td></tr>
<tr><td><code id="1.1.make.import.data_+3A_fuel">fuel</code></td>
<td>

<p>Some <code>import...</code> functions that handle exhaust monitoring system data may assume fuel types when 
calibrating inputs or calculating constants. In such cases the <code>fuel</code> argument is also included 
to identify which fuel was used. 
</p>
</td></tr>
<tr><td><code id="1.1.make.import.data_+3A_reset.signals">reset.signals</code></td>
<td>

<p>(Logical or Character vector) For <code>importParSYNC2PEMS</code>, should any raw signal be reset? The 
default (<code>TRUE</code>) reverses the sign of opacity and ionization signals.      
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>is.pems</code> tests if an object is/is not a <code>pems</code> object.
</p>
<p><code>pems</code> makes a <code>pems</code> object using supplied data and information. 
</p>
<p><code>pems.element</code> makes a <code>pems.element</code> object using supplied data and information.
</p>
<p><code>as.pems...</code> functions attempt to convert a supplied object into a <code>pems</code> object. 
Currently, there is only a <code>data.frame</code> method and (by <code>default</code>) a <code>pems</code> 
method.
</p>
<p><code>isPEMS</code>, <code>makePEMS</code> and <code>makePEMSElement</code> are historical code, retained for 
backward compatibility.
</p>
<p><code>rebuildPEMS</code> rebuilds <code>pems</code> object as a different build version. 
</p>
<p>Crude <code>import...</code> functions import simple file structures, and are useful for getting 
data quickly into <code>R:pems.utils</code>. <code>importTAB2PEMS</code> imports tab delimited files and 
clipboard content. <code>importCSV2PEMS</code> imports comma delimited files. Both assume a simple 
file structure (i.e. data series in columns with names as headers), but require some time data 
management by the user. Note: These are wrappers for <code>import2PEMS</code>. 
</p>
<p>Other <code>import...</code> import specific file types.
</p>
<p><code>importOBS2PEMS</code> imports standard Horiba OBS files and converts them to <code>pems</code> 
objects. See Notes below. 
</p>
<p><code>importOB12PEMS</code> imports <code>.OB1</code> files and converts them to <code>pems</code> objects. <code>OB1</code> 
files are generated by a Visual Basic PEMS data handler used during the RETEMM project. Notes below. 
</p>
<p><code>importParSYNC2PEMS</code> imports standard parSYNC files and converts them to <code>pems</code> 
objects. See Notes below. 
</p>
<p><code>importCAGE2PEMS</code> imports standard CAGE files and converts them to <code>pems</code> objects. 
See <code>importParSYNC2PEMS</code> Notes below.
</p>
<p><code>importSEMTECH2PEMS</code> imports Sensors Inc. SEMTECH ECOSTAR files and converts them to <code>pems</code> 
objects. See Notes below. 
</p>
<p><code>importRoyalTek2PEMS</code> imports <code>.txt</code> and <code>.nmea</code> format Royal Tek GPS files and 
converts them to <code>pems</code> objects. See Notes below. 
</p>
<p><code>importKML2PEMS</code> imports <code>.kml</code> format KML files and 
converts them to <code>pems</code> objects. See Notes below. 
</p>


<h3>Value</h3>

<p><code>is.pems</code> return a logical, <code>TRUE</code> if the supplied object is <code>pems</code> class, 
otherwise <code>FALSE</code>. If the argument <code>full.test = TRUE</code> is also supplied, additional 
information about the object is returned as <code>comment(output)</code>. 
</p>
<p><code>pems</code> and <code>pems.element</code> functions return <code>pems</code> and <code>pems.element</code> 
objects, respectively, made using the supplied file and any additional information also 
supplied in the same call.
</p>
<p><code>rebuildPEMS</code> rebuilts the supplied <code>pems</code> object. The default rebuilds as the lastest 
build structure.
</p>
<p><code>import...</code> functions return a <code>pems</code> object, made using the supplied file and any 
additional information also supplied in the same call. 
</p>


<h3>Note</h3>

<p><code>isPEMS</code>, <code>makePEMS</code> and <code>makePEMSElement</code> were earlier functions that performed 
the same functions as <code>is.pems</code>, <code>pems</code> and <code>pems.elements</code>, respectively. The 
the current versions of these functions are wrappers for their replacements. 
</p>
<p>With the crude <code>import...</code> functions (<code>import2PEMS</code>, <code>importTAB2PEMS</code>, 
<code>importCSV2PEMS</code>) modifications are minimal. Unless any additional changes are requested 
in the <code>import...(...)</code> call, the data is simply read in as a <code>data.frame</code> and 
converted to a <code>pems</code> object.  
</p>
<p>With <code>importOBS2PEMS</code>, OBS data is also modified as follows: data series names are simplified and 
converted to lower case to simplify use in R; the data series <code>time.stamp</code> and <code>local.time</code> 
are added (generated using the file time stamp, the row counter and the log.rate constant); 
data series <code>latitude</code> and <code>longitude</code> are resigned according to set N/S and E/W values, 
if these are present/valid; <code>latitude</code> and <code>longitude</code> units are also reset to <code>'d.degLat'</code> 
and <code>'d.degLon'</code>. Any data series names in <code>analytes</code> is renamed <code>'conc.[analyte name]'</code>. 
If not supplied in the <code>importOBS2PEMS</code>, typical OBS constants are currently assumed. Several of these 
are based on emission source fuel. Defaults for these are generated according to <code>fuel</code> (default 
<code>'petrol'</code>).
</p>
<p>With <code>importOB12PEMS</code>, handling is similar to that with <code>importOBS2PEMS</code>. 
</p>
<p>With <code>importParSYNC2PEMS</code>, the parSYNC data modifications are as follows: parSYNC Date and Time 
data-series are merged and converted into <code>*POSIX</code> as <code>time.stamp</code>; <code>local.time</code> is calculated 
from this; the parSYNC data series Timestamp is retained as <code>parsync.timestamp</code>; by default units are 
removed from data-series names, but retained as <code>units(pems)</code>; (again by default) all names are 
converted to lower case. The default option <code>reset.signal = TRUE</code> reverses the voltage reading 
of opacity and ionization time-series (x = - x), if present. Alternatively, imports can be identified 
specifically by name, e.g. <code>reset.signal = "opacity"</code> to just reset opacity. Typical OBS constants 
are currently assumed, if not supplied. Several of these are based on emission source fuel. The default 
assumption is that the fuel is <code>'petrol'</code> unless <code>fuel</code> has been assigned.  
</p>
<p>With <code>importCAGE2PEMS</code>, handling is similar to that with <code>importParSYNC2PEMS</code>. 
</p>
<p>With <code>importSEMTECH2PEMS</code>, SEMTECH data is imported and modified as follows: data series names are simplified and 
converted to lower case to simplify use in R; the data series <code>time.stamp</code> and <code>local.time</code> 
are added (generated using the file time stamp). Defaults constants are assigned according to <code>fuel</code> (default 
<code>'petrol'</code>). This function in in-development and has so far only been used with files from two 
sources, so handle with care, and <code>time.format</code> has varied so may need resetting for some files.
</p>
<p>With <code>importRoyalTek2PEMS</code>, the Royal Tek data modifications are currently being documented.  
</p>
<p>With <code>importKML2PEMS</code>, the function attempts to import and time.stamp, latitude, longtiude and altitude data 
in the suppled KML file. This function in in-development and has so far only been used with KML files from one 
source, so handle with care.  
</p>


<h3>Author(s)</h3>

<p>Karl Ropkins
</p>


<h3>References</h3>

<p>References in preparation.
</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+ref.unit.conversions">ref.unit.conversions</a></code> and <code><a href="#topic+convertUnits">convertUnits</a></code> for general unit handling; 
<code><a href="#topic+merge.pems">merge.pems</a></code> for pems data merging and alignment. 
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
###########
##example 1 
###########

#make little pems

data &lt;- data.frame(speed=1:10, emissions=1:10)
units &lt;- c("m/s", "g/s")
pems &lt;- pems(x = data, units=units, example="my record") 
 
pems                       #the pems object
summary(pems)              #summary of held data
pems$speed                 #the speed pems.element

#import data file as pems using import... functions

#For example, to import CSV file as pems object 
## Not run: 
pems &lt;- importCSV2PEMS() 

## End(Not run)

</code></pre>

<hr>
<h2 id='1.2.export.data'>
exporting PEMS data
</h2><span id='topic+1.2.export.data'></span><span id='topic+export.data'></span><span id='topic+exportPEMS'></span><span id='topic+exportPEMS2TAB'></span><span id='topic+exportPEMS2CSV'></span>

<h3>Description</h3>

<p>Some functions for exporting data from R and pems.utils.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>
exportPEMS(pems, file = "tempfile", file.writer = write.table, 
           sep = "\t", ...)

exportPEMS2TAB(pems, file = "tempfile", file.writer = write.table, 
           sep = "\t", ...) 

exportPEMS2TAB(pems, file = "tempfile", file.writer = write.table, 
           sep = "\t", ...) 

#exportPEMS2Excel 
#currently disabled

</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="1.2.export.data_+3A_pems">pems</code></td>
<td>

<p>(A required object) The object to export from R, typically a <code>data.frame</code> or 
<code>pems</code> object.   
</p>
</td></tr> 
<tr><td><code id="1.2.export.data_+3A_file">file</code></td>
<td>

<p>(Character) The name of the file to create when exporting data. This can be 
<code>'clipboard'</code>, to export to the clipboard assuming the clipboard buffers are not 
exceeded.  
</p>
</td></tr> 
<tr><td><code id="1.2.export.data_+3A_file.writer">file.writer</code>, <code id="1.2.export.data_+3A_sep">sep</code></td>
<td>

<p>(Various arguments) <code>file.writer</code> is the R function used to create the export file. 
<code>sep</code> is the separator argument passed to <code>file.writer</code>.     
</p>
</td></tr>
<tr><td><code id="1.2.export.data_+3A_...">...</code></td>
<td>

<p>(Optional) Other arguments, handling varies. For <code>exportPEMS2...</code> functions, these typically 
passed to <code>exportPEMS</code> or from there to the assigned <code>file.writer</code>. 
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>By default, <code>exportPEMS2TAB</code> and <code>exportPEMS2CSV</code> export the data component of a supplied 
<code>pems</code> object, to tab-delimited <code>.txt</code> and comma-delimited <code>.csv</code> files, 
respectively. <code>file</code> sets the file name (default <code>tempfile</code>).  
</p>
<p>These are typically used in form: 
</p>
<p><code>exportPEMS2...(pems, file, ...)</code>
</p>
<p>By default, they make the following associated modifications:
</p>
<p>If file extensions are not included in <code>file</code>, they add <code>.txt</code> and <code>.csv</code> 
extensions to tab-delimited and comma-delimited files, respectively. The argument 
<code>tidy.file=FALSE</code> can be used to disable this modification.
</p>
<p>Time stamps, if identified, are exported in &quot;DD/MM/YYYY HH:MM:SS.x&quot; format. Handling can be 
altered using <code>time.stamp</code>, <code>time.format</code> and <code>tz</code> arguments like 
<code><a href="#topic+import2PEMS">import2PEMS</a></code> or disabled using <code>tidy.time.stamp=FALSE</code>. 
</p>
<p>Data-series units can also be added to exported file column names in form <code>name(units)</code> 
by adding the argument <code>units="add.to.names"</code>.     
</p>


<h3>Value</h3>

<p><code>exportPEMS2...()</code> functions generate export file from pems data. 
</p>


<h3>Warning</h3>

<p>Currently, <code>exportPEMS...</code> functions overwrite without warnings. 
</p>


<h3>Note</h3>

<p><code>exportPEMS2Excel</code> is curently disabled.
</p>
<p>These are very crude functions in the most part because they are rarely used. Suggestions for helpful 
improvements would be very welcome.
</p>


<h3>Author(s)</h3>

<p>Karl Ropkins
</p>


<h3>References</h3>

<p>References in preparation.
</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+import2PEMS">import2PEMS</a></code>, etc. for importing data into <code>pems.utils</code>. 
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
###########
##example 1 
###########

#making a comma-delimited copy of pems.1

## Not run: 
exportPEMS2CSV(pems.1, "pems.example")
dir()

## End(Not run)

</code></pre>

<hr>
<h2 id='2.1.pems.structure'>
'pems' object structure
</h2><span id='topic+2.1.pems.structure'></span><span id='topic+pems.structure'></span><span id='topic+getPEMSElement'></span><span id='topic+getPEMSData'></span><span id='topic+getPEMSConstants'></span><span id='topic+pemsData'></span><span id='topic+pemsConstants'></span><span id='topic+pemsHistory'></span><span id='topic+pemsin'></span><span id='topic+pemsin2'></span><span id='topic+cpe'></span>

<h3>Description</h3>

<p>This pages provides a brief outview description of 
the 'pems' object structure. It also lists some 
associated functions
</p>


<h3>Usage</h3>

<pre><code class='language-R'>
getPEMSElement(x, pems = NULL, units = NULL, ..., 
            fun.name="getPEMSElement", 
            if.missing = "stop", if.null = if.missing, 
            track.name = TRUE, .x = enquo(x))

getPEMSData(pems=NULL, ..., fun.name = "getPEMSData", 
            if.missing = "stop", .pems = enquo(pems))

getPEMSConstants(pems=NULL, ..., 
            fun.name = "getPEMSConstants", 
            if.missing = "stop", .pems = enquo(pems))

pemsData(pems=NULL, ..., 
          fun.name = "pemsData", if.missing = "stop",
          pems.name = deparse(substitute(pems)))

pemsConstants(pems=NULL, ..., 
          fun.name = "pemsConstants", if.missing = "stop",
          pems.name = deparse(substitute(pems)))

pemsHistory(pems=NULL, ..., 
         fun.name = "pemsHistory", if.missing = "stop",
         pems.name = deparse(substitute(pems)))
         
cpe(...)

</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="2.1.pems.structure_+3A_x">x</code></td>
<td>

<p>(Required vector, typically pems.element) For 
<code>getPEMSElement</code>, the required data element.
</p>
</td></tr>
<tr><td><code id="2.1.pems.structure_+3A_pems">pems</code></td>
<td>

<p>(pems object) If supplied, the <code>pems</code> object 
to search for <code>x</code> before checking the parent 
environments and R workspace.
</p>
</td></tr>
<tr><td><code id="2.1.pems.structure_+3A_units">units</code></td>
<td>

<p>(Optional) The units that <code>x</code> should be supplied 
in (handled by <code><a href="#topic+convertUnits">convertUnits</a></code>). 
</p>
</td></tr>
<tr><td><code id="2.1.pems.structure_+3A_...">...</code></td>
<td>

<p>(Optional) Other Arguments.
</p>
</td></tr>
<tr><td><code id="2.1.pems.structure_+3A_fun.name">fun.name</code>, <code id="2.1.pems.structure_+3A_if.missing">if.missing</code>, <code id="2.1.pems.structure_+3A_if.null">if.null</code>, <code id="2.1.pems.structure_+3A_track.name">track.name</code>, <code id="2.1.pems.structure_+3A_pems.name">pems.name</code>, <code id="2.1.pems.structure_+3A_.x">.x</code>, <code id="2.1.pems.structure_+3A_.pems">.pems</code></td>
<td>

<p>(Various) Other options using for <code>pems.utils</code> 
house-keeping. See <code><a href="#topic+check...">check...</a></code> for 
definitions, although generally these can be ignored
by users. See Note below.  
</p>
</td></tr> 
</table>


<h3>Details</h3>

<p>The <code>pems</code> object is a managed <code>data.frame</code>. 
It has five main components: <code>data</code>, 
<code>units</code>, <code>constants</code>, <code>history</code> and 
<code>tags</code>. <code>data</code> is the main 
<code>data.frame</code>. Each element (named 
<code>data.frame</code> column) is a data-series of the 
original PEMS data. <code>units</code> are the associated 
unit definitions. <code>constants</code> is a list of 
associated constants that are to be used with the 
<code>pems</code> object. (The preference order is arguments 
given in a call then <code>constants</code> declared in the 
<code>pems</code> object then <code>constant</code> defaults held 
by the <code>pems.utils</code> package.) <code>history</code> is a 
log of <code>pems</code> object modifications. <code>tags</code> 
are any other components that the user wishes to add 
to a <code>pems</code> object as identifiers.
</p>
<p><code>getPEMSElement</code> gets a requested 
<code>pem.element</code> from <code>pems</code> if supplied or 
from the local workspace. 
</p>
<p><code>pemsData</code> and <code>getPEMSData</code> get the 
data component of a supplied <code>pems</code> object.
</p>
<p><code>pemsConstants</code> and <code>getPEMSConstants</code> get 
all constants locally defined for the supplied 
<code>pems</code> object. 
</p>
<p><code>pemsHistory</code> gets the history of supplied 
<code>pems</code> object.
</p>
<p><code>cpe</code> combines <code>pems.elements</code>. It is 
intended as an alternative to 
<code>c(pems.element, ...)</code> while 
that generic is in-development. 
</p>


<h3>Value</h3>

<p><code>getPEMSElement</code> returns the requested element 
of a supplied <code>pems</code> object as a managed vector or 
<code>pems.element</code>, if available. If missing, error 
handling is by <code>checkIfMissing</code>. See 
<code><a href="#topic+check...">check...</a></code> for more details.) 
</p>
<p><code>pemsData</code> returns the data component of a 
supplied <code>pems</code> object as a <code>data.frame</code>. 
</p>
<p><code>getPEMSData</code> returns the data component of 
a supplied <code>pems</code> object as a <code>data.frame</code>. 
</p>
<p><code>pemsConstants</code> returns the constants component 
of a supplied <code>pems</code> object as a <code>list</code>. 
</p>
<p><code>getPEMSConstants</code> returns the constants 
component of a supplied <code>pems</code> object as a 
<code>list</code>. 
</p>
<p><code>pemsHistory</code> returns the history component of 
a supplied <code>pems</code> object as a <code>list</code>.
</p>
<p><code>cpe</code> turns the concatenated form of supplied 
input. 
</p>


<h3>Note</h3>

<p><code>pems...</code> functions are in development <code>pems</code> 
object handlers. They are intended for 
convenient 'front of house' use. As part of this role, 
their structure will evolve over time, 
so arguments and operations may change based on user 
feedback. Those wishing to develop 
future-proof third party functions should also 
consider <code>check...</code> functions when developing 
their code. See <code><a href="#topic+common.calculations">common.calculations</a></code> 
for some Examples.      
</p>
<p><code>getPEMS...</code> functions are a revision of earlier 
<code>pems...</code> <code>pems</code> object handlers. 
They are intended to replace <code>pems...</code> code in 
future package versions.       
</p>
<p><code>rlang</code> and <code>dplyr</code> functions now do 
the heavy lifting for <code>getPEMSElement</code>.
</p>


<h3>Author(s)</h3>

<p>Karl Ropkins
</p>


<h3>References</h3>

<p><code>rlang</code> and <code>dplyr</code> package functions now 
do the heavy lifting for <code>getPEMSElement</code>.
</p>
<p>Lionel Henry and Hadley Wickham (2018). rlang: 
Functions for Base Types and Core R and 
'Tidyverse' Features. R package version 0.2.0.
https://CRAN.R-project.org/package=rlang
</p>
<p>Hadley Wickham, Romain Francois, Lionel Henry and 
Kirill Muller (2017). dplyr: A Grammar of Data 
Manipulation. R package version
0.7.4. https://CRAN.R-project.org/package=dplyr
</p>


<h3>See Also</h3>

<p>See Also: <code><a href="#topic+check...">check...</a></code> for 
<code>check...</code> function equivalents; 
<code><a href="#topic+pems.generics">pems.generics</a></code> for <code>pems</code> object 
generic functions.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
###########
##example 1 
###########

#basic usage

#using example data pems.1
#(supplied as part of pems.utils package)

#pems structure
pems.1

# extracting the pems.1 element velocity
getPEMSElement(velocity, pems.1)

## Not run: 
#generic (SE) equivalents
pems.1$velocity
pems.1["velocity"] 

## End(Not run)

</code></pre>

<hr>
<h2 id='3.1.generic.pems.handlers'> Generic handling of pems objects </h2><span id='topic+3.1.generic.pems.handlers'></span><span id='topic+generic.pems.handlers'></span><span id='topic+pems.generics'></span><span id='topic+as.data.frame.pems'></span><span id='topic+as.data.frame'></span><span id='topic+dim.pems'></span><span id='topic+dim'></span><span id='topic++24.pems'></span><span id='topic++24'></span><span id='topic++24+3C-.pems'></span><span id='topic++24+3C-'></span><span id='topic++5B.pems'></span><span id='topic++5B'></span><span id='topic++5B+3C-.pems'></span><span id='topic++5B+3C-'></span><span id='topic++5B+5B.pems'></span><span id='topic++5B+5B'></span><span id='topic++5B+5B+3C-.pems'></span><span id='topic++5B+5B+3C-'></span><span id='topic+with.pems'></span><span id='topic+with'></span><span id='topic+subset.pems'></span><span id='topic+subset'></span><span id='topic+head.pems'></span><span id='topic+head'></span><span id='topic+tail.pems'></span><span id='topic+tail'></span><span id='topic+names.pems'></span><span id='topic+names'></span><span id='topic+names+3C-.pems'></span><span id='topic+names+3C-'></span><span id='topic+print.pems'></span><span id='topic+print'></span><span id='topic+plot.pems'></span><span id='topic+summary.pems'></span><span id='topic+na.omit.pems'></span><span id='topic+na.omit'></span><span id='topic+units.pems'></span><span id='topic+units'></span><span id='topic+units+3C-.pems'></span><span id='topic+units+3C-'></span>

<h3>Description</h3>

<p>pems objects can be manipulated using generic functions like print, plot and 
summary in a similar fashion to objects of other R classes. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>
## S3 method for class 'pems'
as.data.frame(x,...)

## S3 method for class 'pems'
 dim(x, ...)

## S3 method for class 'pems'
 x$name, ...

## S3 replacement method for class 'pems'
 x$name, ... &lt;- value

## S3 method for class 'pems'
 x[i, j, ..., force = FALSE, simplify = TRUE]

## S3 replacement method for class 'pems'
 x[i, j, ..., force = FALSE] &lt;- value

## S3 method for class 'pems'
 x[[k, ...]]

## S3 replacement method for class 'pems'
 x[[k, ...]] &lt;- value

## S3 method for class 'pems'
 with(data, expr, ...)

## S3 method for class 'pems'
 subset(x, ...)

## S3 method for class 'pems'
names(x, ...)

## S3 replacement method for class 'pems'
names(x, ...) &lt;- value

## S3 method for class 'pems'
print(x,..., rows=NULL, cols=NULL, width=NULL)

## S3 method for class 'pems'
plot(x, id = NULL, ignore = "time.stamp", n = 3, ...)

## S3 method for class 'pems'
head(x, n = 6, ...)

## S3 method for class 'pems'
tail(x, n = 6, ...)

## S3 method for class 'pems'
summary(object, ...)

## S3 method for class 'pems'
na.omit(object, ...)

## S3 method for class 'pems'
units(x)

## S3 replacement method for class 'pems'
units(x) &lt;- value

</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="3.1.generic.pems.handlers_+3A_x">x</code>, <code id="3.1.generic.pems.handlers_+3A_object">object</code>, <code id="3.1.generic.pems.handlers_+3A_data">data</code></td>
<td>
 
<p>(An Object of pems class). For direct use with <code>print</code>, <code>plot</code>, <code>summary</code>, 
etc. NOTE: Object naming (i.e., <code>x</code> or <code>object</code>) is determined in parent or 
base function in R, so naming can vary by method.
</p>
</td></tr>
<tr><td><code id="3.1.generic.pems.handlers_+3A_name">name</code></td>
<td>
 
<p>Element name, which operates in a similar fashion to <code>data.frame</code> names, e.g. 
<code>pems$name</code> extracts the element <code>name</code> from the pems object <code>pems</code>.
</p>
</td></tr>
<tr><td><code id="3.1.generic.pems.handlers_+3A_i">i</code>, <code id="3.1.generic.pems.handlers_+3A_j">j</code></td>
<td>
 
<p>Row and column (elements) indices, which operate as a stricter version of 
<code>data.frame</code> indices. See Note below.
</p>
</td></tr>
<tr><td><code id="3.1.generic.pems.handlers_+3A_k">k</code></td>
<td>
 
<p>Structural indices. See Note below.
</p>
</td></tr>
<tr><td><code id="3.1.generic.pems.handlers_+3A_expr">expr</code></td>
<td>

<p>(Expression) For <code>with(pems)</code>, an expression to be evaluated inside 
the supplied <code>pems</code> object.  
</p>
</td></tr>
<tr><td><code id="3.1.generic.pems.handlers_+3A_value">value</code></td>
<td>

<p>(vector, data.frame or pems) An object to be inserted into a <code>pems</code> object in e.g. the form 
<code>pems[i,j] &lt;- value</code> or <code>pems$name &lt;- value</code>. 
</p>
</td></tr>
<tr><td><code id="3.1.generic.pems.handlers_+3A_...">...</code></td>
<td>
 
<p>Addition options, typically passed to associated default method(s).
</p>
</td></tr>
<tr><td><code id="3.1.generic.pems.handlers_+3A_force">force</code></td>
<td>
 
<p>(Logical or character) Data element handling options. <code>force</code> provides various options to 
forces data to fit it destination. This can either be set as a logical (<code>TRUE</code>/<code>FALSE</code> 
force/don't force) or one or more character strings to specify particular types of forcing to try 
when e.g. fitting <code>value</code> into <code>pems[i,j]</code>: <code>'omit.err.cases'</code>, equivalent to 
<code>TRUE</code>, remove any unknown/unfound <code>i</code> or <code>j</code> terms; <code>'na.pad.insert'</code> expand 
the <code>value</code> to fit larger <code>pems[i,j]</code>, placing <code>NAs</code> in any holes generated; 
<code>'na.pad.target'</code> like previous but expanding <code>pems[i,j]</code> to fit larger <code>value</code>; 
<code>'fill.insert'</code> like <code>'na.pad.inert'</code> but holes are filled by wrapping the supplied 
<code>value</code> within elements and then by element. 
</p>
</td></tr>
<tr><td><code id="3.1.generic.pems.handlers_+3A_simplify">simplify</code></td>
<td>
 
<p>(Logical) <code>simplify</code> returns a <code>pems.element</code> rather than a <code>pems</code> object 
if possible. 
</p>
</td></tr>
<tr><td><code id="3.1.generic.pems.handlers_+3A_id">id</code>, <code id="3.1.generic.pems.handlers_+3A_ignore">ignore</code></td>
<td>
 
<p>(local plot parameters). <code>id</code> identifies which data series to plot; <code>ignore</code> identifies 
which data series to ignore when leaving the choice of <code>id</code> to the function; and, <code>n</code> gives 
the maximum number of data series to plot when leaving the choice of <code>id</code> to the function.
</p>
</td></tr>
<tr><td><code id="3.1.generic.pems.handlers_+3A_rows">rows</code>, <code id="3.1.generic.pems.handlers_+3A_cols">cols</code>, <code id="3.1.generic.pems.handlers_+3A_width">width</code></td>
<td>

<p>(numerics, optional). For <code>print</code>, if supplied, these reset the number of rows and columns 
to table when printing a <code>pems</code> object, and character width to print across.   
</p>
</td></tr>
<tr><td><code id="3.1.generic.pems.handlers_+3A_n">n</code></td>
<td>
 
<p>(various). For <code>plot</code>, sets the maximum number of data series to plot when leaving the choice of 
<code>id</code> to the function. For <code>head</code> or <code>tail</code>, sets the number of rows. 
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Generic functions provide appropriate (conventional) handling of objects of 
<code>'pems'</code> class: 
</p>
<p><code>as.data.frame(pems)</code> extracts the <code>data.frame</code> component of a 
pems object.
</p>
<p><code>dim(pems)</code> extracts the dimensions, row count and column count, 
respectively, of the <code>data.frame</code> component of a pems object. The 
function also allows <code>nrow(pems)</code> and <code>ncol(pems)</code>.  
</p>
<p><code>pems$name</code> extracts the named element from a pems objects 
in a similar fashion to <code>data.frame$name</code>. Likewise, 
<code>pems$name &lt;- value</code> inserts <code>value</code> into a pems objects 
in a similar fashion to <code>data.frame$name &lt;- value</code>.      
</p>
<p><code>pems.object[i, j]</code> extracts the [i,j] elements of the data held in a 
<code>pems</code> object. This is returned as either a <code>pems</code> or <code>pems.element</code> 
object depending on the dimension of the extracted data and the <code>simplify</code> 
setting.
</p>
<p><code>pems.object[i, j]&lt;-</code> insert <code>value</code> into the [i,j] region of the supplied  
<code>pems</code> object. By default this action is strict and mismatching <code>pems[i, j]</code> 
and <code>value</code> dimension produce an error, although mismatching insertions may be 
forced using the <code>force</code> argument.  
</p>
<p><code>pems.object[[k]]</code> extracts structural elements of a pems object: 
<code>data</code>, the <code>data.frame</code>; <code>units</code> the unit table, etc.  
</p>
<p><code>with(pems.object, expression)</code> evaluates the supplied <code>expression</code> 
using the elements of the supplied <code>pems.object</code>. 
</p>
<p><code>subset(pems.object, expression)</code> behaves like 
<code>subset(data.frame, expression)</code>.
</p>
<p><code>print(pems.object)</code> provides a (to console) description of a <code>pems</code> 
object. This forshortens large datasets in a similar fashion to a tibble. 
</p>
<p><code>plot(pems.object)</code> generates a standard R plot using selected data series in 
a <code>pems</code> object.
</p>
<p><code>names(pems.object)</code> returns a vector of the names of data series held in a 
<code>pems</code> object when used in the form <code>names(pems)</code> or resets names when 
used in the form <code>names(pems) &lt;- new.names</code>. 
</p>
<p><code>na.omit(pems.object)</code> returns the supplied <code>pems</code> object with all rows 
including NAs removed. 
</p>
<p><code>summary(pems.object)</code> generates a summary report for data series held in a 
<code>pems</code> object. 
</p>
<p><code>units(pems.object)</code> extracts the units from a supplied <code>pems</code> object 
when used in the form <code>units(pems)</code> or sets/resets units when used in the form 
<code>units(pems) &lt;- new.units</code>. 
</p>


<h3>Note</h3>

<p>The <code>pems</code> object is intended to be a stricter version of a standard R 
<code>data.frame</code>. Unless the user specifically forces the operation, a <code>pems[]</code> 
or <code>pems[]&lt;-</code> call is not allowed unless it fits exactly. So, for example by default 
the call <code>pems[,1]&lt;-10</code> will not place 10 in every row of column one in the 
same fashion as <code>data.frame[,1]&lt;-10</code>. 
</p>
<p>The logic behind this is that columns (elements) of <code>pems</code> objects are time-series. 
So, users would want to place these exactly and avoid any unintended wrapping. The 
<code>force</code> argument should be used in cases where data padding or wrapping operations 
are required. 
</p>
<p><code>pems$name</code> and <code>pems$name&lt;-</code> are not are rigorously managed, so behave more 
like <code>data.frame$name</code> and <code>data.frame$name&lt;-</code> calls, although even these do 
wrap by default.
</p>
<p><code>pems[[]]</code> provides access to structural components of the <code>pems</code> object, 
e.g. <code>pems[["data"]]</code> extracts the <code>data.frame</code> component of the <code>pems</code> 
object, <code>pems[["units"]]</code> extracts the <code>units</code> component, etc. See also 
<code><a href="#topic+pems.structure">pems.structure</a></code>.
</p>


<h3>Author(s)</h3>

<p> Karl Ropkins </p>


<h3>References</h3>

<p>generics in general:
</p>
<p>H. Wickham. Advanced R. CRC Press, 2014.
</p>
<p>(Not yet fully implemented within this package.)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
##example 1
##basics pems handling

#extract a subset pems object from pems.1
a &lt;- pems.1[1:4, 1:5]
a      

#indices work like data.frame
#a[x] and a[,x] recovers element/column number x
#a[x,] recovers row number x
#a["name"] and a[,"name"] recovers element/column named "name"
#a[4:5, "name"] recovers rows 4 to 5 of element/column named "name"
#a[x,y] &lt;- z inserts z into a at row x, element y 
#etc

#insert 10 in at element 3, row 2
a[2,3] &lt;- 10
a

#replace element conc.co2 with conc.co
a["conc.co2"] &lt;- a$conc.co
a

#Note: by default pems objects subsetting and inserting is 
#more rigorous than data.frame subsetting/insertion
#for example, a[1:2, "conc.hc"] &lt;- 8 would generate error
#because the target, a[1:2], and insert, 8, dimensions do not 
#match exactly: target 2 x 1; insert 1 x 1 

#By default no wrapping is applied.  

#the force argument allows the user to control how mismatching 
#targets and insertions are handled

#na pad target for larger insert
a[1:2, "conc.hc", force="na.pad.target"] &lt;- 1:5
a

#Note here when the target is padded existing enteries are NOT 
#overwritten if they are not declared in a[], and the next 
#previously unassigned cells are used for any extra cases in
#the insert.

#wrap insert to fill hole made by a[i,j]  
a[1:2, "conc.hc", force="fill.insert"] &lt;- 8
a

#pems$name &lt;- value is equivalent to 
#pems[name, force=c("na.pad.target", "na.pad.insert")]
a$new &lt;- 1:4
a

</code></pre>

<hr>
<h2 id='3.2.generic.pems.element.handlers'> Generic handling of pems.element objects </h2><span id='topic+3.2.generic.pems.element.handlers'></span><span id='topic+generic.pems.element.handlers'></span><span id='topic+pems.element.generics'></span><span id='topic+print.pems.element'></span><span id='topic+plot.pems.element'></span><span id='topic+plot'></span><span id='topic+units.pems.element'></span><span id='topic+units+3C-.pems.element'></span><span id='topic+summary.pems.element'></span><span id='topic+summary'></span><span id='topic+as.pems.pems.element'></span><span id='topic+round.pems.element'></span><span id='topic+round'></span><span id='topic++5B.pems.element'></span><span id='topic++5B+3C-.pems.element'></span>

<h3>Description</h3>

<p>pems elements objects can be manipulated using generic functions like print, plot and 
summary in a similar fashion to objects of other R classes. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>
## S3 method for class 'pems.element'
 x[i, ..., force = TRUE, wrap = FALSE]

## S3 replacement method for class 'pems.element'
 x[i, ..., force = TRUE, wrap = FALSE] &lt;- value

## S3 method for class 'pems.element'
as.pems(x, ...)

## S3 method for class 'pems.element'
print(x, ..., n = NULL, rows = NULL, width = NULL)

## S3 method for class 'pems.element'
plot(x, y = NULL, xlab = NULL, ylab = NULL, ...)

## S3 method for class 'pems.element'
units(x)

## S3 replacement method for class 'pems.element'
units(x) &lt;- value

## S3 method for class 'pems.element'
summary(object, ...)

## S3 method for class 'pems.element'
round(x, ...)

</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="3.2.generic.pems.element.handlers_+3A_x">x</code>, <code id="3.2.generic.pems.element.handlers_+3A_object">object</code></td>
<td>
 
<p>(An Object of pems.element class). For direct use with <code>print</code>, <code>plot</code>, <code>summary</code>, 
etc. NOTE: Object naming (i.e., <code>x</code> or <code>object</code>) 
is determined in parent or base function in R, so naming 
varies by method.
</p>
</td></tr>
<tr><td><code id="3.2.generic.pems.element.handlers_+3A_i">i</code></td>
<td>
 
<p>Element indices, which operate in a similar fashion to <code>vector</code> indices.
</p>
</td></tr>
<tr><td><code id="3.2.generic.pems.element.handlers_+3A_...">...</code></td>
<td>
 
<p>Addition options, typically passed to associated default method(s).
</p>
</td></tr>
<tr><td><code id="3.2.generic.pems.element.handlers_+3A_force">force</code>, <code id="3.2.generic.pems.element.handlers_+3A_wrap">wrap</code></td>
<td>
 
<p>(Logicals) Data element handling options: <code>force</code> forces data to fit it destination; 
<code>wrap</code> expands data to fit its destination by wrapping the source <code>pems.element</code>.
</p>
</td></tr>
<tr><td><code id="3.2.generic.pems.element.handlers_+3A_value">value</code></td>
<td>

<p>(Vector) For calls in <code>pems.element[1] &lt;- value</code> or <code>units(pems.element) &lt;- value</code>, 
the value to be inserted.
</p>
</td></tr>
<tr><td><code id="3.2.generic.pems.element.handlers_+3A_n">n</code>, <code id="3.2.generic.pems.element.handlers_+3A_rows">rows</code>, <code id="3.2.generic.pems.element.handlers_+3A_width">width</code></td>
<td>

<p>(Numerics) For <code>print(pems)</code>, number of elements, rows or screen width to foreshorten 
print output to. 
</p>
</td></tr>
<tr><td><code id="3.2.generic.pems.element.handlers_+3A_y">y</code>, <code id="3.2.generic.pems.element.handlers_+3A_xlab">xlab</code>, <code id="3.2.generic.pems.element.handlers_+3A_ylab">ylab</code></td>
<td>
 
<p>(other plot arguments). As with the default <code><a href="#topic+plot">plot</a></code> method, <code>y</code> is an optional 
second data verctor, typically numeric, and <code>xlab</code> and <code>ylab</code> are labels to use on 
x and y axes.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Generic functions provide appropriate (conventional) 
handling of objects of <code>'pems.elements'</code> class: 
</p>
<p><code>print(pems.element)</code> provides a (to console) 
description of the supplied <code>pems.element</code> object. 
</p>
<p><code>plot(pems.element)</code> generates a standard R plot 
of the supplied <code>pems.element</code>. 
</p>
<p><code>units(pems.element)</code> extracts the units from the 
supplied <code>pems.element</code>.  
</p>


<h3>Note</h3>

<p>A dedicated <code>round(pems.element)</code> is required as 
a wrapper to <code>round.Date</code> and <code>round.POSIXt</code> 
handling.
</p>


<h3>Author(s)</h3>

<p> Karl Ropkins </p>


<h3>Examples</h3>

<pre><code class='language-R'>
#the velocity pems.element in pems.1
pems.1$velocity

</code></pre>

<hr>
<h2 id='4.1.merge.data.pems'>
Merging data and pems objects
</h2><span id='topic+4.1.merge.data.pems'></span><span id='topic+merge.pems'></span><span id='topic+align'></span><span id='topic+cAlign'></span><span id='topic+tAlign'></span><span id='topic+findLinearOffset'></span><span id='topic+stackPEMS'></span><span id='topic+C_ylagxCOR'></span>

<h3>Description</h3>

<p>Various pems.utils functions to merge data of different types.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>
  #basic alignment
  align(data1, data2, n = 0, ...)
 
  #alignment based on correlation
  cAlign(form, data1 = NULL, data2 = NULL, ...)

  #alignment based on time.stamp
  tAlign(form, data1, data2 = NULL, order=TRUE, ...)

  #basic stacking
  stackPEMS(..., key=key, ordered=TRUE)

  #historical
  findLinearOffset(x = NULL, y = NULL, ...)

  #c wrappers
  C_ylagxCOR(x, y)

</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="4.1.merge.data.pems_+3A_data1">data1</code>, <code id="4.1.merge.data.pems_+3A_data2">data2</code></td>
<td>

<p>(<code>pems</code> or <code>data.frame</code>; optional for <code>cAlign</code>, required for other
alignment functions) <code>pems</code> objects or <code>data.frame</code>s to be aligned. 
</p>
</td></tr>
<tr><td><code id="4.1.merge.data.pems_+3A_n">n</code></td>
<td>

<p>(<code>numeric</code>; required) An offset to be applied to <code>data2</code> when aligning 
<code>data1</code> and <code>data2</code>. The default, <code>n = 0</code>, applies no offset and directly 
aligns the two supplied data sets, first row to first row.  
</p>
</td></tr>
<tr><td><code id="4.1.merge.data.pems_+3A_...">...</code></td>
<td>

<p>(Any other arguments) For <code>stackPEMS</code> this is typically a series of <code>pems</code> objects 
to be stacked. For other functions, this may be passed on but are typically ignored. See Notes.
</p>
</td></tr>
<tr><td><code id="4.1.merge.data.pems_+3A_form">form</code></td>
<td>

<p>(<code>formula</code>; required) A formula identifying the elements in the supplied 
data sets to be used as references for the alignment. This typically takes 
the form, e.g. <code>cAlign(x~y, d1, d2)</code> where <code>d1$x</code> and <code>d2$y</code> 
are the data series to be used to correlation align the two data sets. 
</p>
</td></tr>
<tr><td><code id="4.1.merge.data.pems_+3A_order">order</code></td>
<td>

<p>(<code>logical</code>; optional) If <code>TRUE</code> the function orders the data. 
</p>
</td></tr>
<tr><td><code id="4.1.merge.data.pems_+3A_key">key</code></td>
<td>

<p>(character or NSE) For <code>stackPEMS</code> the name to <code>key</code> column that 
identifies the data sources of elements in a stack of <code>pems</code> objects. 
</p>
</td></tr>
<tr><td><code id="4.1.merge.data.pems_+3A_ordered">ordered</code></td>
<td>

<p>(<code>logical</code>; default <code>TRUE</code>) For <code>stackPEMS</code>, when creating the 
source key should the order <code>pems</code> objects were supplied be retained. 
</p>
</td></tr>
<tr><td><code id="4.1.merge.data.pems_+3A_x">x</code>, <code id="4.1.merge.data.pems_+3A_y">y</code></td>
<td>

<p>(Required objects, various classes) For <code>bindPEMS</code>, two <code>pems</code>, 
<code>data.frame</code>, <code>pems.elements</code> or <code>vectors</code> to be bound together. 
For <code>findLinearOffset</code>, two <code>pems.elements</code> or <code>vectors</code> to be 
aligned.
</p>
</td></tr> 
</table>


<h3>Details</h3>

<p>The <code>align</code> function accepts two <code>pems</code> objects, 
<code>data.frame</code>, etc, and returns a single dataset (as 
a <code>pems</code> object) of the aligned data. An extra argument, 
<code>n</code>, may be supplied to offset the starting row of the 
second data set relative to the first. It is intended to be 
used in the form:
</p>
<p><code>aligned.data &lt;- align(data1, data2)</code>    #aligned row 1-to-1
</p>
<p><code>aligned.data &lt;- align(data1, data2, 3)</code> #row 3-to-1, etc
</p>
<p>The <code>cAlign</code> function accepts a formula and up to two data 
sets and returns a single data set (as a <code>pems</code> object) of 
correlation aligned data. This uses the best fit linear offset 
correlation for the elements identifed in the formula term. 
</p>
<p>It is intended to be used in the form:
</p>
<p><code>aligned.data &lt;- cAlign(name1~name2, data1, data2)</code>
</p>
<p><code>C_ylagxCOR</code> is a wrapper for C++ code used by <code>cAlign</code>. 
</p>
<p>The <code>tAlign</code> function accepts a formula and two data sets 
and returns a single data set (as a <code>pems</code> object) of the 
time stamp aligned data. This is this done by matching entries 
in the elements identifed in the formula term. 
</p>
<p>It is intended to be used in the form:
</p>
<p><code>aligned.data &lt;- tAlign(name1~name2, data1, data2)</code>
</p>
<p>The <code>stackPEMS</code> function stacks two or more <code>pems</code> 
objects and returns a single <code>pems</code> object. <code>stackPEMS</code> 
stacks using <code>dplyr</code> function <code>bind_rows</code> so handles 
<code>pems</code> with column names that do not completely intersect. 
However it also attempts to units match. It is intended to be 
used in the form:
</p>
<p><code>stacked.data &lt;- stackPEMS(data1, data2)</code>
</p>
<p>Historical functions:
</p>
<p><code>findLinearOffset</code> is historical code.  
</p>


<h3>Value</h3>

<p><code>align</code>, <code>cAlign</code>, <code>tAlign</code>, etc all return a 
single object of <code>pem</code> class containing the aligned data 
from <code>data1</code> and <code>data2</code>.
</p>
<p><code>findLinearOffset</code> returns the best fit offset for <code>y</code> 
relative to <code>x</code>. 
</p>


<h3>Note</h3>

<p>These functions are under revision and need to be handled 
with care.
</p>
<p><code>cAlign</code>: By default <code>cAlign</code> generates an alignment 
plot and returns a <code>pems</code> object of aligned data. But it 
also allows several hidden arguments to refine outputs, the 
logicals <code>plot</code>, <code>offset</code> and <code>pems</code>, which turn 
off/on plot, offset and pems reporting individually, and  
<code>output = c("plot", "offset", "pems")</code> or combinations thereof 
also provides a single argument alternative.     
</p>
<p><code>bindPEMS</code>: The historical function <code>bindPEMS</code> has 
been superceded by <code>align</code>. 
</p>
<p><code>findLinearOffset</code>: <code>findLinearOffset</code> is currently 
retained but will most likely be removed from future versions of 
<code>pems.utils</code>. 
</p>
<p>The call <code>cAlign(x~y, output = "offset")</code> is equivalent to 
<code>findLinearOffset(x, y)</code>.
</p>


<h3>Author(s)</h3>

<p>Karl Ropkins
</p>


<h3>References</h3>

<p><code>align</code> uses the <code>dplyr</code> function <code>full_join</code>.         
</p>
<p><code>cAlign</code> function uses the <code>stats</code> function <code>ccf</code>.         
</p>
<p><code>tAlign</code> uses the <code>dplyr</code> function <code>full_join</code>.         
</p>


<h3>See Also</h3>

<p>See also: <code><a href="base.html#topic+cbind">cbind</a></code> for standard column binding in <code>R</code>; 
<code><a href="dplyr.html#topic+dplyr">dplyr</a></code> for <code><a href="#topic+full_join">full_join</a></code>. 
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
###########
##example 1 
###########

##data vector alignment

#make two offset ranges
temp &lt;- rnorm(500)
x &lt;- temp[25:300]
y &lt;- temp[10:200]

#plot pre-alignment data
plot(x, type="l"); lines(y, col="blue", lty=2)

#estimated offset
findLinearOffset(x,y)
#[1] -15

#applying linear offset
ans &lt;- align(x, y, findLinearOffset(x,y))
names(ans) &lt;- c("x", "y")

#plot post-alignment data
plot(ans$x, type="l"); lines(ans$y, col="blue", lty=2)

#shortcut using cAlign
## Not run: 
plot(x, type="l"); lines(y, col="blue", lty=2)
ans &lt;- cAlign(x~y)
plot(ans$x, type="l"); lines(ans$y, col="blue", lty=2)

## End(Not run)


###########
##example 2 
###########

##aligning data sets
##(pems object example)

#make some offset data
p1 &lt;- pems.1[101:200, 1:5]
p2 &lt;- pems.1[103:350, 1:3]

#correlation alignment using ccf 
ans &lt;- cAlign(~conc.co, p1, p2)

#this aligns by comparing p1$conc.co and p2$conc.co
#and aligning at point of best linear regression fit

## Not run: 

#compare:

cAlign(~conc.co, p2, p1)
cAlign(conc.co2~conc.co, p1, p2)
#(aligns using p1$conc.co2 and p2$conc.co)
cAlign(conc.co2~conc.co, p1)
#(realigns just conc.co within p1 based on best fit 
# with conc.co2 and returns as output ans) 

#time stamp alignment  
tAlign(~time.stamp, p1, p2)

#this aligns by pairing elements in p1$time.stamp 
#and p2$time.stamp
#(if time stamps have different names 
# tAlign(time1~time2, p1, p2), the time stamp name 
# from p1 would be retained when merging p1$time1 
# and p2$time2, generating [output]$time1)  


## End(Not run)

###########
##example 3 
###########

##stacking pems

#make some offset data
p1 &lt;- pems.1[1:2, 1:4]
p2 &lt;- pems.1[3, 2:4]
p3 &lt;- pems.1[4:6, 1:3]

#stack  
stackPEMS(p1, p2, p3, key=source)

</code></pre>

<hr>
<h2 id='4.2.referencing.pems.data'>
Data Referencing Functions.
</h2><span id='topic+4.2.referencing.pems.data'></span><span id='topic+referencing.pems.data'></span><span id='topic+refRow'></span><span id='topic+refX'></span><span id='topic+refEngineOn'></span><span id='topic+refDrivingMode'></span>

<h3>Description</h3>

<p>Various functions for grouping, subsetting, filtering 
and conditioning datasets.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>
refRow(ref = NULL, n = 4, breaks = NULL, 
        data = NULL, ..., labels = NULL,
        fun.name = "refRow")

refX(ref = NULL, n = 4, breaks = NULL, 
        method = "percentile", 
        data = NULL, ..., labels = NULL,
        fun.name = "refX")
        
refEngineOn(rpm = NULL, data = NULL, 
        threshold = 200, ..., labels = NULL, 
        fun.name = "refEngineOn")
        
refDrivingMode(speed = NULL, accel = NULL,
        time = NULL, data = NULL, 
        threshold.speed = 0.1, 
        threshold.accel = 0.1,
        ..., labels = NULL, 
        fun.name = "refDrivingMode")

</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="4.2.referencing.pems.data_+3A_ref">ref</code></td>
<td>

<p>(Data series, typically vector) The reference data-series 
to consider when making a vector of subset 
markers/indices. See Details.
</p>
</td></tr> 
<tr><td><code id="4.2.referencing.pems.data_+3A_n">n</code>, <code id="4.2.referencing.pems.data_+3A_breaks">breaks</code></td>
<td>

<p>(numerics) With <code>refRow</code> and <code>refX</code>, 
<code>n</code> sets the number of equal intervals to 
attempt to cut the data into. With <code>refRow</code>, 
<code>breaks</code> sets the rows at which to cut 
the data at. With <code>refX</code>, <code>breaks</code> sets 
the values of <code>ref</code> to cut the data at. In both 
cases, if both <code>n</code> and <code>breaks</code> are set, 
<code>breaks</code> is applied. 
</p>
</td></tr>
<tr><td><code id="4.2.referencing.pems.data_+3A_data">data</code></td>
<td>

<p>(Optional <code>data.frame</code> or <code>pems</code> object) The 
data source if <code>ref</code> is supplied in either 
a <code>data.frame</code> or <code>pems</code> object.
</p>
</td></tr> 
<tr><td><code id="4.2.referencing.pems.data_+3A_...">...</code></td>
<td>

<p>(Optional) Other arguments, currently passed on to 
<code>pems.utils</code> management functions.
</p>
</td></tr>
<tr><td><code id="4.2.referencing.pems.data_+3A_labels">labels</code></td>
<td>

<p>(Vector, typically Character) a vector of labels to be 
assigned to the reference regions. 
</p>
</td></tr> 
<tr><td><code id="4.2.referencing.pems.data_+3A_fun.name">fun.name</code></td>
<td>

<p>(function managment argument) <code>fun.name</code> is the 
name of the parent function, to be used in 
error messaging. 
</p>
</td></tr>
<tr><td><code id="4.2.referencing.pems.data_+3A_method">method</code></td>
<td>

<p>(Various) For <code>refX</code>, the method to use when 
cutting data. If character vector, <code>'percentile'</code> 
or <code>'range'</code>. If function, it should be in form 
<code>function(ref, n)</code>, and return breaks.
</p>
</td></tr>
<tr><td><code id="4.2.referencing.pems.data_+3A_rpm">rpm</code></td>
<td>

<p>For <code>refEngineOn</code>, the input, assumed to be engine 
speed and expected to have units of rpm. 
</p>
</td></tr>
<tr><td><code id="4.2.referencing.pems.data_+3A_threshold">threshold</code></td>
<td>

<p>For <code>refEngineOn</code>, the signal threshold above which 
the vehicle engine is assumed to be on.
</p>
</td></tr>
<tr><td><code id="4.2.referencing.pems.data_+3A_speed">speed</code>, <code id="4.2.referencing.pems.data_+3A_accel">accel</code>, <code id="4.2.referencing.pems.data_+3A_time">time</code></td>
<td>

<p>For <code>refDrivingMode</code>, possible inputs. Strictly, 
<code>refDrivingMode</code> needs <code>speed</code> and <code>accel</code> 
but can use <code>speed</code> and <code>time</code> to build 
<code>accel</code>. 
</p>
</td></tr>
<tr><td><code id="4.2.referencing.pems.data_+3A_threshold.speed">threshold.speed</code>, <code id="4.2.referencing.pems.data_+3A_threshold.accel">threshold.accel</code></td>
<td>

<p>For <code>refDrivingMode</code>, the speed and acceleration 
signal thresholds. Below these thresholds the signals are 
assumed to be noise and the vehicle is not moving or 
accelerating, respectively. 
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>ref...</code> functions generate a vector 
of subset markers or indices based of the referencing  
method applied and the length of <code>ref</code>. 
See Value regarding outputs.
</p>
<p><code>refRow</code> assigns reference regions based on row 
number. Because row depends on the length of the 
<code>ref</code> element independent of values, this is a 
unique case where <code>ref</code> can be either a vector or 
a data set (<code>pems</code>, <code>data.frame</code>). It accepts 
<code>n</code> to set the number of cases to make or 
<code>breaks</code> to set break-points at specific rows.
</p>
<p><code>refX</code> assigns reference regions based on the value 
of a supplied data-series.It accepts <code>n</code> to set the 
number of cases to make or <code>breaks</code> to set the 
<code>ref</code> values to make break-points. If using <code>n</code>,
<code>method</code> used to assign cut method, e.g. 
<code>'percentile'</code> or <code>'range'</code>.
</p>
<p><code>refEngineOn</code> assigns reference regions based on 
engine operation status. It uses the input, which it assumes 
is engine speed, and assumes reported engine speeds larger 
than the supplied threshold, by default 200 rpm, indicate 
that the engine is on.
</p>
<p><code>refDrivingMode</code> assigns reference regions based on 
vehicle driving mode. It uses inputs, assumed to be 
<code>speed</code>, <code>accel</code> and/or <code>accel</code>, and 
associated threshold to characterize activity as 
<code>decel</code>, <code>idle</code>, <code>cruise</code> or <code>accel</code>. 
</p>


<h3>Value</h3>

<p>By default results are returned as 
<code><a href="#topic+pems.element">pems.element</a></code>s. 
</p>
<p>The reference vector generated by <code>ref...</code> 
functions can then be used to group, subset, filter 
or condition data in <code>pems</code> objects.
</p>
<p><code>refRow</code> assigns reference according to row number, 
and, by default, reference labels show <code>start row</code> and 
<code>end row</code> of the referenced case. 
</p>
<p><code>refX</code> assigns reference according to value of supplied 
input, and, by default, reference labels show 
<code>lower value</code> and <code>higher value</code> of the referenced 
case.
</p>
<p><code>refEngineOn</code> assigns reference according to engine 
operation status based on engine speed, and, by default, 
reference labels are <code>'on'</code> or <code>'off'</code>.
</p>
<p><code>refDrivingMode</code> assigns reference according to vehicle
driving mode, based on vehicle speed, acceleration and 
associated thresholds, and, by default, 
reference labels are <code>decel</code>, <code>idle</code>, 
<code>cruise</code> and <code>accel</code>.
</p>


<h3>Note</h3>

<p>With <code>refRow</code>, If <code>n</code> is applied and the length 
of <code>ref</code> is not exactly divisible by <code>n</code> 
a best attempt is made.
</p>
<p>With <code>refX</code>, if <code>breaks</code> are at values that are 
duplicated, all same values are assigned to the same (lower) 
value case, so e.g. <code>'percentile'</code> may vary significantly 
if break-point values are highly duplicated in <code>ref</code>
</p>


<h3>Author(s)</h3>

<p>Karl Ropkins
</p>


<h3>References</h3>

<p>References in preparation.
</p>


<h3>See Also</h3>

<p><code><a href="base.html#topic+cut">cut</a></code>, etc. in the main R package.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
###########
##example 1 
###########

#basic usage

#working with a temporary pems

temp &lt;- pems.1

#cut into equal subsets

temp$ref &lt;- refRow(velocity, n= 5, data=temp)
pemsPlot(local.time, velocity, cond=ref, data=temp, 
             type="l", layout=c(1,5))

#cut at three points

temp &lt;- pems.1
temp$ref &lt;- refRow(velocity, breaks=c(180,410,700), 
             data=temp)

pemsPlot(local.time, velocity, cond=ref, data=temp, 
             type="l", layout=c(1,5))

</code></pre>

<hr>
<h2 id='4.3.time.handlers'>
pems Data Time Handlers
</h2><span id='topic+4.3.time.handlers'></span><span id='topic+time.handlers'></span><span id='topic+regularize'></span><span id='topic+repairLocalTime'></span>

<h3>Description</h3>

<p>Time handlers are subset of <code>pems.utils</code> functions that 
work on or with time records (<code>time.stamp</code> and 
<code>local.time</code>).  
</p>


<h3>Usage</h3>

<pre><code class='language-R'>
regularize(data, Hz=1, ...)

repairLocalTime(data, local.time, ref, ..., reset.count = TRUE,
      fun.name = "repairLocalTime")

</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="4.3.time.handlers_+3A_data">data</code></td>
<td>

<p>(Required, typically <code>pems</code>) The dataset to be worked with. 
For <code>regularize</code>, the dataset to regularize (see below). 
</p>
</td></tr>
<tr><td><code id="4.3.time.handlers_+3A_hz">Hz</code></td>
<td>

<p>(For <code>regularize</code>) (Required numeric) The time resolution to 
regularize the data to in Hertz. So, the default, <code>Hz=1</code> is 
one measurement (or row of data) per second.  
</p>
</td></tr>
<tr><td><code id="4.3.time.handlers_+3A_...">...</code></td>
<td>

<p>(Optional) Other arguments, typically passed on. 
</p>
</td></tr>
<tr><td><code id="4.3.time.handlers_+3A_local.time">local.time</code></td>
<td>

<p>(For <code>repairLocalTime</code>) (Required pems.element) The 
<code>local.time</code> <code>pems.element</code> to work been repaired. 
</p>
</td></tr>
<tr><td><code id="4.3.time.handlers_+3A_ref">ref</code>, <code id="4.3.time.handlers_+3A_reset.count">reset.count</code></td>
<td>

<p>(For <code>repairLocalTime</code>) (Other arguments) <code>ref</code> is 
a second source that local.time can be inferred from in cases 
where <code>local.time</code> records are missing. If <code>TRUE</code>, 
<code>reset.count</code> resets <code>local.time</code> so it starts at 0. 
</p>
</td></tr>
<tr><td><code id="4.3.time.handlers_+3A_fun.name">fun.name</code></td>
<td>

<p>(<code>character</code>) (<code>pems</code> handler) argument used by 
<code>pems.utils</code>. These can typically be ignored. 
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>regularize</code> attempts to extrapolate a regular series, generated at the 
time resolution requested, from the supplied <code>data</code>. It can be useful 
for the regularization of irregularly time-logged data and 
for hole-filling missing records but should not be used aggressively, 
to convert 1Hz to 10Hz data.  
</p>
<p><code>repairLocalTime</code> attempts to repair an incomplete <code>local.time</code> 
record. For example, if you merge two datasets with overlapping but 
different time ranges, one may not track the time range of the other and 
this can generate incomplete time records. This function attempts to 
hole-fill such cases.
</p>


<h3>Value</h3>

<p><code>regularize</code> returns the supplied dataset (<code>data</code>) with time-series 
(<code>time.stamp</code> and <code>local.time</code>) are regularized at the 
requestion time resolution, based on <code>Hz</code> value. It uses 
<code>approx</code> the estimate associated changes for other data-series.
</p>
<p><code>repairLocalTime</code> returns a repaired <code>local.time</code> 
<code>pem.element</code>, typically the supplied <code>local.time</code> with 
any holes (<code>NAs</code>) it can fill filled. 
</p>


<h3>Note</h3>

<p>All time handlers should be used with care.  
</p>


<h3>Author(s)</h3>

<p>Karl Ropkins
</p>


<h3>References</h3>

<p><code>regularize</code> uses <code>approx</code>:
</p>
<p>Base R Stats package function based on Becker, R. A., Chambers, 
J. M. and Wilks, A. R. (1988) The New S Language. Wadsworth &amp; 
Brooks/Cole.  
</p>
<p>A lot of leg-work testing <code>regularize</code> was done by then Leeds 
MSc Student Adrian Felipe Ortega Calle.  
</p>


<h3>See Also</h3>

<p><code><a href="stats.html#topic+approx">approx</a></code> regarding data regularization methods.
</p>

<hr>
<h2 id='4.4.unit.handlers'>
data unit handlers 
</h2><span id='topic+4.4.unit.handlers'></span><span id='topic+pems.units'></span><span id='topic+getUnits'></span><span id='topic+setUnits'></span><span id='topic+convertUnits'></span><span id='topic+addUnitConversion'></span><span id='topic+addUnitAlias'></span><span id='topic+listUnitConversions'></span>

<h3>Description</h3>

<p>Various pems.utils functions for the management of data units.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>
getUnits(input = NULL, data = NULL, ..., 
         if.missing = c("stop", "warning", "return"))

setUnits(input = NULL, units = NULL, data = NULL, ..., 
         if.missing = c("stop", "warning", "return"), 
         output = c("input", "data.frame", "pems", "special"),
         force = FALSE, overwrite = FALSE)

convertUnits(input = NULL, to = NULL, from = NULL, data = NULL, ..., 
         if.missing = c("stop", "warning", "return"), 
         output = c("input", "data.frame", "pems", "special"), 
         unit.conversions = NULL, force = FALSE, overwrite = FALSE)

#local unit.conversion method handling 

addUnitConversion(to = NULL, from = NULL, conversion = NULL, 
         tag = "undocumented",
         unit.conversions = ref.unit.conversions, ...,
         overwrite = FALSE)

addUnitAlias(ref = NULL, alias = NULL, 
         unit.conversions = ref.unit.conversions, ...)

listUnitConversions(unit.conversions = ref.unit.conversions, ...,
         verbose = FALSE, to = NULL, from = NULL)

</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="4.4.unit.handlers_+3A_input">input</code></td>
<td>

<p>(vector, object or object element) An input, e.g. a vector of speed measurements. 
</p>
</td></tr> 
<tr><td><code id="4.4.unit.handlers_+3A_data">data</code></td>
<td>

<p>(data.frame, pems object) If supplied, the assumed source for an <code>input</code>. This 
can currently be a standard <code>data.frame</code> or a <code>'pems' object</code>. Note: if 
an <code>input</code> is not found in <code>data</code>, the parent environment is then also 
checked before returning an error message.
</p>
</td></tr>
<tr><td><code id="4.4.unit.handlers_+3A_units">units</code>, <code id="4.4.unit.handlers_+3A_to">to</code>, <code id="4.4.unit.handlers_+3A_from">from</code>, <code id="4.4.unit.handlers_+3A_ref">ref</code>, <code id="4.4.unit.handlers_+3A_alias">alias</code>, <code id="4.4.unit.handlers_+3A_tag">tag</code></td>
<td>

<p>(Character vectors). Unit ids. <code>units</code> sets the units of <code>input</code> in <code>setUnits</code>. 
<code>to</code> sets the units to convert <code>input</code> to when using <code>convertUnits</code>. The additional 
arguments <code>from</code> can be used to apply unit conversions to <code>inputs</code> with un-defined or 
mismatched units, but requires the extra argument <code>force = TRUE</code> to confirm action. When working 
with local unit conversions <code>to</code> and <code>from</code> should be used to identify specific conversions, 
e.g. when using <code>addUnitConversion</code> to add a new unit conversion method, and <code>ref</code> and 
<code>alias</code> should be used to identify a current unit id and new alias, respectively, when using 
<code>addUnitAlias</code>. <code>tag</code> is an optional more detailed conversion description, intended for 
use in method documentation. (See Below for further details.) 
</p>
</td></tr>
<tr><td><code id="4.4.unit.handlers_+3A_...">...</code></td>
<td>

<p>(Optional) Other arguments, currently ignored.
</p>
</td></tr>
<tr><td><code id="4.4.unit.handlers_+3A_if.missing">if.missing</code></td>
<td>

<p>(Optional character vector) What the function should do if things do not go as expected. Current 
options include: <code>"stop"</code> to stop the function with an error message; <code>"warning"</code> to 
warn users that expected information was missing but to continue running the parent code; or 
<code>"return"</code> to continue running the parent code without any warnings.
</p>
</td></tr>
<tr><td><code id="4.4.unit.handlers_+3A_output">output</code></td>
<td>

<p>(Character vector) Output mode for function results. Options currently include: <code>special</code>, 
<code>input</code>, <code>data.frame</code>, and <code>pems</code>. See <code>force</code>, <code>overwrite</code> and Values 
below for further details. 
</p>
</td></tr>
<tr><td><code id="4.4.unit.handlers_+3A_force">force</code></td>
<td>

<p>(Logical) Should a unit change to attempted even if checking indicates a mismatch, e.g. an attempt to 
set the units of an <code>input</code> that already has units assigned.  
</p>
</td></tr>
<tr><td><code id="4.4.unit.handlers_+3A_overwrite">overwrite</code></td>
<td>

<p>(Logical) If 'same name' cases are encountered when packing/repacking an <code>output</code> into a 
<code>data.frame</code> or <code>pems</code> object, should the function overwrite the case in the target 
<code>data.frame</code> or <code>pems</code> object with the modified <code>input</code>? (If <code>FALSE</code>, a 
new element is generated with a unique name in the form <code>[input.name].number</code>.)
</p>
</td></tr>
<tr><td><code id="4.4.unit.handlers_+3A_unit.conversions">unit.conversions</code></td>
<td>

<p>(Optional list) If supplied, <code>unit.conversions</code> is a 'look up' table for unit conversion 
methods. By default, functions in <code>pems.utils</code> use the reference 
<code><a href="#topic+ref.unit.conversions">ref.unit.conversions</a></code>, but this can be copied to the workspace and updated to provide 
the user with a means of updating and expanding the method set. 
</p>
</td></tr>
<tr><td><code id="4.4.unit.handlers_+3A_conversion">conversion</code></td>
<td>

<p>(Numeric or function) When adding or updating a conversion method using <code>addUnitConversion</code>, the 
conversion method. This can be a numeric, in which case it is assumed to be a multiplication factor (and 
converted to a function in the form <code>function(x) x * conversion</code>) or a function to be applied directly 
to an <code>input</code>.    
</p>
</td></tr>
<tr><td><code id="4.4.unit.handlers_+3A_verbose">verbose</code></td>
<td>

<p>(Logical) For <code>listUnitConversions</code>. Should <code>unit.conversions</code> be reported in detail? By default 
(<code>verbose = FALSE</code>) only unit conversion <code>tags</code> are reported.       
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>getUnits</code> returns the units of an <code>input</code>.
</p>
<p><code>setUnits</code> sets/resets the units of an <code>input</code>.
</p>
<p><code>convertUnits</code> converts the units of an <code>input</code>.     
</p>
<p><code>addUnitConversion</code> adds a conversion method to a local version 
of the unit conversion look-up table. Methods should be supplied as 
<code>to</code> and <code>from</code> unit ids and an associated <code>conversion</code>.
A <code>tag</code> can also be supplied to provide a more detailed description 
of the conversion for use in documentation.   
</p>
<p><code>addUnitAlias</code> adds an alias for an existing unit id in a local version 
of the unit conversion look-up table. The existing unit id should be identified 
using <code>ref</code> and the new alias should be assinged using <code>alias</code>. The 
<code>alias</code> is added to all <code>to</code> and <code>from</code> elements containing 
<code>ref</code> to allow users to work with alternative unit abbreviations.
</p>
<p><code>listUnitConversions</code> lists the methods a supplied unit conversion look-up table. 
If <code>to</code> and/or <code>from</code> arguments are also supplied, these are used to 
subsample relevant methods. 
</p>


<h3>Value</h3>

<p><code>getUnits</code> returns the units of an <code>input</code> as a character vector if available, 
else it returns <code>NULL</code>. 
</p>
<p><code>setUnits</code> sets the units of an <code>input</code> to a supplied value, <code>units</code>, if they have 
not already be set or if <code>force = TRUE</code>. The result is returned as the modified <code>input</code> alone, 
the modified <code>input</code> as an element in a <code>data.frame</code>, or the modifed <code>input</code> as 
an element in a <code>pems</code> object (depending on <code>output</code> setting). If either a 
<code>data.frame</code> or <code>pems</code> object is supplied as <code>data</code>, this is used as the target 
when repacking the <code>output</code>. (Note: <code>output = "special"</code> is a special case which allows the 
function to select the <code>output</code> mode based on the type of <code>data</code> supplied.
</p>
<p><code>convertUnits</code> converts the units of an <code>input</code>. Typically, this is done by setting the 
required new units, using <code>to</code>, and letting the function select a suitable conversion method. However, 
conversions can be forced by setting <code>from</code> and <code>force = TRUE</code> to apply a specifc 
<code>to</code>/<code>from</code> method to an <code>input</code> regardless of the actual <code>units</code> of <code>input</code>. 
As with <code>setUnits</code>, results can be <code>output</code> as <code>input</code>, <code>data.frame</code> or <code>pems</code> 
objects.
</p>
<p><code>addUnitConversion</code> returns a supplied unit conversion look-up table (or in its absence the reference 
<code>ref.unit.conversions</code>) subject to the requested addition or update. Note: modifications that change 
exist information require the extra argument <code>overwrite = TRUE</code> as confirmation. 
</p>
<p><code>addUnitAlias</code> returns a supplied unit conversion look-up table (or in its absence the reference 
<code>ref.unit.conversions</code>) subject to the requested alias addition. 
</p>
<p><code>listUnitConversions</code> returns summary descriptions of methods in the supplied unit conversion look-up 
table (or in its absence the reference <code>ref.unit.conversions</code>). Additional arguments, <code>to</code> and 
<code>from</code>, can be used to select unit conversions of particular relevance.  
</p>


<h3>Note</h3>

<p>This set of functions is intended to provide a flexible framework for the routine handling of 
data units. 
</p>


<h3>Author(s)</h3>

<p>Karl Ropkins
</p>


<h3>References</h3>

<p>References in preparation
</p>


<h3>See Also</h3>

<p><code><a href="#topic+pems.element">pems.element</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
###########
##example 1 
###########

#work with data units

#getting units (where assigned)
getUnits(velocity, pems.1) #km/h

#setting units
a &lt;- 1:10
a &lt;- setUnits(a, "km/h") #add unit 

#alternaltive 
#using pems.element
#a &lt;- pems.element(a, units="km/h", name = "a") 

#changing units
convertUnits(a, "mi/h")

# [1] 0.6213712 1.2427424 1.8641136 2.4854848 3.1068560 3.7282272 4.3495983
# [8] 4.9709695 5.5923407 6.2137119
# pems.element; [unnamed] [mi/h] [n = 10]

###########
##example 2
###########

#working with local unit conversions
#adding/updating unit conversion methods

#make a local reference
ref.list &lt;- ref.unit.conversions 

#add a miles/hour alias to mi/h
ref.list &lt;- addUnitAlias("mi/h", "miles/hour", ref.list)

#add a new conversion
ref.list &lt;- addUnitConversion(to = "silly", from = "km/h", 
                              conversion = function(x) 12 + (21 * x), 
                              tag = "kilometers/hour to some silly scale",
                              unit.conversions = ref.list)

#use these
convertUnits(a, "miles/hour", unit.conversions = ref.list)

# [1] 0.6213712 1.2427424 1.8641136 2.4854848 3.1068560 3.7282272 4.3495983
# [8] 4.9709695 5.5923407 6.2137119
# units: "miles/hour" (as above but using your unit abbreviations)

convertUnits(a, "silly", unit.conversions = ref.list)

# [1]  33  54  75  96 117 138 159 180 201 222
# units: "silly" (well, you get what you ask for)

</code></pre>

<hr>
<h2 id='5.1.pems.plots'>
Various plots for pems.utils
</h2><span id='topic+5.1.pems.plots'></span><span id='topic+pems.plots'></span><span id='topic+latticePlot'></span><span id='topic+panel.PEMSXYPlot'></span><span id='topic+XYZPlot'></span><span id='topic+pemsPlot'></span><span id='topic+panel.pemsPlot'></span><span id='topic+preprocess.pemsPlot'></span><span id='topic+pemsXYZCondUnitsHandler'></span><span id='topic+panel.routePath'></span><span id='topic+WatsonPlot'></span><span id='topic+preprocess.WatsonPlot'></span><span id='topic+panel.WatsonBinPlot'></span><span id='topic+panel.WatsonContourPlot'></span><span id='topic+panel.WatsonSmoothContourPlot'></span>

<h3>Description</h3>

<p>Various plot functions and visualization tools 
for use with <code>pems</code> objects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>
#pemsPlot

pemsPlot(x, y = NULL, z = NULL, groups = NULL, 
         cond = NULL, ..., data = NULL, 
         units = TRUE, multi.y = "special", 
         fun.name="pemsPlot",
         panel = panel.pemsPlot, scheme = pems.scheme)

#associated functions

pemsXYZCondUnitsHandler(x, y = NULL, z = NULL, 
         cond = NULL, groups = NULL, data = NULL, 
         units = TRUE, ..., 
         fun.name = "pemsXYZCondHandler")

preprocess.pemsPlot(lattice.like = lattice.like, 
         units = units, ...)

panel.pemsPlot(..., loa.settings = FALSE)

panel.routePath(..., loa.settings = FALSE)

#WatsonPlot

WatsonPlot(speed, accel = NULL, z = NULL, ..., 
         data = NULL, cond = NULL, units = TRUE, 
         plot.type = 2, fun.name="WatsonPlot",
         scheme = pems.scheme)

#associated functions

preprocess.WatsonPlot(lattice.like = lattice.like, ...)

panel.WatsonBinPlot(..., ref.line = TRUE, 
         process.panel = panel.binPlot, 
         plot.panel = panel.binPlot, 
         omit.stopped = FALSE, process = TRUE, 
         plot = TRUE, loa.settings = FALSE)

panel.WatsonContourPlot(..., 
         plot.panel=panel.kernelDensity, process = TRUE, 
         plot = TRUE, loa.settings = FALSE)

panel.WatsonSmoothContourPlot(..., 
         plot.panel=panel.surfaceSmooth,           
         process = TRUE, plot = TRUE, 
         loa.settings = FALSE)
 
#old plots

latticePlot(x = NULL, data = NULL, plot = xyplot, 
         panel = NULL,  ..., greyscale = FALSE, 
         fun.name = "latticePlot")

panel.PEMSXYPlot(..., grid=NULL)

XYZPlot(x = NULL, ..., data = NULL, statistic = NULL, 
         x.res = 10, y.res = 20, plot = levelplot,
        fun.name = "XYZPlot")

</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="5.1.pems.plots_+3A_x">x</code>, <code id="5.1.pems.plots_+3A_y">y</code>, <code id="5.1.pems.plots_+3A_z">z</code>, <code id="5.1.pems.plots_+3A_groups">groups</code>, <code id="5.1.pems.plots_+3A_cond">cond</code></td>
<td>

<p>(Various) The main plot elements. <code>x</code> and 
<code>y</code> are typically plot coordinates. 
<code>z</code> is any additional information that could 
be used , e.g. to modify points plotted at 
<code>(x,y)</code> coordinates or generate a third axis 
for a surface plot. <code>groups</code> and <code>cond</code> 
are plot grouping and conditioning terms that can 
be used to subset the supplied data and/or generate 
multiple plot panels. See Below.
</p>
<p>For new plots, these should be supplied individually, 
e.g. for <code>pemsPlot</code>:
</p>
<p><code>pemsPlot(x, y, z, groups, cond)</code> 
</p>
<p>For old plots, these must be formulae.         
</p>
<p>For <code>latticePlot</code> the basic formula structure 
is <code>y ~ x | cond</code>. 
</p>
<p>For <code>XYZPlot</code> the basic formula structure is 
<code>z ~ y * x | cond</code>. <code>z</code> is optional, but 
when it is not supplied <code>z</code> it is treated 
as the bin count. 
</p>
<p>See Notes and Examples.  
</p>
</td></tr> 
<tr><td><code id="5.1.pems.plots_+3A_data">data</code></td>
<td>

<p>(Optional <code>data.frame</code> or <code>pems</code> object) 
For most plots, the data source for plot elements, 
e.g <code>x</code>, <code>y</code>, <code>z</code>, etc, if these are 
not supplied directly or accessible from the 
current workspace.
</p>
</td></tr> 
<tr><td><code id="5.1.pems.plots_+3A_units">units</code></td>
<td>

<p>(Optional <code>logical</code> or <code>list</code>) for 
<code>pemsPlot</code> only, unit handling information. 
By default, <code>pems.utils</code> adds any known units 
to plot labels and allows in-plot unit 
management. Unit management is handled by 
<code>convertUnits</code>, and requested conversions 
need to assigned to an axis. So, for example, the 
call <code>pemsPlot(..., x.to="m/s")</code> 
would generate a plot with the x-axis in units of 
m/s (assuming <code>pems.utils</code> knows 
the unit conversion and the x-axis data series is 
in units that can be converted). All unit management 
and associated figure labelling can disabled using 
<code>units = FALSE</code>, or unit suffixes 
can be removed but unit management retained using 
<code>units.add.to.labels = FALSE</code>. 
</p>
</td></tr>
<tr><td><code id="5.1.pems.plots_+3A_multi.y">multi.y</code></td>
<td>

<p>(character) <code>pems.plots</code> accepted multiple 
<code>y</code> data-series if passed using <code>cpe</code>, 
e.g. <code>y = cpe(a,b)</code>. <code>multi.y</code> sets how 
these are handled, options include <code>'groups'</code>, 
<code>'cond'</code> and <code>'special'</code> (the default), 
which selects groups if not used in plot call else 
cond. 
</p>
</td></tr>
<tr><td><code id="5.1.pems.plots_+3A_...">...</code></td>
<td>

<p>(Optional) Other arguments, typically passed on.
</p>
</td></tr>
<tr><td><code id="5.1.pems.plots_+3A_fun.name">fun.name</code></td>
<td>

<p>(Function management argument) <code>pems.utils</code> 
management settings, can typically be ignored by 
most users.
</p>
</td></tr>
<tr><td><code id="5.1.pems.plots_+3A_panel">panel</code>, <code id="5.1.pems.plots_+3A_plot.panel">plot.panel</code>, <code id="5.1.pems.plots_+3A_process.panel">process.panel</code></td>
<td>

<p>(Functions) These functions are used to generate 
the content of individual plot panels. 
Typically, all in-panel data processing and plotting 
is carried out using <code>panel</code>. However, these 
steps can be handled by separate functions if these 
are supplied as 
<code>plot.panel</code> and <code>process.panel</code>.  
</p>
</td></tr>
<tr><td><code id="5.1.pems.plots_+3A_scheme">scheme</code></td>
<td>

<p>(<code>character</code> or <code>list</code>) The default 
coloring scheme for the plot. See Note 
below.
</p>
</td></tr>
<tr><td><code id="5.1.pems.plots_+3A_lattice.like">lattice.like</code>, <code id="5.1.pems.plots_+3A_plot">plot</code>, <code id="5.1.pems.plots_+3A_process">process</code>, <code id="5.1.pems.plots_+3A_loa.settings">loa.settings</code></td>
<td>

<p>(Various) Plot management elements. These can 
typically be ignored by most users, but 
allow plot developers to fine-tune plots. See 
Details below.
</p>
</td></tr>
<tr><td><code id="5.1.pems.plots_+3A_speed">speed</code>, <code id="5.1.pems.plots_+3A_accel">accel</code></td>
<td>

<p>(Various) For <code>WatsonPlot</code>, the <code>x</code> and 
<code>y</code> terms, speed and acceleration, 
respectively. 
</p>
</td></tr>
<tr><td><code id="5.1.pems.plots_+3A_ref.line">ref.line</code></td>
<td>

<p>(Logical or list) For <code>WatsonPlot</code>. This 
argument manages the speed = 0 reference 
added to WatsonPlots. It can be either a logical 
(<code>TRUE</code>/<code>FALSE</code>), to turn the 
line on or off, or a list of parameters to set 
the properties of the line.
</p>
</td></tr>
<tr><td><code id="5.1.pems.plots_+3A_omit.stopped">omit.stopped</code></td>
<td>

<p>(Logical or character) For WatsonPlot, how to 
handle idling data: <code>FALSE</code> include 
in plot; <code>TRUE</code> or <code>'points'</code> removes 
idle points before plotting; <code>'cell'</code> or 
<code>'cells'</code> removes any cells that include 
idling points before the data is binned.   
</p>
</td></tr> 
<tr><td><code id="5.1.pems.plots_+3A_plot.type">plot.type</code></td>
<td>

<p>(numeric) For WatsonPlot, pre-set plot types: 
<code>1</code> scatter plot; <code>2</code> bin plot; 
<code>3</code> contour plot of binned data; <code>4</code> 
smoothed surface of binned data. 
See also <code>statistic</code>     
</p>
</td></tr> 
<tr><td><code id="5.1.pems.plots_+3A_greyscale">greyscale</code></td>
<td>

<p>(Logical) For older plots only, should the plot 
be greyscale by default? This option resets 
the <code>lattice</code> color themes to greyscale while 
the plot is beging generated. So: (1) 
This only effects the plot itself, not subsequent 
plots; and, (2) any user resets overwrite 
this, e.g. <code>latticePlot(..., greyscale=TRUE, 
  col="red")</code> will place red symbols on an 
overwise greyscale plot. Newer plots use the 
alternative <code>plot(..., scheme = "greyscale")</code>.
</p>
</td></tr>
<tr><td><code id="5.1.pems.plots_+3A_grid">grid</code></td>
<td>

<p>(List) If supplied, a list of plot parameters to be 
used to control the appearance of the 
grid component of the plot. See Below.
</p>
</td></tr>
<tr><td><code id="5.1.pems.plots_+3A_statistic">statistic</code></td>
<td>

<p>(Function) when binning data with <code>XYZPlot</code> 
and <code>WatsonPlot</code>, the function to use when 
evaluating the elements of each data bin. By 
default, <code>length</code> is used if <code>z</code> is 
not supplied to generate a frequency plot and 
<code>mean</code> is used if <code>z</code> is supplied to 
generate a bin average plot. 
</p>
</td></tr>
<tr><td><code id="5.1.pems.plots_+3A_x.res">x.res</code>, <code id="5.1.pems.plots_+3A_y.res">y.res</code></td>
<td>

<p>(Numerics) when binning data with <code>XYZPlot</code>, 
the number of x- and y-axis bins to 
generate. 
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>pems.utils</code> includes conventional (generic) 
<code>plot</code> methods for <code>pems</code> and 
<code>pems.element</code> objects. See 
<code><a href="#topic+plot.pems">plot.pems</a></code> and 
<code><a href="#topic+plot.pems.element">plot.pems.element</a></code> for further 
details. 
</p>
<p>However, it also includes a range of higher-level 
plotting functions developed for use with 
<code>pems</code> data. 
</p>
<p>Early plots, e.g. <code>latticePlot</code>, only allowed 
plot arguments using the 
<code><a href="lattice.html#topic+lattice">lattice</a></code> formula format. While this is 
flexible and very powerful system, some users 
preferred the more conventional <code>plot(x,y,..)</code> 
call format. 
So, newer plots, e.g. <code>pemsPlot</code>, allow both 
conventional plot and 
<code><a href="lattice.html#topic+lattice">lattice</a></code>-style formula calls. 
</p>
<p><code>pemsXYZCondUnitsHandler</code> handles the pems 
information associated with the plots. This 
routine is included as a discrete function within 
this package and others are welcome to 
use elsewhere for similar purposes. 
<code>edit(pemsPlot)</code> to see it.  
</p>
<p>Newer plots use a combination of <code><a href="lattice.html#topic+lattice">lattice</a></code> 
and <code>loa</code> functions to provide a range of 
additional plotting options, such as integrated panel 
and key management. See <code>loa</code> 
documentation for further details.   
</p>
<p><code>preprocess...</code> and <code>panel...</code> functions 
handle pre-plot and in-plot elements 
of plot generation. These use the <code>loa</code> 
modification of the <code><a href="lattice.html#topic+lattice">lattice</a></code> 
plotting framework.    
</p>
<p>See Notes, Examples and extra documentation: 
<a href="http://pems.r-forge.r-project.org/pems.utils.plots.html">pems.plots</a>.
</p>


<h3>Value</h3>

<p>By default, <code>pemsPlot</code> generates a bubble plot, 
so it plots <code>(x,y)</code> points, and by default 
color-grades and size-scales them according to 
<code>z</code> if also supplied.
</p>
<p>When supplied speed and accel data-series as 
<code>x</code> and <code>y</code> cases, the <code>WatsonPlot</code> 
generates various forms of Watson's classic 
speed/accel frequency distribution 
plot. 
</p>
<p><code>latticePlot</code> and <code>XYZPlot</code> are general 
purpose 'xy' and 'xyz' data plotting functions.  
</p>
<p><code>fortify</code> is intended for use by <code>ggplot2</code> 
functions when users are plotting data in 
<code>pems</code> objects. See Notes.
</p>


<h3>Warning</h3>

<p>IMPORTANT: Conditioning is currently disabled on 
<code>XYZPlot</code>.
</p>
<p><code>XYZPlot</code> is a short-term replace for 
previous function <code>quickPlot</code>. It will most 
likely be replaced when <code>pems.utils.0.3</code> is 
released.
</p>
<p><code>pemsPlot</code> and <code>WatsonPlot</code> no longer 
accept formula <code>x</code>, <code>y</code>, <code>z</code> inputs. 
</p>
<p>With all these functions I have tried to make 
the default plotting options as robust as possible. 
However, it is not always possible to test all the plot
combines that users might try. So, please 
let me know if anything is not working nicely for 
you. Thanks.
</p>


<h3>Note</h3>

<p>General: 
</p>
<p>Like most other plot functions in <code>R</code>, 
<code><a href="lattice.html#topic+lattice">lattice</a></code> functions use a number 
of common parameter terms. For example, <code>xlab</code> 
and <code>ylab</code> reset the x and y labels of a graph; 
<code>xlim</code> and <code>ylim</code> to set the x- and 
y-scales of a graph; <code>col</code> sets the color of a 
plot element; <code>type</code> sets the type ('p' for 
points, 'l' for lines, etc); <code>pch</code> and 
<code>cex</code> set plot symbol type and size, respectively; 
and, <code>lty</code> and <code>lwd</code> set plot line type and 
thickness, respectively; etc. These terms are passed 
onto and evaluated by all these plot functions to 
provide standard plot control. 
</p>
<p><code>latticePlot</code>:
</p>
<p>The default <code>plot</code> option for <code>latticePlot</code> 
is <code>xyplot</code>. 
</p>
<p><code>panel</code> options for <code>latticePlot</code>: Default 
<code>panel.xyplot</code>. The alternative panel, 
<code>panel.PEMSXYPlot</code> supplied as part of this 
package, adds a grid layer to a standard xy panel. 
The extra code just allows you to pass specific plot 
parameters to the grid panel using the argument 
<code>grid</code>. You can build almost any plot layout 
using these and other panels in <code>lattice</code> and 
<code>loa</code> as building blocks. 
</p>
<p><code>XYZPlot</code>:
</p>
<p>The default <code>plot</code> option for <code>latticePlot</code> 
is <code>levelplot</code>. 
</p>
<p><code>pemsPlot</code>:
</p>
<p><code>pemsPlot</code> and subsequent plot functions use an 
alternative convention. Here, plots include  
separate <code>process</code> and <code>plot</code> steps. 
This option allows the plot to pass on share the 
results of in-panel calculations with other panels 
and keys. The handling mechanism is part of the 
<code>loa</code> package. 
</p>
<p>The reason for <code>latticePlot</code>, etc: 
</p>
<p><code>latticePlot</code> combines a number of 
<code>lattice</code> and <code>latticeExtra</code> function 
modifications I regularly use when plotting data. 
So, it is basically a short cut to save having to 
write out a lot of code I regularly use. I would 
encourage anyone to at the very least have a look 
at <code>lattice</code>. 
</p>
<p>I also hope those learning <code>lattice</code>, find 
these functions a helpful introduction and handy 
'stop gap' while they are getting to grips with 
the code behind trellis and panel structures.
</p>


<h3>Author(s)</h3>

<p>Karl Ropkins
</p>


<h3>References</h3>

<p>lattice:
</p>
<p>Sarkar, Deepayan (2008) Lattice: Multivariate 
Data Visualization with
R. Springer, New York. ISBN 978-0-387-75968-5
</p>
<p>latticeExtra:
</p>
<p>Deepayan Sarkar and Felix Andrews (2011). 
latticeExtra: Extra Graphical Utilities Based on 
Lattice. R package version 0.6-18. 
http://CRAN.R-project.org/package=latticeExtra
</p>
<p><code><a href="lattice.html#topic+lattice">lattice</a></code> is one of number of really 
nice graphical tools in <code>R</code>. Others, like 
<code>ggplot2</code> and <code>iplot</code>, help you to very 
quickly explore your data. But, for me the trellis 
framework of <code><a href="lattice.html#topic+lattice">lattice</a></code> 
has always felt the most flexible.
</p>


<h3>See Also</h3>

<p>See <code><a href="lattice.html#topic+lattice">lattice</a></code>, <code>latticeExtra</code>, 
<code>loa</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
###########
##example 1
###########

## Not run: 
#plotting pems with other packages

#base 
plot(pems.1)
plot(pems.1$velocity)

#lattice 
xyplot(velocity~local.time, data = pems.1, type = "l")

#in ggplot2

#Note: Suggests only so you need to load this...
#Note: this uses fortify.pems behind scenes...

require(ggplot2)
qplot(time.stamp, velocity, data=pems.1)
ggplot(pems.1, aes(x = time.stamp, y = velocity)) + geom_line() 
#etc


## End(Not run)

###########
##example 2 
###########

#basic usage of latticePlot

latticePlot(velocity~local.time, data = pems.1, type = "l")

latticePlot(velocity~local.time, data = pems.1, col = "red", 
            pch = 20, panel = panel.PEMSXYPlot, 
            grid = list(col ="black", lty=2))

###########
##example 3 
###########

#basic usage of XYZPlot

a &lt;- calcAccel(velocity, local.time, data = pems.1, output="pems")

XYZPlot(~accel*velocity, data=a)

XYZPlot(~accel*velocity, data=a, plot = wireframe, shade=TRUE)


###########
##example 4 
###########

#basic usage of pemsPlot

pemsPlot(local.time, velocity, data=pems.1, type="l")


###########
##example 5 
###########

#basic usage of WatsonPlot

#Note: using 'a' generated in example 3 
WatsonPlot(velocity, accel, data=a)

## Not run: 
#omit.stopped for different handling of idling data
WatsonPlot(velocity, accel, data=a, omit.stopped="points")
WatsonPlot(velocity, accel, data=a, omit.stopped="cells")

#plot.type for different plot methods
WatsonPlot(velocity, accel, data=a, plot.type=1)
WatsonPlot(velocity, accel, data=a, plot.type=2)
WatsonPlot(velocity, accel, data=a, plot.type=3)
WatsonPlot(velocity, accel, data=a, plot.type=4)

## End(Not run)

</code></pre>

<hr>
<h2 id='6.1.common.calculations'>
Common calculations
</h2><span id='topic+6.1.common.calculations'></span><span id='topic+common.calculations'></span><span id='topic+calcDistance'></span><span id='topic+calcSpeed'></span><span id='topic+calcAccel'></span><span id='topic+calcAcceleration'></span><span id='topic+calcJerk'></span><span id='topic+calcChecks'></span><span id='topic+calcPack'></span>

<h3>Description</h3>

<p>Various common calculations associated with PEMS data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>
calcDistance(speed = NULL, time = NULL, data = NULL, 
          ..., fun.name = "calcDistance")

calcSpeed(distance = NULL, time = NULL, data = NULL, 
          ..., fun.name = "calcSpeed")

calcAccel(speed = NULL, time = NULL, data = NULL, 
          ..., method = 2, fun.name = "calcAccel")

calcAcceleration(speed = NULL, time = NULL, data = NULL, 
          ..., method = 2, fun.name = "calcAccel")

calcJerk(accel = NULL, time = NULL, data = NULL, 
          ..., fun.name = "calcJerk")

#associated

calcChecks(fun.name = "calcChecks", ..., data = NULL,
          if.missing = c("stop", "warning", "return"), 
          output = c("input", "data.frame", "pems", "special"),
          unit.conversions = NULL, overwrite = FALSE)

calcPack(output = NULL, data = NULL, settings = NULL, 
          fun.name = "calcPack", this.call = NULL)

</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="6.1.common.calculations_+3A_speed">speed</code>, <code id="6.1.common.calculations_+3A_time">time</code>, <code id="6.1.common.calculations_+3A_distance">distance</code>, <code id="6.1.common.calculations_+3A_accel">accel</code></td>
<td>

<p>(Required data series typically vectors) The inputs to use when doing a calculation. These 
can typically be vectors or elements in either a <code>data.frame</code> or <code>pems</code> object.
</p>
</td></tr> 
<tr><td><code id="6.1.common.calculations_+3A_data">data</code></td>
<td>

<p>(Optional <code>data.frame</code> or <code>pems</code> object) The data source if either a <code>data.frame</code> 
or <code>pems</code> object is being used.
</p>
</td></tr> 
<tr><td><code id="6.1.common.calculations_+3A_...">...</code></td>
<td>

<p>(Optional) Other arguments, currently passed on to <code>calcChecks</code>.
</p>
</td></tr>
<tr><td><code id="6.1.common.calculations_+3A_fun.name">fun.name</code></td>
<td>

<p>(Optional character) The name of the parent function, to be used in error messaging.
</p>
</td></tr>
<tr><td><code id="6.1.common.calculations_+3A_if.missing">if.missing</code>, <code id="6.1.common.calculations_+3A_output">output</code>, <code id="6.1.common.calculations_+3A_unit.conversions">unit.conversions</code>, <code id="6.1.common.calculations_+3A_overwrite">overwrite</code>, <code id="6.1.common.calculations_+3A_settings">settings</code>, <code id="6.1.common.calculations_+3A_this.call">this.call</code></td>
<td>

<p>(Various) Along with <code>data</code> and <code>fun.name</code>, arguments used by <code>calcCheck</code> and 
<code>calcPack</code> to manage error and unit handling and workhorse <code>calc...</code> operations. These 
are typically passed to the appropriate <code>check...</code> or <code>...Units</code> function for evaluation. 
See Details, Note and Examples below. 
</p>
</td></tr>
<tr><td><code id="6.1.common.calculations_+3A_method">method</code></td>
<td>

<p>(Character) Currently for <code>calcAccel</code> only. The method to use if options exist. 
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>With the exception of <code>calcChecks</code> and <code>calcPack</code>, <code>calc...</code> functions 
are common calculations.
</p>
<p><code>calcDistance</code> calculates distance (in m) using speed and time.    
</p>
<p><code>calcSpeed</code> calculates speed (in m/s) using distance and time.
</p>
<p><code>calcAccel</code> calculates acceleration (in m/s/s) using speed and time.
</p>
<p><code>calcJerk</code> calculates jerk (rate of change of acceleration in m/s/s/s) using 
acceleration and time.
</p>
<p>By default results are returned as <code>pems.elements</code>. Other options include 
returning as the supplied data plus the results as either a <code>data.frame</code> or a 
<code>pems</code> object. See Note below. 
</p>
<p>Unit management is by <code><a href="#topic+convertUnits">convertUnits</a></code>. See Note below. 
</p>
<p>The extra functions <code>calcChecks</code> and <code>calcPack</code> are add-ins that anyone can use 
to develop other similiar functions. They are added at the start and end of standard 
<code>calc...</code> functions to provide an option to use with third-party code. See Note.  
</p>


<h3>Value</h3>

<p>With the exception of <code>calcChecks</code> and <code>calcPack</code>, all <code>calc...</code> functions 
return either a <code>pems.element</code> vector, <code>data.frame</code> or <code>pems</code> object, depending 
on <code>output</code> setting and <code>data</code> supplied.
</p>


<h3>Note</h3>

<p>Unit handling in <code>pems.utils</code> is via <code><a href="#topic+checkUnits">checkUnits</a></code>, <code><a href="#topic+getUnits">getUnits</a></code>, 
<code><a href="#topic+setUnits">setUnits</a></code> and <code><a href="#topic+convertUnits">convertUnits</a></code>. Allowed unit conversion methods have 
to be defined in <code><a href="#topic+ref.unit.conversions">ref.unit.conversions</a></code> or a locally defined alternative supplied 
by the user. See <code><a href="#topic+convertUnits">convertUnits</a></code> for an example of how to locally work with unit 
conversions.
</p>
<p><code>calc.dist</code> and <code>calc.accel</code> are alternatives to <code>calcDistance</code> and <code>calcAccel</code>. 
</p>
<p>The functions <code>calcChecks</code> and <code>calcPack</code> are currently under revision and likely to be 
replaced in future versions of <code>pems.utils</code>.
</p>


<h3>Author(s)</h3>

<p>Karl Ropkins
</p>


<h3>References</h3>

<p>References in preparation.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+calcVSP">calcVSP</a></code> for VSP calculations. <code><a href="#topic+calcEm">calcEm</a></code> for emissions calculations.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
###########
##example 1 
###########

#basic usage

#calculated accel as pems.element

calcAccel(velocity, local.time, pems.1)

#answer returned as suppied pems + calculated accel

calcAccel(velocity, local.time, pems.1, output = "pems")

#or, if you would rather... 
## Not run: 
pems.1$accel &lt;- calcAccel(velocity, local.time, pems.1)

## End(Not run)

###########
#example 2
###########

#making wrappers for routine data processing 

my.pems &lt;- list(pems.1, pems.1)

sapply(my.pems, function(x) 
                  calcAccel(velocity, local.time, data=x))

#ans = accel data series for each pems in my.pems list

#             [,1]        [,2]
# [1,]          NA          NA
# [2,]  0.00000000  0.00000000
# [3,]  0.05555556  0.05555556
# [4,]  0.00000000  0.00000000
# [5,] -0.02777778 -0.02777778
# [6,]  0.05555556  0.05555556
#       ....

#note:
#sapply if you can/want to simiplify outputs
#lapply if you want to keep output as a list of answers

</code></pre>

<hr>
<h2 id='6.2.common.check.functions'>
common check... functions 
</h2><span id='topic+6.2.common.check.functions'></span><span id='topic+check...'></span><span id='topic+checkOption'></span><span id='topic+checkPEMS'></span><span id='topic+checkUnits'></span><span id='topic+checkOutput'></span><span id='topic+checkIfMissing'></span>

<h3>Description</h3>

<p>Various pems.utils workhorse functions for input checking and routine data handling.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>checkOption(option=NULL, allowed.options=NULL,
           option.name = "option", allowed.options.name = "allowed.options",
           partial.match=TRUE, fun.name = "checkOption", 
           if.missing = c("stop", "warning", "return"),
           output = c("option", "test.result"), ...)

checkPEMS(data = NULL, fun.name = "checkPEMS",
           if.missing = c("return", "warning", "stop"),
           output = c("pems", "data.frame", "test.result"),
           ...) 

checkUnits(input = NULL, units = NULL, data = NULL, 
           input.name = NULL, fun.name = "checkUnits", 
           if.missing = c("stop", "warning", "return"),
           output = c("special", "units", "input", "test.result"),
           ..., unit.conversions = NULL)

checkOutput(input = NULL, data = NULL,
           input.name = NULL, fun.name = "checkOutput", 
           if.missing = c("stop", "warning", "return"),
           output = c("pems", "data.frame", "input", "test.result"),
           overwrite = FALSE, ...)

checkIfMissing(..., if.missing = c("stop", "warning", "return"), 
           reply = NULL, suggest = NULL, if.warning = NULL, 
           fun.name = NULL)

</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="6.2.common.check.functions_+3A_input">input</code></td>
<td>

<p>(vector, object or object element) An input to be tested or recovered for 
subsequent use by another function, e.g. a speed measurement from a <code>pems</code> 
object. 
</p>
</td></tr> 
<tr><td><code id="6.2.common.check.functions_+3A_data">data</code></td>
<td>

<p>(data.frame, pems object) If supplied, the assumed source for an <code>input</code>. This 
can currently be a standard <code>data.frame</code> or a <code>'pems' object</code>. Note: if an 
<code>input</code> is not found in <code>data</code>, the parent environment is then also 
checked before returning an error message.
</p>
</td></tr>
<tr><td><code id="6.2.common.check.functions_+3A_input.name">input.name</code>, <code id="6.2.common.check.functions_+3A_option.name">option.name</code></td>
<td>

<p>(Optional character vectors) If a <code>check...</code> function is used as a workhorse by 
another function, the name it is given in any associated error messaging. See Note below.   
</p>
</td></tr>
<tr><td><code id="6.2.common.check.functions_+3A_fun.name">fun.name</code></td>
<td>

<p>(Optional character vector) If a <code>check...</code> function is used as a workhorse routine 
within another function, the name of that other function to be used in any associated error 
messaging. See Note below.
</p>
</td></tr>
<tr><td><code id="6.2.common.check.functions_+3A_if.missing">if.missing</code></td>
<td>

<p>(Optional character vector) How to handle an input, option, etc, if missing, not supplied or <code>NULL</code>. 
Current options include: <code>"stop"</code> to stop the <code>check...</code> function and any parent function
using it with an error message; <code>"warning"</code> to warn users that expected information was missing 
but to continue running the parent code; or <code>"return"</code> to continue running the parent code 
without any warnings.
</p>
</td></tr>
<tr><td><code id="6.2.common.check.functions_+3A_output">output</code></td>
<td>

<p>(Character vector) Output mode for <code>check...</code> function results. Options typically include the 
<code>check type</code> and <code>"test.results"</code>. See Value below.
</p>
</td></tr>
<tr><td><code id="6.2.common.check.functions_+3A_...">...</code></td>
<td>

<p>(Optional) Other arguments, currently ignored by all <code>check...</code> functions expect <code>checkIfMissing</code>.
</p>
</td></tr>
<tr><td><code id="6.2.common.check.functions_+3A_option">option</code>, <code id="6.2.common.check.functions_+3A_allowed.options">allowed.options</code>, <code id="6.2.common.check.functions_+3A_allowed.options.name">allowed.options.name</code></td>
<td>

<p>(Character vectors) For <code>checkOption</code>, <code>option</code> and <code>allowed.options</code> are the supplied option, 
and the allowed options it should be one of, respectively, and <code>allowed.options.name</code> if way these allowed 
options should be identified in any associated error messaging. See Note below.  
</p>
</td></tr>
<tr><td><code id="6.2.common.check.functions_+3A_partial.match">partial.match</code></td>
<td>

<p>(Logical) For <code>checkOption</code>, should partial matching be used when comparing <code>option</code> and 
<code>allowed.options</code>.
</p>
</td></tr>
<tr><td><code id="6.2.common.check.functions_+3A_units">units</code></td>
<td>

<p>(Character vector) For <code>checkUnits</code>, the units to return <code>input</code> in, if requested 
(<code>output = "input"</code>). Note: The default, <code>output = "special"</code>, is a special case which 
allows <code>checkUnits</code> to return either the units if they are not set in the call (equivalent to 
<code>output = "units"</code>) or the <code>input</code> in the requested units if they are set in the call 
(equivalent to <code>output = "input"</code>). 
</p>
</td></tr>
<tr><td><code id="6.2.common.check.functions_+3A_unit.conversions">unit.conversions</code></td>
<td>

<p>(List) For <code>checkUnits</code>, the conversion method source. See <code><a href="#topic+ref.unit.conversions">ref.unit.conversions</a></code> and 
<code><a href="#topic+convertUnits">convertUnits</a></code> for further details. 
</p>
</td></tr>
<tr><td><code id="6.2.common.check.functions_+3A_overwrite">overwrite</code></td>
<td>

<p>(Logical) For <code>checkOutput</code>, when packing/repacking a <code>data.frame</code> or <code>pems</code> object, 
should 'same name' cases be overwritten? If <code>FALSE</code> and 'same names' are encountered, e.g. when 
modifying an existing <code>data.frame</code> or <code>pems</code> element, a new element if generated with a 
unique name in the form <code>[name].[number]</code>. 
</p>
</td></tr>
<tr><td><code id="6.2.common.check.functions_+3A_reply">reply</code>, <code id="6.2.common.check.functions_+3A_suggest">suggest</code>, <code id="6.2.common.check.functions_+3A_if.warning">if.warning</code></td>
<td>

<p>(Character vectors) For <code>checkIfMissing</code>, when generating error or warning messages, the main 
reply/problem description, any suggestions what users can try to fix this, and the action taken by the 
function if just warning (e.g. setting the missing value to <code>NULL</code>), respectively. All are options. 
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>check...</code> functions are intended as a means of future-proofing <code>pems.utils</code> data 
handling. They provide routine error/warning messaging and consistent 'front-of-house' handling 
of function arguments regardless of any underlying changes in the structure of the <code>pems</code> 
objects and/or <code>pems.utils</code> code. This means third-party function developed using these 
functions should be highly stable.
</p>
<p><code>checkOption</code> checks a supplied option against a set of allowed options, and then if present or 
matchable returns the assigned option. It is intended as a workhorse for handling optional function 
arguments.  
</p>
<p><code>checkPEMS</code> checks a supplied data source and provides a short-cut for converting this 
to and from <code>data.frames</code> and <code>pems</code> object classes. It is intended as a 'best-of-both-worlds' 
mechanism, so users can supply data in various different formats, but function developers only 
have to work with that data in one (known) format. 
</p>
<p><code>checkUnits</code> checks the units of a previously recovered <code>input</code>, and then, depending on the 
<code>output</code> setting, returns either the <code>units</code> of the <code>input</code> or the <code>input</code> in the 
required <code>units</code> (assuming the associated conversion is known).
</p>
<p><code>checkOutput</code> packs/repacks a previously recovered <code>input</code>. Depending on the <code>output</code> setting, this 
can be as the (standalone) <code>input</code>, an element of a <code>data.frame</code> or an element of a <code>pems</code> object.  
</p>
<p><code>checkIfMissing</code> if a workhorse function for the <code>if.missing</code> argument. If any of the supplied 
additional arguments are <code>NULL</code>, it stops, warns and continues or continues a parent function according to 
the <code>if.missing</code> argument. If supplied, <code>reply</code>, <code>suggest</code> and <code>if.warning</code> arguments are 
used to generate the associated error or warning message.
</p>


<h3>Value</h3>

<p>All <code>check...</code> functions return a logical if <code>output = "test.result"</code>, <code>TRUE</code> 
if the <code>input</code>, <code>option</code>, etc., is suitable for use in that fashion or <code>FALSE</code> if not.      
</p>
<p>Otherwise,
</p>
<p><code>checkOption</code> return the <code>option</code> argument if valid (on the basis of <code>if.missing</code>) or an 
error, warning and/or <code>NULL</code> (on the basis of <code>if.missing</code>) if not. If <code>partial.match = TRUE</code> 
and partial matching is possible this is in the full form given in <code>allowed.options</code> regardless of 
the degree of abbreviation used by the user.
</p>
<p><code>checkPEMS</code> returns the <code>data</code> argument if valid or an error, warning and/or <code>NULL</code> (on the basis 
of <code>if.missing</code>) if not. Depending on <code>output</code> setting, the valid return is either a <code>data.frame</code> 
or <code>pems</code> object.
</p>
<p><code>checkUnits</code> returns the units of the <code>input</code> argument if no other information is supplied and 
<code>units</code> have previously been assigned to that <code>input</code>. If <code>units</code> are assigned in the call 
or <code>output</code> is forced (<code>output = "input"</code>), the <code>input</code> is returned in the requested 
<code>units</code>. If this action is not possible (e.g. <code>pems.utils</code> does not know the conversion), the 
function returns an error, a warning and the unchanged <code>input</code> or the unchanged <code>input</code> alone 
depending on <code>if.missing</code> setting.
</p>
<p>Depening on <code>if.missing</code> argument, <code>checkIfMissing</code> either stops all parent functions with an error 
message, warns of a problem but allows parent functions to continue running, or allows parent functions to 
continue without informing the user. 
</p>


<h3>Note</h3>

<p>The <code>...name</code> arguments allow the <code>check...</code> functions to be used silently. 
If a parent function is identified as <code>fun.name</code> and the check case (codeinput, 
<code>option</code>, etc.) is identified with the associated <code>...name</code> argument these are 
used in any associated error messaging.
</p>


<h3>Author(s)</h3>

<p>Karl Ropkins
</p>


<h3>References</h3>

<p>[TO DO]
</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+ref.unit.conversions">ref.unit.conversions</a></code> and <code><a href="#topic+convertUnits">convertUnits</a></code> for general unit handling. 
</p>

<hr>
<h2 id='6.3.corrections'>
Corrections
</h2><span id='topic+6.3.corrections'></span><span id='topic+corrections'></span><span id='topic+calcPack2'></span><span id='topic+correctInput'></span><span id='topic+zeroNegatives'></span><span id='topic+correctBaseline'></span>

<h3>Description</h3>

<p>Corrections are a special subset of functions which by default 
write over the elements that they recalculate.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>
correctInput(input = NULL, ..., data = NULL,
         correction = NULL)

zeroNegatives(input = NULL, ..., data = NULL, 
         screen = FALSE)

correctBaseline(x, ..., data = NULL, output = "ans")

#associated

calcPack2(input, ..., settings = NULL, data = NULL)

</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="6.3.corrections_+3A_input">input</code></td>
<td>

<p>(Required data series typically vectors) The input to use when makin a correction. This 
is typically a vector or element in either a <code>data.frame</code> or <code>pems</code> object.
</p>
</td></tr>
<tr><td><code id="6.3.corrections_+3A_x">x</code></td>
<td>

<p>(For <code>correctBaseline</code>) (Required data series typically vectors) The input to use when makin a correction. This 
is typically a vector or element in either a <code>data.frame</code> or <code>pems</code> object.
</p>
</td></tr>
<tr><td><code id="6.3.corrections_+3A_...">...</code></td>
<td>

<p>(Optional) Other arguments, typically passed on. 
</p>
</td></tr>
<tr><td><code id="6.3.corrections_+3A_data">data</code></td>
<td>

<p>(Optional <code>data.frame</code> or <code>pems</code> object) The data source if either a <code>data.frame</code> 
or <code>pems</code> object is being used.
</p>
</td></tr> 
<tr><td><code id="6.3.corrections_+3A_correction">correction</code></td>
<td>

<p>(For <code>correctInput</code>, required function) The correction operation to apply to 
<code>input</code>. This is typically a function or function name (as character string). 
</p>
</td></tr>
<tr><td><code id="6.3.corrections_+3A_screen">screen</code></td>
<td>

<p>(For <code>zeroNegatives</code>, logical) If the user intends screening the correction before applying 
it, this should be set to <code>TRUE</code>.  
</p>
</td></tr>
<tr><td><code id="6.3.corrections_+3A_output">output</code></td>
<td>

<p>(character) Where options exists for the function output, the required output. For 
<code>correctBaseline</code>, current options: <code>'ans'</code> (the default) and 
<code>'diagnostic'</code>.
</p>
</td></tr>
<tr><td><code id="6.3.corrections_+3A_settings">settings</code></td>
<td>

<p>(For <code>calcPack2</code>, list) Any arguments to be used as settings when handling 
<code>pems.elements</code>. Unless developing functions, this can typically be ignored. 
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>correctInput</code> is a general correction handlers. It accepts an 
<code>input</code> and a function, <code>correction</code>, which it applies to 
<code>input</code>. 
</p>
<p><code>zeroNegatives</code> resets any negative values in an <code>input</code> to 
zero.
</p>
<p><code>correctBaseline</code> attempts to correct the baseline of a supplied data 
(<code>pems.element</code> <code>vector</code>) time-series. Baseline corrections are 
carried out using methods from the <code>baseline</code> package. See Below.
</p>
<p><code>calcPack2</code> is an alternative version of <code><a href="#topic+calcPack">calcPack</a></code>. See 
associated help for details. 
</p>


<h3>Value</h3>

<p>With the exception of <code>calcPack2</code>, all the above functions generate 
input corrections. 
</p>
<p><code>correctBaseline</code> returns the supplied data time-series (<code>x</code>) after applying the 
requested baseline correction (see below).
</p>


<h3>Note</h3>

<p>By default, corrections return results in the format of the <code>input</code>. So: If 
inputs are supplied as vectors, the answer is returned as a vector; If inputs are 
supplied in a <code>pems</code> object, that <code>pems</code> object is returned with the answer 
added in. This behaviour is enabled by the default <code>output = "special"</code>. Output 
type can be forced by declaring <code>ouput</code> in the function call. Options 
<code>"input"</code>, <code>"data.frame"</code> and <code>"pems"</code> return vectors, data.frames and 
pems objects, respectively.
</p>
<p>Unlike other calculations, corrections automatically replace the associated 
<code>input</code>, unless prevented (using <code>overwrite = FALSE</code>).
</p>
<p>This function management is handled by <code><a href="#topic+calcChecks">calcChecks</a></code> and 
<code><a href="#topic+calcPack">calcPack</a></code>. These are front and back end <code>calc...</code> 
function add-ins that anyone can use as a 'minimal code' means of 
integrating third-party and <code>pems.utils</code> functions.
</p>
<p>See <code><a href="#topic+calcChecks">calcChecks</a></code> documentation for details. 
</p>
<p><code>correctBaseline</code> is a recent transfer from <code>sleeper.service</code>. 
It uses <code>baseline</code> functions to provide 'best guess' baseline 
corrections. 
</p>
<p>By default, it applies: 
</p>
<p><code>baseline(..., method="rollingBall", wm=50, ws=50)</code> 
</p>
<p>Please Note the 'best guess': As baseline corrections are based statistical 
estimates of likely baselines rather than actual measures of drift these should 
be treated as estimates.
</p>
<p>Unit management is by <code><a href="#topic+convertUnits">convertUnits</a></code>. See associated help 
documentation for details.         
</p>


<h3>Author(s)</h3>

<p>Karl Ropkins
</p>


<h3>References</h3>

<p>baseline:
</p>
<p>Kristian Hovde Liland and Bjorn-Helge Mevik (2015). baseline:
Baseline Correction of Spectra. R package version 1.2-1.
https://CRAN.R-project.org/package=baseline
</p>


<h3>See Also</h3>

<p><code>baseline</code> regarding baseline corrections.
</p>
<p><code><a href="#topic+common.calculations">common.calculations</a></code>, <code><a href="#topic+calcVSP">calcVSP</a></code> or <code><a href="#topic+calcEm">calcEm</a></code> for calculation functions.
</p>
<p><code><a href="base.html#topic+getElement">getElement</a></code> (<code><a href="#topic+checkUnits">checkUnits</a>, etc</code> 
and <code><a href="#topic+convertUnits">convertUnits</a></code> for data management.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
###########
##example 1 
###########

#basic usage

zeroNegatives(-10:10) #etc



</code></pre>

<hr>
<h2 id='6.4.analysis.summary.reports'>
Generating summary reports
</h2><span id='topic+6.4.analysis.summary.reports'></span><span id='topic+summary.reports'></span><span id='topic+summaryReport'></span>

<h3>Description</h3>

<p>Various functions for generating summary reports for <code>pems</code> objects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>
summaryReport(speed = NULL, time = NULL, accel = NULL, 
          distance = NULL, data = NULL, ..., 
          lod.speed = 0.1, lod.accel = 0.1,
          fun.name = "summaryReport")

</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="6.4.analysis.summary.reports_+3A_speed">speed</code>, <code id="6.4.analysis.summary.reports_+3A_accel">accel</code>, <code id="6.4.analysis.summary.reports_+3A_time">time</code>, <code id="6.4.analysis.summary.reports_+3A_distance">distance</code></td>
<td>

<p>(Data series typically vectors) The inputs to use when doing a calculation. These 
can typically be vectors or elements in either a <code>data.frame</code> or <code>pems</code> object if 
supplied as <code>data</code>. See Details below regarding requirements.
</p>
</td></tr> 
<tr><td><code id="6.4.analysis.summary.reports_+3A_data">data</code></td>
<td>

<p>(Optional <code>data.frame</code> or <code>pems</code> object) The data source if either a <code>data.frame</code> 
or <code>pems</code> object is being used.
</p>
</td></tr> 
<tr><td><code id="6.4.analysis.summary.reports_+3A_...">...</code></td>
<td>

<p>(Optional) Other arguments, currently passed on to <code><a href="#topic+calcChecks">calcChecks</a></code> which in turn provides 
access to <code>pems.utils</code> management arguments such as <code>if.missing</code> and unit handlers such 
as <code>unit.conversions</code>.
</p>
</td></tr>
<tr><td><code id="6.4.analysis.summary.reports_+3A_lod.speed">lod.speed</code>, <code id="6.4.analysis.summary.reports_+3A_lod.accel">lod.accel</code></td>
<td>

<p>(numerics) The limits of detection for speed and accel measurements, respectively. [Note: if only one 
value is given for accel, the accel limits are assumed to be c(-lod.accel, + lod.accel)].
</p>
</td></tr>
<tr><td><code id="6.4.analysis.summary.reports_+3A_fun.name">fun.name</code></td>
<td>

<p>(Optional character) The name of the parent function, to be used in error messaging.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>summaryReport</code> does not strictly require all the arguments <code>speed</code>, <code>accel</code>, <code>time</code> 
and <code>distance</code> as inputs. It calculates as many of the missing cases as it can using the 
<code><a href="#topic+common.calculations">common.calculations</a></code> before halting an analysis or warning the user of any problems.
</p>
<p>Unit management is by <code><a href="#topic+convertUnits">convertUnits</a></code>. See Note below.  
</p>


<h3>Value</h3>

<p><code>summaryReport</code> returns a one-row <code>data.frame</code> with twelve elements:
</p>
<p><code>distance.travelled.km</code> this total distance travelled (in km)
</p>
<p><code>time.total.s</code> the total time taken (in s)
</p>
<p><code>avg.speed.km.h</code> the mean speed as averaged across the total journey/dataset 
(in km/h)  
</p>
<p><code>avg.running.speed.km.h</code> the mean speed while the vehicle was in motion (in km/h), 
assuming a 0.01 km/h accuracy for <code>speed</code> measurements.
</p>
<p><code>time.idle.s</code> and <code>time.idle.pc</code>, the time the vehicle was idling (in s and as a 
percentage, respectively), also assuming a 0.01 km/h cutoff for <code>speed</code> measurements. 
</p>
<p><code>avg.accel.m.s.s</code> the mean (positive component of) acceleration (in m/s/s), 
assuming a 0.1 m/s/s cutoff for <code>accel</code> measurements.
</p>
<p><code>time.accel.s</code> and <code>time.accel.pc</code>, the time the vehicle was accelerating (in s and as a 
percentage, respectively), also assuming a 0.1 m/s/s cutoff for <code>accel</code> measurements. 
</p>
<p><code>avg.decel.m.s.s</code> the mean deceleration (negative component of acceleration in m/s/s), 
assuming a -0.1 m/s/s cutoff for <code>accel</code> measurements.
</p>
<p><code>time.decel.s</code> and <code>time.decel.pc</code>, the time the vehicle was decelerating (in s and as a 
percentage, respectively), also assuming a -0.1 m/s/s cutoff for <code>accel</code> measurements. 
</p>


<h3>Warning </h3>

<p>Currently, <code>summaryReport</code> outputs have units incorporated into their names because the 
outputs themselves are unitless <code>data.frames</code>.  
</p>


<h3>Note</h3>

<p>Unit handling in <code>pems.utils</code> is via <code><a href="#topic+checkUnits">checkUnits</a></code>, <code><a href="#topic+getUnits">getUnits</a></code>, 
<code><a href="#topic+setUnits">setUnits</a></code> and <code><a href="#topic+convertUnits">convertUnits</a></code>. Allowed unit conversion methods have 
to be defined in <code><a href="#topic+ref.unit.conversions">ref.unit.conversions</a></code> or a locally defined alternative supplied 
by the user. See <code><a href="#topic+convertUnits">convertUnits</a></code> for an example of how to locally work with unit 
conversions. 
</p>


<h3>Author(s)</h3>

<p>Karl Ropkins
</p>


<h3>References</h3>

<p>References in preparation.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+checkUnits">checkUnits</a></code> and <code><a href="#topic+convertUnits">convertUnits</a></code> for data management.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
###########
##example 1 
###########

#basic usage

summaryReport(velocity, local.time, data=pems.1)

#   distance.travelled.km time.total.s avg.speed.km.h avg.running.speed.km.h
# 1              6.186056         1000        22.2698               28.78538
#   time.idle.s time.idle.pc avg.accel.m.s.s time.accel.s time.accel.pc
# 1          40            4       0.7921279          271          27.1
#   avg.decel.m.s.s time.decel.s time.decel.pc
# 1      -0.9039449          238          23.8

#apply to multiple cases

my.pems &lt;- list(pems.1, pems.1)

sapply(my.pems, function(x) 
                    summaryReport(velocity, local.time, data = x))


#                        [,1]       [,2]      
# distance.travelled.km  6.186056   6.186056  
# time.total.s           1000       1000      
# avg.speed.km.h         22.2698    22.2698   
# avg.running.speed.km.h 28.78538   28.78538  
# time.idle.s            40         40        
# time.idle.pc           4          4         
# avg.accel.m.s.s        0.7921279  0.7921279 
# time.accel.s           271        271       
# time.accel.pc          27.1       27.1      
# avg.decel.m.s.s        -0.9039449 -0.9039449
# time.decel.s           238        238       
# time.decel.pc          23.8       23.8  




</code></pre>

<hr>
<h2 id='7.1.vsp.code'>
Vehicle Specific Power (VSP) related code
</h2><span id='topic+7.1.vsp.code'></span><span id='topic+vsp.code'></span><span id='topic+vsp'></span><span id='topic+calcVSP'></span><span id='topic+calcVSP_JimenezPalacios'></span><span id='topic+refVSPBin'></span><span id='topic+refVSPBin_NCSU.14'></span><span id='topic+refVSPBin_MOVES.23'></span><span id='topic+VSPPlot'></span><span id='topic+VSPBinPlot'></span>

<h3>Description</h3>

<p>Functions associated with VSP calculations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>
#calculation

calcVSP(speed = NULL, accel = NULL, slope = NULL, 
          time = NULL, distance = NULL, data = NULL,
          calc.method = calcVSP_JimenezPalacios,
          ..., fun.name = "calcVSP", this.call = NULL)

calcVSP_JimenezPalacios(speed = NULL, accel = NULL, 
          slope = NULL, vehicle.weight = NULL, vsp.a = NULL, 
          vsp.b = NULL, vsp.c = NULL, vsp.g = NULL, ..., 
          data = NULL,  
          fun.name = "calcVSP_JimenezPalacios", 
          this.call = NULL)

#VSP binning

refVSPBin(..., bin.method="ncsu.14")

refVSPBin_NCSU.14(vsp = NULL, data = NULL, 
          ..., fun.name="refVSPBin_NSCU.14")

refVSPBin_MOVES.23(vsp = NULL, speed = NULL, data = NULL, 
          ..., fun.name="refVSPBin_MOVES.23")
          
#vsp plotting

VSPPlot(vsp, em = NULL, ..., data = NULL, plot.type = 1, 
          fun.name="VSPPlot", scheme = pems.scheme)

VSPBinPlot(vspbin, em = NULL, ..., data = NULL, 
          plot.type = 1, stat = NULL, fun.name="VSPBinPlot",
          scheme = pems.scheme)
          
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="7.1.vsp.code_+3A_speed">speed</code>, <code id="7.1.vsp.code_+3A_accel">accel</code>, <code id="7.1.vsp.code_+3A_slope">slope</code>, <code id="7.1.vsp.code_+3A_time">time</code>, <code id="7.1.vsp.code_+3A_distance">distance</code>, <code id="7.1.vsp.code_+3A_vsp">vsp</code>, <code id="7.1.vsp.code_+3A_vspbin">vspbin</code>, <code id="7.1.vsp.code_+3A_em">em</code></td>
<td>

<p>(Typically pems.element vectors) <code>speed</code>, <code>accel</code>, 
<code>slope</code>, <code>time</code> and <code>distance</code> are possible 
inputs for VSP calculation. <code>vsp</code> and <code>speed</code> are 
possible inputs for VSP binning methods. <code>vsp</code>, 
<code>vspbin</code> and <code>em</code> are x and y inputs for 
associated plots.
(See Notes about inputs and methods.)
</p>
</td></tr> 
<tr><td><code id="7.1.vsp.code_+3A_data">data</code></td>
<td>

<p>(Optional, typically <code>pems</code>) The data source for inputs.
</p>
</td></tr> 
<tr><td><code id="7.1.vsp.code_+3A_calc.method">calc.method</code>, <code id="7.1.vsp.code_+3A_bin.method">bin.method</code></td>
<td>

<p>(Required functions) <code>calc.method</code> is the function used 
to calculate VSP (default <code>calcVSP_JimenezPalaciosCMEM</code>). 
<code>bin.method</code> is the methods used when binning VSP 
measurements. (See Notes.)
</p>
</td></tr>
<tr><td><code id="7.1.vsp.code_+3A_...">...</code></td>
<td>

<p>(Optional) Other arguments, currently passed on as supplied 
to assoicated calculation or binning method.
</p>
</td></tr>
<tr><td><code id="7.1.vsp.code_+3A_fun.name">fun.name</code></td>
<td>

<p>(Optional character) The name of the parent function, to be 
used in error messaging.
</p>
</td></tr>
<tr><td><code id="7.1.vsp.code_+3A_this.call">this.call</code></td>
<td>

<p>(Optional) Initial call, should generally be ignored. See 
code<a href="#topic+common.calculations">common.calculations</a> for further details.
</p>
</td></tr>
<tr><td><code id="7.1.vsp.code_+3A_vehicle.weight">vehicle.weight</code>, <code id="7.1.vsp.code_+3A_vsp.a">vsp.a</code>, <code id="7.1.vsp.code_+3A_vsp.b">vsp.b</code>, <code id="7.1.vsp.code_+3A_vsp.c">vsp.c</code>, <code id="7.1.vsp.code_+3A_vsp.g">vsp.g</code></td>
<td>

<p>(Numerics) VSP constants. If not supplied, defaults are 
applied. See Below.
</p>
</td></tr>
<tr><td><code id="7.1.vsp.code_+3A_plot.type">plot.type</code></td>
<td>

<p>(Optional numeric) For <code>VSPPlot</code> and <code>VSPBinPlot</code>, 
the type of plot to generate. For <code>VSPPlot</code>, 1 a 
conventional scatter plot; or 2 a box-and-whisker plot. For 
<code>VSPBinPlot</code>, 1 a bar plot; or 2 a box-and-whisker 
plot. 
</p>
</td></tr>
<tr><td><code id="7.1.vsp.code_+3A_stat">stat</code></td>
<td>

<p>(Function) For <code>VSPBinPlot</code>, the statistic to use when 
calculating bar scales for <code>plot.type</code> 1. By default this 
is mean if <code>em</code> is supplied or count if not. NOTE: 
stat is ignore when <code>plot.type</code> is used
</p>
</td></tr>
<tr><td><code id="7.1.vsp.code_+3A_scheme">scheme</code></td>
<td>

<p>(Various) For <code>speedEmPlot</code>, the scheme to apply to 
the plot, <code>loa</code> argument. 
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>calcVSP...</code> functions calculate VSP:
</p>
<p><code>calcVSP</code> is a wrapper function which allows users to 
supply different combinations of inputs. VSP calculations 
typically require speed, acceleration and slope inputs. 
However, This wrapper allows different input combinations, 
e.g.:
</p>
<p>time and distance (time and distance -&gt; speed, 
time and speed -&gt; accel)
</p>
<p>time and speed (time and speed -&gt; accel)
</p>
<p>speed and accel
</p>
<p>This then passes on <code>speed</code>, <code>accel</code> and (if 
supplied) <code>slope</code> to the method defined by 
<code>calc.method</code>. (This means other VSP functions run 
via <code>calcVSP(..., calc.method = function)</code> 
share this option without needed dedicated code.)
</p>
<p><code>calcVSP_JimenezPalacios</code> calculates VSP according 
to Jimenez Palacios methods. See References and Note below.
</p>
<p><code>refVSPBin...</code> functions generate a reference list of 
VSP bins:
</p>
<p><code>refVSPBin</code> is a wrapper that generates VSP Mode bins 
depending on method applied. 
</p>
<p><code>binVSP_NCSU.14</code> bins supplied <code>vsp</code> using the 
14 bin method described in Frey et al 2002. 
</p>
<p><code>binVSP_MOVES.23</code> bins supplied <code>vsp</code> using that 
and <code>speed</code> and the 23 bin MOVES method (See Note). 
</p>
<p><code>VSPPlot</code> generates various plots of VSP (x-axis) and 
emission (y-axis) data. 
</p>
<p><code>VSPBinPlot</code> generates various plots of VSP binned data. 
</p>


<h3>Value</h3>

<p><code>calcVSP</code> by default uses the Jimenez Palacios method 
to calculate VSP in kW/metric ton.
</p>
<p><code>refVSPBin</code> generates a <code>pems.element factor</code> 
vector  of VSP Mode bin assignments. 
</p>
<p><code>VSPPlot</code> and <code>VSPBinPlot</code> generate plots as
<code>lattice</code> objects.
</p>


<h3>Note</h3>

<p><code>calcVSP...</code> constants can be set/modified in the 
calculation call, e.g. 
<code>calcVSP(..., vsp.a = [new.value])</code>. If not supplied, 
defaults are used. (See References.) 
</p>
<p><code>binVSP_MOVES.23</code> is in-development. Do not use without 
independent confirmation of values.  
</p>
<p>Unit handling in <code>pems.utils</code> is via 
<code><a href="#topic+checkUnits">checkUnits</a></code>, 
<code><a href="#topic+getUnits">getUnits</a></code>, <code><a href="#topic+setUnits">setUnits</a></code> and 
<code><a href="#topic+convertUnits">convertUnits</a></code>. 
See <code><a href="#topic+common.calculations">common.calculations</a></code> for details.
</p>


<h3>Author(s)</h3>

<p>Karl Ropkins
</p>


<h3>References</h3>

<p><code>calcVSP_JimenezPalacios</code> uses methods described in:
</p>
<p>Jimenez-Palacios, J.L. (1999) Understanding and Quantifying 
Motor Vehicle Emissions with Vehicle Specific Power and TILDAS 
Remote Sensing. PhD Thesis, Massachusetts Institute of 
Technology, Cambridge, MA.
</p>
<p><code>vehicle.weight</code> is the vehicle mass (in metric tons), 
and <code>vsp.a</code>, <code>vsp.b</code>, <code>vsp.c</code> and <code>vsp.g</code> 
are the calculations constants for:
</p>
<p><code>vsp = speed * (a * accel + (g * slope) + b) + (c * speed^3)</code>
</p>
<p>By default: a = 1.1, b = 0.132, c = 0.000302 and g = 0.132 
(as of Jimenez-Palacios, 1999).
</p>
<p>Method ONLY INTENDED FOR vehicles &lt; 3.855 metric tons.
</p>
<p><code>refVSPBin_NCSU.14</code> VSP binning as described in:
</p>
<p>Frey, H.C., Unal, A., Chen, J., Li, S. and Xuan, C., 2002. 
Methodology for developing modal emission rates for EPA's 
multi-scale motor vehicle &amp; equipment emission system. Ann 
Arbor, Michigan: US Environmental Protection Agency. 
(EPA420-R-02-027)
</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+common.calculations">common.calculations</a></code> (and 
<code><a href="#topic+checkUnits">checkUnits</a></code> and 
<code><a href="#topic+convertUnits">convertUnits</a></code>) for details of data management.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
###########
##example 1 
###########

#basic usage

vsp &lt;- calcVSP(velocity, time = local.time, data = pems.1)
#where the returned object, vsp, is vsp values as pems.element

ncsu.14 &lt;- refVSPBin(vsp)
#where the returned object, nscu.14, is the associated modal bin 
# assignments based on the Frey et al (2002) 14 bin method. 

</code></pre>

<hr>
<h2 id='7.2.emissions.calculations'>
Emission calculations
</h2><span id='topic+7.2.emissions.calculations'></span><span id='topic+emissions.calculations'></span><span id='topic+emissions'></span><span id='topic+em'></span><span id='topic+calcEm'></span><span id='topic+calcEm_HoribaPitot'></span>

<h3>Description</h3>

<p>Functions associated with emissions calculations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>
calcEm(conc = NULL, calc.method = calcEm_HoribaPitot, 
          analyte = NULL, ..., data = NULL, fun.name = "calcEm", 
          force = FALSE, this.call = NULL)

calcEm_HoribaPitot(conc = NULL, time = local.time, exflow = exh.flow.rate, 
          extemp = exh.temp, express = exh.press, analyte = NULL, 
          delay = NULL, mm = NULL, ..., force = force, data = NULL, 
          fun.name = "calcEm_HoribaPitot", this.call = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="7.2.emissions.calculations_+3A_conc">conc</code></td>
<td>

<p>(Data series, typically pems.element vector) Analyte/species concentrations, the main input for 
calculating emissions. If <code>conc</code> is a concentration data series from a standard 
<code>pems</code> source it should be named <code>conc.[analyte]</code> and <code>pems.utils</code> will 
manage it accordingly. See below for further details.
</p>
</td></tr>
<tr><td><code id="7.2.emissions.calculations_+3A_time">time</code>, <code id="7.2.emissions.calculations_+3A_exflow">exflow</code>, <code id="7.2.emissions.calculations_+3A_extemp">extemp</code>, <code id="7.2.emissions.calculations_+3A_express">express</code></td>
<td>
 
<p>(Data series, typically pems.element vectors) Other inputs used when calculating emissions. The 
combination depending on the calcuation method used (and set by <code>calc.method</code>).
</p>
</td></tr> 
<tr><td><code id="7.2.emissions.calculations_+3A_calc.method">calc.method</code></td>
<td>

<p>(Required function) The function to use to calculate emissions. (Default 
<code>calcEm_HoribaPitot</code>). See below for further details.
</p>
</td></tr>
<tr><td><code id="7.2.emissions.calculations_+3A_analyte">analyte</code></td>
<td>

<p>(Optional character vector) The analyte emissions are to be calculated for. If supplied,
this is used as a reference when assigning molecule weight and other analyte properties 
if these are not provided as part of calculate call. If not supplied, <code>pems.utils</code> 
attempts to recover these from available sources, e.g. <code>data</code> if supplied as part 
of the calculation call or package references such as <code><a href="#topic+ref.chem">ref.chem</a></code>.   
</p>
</td></tr>
<tr><td><code id="7.2.emissions.calculations_+3A_...">...</code></td>
<td>

<p>(Optional) Other arguments, currently passed on to function provided as 
<code>calc.method</code> (default <code>calcEm_HoribaPitot</code>) and appropriate 
<code>pems.utils</code> functions.
</p>
</td></tr>
<tr><td><code id="7.2.emissions.calculations_+3A_data">data</code></td>
<td>

<p>(Optional <code>pems</code> object) The data source for inputs.
</p>
</td></tr> 
<tr><td><code id="7.2.emissions.calculations_+3A_fun.name">fun.name</code>, <code id="7.2.emissions.calculations_+3A_this.call">this.call</code>, <code id="7.2.emissions.calculations_+3A_force">force</code></td>
<td>

<p>(Various pems management functions) <code>fun.name</code> (character vector) the name of the 
parent function, to be used in error messaging.  
<code>this.call</code> the initial call (can generally be ignored). <code>force</code> 
(Logical) Should <code>calcEm</code> and <code>calc.method</code> ignore any error checking, e.g. 
units assignments, and do calculations anyway?
</p>
</td></tr>
<tr><td><code id="7.2.emissions.calculations_+3A_delay">delay</code>, <code id="7.2.emissions.calculations_+3A_mm">mm</code></td>
<td>

<p>(Optional numerics) Emissions calculation constants. <code>delay</code> is the time delay between 
<code>conc</code> measurements and other timeseries. <code>mm</code> is the molecular mass of the 
analyte. If supplied, these in-call values supercede any preset in e.g. package <code>look-up.tables</code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>calcEm...</code> functions calculate emissions.
</p>
<p><code>calcEm</code> is a wrapper function which is intended to provide a conventient front for 
emissions calculation methods. It accepts an input codeconc which it checks and passes 
on to <code>calc.method</code>, along with other supplied arguments. 
</p>
<p><code>calcEm_HoribaPitot</code> calculates emissions using methods described in the Horiba OBS 
Operators Manual. In addition to <code>conc</code>, the function requires the time, and exhaust 
flow data series (measured by the OBS Pitot flow meter). By default, the function assumes 
that these are default names that are generated for these when standard OBS files are 
imported into <code>R</code> using the <code>pems.utils</code> import function <code><a href="#topic+importOBS2PEMS">importOBS2PEMS</a></code>. 
See References and Note below.  
</p>


<h3>Value</h3>

<p><code>calcEm_HoribaPitot</code> (and <code>calcEm</code> by default) use Horiba Manual methods to 
calculate emissions (in g/s).
</p>


<h3>Note</h3>

<p><code>calcEm...</code> constants can be set/modified in the calculation call, e.g. 
<code>calcEm(..., delay = [new.value])</code>. If not supplied, these are first checked for 
in the associated <code>pems</code> object (if supplied), or set to default values. See 
References. If analyte-related constants are to be added to a <code>pems</code> object, 
these should be named in the format '[type].[analyte]', e.g. <code>delay.co</code> for 
the <code>delay</code> constant to be used for the analyte CO.   
</p>
<p>Unit handling in <code>pems.utils</code> is via <code><a href="#topic+checkUnits">checkUnits</a></code>, <code><a href="#topic+getUnits">getUnits</a></code>, 
<code><a href="#topic+setUnits">setUnits</a></code> and <code><a href="#topic+convertUnits">convertUnits</a></code>. See <code><a href="#topic+common.calculations">common.calculations</a></code> 
for details.
</p>


<h3>Author(s)</h3>

<p>Karl Ropkins
</p>


<h3>References</h3>

<p><code>calcEm_HoribaPitot</code> uses methods described in:
</p>
<p>The Horiba Operators Manual.  
</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+common.calculations">common.calculations</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
###########
##example 1 
###########

#basic usage

em.co &lt;- calcEm(conc.co, data = pems.1)

#where the returned object, em.co, is a pems.element

</code></pre>

<hr>
<h2 id='7.3.coldstart.code'>
Cold Start Emissions related code
</h2><span id='topic+7.3.coldstart.code'></span><span id='topic+coldstart.code'></span><span id='topic+coldstart'></span><span id='topic+fitColdStart'></span><span id='topic+coldStartPlot'></span><span id='topic+panel.coldStartPlot1'></span><span id='topic+panel.coldStartPlot2'></span>

<h3>Description</h3>

<p>Functions associated with Cold Start Emissions calculations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>
#calculations

fitColdStart(em, time, engine.on = NULL, 
             data = NULL, method = 2, ...,
             fun.name="fitColdStart")

#Cold Start Plots

coldStartPlot(time, em = NULL,  
             ..., data = NULL, engine.on = NULL,
             plot.type = 1, method = 2,
             fun.name="coldStartPlot",
             scheme = pems.scheme)

panel.coldStartPlot1(..., loa.settings = FALSE)
panel.coldStartPlot2(..., loa.settings = FALSE)

</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="7.3.coldstart.code_+3A_em">em</code>, <code id="7.3.coldstart.code_+3A_time">time</code></td>
<td>

<p>(Typically pems.element vectors) <code>em</code> is the emissions 
data-series that the cold start contribution should be 
estimated for; <code>time</code> is the associated time-series, 
typically a local time measurement in seconds. 
</p>
</td></tr> 
<tr><td><code id="7.3.coldstart.code_+3A_engine.on">engine.on</code></td>
<td>

<p>(Optimal, single Numeric) The time the emission source, e.g. 
monitored vehicle engine, was started. If not supplied, this 
is assumed to be start of the supplied <code>em</code> and 
<code>time</code> data-series. See also Notes.
</p>
</td></tr>
<tr><td><code id="7.3.coldstart.code_+3A_data">data</code></td>
<td>

<p>(Optional, typically <code>pems</code>) The data source for 
<code>em</code> and <code>time</code>.
</p>
</td></tr> 
<tr><td><code id="7.3.coldstart.code_+3A_method">method</code></td>
<td>

<p>(Optinal, Numeric) The method to use when fitting and 
calculating the cold start contribution: method <code>1</code> 
Single break point fit of accumulated emissions; 
method <code>2</code> modified break-point. If not supplied, 
method 2 is used by default.See also Notes and References.  
</p>
</td></tr>  
<tr><td><code id="7.3.coldstart.code_+3A_...">...</code></td>
<td>

<p>(Optional) Other arguments, currently passed on as supplied 
to assoicated calculation or plotting function.
</p>
</td></tr>
<tr><td><code id="7.3.coldstart.code_+3A_fun.name">fun.name</code></td>
<td>

<p>(Optional character) The name of the parent function, to be 
used in error messaging.
</p>
</td></tr>
<tr><td><code id="7.3.coldstart.code_+3A_plot.type">plot.type</code></td>
<td>

<p>(Optional numeric) For <code>coldStartPlot</code>, the type of cold 
start plot to generate: 1 a conventional accumulation profile;
or 2 an emission time-series. If not supplied, plot type 1 is 
selected by default. 
</p>
</td></tr>
<tr><td><code id="7.3.coldstart.code_+3A_scheme">scheme</code></td>
<td>

<p>(Various) For <code>coldStartPlot</code>, the scheme to apply to 
the plot, <code>loa</code> argument. 
</p>
</td></tr>
<tr><td><code id="7.3.coldstart.code_+3A_loa.settings">loa.settings</code></td>
<td>

<p>(Logical) For <code>coldStartPlot</code> panel functions, 
a <code>loa</code> plot argument that can typically be 
ignored by plot users. 
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>fitColdStart</code> fits a cold start model to the supplied 
emissions and time-series data. 
</p>
<p><code>coldStartPlot</code> generates a plot of the cold start model. 
</p>
<p><code>panel.coldStartPlot1</code> and <code>panel.coldStartPlot1</code> 
are plot panels used by coldStartPlot when generating 
<code>plot.type</code>s 1 and 2, respectively.
</p>


<h3>Value</h3>

<p><code>fitColdStart</code> generates a cold start contribution 
report as a <code>pems</code> dataset. 
</p>
<p><code>coldStartPlot</code> generates a cold start contribution 
report as a <code>lattice</code> plot. 
</p>


<h3>Note</h3>

<p>Regarding <code>engine.on</code>: This is specifically the time 
the engine is turned on rather than the row of data set 
where this happens. In some cases, they are same, e.g. when 
the data is logged at a regular 1-Hz and data capture is 
complete. 
</p>
<p>Regarding <code>method</code>: Method 1 (break-point) and method 2 
(modified break-point) are based on the identification of a
change point in the accumulated emissions profile. 
</p>
<p>[Doc further] 
</p>
<p>(See References.) 
</p>


<h3>Author(s)</h3>

<p>Karl Ropkins
</p>


<h3>References</h3>

<p><code>fitColdStart</code> uses methods described in:
</p>
<p>[Heeb]
</p>
<p>[Ropkins cold start]
</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+common.calculations">common.calculations</a></code> (and 
<code><a href="#topic+checkUnits">checkUnits</a></code> and 
<code><a href="#topic+convertUnits">convertUnits</a></code>) for details of data management.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
###########
##example 1 
###########

#basic usage

#to do/maybe not run... time to compile...

</code></pre>

<hr>
<h2 id='7.4.speed.em.code'>
Speed Emissions related code
</h2><span id='topic+7.4.speed.em.code'></span><span id='topic+speed.em.code'></span><span id='topic+speed.em'></span><span id='topic+fitSpeedEm'></span><span id='topic+speedEmPlot'></span>

<h3>Description</h3>

<p>Functions associated with Speed/Emissions terms.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>
#calculations

fitSpeedEm(em, time, speed, engine.on = NULL,
           data = NULL, method = 1, min.speed = 5,
           bin.size = NULL, ..., 
           fun.name="fitEmSpeed")
                       
#speed/emissions Plots

speedEmPlot(speed, em = NULL, time = NULL, 
         ..., data = NULL, engine.on = NULL,
         min.speed = 5, bin.size = NULL,  
         plot.type = 1, method = 1,
         fun.name="speedEmPlot",
         scheme = pems.scheme)

</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="7.4.speed.em.code_+3A_em">em</code>, <code id="7.4.speed.em.code_+3A_time">time</code>, <code id="7.4.speed.em.code_+3A_speed">speed</code></td>
<td>

<p>(Typically pems.element vectors) <code>em</code> is the (g/s) 
emissions data-series; <code>speed</code> and <code>time</code> are 
the associated speed profile and time-series. 
</p>
</td></tr> 
<tr><td><code id="7.4.speed.em.code_+3A_engine.on">engine.on</code></td>
<td>

<p>(Optimal, single Numeric) The time the emission source, e.g. 
monitored vehicle engine, was started. If not supplied, this 
is assumed to be start of the supplied <code>em</code> and 
<code>time</code> data-series. See also Notes.
</p>
</td></tr>
<tr><td><code id="7.4.speed.em.code_+3A_data">data</code></td>
<td>

<p>(Optional, typically <code>pems</code>) The data source for 
<code>em</code>, <code>speed</code> and <code>time</code>.
</p>
</td></tr> 
<tr><td><code id="7.4.speed.em.code_+3A_method">method</code></td>
<td>

<p>(Optinal, Numeric) The method to use when calculating 
and binning data: method <code>1</code> calculate g/km emissions 
and bin by row. See also <code>bin.size</code>, Notes and 
References.
</p>
</td></tr>  
<tr><td><code id="7.4.speed.em.code_+3A_min.speed">min.speed</code></td>
<td>

<p>(Optinal, Numeric) measurements when speeds were less than 
this value are exluded, default value <code>5</code>. See also 
Notes.
</p>
</td></tr>  
<tr><td><code id="7.4.speed.em.code_+3A_bin.size">bin.size</code></td>
<td>

<p>(Optinal, Numeric) The data binning scale to use. For 
<code>method 1</code>, this is the number of rows of 
measurements to merge. 
</p>
</td></tr>  
<tr><td><code id="7.4.speed.em.code_+3A_...">...</code></td>
<td>

<p>(Optional) Other arguments, currently passed on as supplied 
to assoicated calculation or plotting function.
</p>
</td></tr>
<tr><td><code id="7.4.speed.em.code_+3A_fun.name">fun.name</code></td>
<td>

<p>(Optional character) The name of the parent function, to be 
used in error messaging.
</p>
</td></tr>
<tr><td><code id="7.4.speed.em.code_+3A_plot.type">plot.type</code></td>
<td>

<p>(Optional numeric) For <code>speedEmPlot</code>, the type of 
speed/emission plot to generate: 1 a conventional 
scatter plot; or 2 a box-and-whisker plot. If not supplied, 
plot type 1 is 
selected by default. 
</p>
</td></tr>
<tr><td><code id="7.4.speed.em.code_+3A_scheme">scheme</code></td>
<td>

<p>(Various) For <code>speedEmPlot</code>, the scheme to apply to 
the plot, <code>loa</code> argument. 
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>fitSpeedEm</code> builds a speed and g/km emissions 
data sets for the supplied emissions, speed and 
time-series data. 
</p>
<p><code>speedEmPlot</code> generates a plot of one or more 
data set generated by <code>fitSpeedEm</code>. 
</p>


<h3>Value</h3>

<p><code>fitSpeedEm</code> generates a speed/emissions contribution 
report as a <code>pems</code> dataset. 
</p>
<p><code>speedEmPlot</code> generates a speed/emissions contribution 
report as a <code>lattice</code> plot. 
</p>


<h3>Note</h3>

<p>Regarding <code>engine.on</code>: This is specifically the time 
the engine is turned on rather than the row of data set 
where this happens. In some cases, they are same, e.g. when 
the data is logged at a regular 1-Hz and data capture is 
complete. 
</p>
<p>Regarding <code>method</code>: Method 1 [Doc further]. 
</p>
<p>[Doc further] 
</p>
<p>(See References.) 
</p>


<h3>Author(s)</h3>

<p>Karl Ropkins
</p>


<h3>References</h3>

<p><code>fitColdStart</code> uses methods described in:
</p>
<p>[COPERT on speed/emission terms]
</p>
<p>[Ropkins speed/emissions]
</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+common.calculations">common.calculations</a></code> (and 
<code><a href="#topic+checkUnits">checkUnits</a></code> and 
<code><a href="#topic+convertUnits">convertUnits</a></code>) for details of data management.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
###########
##example 1 
###########

#basic usage

#to do/maybe not run... time to compile...

</code></pre>

<hr>
<h2 id='8.1.pems.tidyverse.tools'>
Functions to use tidyverse code with pems.utils outputs  
</h2><span id='topic+8.1.pems.tidyverse.tools'></span><span id='topic+pems.tidyverse'></span><span id='topic+fortify.pems'></span><span id='topic+fortify'></span><span id='topic+select_.pems'></span><span id='topic+select.pems'></span><span id='topic+select'></span><span id='topic+rename_.pems'></span><span id='topic+rename.pems'></span><span id='topic+rename'></span><span id='topic+filter_.pems'></span><span id='topic+filter.pems'></span><span id='topic+filter'></span><span id='topic+arrange_.pems'></span><span id='topic+arrange.pems'></span><span id='topic+arrange'></span><span id='topic+slice_.pems'></span><span id='topic+slice.pems'></span><span id='topic+slice'></span><span id='topic+mutate_.pems'></span><span id='topic+mutate.pems'></span><span id='topic+mutate'></span><span id='topic+group_by.pems'></span><span id='topic+group_by_.pems'></span><span id='topic+group_by'></span><span id='topic+groups.pems'></span><span id='topic+groups'></span><span id='topic+ungroup.pems'></span><span id='topic+ungroup'></span><span id='topic+group_size.pems'></span><span id='topic+group_size'></span><span id='topic+n_groups.pems'></span><span id='topic+n_groups'></span><span id='topic+summarise_.pems'></span><span id='topic+summarise.pems'></span><span id='topic+summarise'></span><span id='topic+pull.pems'></span><span id='topic+pull'></span><span id='topic+left_join.pems'></span><span id='topic+left_join'></span><span id='topic+inner_join.pems'></span><span id='topic+inner_join'></span><span id='topic+right_join.pems'></span><span id='topic+right_join'></span><span id='topic+full_join.pems'></span><span id='topic+full_join'></span><span id='topic+semi_join.pems'></span><span id='topic+semi_join'></span><span id='topic+anti_join.pems'></span><span id='topic+anti_join'></span>

<h3>Description</h3>

<p>Various codes and methods.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>
#ggplot2 

## S3 method for class 'pems'
fortify(model, data, ...)

#dplyr (1) standard methods

## S3 method for class 'pems'
select(.data, ...)
## S3 method for class 'pems'
rename(.data, ...)
## S3 method for class 'pems'
filter(.data, ...)
## S3 method for class 'pems'
arrange(.data, ...)
## S3 method for class 'pems'
slice(.data, ...)
## S3 method for class 'pems'
mutate(.data, ..., units=NULL, warn=TRUE)
## S3 method for class 'pems'
group_by(.data, ..., .add=FALSE)
## S3 method for class 'pems'
groups(x)
## S3 method for class 'pems'
ungroup(x, ...)
## S3 method for class 'pems'
group_size(x)
## S3 method for class 'pems'
n_groups(x)
## S3 method for class 'pems'
summarise(.data, ...)
## S3 method for class 'pems'
pull(.data, ...)

#dplyr (2) related underscore methods

## S3 method for class 'pems'
select_(.data, ..., warn=TRUE)
## S3 method for class 'pems'
rename_(.data, ..., warn=TRUE)
## S3 method for class 'pems'
filter_(.data, ..., warn=TRUE)
## S3 method for class 'pems'
arrange_(.data, ..., warn=TRUE)
## S3 method for class 'pems'
slice_(.data, ..., warn=TRUE)
## S3 method for class 'pems'
mutate_(.data, ..., units=NULL, warn=TRUE)
## S3 method for class 'pems'
group_by_(.data, ..., .add=FALSE, warn=TRUE)             
## S3 method for class 'pems'
summarise_(.data, ..., warn=TRUE)

#dplyr (3) joining methods
## S3 method for class 'pems'
inner_join(x, y, by = NULL, copy = FALSE, ...)
## S3 method for class 'pems'
left_join(x, y, by = NULL, copy = FALSE, ...)
## S3 method for class 'pems'
right_join(x, y, by = NULL, copy = FALSE, ...)
## S3 method for class 'pems'
full_join(x, y, by = NULL, copy = FALSE, ...)
## S3 method for class 'pems'
semi_join(x, y, by = NULL, copy = FALSE, ...)
## S3 method for class 'pems'
anti_join(x, y, by = NULL, copy = FALSE, ...)

</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="8.1.pems.tidyverse.tools_+3A_model">model</code>, <code id="8.1.pems.tidyverse.tools_+3A_data">data</code></td>
<td>

<p>(pems.object) In <code>fortify</code>, the <code>pems</code> 
object to be used as a data source when plotting 
using <code>ggplot2</code> code. The method is rotuinely 
applied by <code>ggplot2</code>, so users can typically 
ignore this. See below.
</p>
</td></tr>
<tr><td><code id="8.1.pems.tidyverse.tools_+3A_...">...</code></td>
<td>

<p>(Optional) Other arguments, typically passed on to
equivalent tidyverse function or method.
</p>
</td></tr>
<tr><td><code id="8.1.pems.tidyverse.tools_+3A_.data">.data</code></td>
<td>

<p>(pems.object) For <code>dplyr</code> functions, the pems 
object to be used with, e.g. dplyr code. 
</p>
</td></tr> 
<tr><td><code id="8.1.pems.tidyverse.tools_+3A_warn">warn</code></td>
<td>

<p>(Optional) Give warnings? For an underscore methods: 
a warning that an underscore method was used 
(See Below). For mutate: if new elements are 
generated without unit assignments.
</p>
</td></tr>
<tr><td><code id="8.1.pems.tidyverse.tools_+3A_units">units</code></td>
<td>

<p>(Character) In mutate, the units to assign to 
new elements created by call. See Below.
</p>
</td></tr>
<tr><td><code id="8.1.pems.tidyverse.tools_+3A_x">x</code>, <code id="8.1.pems.tidyverse.tools_+3A_y">y</code></td>
<td>

<p>(Various) For <code>group...</code> functions, <code>x</code> 
is the <code>pems</code> dataset to be grouped. 
For <code>...join</code> functions, 
<code>x</code> and <code>y</code> are the two datasets 
(<code>pems</code>, codedata.frame, etc) to 
be joined together.
</p>
</td></tr>
<tr><td><code id="8.1.pems.tidyverse.tools_+3A_.add">.add</code></td>
<td>

<p>(Optional) Argument used by <code>group_by</code> and 
related <code>dplyr</code> grouping functions. 
</p>
</td></tr>
<tr><td><code id="8.1.pems.tidyverse.tools_+3A_by">by</code>, <code id="8.1.pems.tidyverse.tools_+3A_copy">copy</code></td>
<td>

<p>(Various) For <code>...join</code> functions, consistent 
with <code>dplyr</code>, <code>by</code> and <code>copy</code> are 
optional arguments. See Below.   
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>fortify</code> is used by <code>ggplot2</code> functions 
when these are used to plot data in a <code>pems</code> 
dataset. Most users will never have to use this 
directly. 
</p>
<p>The pems object methods <code>select</code>, 
<code>rename</code>, <code>filter</code>, 
<code>arrange</code>, <code>slice</code>, <code>mutate</code>, 
<code>group_by</code> and  <code>summarise</code> are similar 
to <code>data.frame</code> methods of the same 
names in <code>dplyr</code>, but (hopefully) they 
also track units, etc, like a pems object. 
Work in progress. See below, especially Note.
</p>
<p>Equivalent underscore methods (<code>select_</code>, etc) 
are also provided, although it should be noted that 
they are probably going when <code>dplyr</code> drops 
these.
</p>
<p>Data joining methods include <code>inner_join</code>, 
<code>left_join</code>, <code>right_join</code>, <code>full_join</code>, 
<code>semi_join</code> and <code>anti_join</code>. Like above 
these are similar <code>data.frame</code> equivalents in 
<code>dplyr</code>, but (hopefully) also track units, etc, 
like a pems object. Same 'work in progress' caveat. 
See Note.
</p>


<h3>Value</h3>

<p><code>select</code> returns the requested part of the 
supplied pems object, e.g.:
<code>select(pems.1, velocity)</code> returns the velocity 
element of pems.1 as a single column pems.object, 
consistent with the data.frame handling of 
<code>select.data.frame</code>.
</p>
<p><code>rename</code> returns the supplied pems object with 
the requested name change, e.g.: 
<code>rename(pems.1, speed=velocity)</code> returns pems.1 
with the velocity column renamed speed.
</p>
<p><code>filter</code> returns the supplied pems object after 
the requested filter operation has been applied, 
e.g.: <code>filter(pems.1, velocity&gt;0.5)</code> returns 
pems.1 after excluding all rows where the velocity 
value was less than or equal to 0.5.
</p>
<p><code>arrange</code> returns the supplied pems object 
reordered based on order of values in an identified 
element, e.g.: <code>arrange(pems.1, velocity)</code> 
returns pems.1 with its row reordered lowest to 
highest velocity entry.
</p>
<p><code>slice</code> returns requested rows of the supplied 
pems object, e.g.: <code>slice(pems.1, 1:10)</code> returns 
rows 1 to 10 of pems.1 as a new pems object.
</p>
<p><code>mutate</code> returns the supplied pems object with 
extra elements calculated as requested, e.g.: 
<code>mutate(pems.1, new=velocity*2)</code> returns the 
pems object with additional column, called new, which 
is twice the values in the velocity column. The units 
of the new column can be set using the additional 
argument units, e.g. 
<code>mutate(pems.1, new=velocity*2, units="ick")</code>.
</p>
<p><code>group_by</code> returns a <code>grouped_df</code> object, 
which allowed by-group handling in subsequent 
<code>dplyr</code> code. 
</p>
<p><code>summarise</code> works like 
<code>summarise(data.frame, ...)</code>  and allows 
dataset calculations, e.g. 
<code>summarise(pems, mean(velocity))</code> calculates 
the mean of the <code>velocity</code> of a supplied 
<code>pems</code> object. Units cannot be tracked 
during such calls and outputs are returned as 
a <code>tibble</code> as with <code>summarise.data.frame</code>. 
</p>
<p>The <code>..._join</code> joining methods, join two 
supplied datasets. The first, <code>x</code>, 
must be a <code>pems</code> to employ <code>..._join.pems</code> 
but the second, <code>y</code> can be e.g. a 
<code>data.frame</code>, etc. 
</p>


<h3>Warning </h3>

<p>This currently work in progress - handle with care.
</p>


<h3>Note</h3>

<p>Currently not sure what I think about tidyverse, but 
it is always interesting, and ideas like 
<code>fortify</code> are nice.  
</p>
<p>The <code>fortify</code> method was developed by 
Hadley Wickham to simplify the integration of 
<code>ggplot2</code> functions and special object classes.
</p>
<p>It is a really nice idea for multiple reasons, the 
main one being that package users will probably never
have to worry about it. However, packaging it means 
you can use a <code>pems</code> object directly 
as the data argument with <code>ggplot2</code> code.
</p>


<h3>Author(s)</h3>

<p>Karl Ropkins
</p>


<h3>References</h3>

<p>Generics in general:
</p>
<p>H. Wickham. Advanced R. CRC Press, 2014.
</p>
<p>(Not yet fully implemented within this package.)
</p>
<p>ggplot2:
</p>
<p>H. Wickham. ggplot2: elegant graphics for data 
analysis. Springer New
York, 2009.
</p>
<p>(See Chapter 9, section 9.3, pages 169-175, 
for discussion of fortify)
</p>
<p>dplyr:
</p>
<p>Hadley Wickham, Romain Francois, Lionel Henry and
Kirill Muller (2020). dplyr: A Grammar of Data
Manipulation. R package version 1.0.2.
https://CRAN.R-project.org/package=dplyr
</p>

<hr>
<h2 id='9.1.example.data'>
example data for use with pems.utils
</h2><span id='topic+9.1.example.data'></span><span id='topic+example.data'></span><span id='topic+pems.1'></span>

<h3>Description</h3>

<p>Example data intended for use with functions in <code>pems.utils</code>. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>
   pems.1

</code></pre>


<h3>Format</h3>

<p><code>pems.1</code> is a example <code>pems</code> object.   
</p>


<h3>Details</h3>

<p><code>pems.1</code> is supplied as part of the <code>pems.utils</code> package. 
</p>


<h3>Note</h3>

<p>None at present
</p>


<h3>Source</h3>

<p>Reference in preparation
</p>


<h3>References</h3>

<p>None at present
</p>


<h3>See Also</h3>

<p>See examples in <code><a href="#topic+pems.structure">pems.structure</a></code>. 
</p>

<hr>
<h2 id='9.2.look-up.tables'>
reference data for use with pems.utils
</h2><span id='topic+9.2.look-up.tables'></span><span id='topic+look-up.tables'></span><span id='topic+ref.unit.conversions'></span><span id='topic+ref.chem'></span><span id='topic+ref.petrol'></span><span id='topic+ref.diesel'></span><span id='topic+pems.scheme'></span>

<h3>Description</h3>

<p>Various reference and example datasets intended for use with functions in 
<code>pems.utils</code>. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>
   ref.unit.conversions

   ref.chem

   ref.petrol

   ref.diesel

   pems.scheme

</code></pre>


<h3>Format</h3>

<p><code>ref.unit.conversions</code>: Unit conversion methods stored as a list of lists. See Details.
</p>
<p><code>ref.chem, ref.petrol, ref.diesel</code>: Common chemical and fuel constants stored as lists.  
</p>
<p><code>pems.scheme</code>: Default scheme for <code>pems.utils</code> plots.
</p>


<h3>Details</h3>

<p><code>unit.conversions</code> is basically a 'look-up' for unit conversion methods. Each element of 
the list is another list. These lists are each individual conversion methods comprising four 
elements: <code>to</code> and <code>from</code>, character vectors given the unit ids and alias of the unit 
types that can be converted using the method; <code>conversion</code>, a function for the associated 
conversion method; and (possibly) <code>tag</code>, a more detailed description of the conversion 
intended for use in documentation.      
</p>
<p>Other <code>ref...</code> are sets of constants or reference information stored as lists. <code>ref.chem</code> 
contains atomic weights of some elements and molecular weights of some species. <code>ref.petrol</code> and 
<code>ref.diesel</code> contain default properties for typical fuels.  
</p>


<h3>Note</h3>

<p><code>ref.unit.conversions</code> can be updated locally. See <code><a href="#topic+convertUnits">convertUnits</a></code>, 
<code><a href="#topic+addUnitConversion">addUnitConversion</a></code>, etc.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
#basic structure
ref.unit.conversions[[1]]

</code></pre>

<hr>
<h2 id='pems.utils-package'>
pems.utils 
</h2><span id='topic+pems.utils-package'></span><span id='topic+pems.utils'></span>

<h3>Description</h3>

<p>The R package pems.utils contains a range of functions for the routine handling 
and analysis of data collected by portable emissions measurement systems (PEMS) 
and other similar mobile monitoring systems.  
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> pems.utils</td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 0.2.29.1</td>
</tr>
<tr>
 <td style="text-align: left;"> 
Date: </td><td style="text-align: left;"> 2021-04-20</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> GPL (&gt;= 2)</td>
</tr>
<tr>
 <td style="text-align: left;">
LazyLoad: </td><td style="text-align: left;"> yes</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

<p>The <code>pems.utils</code> functions have been arranged according to usage, as 
follows:
</p>
<p>1. Getting data in and out of <code>pems.utils</code>.
</p>
<p>1.1. Functions for making and importing datasets for use with <code>pems.utils</code>: <code><a href="#topic+pems">pems</a></code>, 
<code><a href="#topic+import2PEMS">import2PEMS</a></code>, etc.
</p>
<p>1.2. Exporting data from pems objects and R: <code><a href="#topic+export.data">export.data</a></code>.
</p>
<p>2. Data Structure and General Handling
</p>
<p>2.1. The pems object structure: <code><a href="#topic+pems.structure">pems.structure</a></code>, <code><a href="#topic+getPEMSElement">getPEMSElement</a></code>, 
<code><a href="#topic+pemsData">pemsData</a></code>, etc. 
</p>
<p>3. Generic pems handling
</p>
<p>3.1. pems objects, <code><a href="#topic+pems.generics">pems.generics</a></code>.
</p>
<p>3.2. pems.element objects, <code><a href="#topic+pems.element.generics">pems.element.generics</a></code>.
</p>
<p>4. Structure Handling 
</p>
<p>4.1. Merging pems objects: <code><a href="#topic+merge.pems">merge.pems</a></code>, <code><a href="#topic+align">align</a></code>, etc. 
</p>
<p>4.2. Referencing pems objects: <code><a href="#topic+referencing.pems.data">referencing.pems.data</a></code>, <code><a href="#topic+refRow">refRow</a></code>, etc.
</p>
<p>4.3. Time handling functions: <code><a href="#topic+regularize">regularize</a></code>, etc.  
</p>
<p>4.4. Unit handler functions: <code><a href="#topic+getUnits">getUnits</a></code>, <code><a href="#topic+setUnits">setUnits</a></code>, <code><a href="#topic+convertUnits">convertUnits</a></code>, etc.
</p>
<p>5. pems Data Handling 
</p>
<p>5.1. Plots for pems objects: <code><a href="#topic+pems.plots">pems.plots</a></code>, <code><a href="#topic+latticePlot">latticePlot</a></code>, <code><a href="#topic+pemsPlot">pemsPlot</a></code>, etc.
</p>
<p>6. Calculations
</p>
<p>6.1. Common calculations: <code><a href="#topic+common.calculations">common.calculations</a></code>, <code><a href="#topic+calcDistance">calcDistance</a></code>, <code><a href="#topic+calcAccel">calcAccel</a></code>, etc.
</p>
<p>6.2. Common <code><a href="#topic+check...">check...</a></code> functions for the routine handling of function arguments/user inputs.
</p>
<p>6.3. Other correction code
</p>
<p>6.4. Analysing data in pems objects: <code><a href="#topic+summary.reports">summary.reports</a></code>
</p>
<p>7. Refernce datasets, examples, look-up tables, etc.
</p>
<p>7.1. Example datasets: <code><a href="#topic+pems.1">pems.1</a></code>.
</p>
<p>7.2. look-up tables: <code><a href="#topic+ref.unit.conversions">ref.unit.conversions</a></code>, etc.
</p>
<p>8. Specialist code
</p>
<p>8.1. VSP calculations: <code><a href="#topic+calcVSP">calcVSP</a></code>, etc.
</p>
<p>8.2. Emissions calculations: <code><a href="#topic+calcEm">calcEm</a></code>, etc.
</p>
<p>9. Other Code 
</p>
<p>9.1. Tidyverse related code... <code><a href="#topic+pems.tidyverse">pems.tidyverse</a></code>
</p>


<h3>Author(s)</h3>

<p>Karl Ropkins
Maintainer: Karl Ropkins &lt;k.ropkins@its.leeds.ac.uk&gt;
</p>


<h3>References</h3>

<p>Functions in <code>pems.utils</code> make extensive use of code developed by others. 
In particular, I gratefully acknowledge the huge contributions of the R Core Team 
and numerous contributors in developing and maintaining R:
</p>
<p>R Development Core Team (2011). R: A language and environment for
statistical computing. R Foundation for Statistical Computing,
Vienna, Austria. ISBN 3-900051-07-0, URL http://www.R-project.org/.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+pems">pems</a></code>, <code><a href="#topic+import2PEMS">import2PEMS</a></code> 
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
