<!DOCTYPE html><html><head><title>Help for package apollo</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {apollo}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#.onAttach'><p>Prints package startup message</p></a></li>
<li><a href='#apollo_addCovariance'><p>Adds covariance matrix to Apollo model</p></a></li>
<li><a href='#apollo_attach'><p>Attaches predefined variables.</p></a></li>
<li><a href='#apollo_avgInterDraws'><p>Averages across inter-individual draws.</p></a></li>
<li><a href='#apollo_avgIntraDraws'><p>Averages across intra-individual draws.</p></a></li>
<li><a href='#apollo_basTest'><p>Ben-Akiva &amp; Swait test</p></a></li>
<li><a href='#apollo_bootstrap'><p>Bootstrap a model</p></a></li>
<li><a href='#apollo_checkArguments'><p>Checks definitions of Apollo functions</p></a></li>
<li><a href='#apollo_choiceAnalysis'><p>Reports market share for subsamples</p></a></li>
<li><a href='#apollo_classAlloc'><p>Calculates class allocation probabilities for a Latent Class model</p></a></li>
<li><a href='#apollo_cnl'><p>Calculates Cross-Nested Logit probabilities</p></a></li>
<li><a href='#apollo_combineModels'><p>Combines separate model components.</p></a></li>
<li><a href='#apollo_combineResults'><p>Write model results to file</p></a></li>
<li><a href='#apollo_compareInputs'><p>Compares the content of apollo_inputs to their counterparts in the global environment</p></a></li>
<li><a href='#apollo_conditionals'><p>Calculates conditionals</p></a></li>
<li><a href='#apollo_deltaMethod'><p>Delta method for Apollo models</p></a></li>
<li><a href='#apollo_detach'><p>Detaches parameters and the database.</p></a></li>
<li><a href='#apollo_dft'><p>Calculate DFT probabilities</p></a></li>
<li><a href='#apollo_diagnostics'><p>Pre-process input for common models</p>
return</a></li>
<li><a href='#apollo_drugChoiceData'><p>Simulated dataset of medication choice.</p></a></li>
<li><a href='#apollo_dVdB'><p>Calculates gradients of utility functions</p></a></li>
<li><a href='#apollo_dVdBOld'><p>Calculates gradients of utility functions</p></a></li>
<li><a href='#apollo_el'><p>Calculates Exploded Logit probabilities</p></a></li>
<li><a href='#apollo_emdc'><p>MDC model with exogenous budget</p></a></li>
<li><a href='#apollo_emdc1'><p>MDC model with exogenous budget</p></a></li>
<li><a href='#apollo_emdc2'><p>Extended MDC</p></a></li>
<li><a href='#apollo_estimate'><p>Estimates model</p></a></li>
<li><a href='#apollo_estimateHB'><p>Estimates model using Bayesian estimation</p></a></li>
<li><a href='#apollo_expandLoop'><p>Expands loops in a function or expression</p></a></li>
<li><a href='#apollo_firstRow'><p>Keeps only the first row for each individual</p></a></li>
<li><a href='#apollo_fitsTest'><p>Compares log-likelihood of model across categories</p></a></li>
<li><a href='#apollo_fmnl'><p>Calculates Fractional Multinomial Logit probabilities</p></a></li>
<li><a href='#apollo_fnl'><p>Calculates Fractional Nested Logit probabilities</p></a></li>
<li><a href='#apollo_initialise'><p>Prepares environment</p></a></li>
<li><a href='#apollo_insertComponentName'><p>Adds componentName2 to model calls</p></a></li>
<li><a href='#apollo_insertFunc'><p>Modifies function to make it compatible with analytic gradients</p></a></li>
<li><a href='#apollo_insertOLList'><p>Replaces <code>tau=c(...)</code> by <code>tau=list(...)</code> in calls to <code>apollo_ol</code></p></a></li>
<li><a href='#apollo_insertRows'><p>Inserts rows</p></a></li>
<li><a href='#apollo_insertRRMQuotes'><p>Introduces quotes into rrm_settings</p></a></li>
<li><a href='#apollo_insertScaling'><p>Scales variables inside a function</p></a></li>
<li><a href='#apollo_keepRows'><p>Keeps only some rows</p></a></li>
<li><a href='#apollo_lc'><p>Calculates the likelihood of a latent class model</p></a></li>
<li><a href='#apollo_lcConditionals'><p>Calculates conditionals for latent class models.</p></a></li>
<li><a href='#apollo_lcEM'><p>Uses EM for latent class model</p></a></li>
<li><a href='#apollo_lcUnconditionals'><p>Returns unconditionals for a latent class model model</p></a></li>
<li><a href='#apollo_llCalc'><p>Calculates log-likelihood of all model components</p></a></li>
<li><a href='#apollo_loadModel'><p>Loads model from file</p></a></li>
<li><a href='#apollo_longToWide'><p>Converts data from long to wide format.</p></a></li>
<li><a href='#apollo_lrTest'><p>Likelihood ratio test</p></a></li>
<li><a href='#apollo_makeCluster'><p>Creates cluster for estimation.</p></a></li>
<li><a href='#apollo_makeDraws'><p>Creates draws for models with mixing</p></a></li>
<li><a href='#apollo_makeGrad'><p>Creates gradient function.</p></a></li>
<li><a href='#apollo_makeHessian'><p>Creates hessian function.</p></a></li>
<li><a href='#apollo_makeLogLike'><p>Creates log-likelihood function.</p></a></li>
<li><a href='#apollo_mdcev'><p>Calculates MDCEV likelihoods</p></a></li>
<li><a href='#apollo_mdcev2'><p>Calculates MDCEV likelihoods</p></a></li>
<li><a href='#apollo_mdcnev'><p>Calculates MDCNEV likelihoods</p></a></li>
<li><a href='#apollo_mixConditionals'><p>Calculates conditionals for continuous mixture models</p></a></li>
<li><a href='#apollo_mixEM'><p>Uses EM for models with continuous random coefficients</p></a></li>
<li><a href='#apollo_mixUnconditionals'><p>Returns draws for continuously distributed random parameters in mixture model</p></a></li>
<li><a href='#apollo_mlhs'><p>Generate random draws using MLHS algorithm</p></a></li>
<li><a href='#apollo_mnl'><p>Calculates Multinomial Logit probabilities</p></a></li>
<li><a href='#apollo_modeChoiceData'><p>Simulated dataset of mode choice.</p></a></li>
<li><a href='#apollo_modelOutput'><p>Prints estimation results to console</p></a></li>
<li><a href='#apollo_modifyUserDefFunc'><p>Checks and modifies Apollo user-defined functions</p></a></li>
<li><a href='#apollo_nl'><p>Calculates Nested Logit probabilities</p></a></li>
<li><a href='#apollo_normalDensity'><p>Calculates density for a Normal distribution</p></a></li>
<li><a href='#apollo_ol'><p>Calculates Ordered Logit probabilities</p></a></li>
<li><a href='#apollo_op'><p>Calculates Ordered Probit probabilities</p></a></li>
<li><a href='#apollo_outOfSample'><p>Cross-validation of fit (LL)</p></a></li>
<li><a href='#apollo_ownModel'><p>Calculates own model probabilities</p></a></li>
<li><a href='#apollo_panelProd'><p>Calculates product across observations from same individual.</p></a></li>
<li><a href='#apollo_prediction'><p>Predicts using an estimated model</p></a></li>
<li><a href='#apollo_prepareProb'><p>Checks likelihood function</p></a></li>
<li><a href='#apollo_preprocess'><p>Pre-process input for multiple models</p>
return</a></li>
<li><a href='#apollo_print'><p>Prints message to terminal</p></a></li>
<li><a href='#apollo_readBeta'><p>Reads parameters from file</p></a></li>
<li><a href='#apollo_rrm'><p>Calculates Random Regret Minimisation model probabilities</p></a></li>
<li><a href='#apollo_saveOutput'><p>Saves estimation results to files.</p></a></li>
<li><a href='#apollo_searchStart'><p>Searches for better starting values.</p></a></li>
<li><a href='#apollo_setRows'><p>Sets specified rows to a given value</p></a></li>
<li><a href='#apollo_sharesTest'><p>Compares predicted and observed shares</p></a></li>
<li><a href='#apollo_sink'><p>Starts or stops writing output to a text file.</p></a></li>
<li><a href='#apollo_speedTest'><p>Measures evaluation time of a model</p></a></li>
<li><a href='#apollo_swissRouteChoiceData'><p>Dataset of route choice.</p></a></li>
<li><a href='#apollo_timeUseData'><p>Dataset of time use.</p></a></li>
<li><a href='#apollo_unconditionals'><p>Returns unconditionals for models with random heterogeneity</p></a></li>
<li><a href='#apollo_validate'><p>Pre-process input for common models</p>
return</a></li>
<li><a href='#apollo_validateControl'><p>Validates apollo_control</p></a></li>
<li><a href='#apollo_validateData'><p>Validates data</p></a></li>
<li><a href='#apollo_validateHBControl'><p>Validates the <code>apollo_HB</code> list of parameters</p></a></li>
<li><a href='#apollo_validateInputs'><p>Prepares input for <code>apollo_estimate</code></p></a></li>
<li><a href='#apollo_varcov'><p>Calculates variance-covariance matrix of an Apollo model</p></a></li>
<li><a href='#apollo_varList'><p>Lists variable names and definitions used inside a function</p></a></li>
<li><a href='#apollo_weighting'><p>Applies weights</p></a></li>
<li><a href='#apollo_writeF12'><p>Writes an F12 file</p></a></li>
<li><a href='#apollo_writeTheta'><p>Writes the vector [beta,ll] to a file called <code>modelname_iterations.csv</code></p></a></li>
<li><a href='#aux_validateRows'><p>Validates and expands rows if necessary.</p></a></li>
<li><a href='#print.apollo'><p>Prints brief summary of Apollo model</p></a></li>
<li><a href='#summary.apollo'><p>Prints summary of Apollo model</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Tools for Choice Model Estimation and Application</td>
</tr>
<tr>
<td>Version:</td>
<td>0.3.3</td>
</tr>
<tr>
<td>Description:</td>
<td>Choice models are a widely used technique across numerous scientific disciplines. The Apollo package is a very flexible tool for the estimation and application 
    of choice models in R. Users are able to write their own 
    model functions or use a mix of already available ones. Random heterogeneity, 
    both continuous and discrete and at the level of individuals and 
    choices, can be incorporated for all models. There is support for both standalone 
    models and hybrid model structures.  Both classical 
    and Bayesian estimation is available, and multiple discrete 
    continuous models are covered in addition to discrete choice. 
    Multi-threading processing is supported for estimation and a large
    number of pre and post-estimation routines, including for computing posterior
    (individual-level) distributions are available. 
    For examples, a manual, and a support forum, visit 
    <a href="http://www.ApolloChoiceModelling.com">http://www.ApolloChoiceModelling.com</a>. For more information on choice 
    models see Train, K. (2009) &lt;isbn:978-0-521-74738-7&gt; and Hess, 
    S. &amp; Daly, A.J. (2014) &lt;isbn:978-1-781-00314-5&gt; for an overview 
    of the field.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="http://www.apolloChoiceModelling.com">http://www.apolloChoiceModelling.com</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="http://www.apolloChoiceModelling.com/forum/">http://www.apolloChoiceModelling.com/forum/</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.0.0), stats, utils</td>
</tr>
<tr>
<td>Imports:</td>
<td>Rcpp (&ge; 1.0.0), maxLik, mnormt, mvtnorm, graphics,
randtoolbox, numDeriv, parallel, Deriv, matrixStats, RSGHB,
coda, tibble, stringr, bgw (&ge; 0.1.3), cli, Rsolnp</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp, RcppArmadillo, RcppEigen</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, testthat</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.1</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-06-03 16:49:38 UTC; stephane.hess</td>
</tr>
<tr>
<td>Author:</td>
<td>Stephane Hess [aut, cre],
  David Palma [aut],
  Thomas Hancock [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Stephane Hess &lt;S.Hess@leeds.ac.uk&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-06-04 09:46:44 UTC</td>
</tr>
</table>
<hr>
<h2 id='.onAttach'>Prints package startup message</h2><span id='topic+.onAttach'></span>

<h3>Description</h3>

<p>This function is only called by R when attaching the package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>.onAttach(libname, pkgname)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id=".onAttach_+3A_libname">libname</code></td>
<td>
<p>Name of library.</p>
</td></tr>
<tr><td><code id=".onAttach_+3A_pkgname">pkgname</code></td>
<td>
<p>Name of package.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Nothing
</p>

<hr>
<h2 id='apollo_addCovariance'>Adds covariance matrix to Apollo model</h2><span id='topic+apollo_addCovariance'></span>

<h3>Description</h3>

<p>Receives an estimated model object, calculates its Hessian, and classical and robust covariance matrix, and returns the  
same model object, but with these additional elements.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_addCovariance(model, apollo_inputs)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_addCovariance_+3A_model">model</code></td>
<td>
<p>Model object. Estimated model object as returned by function <a href="#topic+apollo_estimate">apollo_estimate</a>.</p>
</td></tr>
<tr><td><code id="apollo_addCovariance_+3A_apollo_inputs">apollo_inputs</code></td>
<td>
<p>List grouping most common inputs. Created by function <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>model.
</p>

<hr>
<h2 id='apollo_attach'>Attaches predefined variables.</h2><span id='topic+apollo_attach'></span>

<h3>Description</h3>

<p>Attaches parameters and data to allow users to refer to individual variables by name without reference to the object that contains them.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_attach(apollo_beta, apollo_inputs)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_attach_+3A_apollo_beta">apollo_beta</code></td>
<td>
<p>Named numeric vector. Names and values for parameters.</p>
</td></tr>
<tr><td><code id="apollo_attach_+3A_apollo_inputs">apollo_inputs</code></td>
<td>
<p>List grouping most common inputs. Created by function <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function should be called at the beginning of <code>apollo_probabilities</code>
to make writing the log-likelihood more user-friendly. If used, then <a href="#topic+apollo_detach">apollo_detach</a>
should be called at the end of <code>apollo_probabilities</code>, or more conveniently, 
using <a href="base.html#topic+on.exit">on.exit</a> after the initial call to <code>apollo_attach</code>.
<code>apollo_attach</code> attaches <code>apollo_beta</code>, <code>database</code>, <code>draws</code>,
and the output of <code>apollo_randCoeff</code> and <code>apollo_lcPars</code>, if they are
defined by the user.
</p>


<h3>Value</h3>

<p>Nothing.
</p>

<hr>
<h2 id='apollo_avgInterDraws'>Averages across inter-individual draws.</h2><span id='topic+apollo_avgInterDraws'></span>

<h3>Description</h3>

<p>Averages individual-specific likelihood across inter-individual draws.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_avgInterDraws(P, apollo_inputs, functionality)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_avgInterDraws_+3A_p">P</code></td>
<td>
<p>List of vectors, matrices or 3-dim arrays. Likelihood of the model components.</p>
</td></tr>
<tr><td><code id="apollo_avgInterDraws_+3A_apollo_inputs">apollo_inputs</code></td>
<td>
<p>List grouping most common inputs. Created by function <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
<tr><td><code id="apollo_avgInterDraws_+3A_functionality">functionality</code></td>
<td>
<p>Character. Setting instructing Apollo what processing to apply to the likelihood function. This is in general controlled by the functions that call <code>apollo_probabilities</code>, though the user can also call <code>apollo_probabilities</code> manually with a given functionality for testing/debugging. Possible values are:
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: For further processing/debugging, produces likelihood for each model component (if multiple components are present), at the level of individual draws and observations.
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: For conditionals, produces likelihood of the full model, at the level of individual inter-individual draws.
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: For model estimation, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: For model estimation, produces analytical gradients of the likelihood, where possible.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Prepares output for post-estimation reporting.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: For model prediction, produces probabilities for individual alternatives and individual model components (if multiple components are present) at the level of an observation, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Prepares likelihood functions for use in estimation.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: For debugging, produces probabilities of all alternatives and individual model components at the level of an observation, at the level of individual draws.
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: Prepares output summarising model and choiceset structure.
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: Produces overall model likelihood with constants only.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Validates model specification, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: Produces overall model likelihood with all parameters at zero.
</p>
</li></ul>
</td></tr>
</table>


<h3>Value</h3>

<p>Argument <code>P</code> with (for most functionalities) the original contents averaged over inter-individual draws. Shape depends on argument <code>functionality</code>.
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: Returns <code>P</code> without changes.
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: Returns <code>P</code> without averaging across draws. Drops all components except <code>"model"</code>.
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: Returns <code>P</code> containing the likelihood of the model averaged across inter-individual draws. Drops all components except <code>"model"</code>.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: Returns <code>P</code> containing the gradient of the likelihood averaged across inter-individual draws. Drops all components except <code>"model"</code>.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Returns <code>P</code> containing the likelihood of all model components averaged across inter-individual draws.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: Returns <code>P</code> containing the probabilities/likelihoods of all alternatives for all model components averaged across inter-individual draws.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Returns <code>P</code> without changes.           
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: Returns <code>P</code> without changes.
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: Returns <code>P</code> without changes.
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: Returns <code>P</code> without changes.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Returns <code>P</code> containing the likelihood of the model averaged across inter-individual draws. Drops all components except <code>"model"</code>.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: Returns <code>P</code> without changes.
</p>
</li></ul>


<hr>
<h2 id='apollo_avgIntraDraws'>Averages across intra-individual draws.</h2><span id='topic+apollo_avgIntraDraws'></span>

<h3>Description</h3>

<p>Averages observation-specific likelihood across intra-individual draws.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_avgIntraDraws(P, apollo_inputs, functionality)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_avgIntraDraws_+3A_p">P</code></td>
<td>
<p>List of vectors, matrices or 3-dim arrays. Likelihood of the model components.</p>
</td></tr>
<tr><td><code id="apollo_avgIntraDraws_+3A_apollo_inputs">apollo_inputs</code></td>
<td>
<p>List grouping most common inputs. Created by function <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
<tr><td><code id="apollo_avgIntraDraws_+3A_functionality">functionality</code></td>
<td>
<p>Character. Setting instructing Apollo what processing to apply to the likelihood function. This is in general controlled by the functions that call <code>apollo_probabilities</code>, though the user can also call <code>apollo_probabilities</code> manually with a given functionality for testing/debugging. Possible values are:
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: For further processing/debugging, produces likelihood for each model component (if multiple components are present), at the level of individual draws and observations.
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: For conditionals, produces likelihood of the full model, at the level of individual inter-individual draws.
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: For model estimation, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: For model estimation, produces analytical gradients of the likelihood, where possible.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Prepares output for post-estimation reporting.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: For model prediction, produces probabilities for individual alternatives and individual model components (if multiple components are present) at the level of an observation, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Prepares likelihood functions for use in estimation.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: For debugging, produces probabilities of all alternatives and individual model components at the level of an observation, at the level of individual draws.
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: Prepares output summarising model and choiceset structure.
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: Produces overall model likelihood with constants only.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Validates model specification, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: Produces overall model likelihood with all parameters at zero.
</p>
</li></ul>
</td></tr>
</table>


<h3>Value</h3>

<p>Argument <code>P</code> with (for most functionalities) the original contents averaged over intra-individual draws. Shape depends on argument <code>functionality</code>.
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: Returns <code>P</code> without changes.
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: Returns <code>P</code> containing the likelihood of the model averaged across intra-individual draws. Drops all components except for <code>"model"</code>.
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: Returns <code>P</code> containing the likelihood of the model averaged across intra-individual draws. Drops all components except <code>"model"</code>.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: Returns <code>P</code> containing the gradient of the likelihood averaged across intra-individual draws. Drops all components except <code>"model"</code>.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Returns <code>P</code> containing the likelihood of all model components averaged across intra-individual draws.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: Returns <code>P</code> containing the probabilities of all alternatives for all model components averaged across intra-individual draws.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Returns <code>P</code> without changes.           
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: Returns <code>P</code> without changes.
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: Returns <code>P</code> without changes.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Returns <code>P</code> containing the likelihood of the model averaged across intra-individual draws. Drops all components but <code>"model"</code>.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: Returns <code>P</code> without changes.
</p>
</li></ul>


<hr>
<h2 id='apollo_basTest'>Ben-Akiva &amp; Swait test</h2><span id='topic+apollo_basTest'></span>

<h3>Description</h3>

<p>Carries out the Ben-Akiva &amp; Swait test for non-nested models and reports the corresponding p-value.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_basTest(model1, model2)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_basTest_+3A_model1">model1</code></td>
<td>
<p>Either a character variable with the name (and possibly path) of a previously estimated model, or an estimated 
model in memory, as returned by <a href="#topic+apollo_estimate">apollo_estimate</a>.</p>
</td></tr>
<tr><td><code id="apollo_basTest_+3A_model2">model2</code></td>
<td>
<p>Either a character variable with the name (and possibly path) of a previously estimated model, or an estimated 
model in memory, as returned by <a href="#topic+apollo_estimate">apollo_estimate</a>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The two models need to both be discrete choice, and need to have been estimated on the same data.
</p>


<h3>Value</h3>

<p>Ben-Akiva &amp; Swait test p-value (invisibly)
</p>

<hr>
<h2 id='apollo_bootstrap'>Bootstrap a model</h2><span id='topic+apollo_bootstrap'></span>

<h3>Description</h3>

<p>Samples individuals with replacement from the database, and estimates the model for each sample.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_bootstrap(
  apollo_beta,
  apollo_fixed,
  apollo_probabilities,
  apollo_inputs,
  estimate_settings = list(estimationRoutine = "bgw", maxIterations = 200, writeIter =
    FALSE, hessianRoutine = "none", printLevel = 2L, silent = FALSE, maxLik_settings =
    list()),
  bootstrap_settings = list(nRep = 30, samples = NA, calledByEstimate = FALSE, recycle =
    TRUE)
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_bootstrap_+3A_apollo_beta">apollo_beta</code></td>
<td>
<p>Named numeric vector. Names and values for parameters.</p>
</td></tr>
<tr><td><code id="apollo_bootstrap_+3A_apollo_fixed">apollo_fixed</code></td>
<td>
<p>Character vector. Names (as defined in <code>apollo_beta</code>) of parameters whose value should not change during estimation.</p>
</td></tr>
<tr><td><code id="apollo_bootstrap_+3A_apollo_probabilities">apollo_probabilities</code></td>
<td>
<p>Function. Returns probabilities of the model to be estimated. Must receive three arguments:
</p>

<ul>
<li> <p><strong><code>apollo_beta</code></strong>: Named numeric vector. Names and values of model parameters.
</p>
</li>
<li> <p><strong><code>apollo_inputs</code></strong>: List containing options of the model. See <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.
</p>
</li>
<li> <p><strong><code>functionality</code></strong>: Character. Can be either <strong><code>"components"</code></strong>, <strong><code>"conditionals"</code></strong>, <strong><code>"estimate"</code></strong> (default), <strong><code>"gradient"</code></strong>, <strong><code>"output"</code></strong>, <strong><code>"prediction"</code></strong>, <strong><code>"preprocess"</code></strong>, <strong><code>"raw"</code></strong>, <strong><code>"report"</code></strong>, <strong><code>"shares_LL"</code></strong>, <strong><code>"validate"</code></strong> or <strong><code>"zero_LL"</code></strong>.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_bootstrap_+3A_apollo_inputs">apollo_inputs</code></td>
<td>
<p>List grouping most common inputs. Created by function <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
<tr><td><code id="apollo_bootstrap_+3A_estimate_settings">estimate_settings</code></td>
<td>
<p>List. Options controlling the estimation process. See <a href="#topic+apollo_estimate">apollo_estimate</a>. 
<code>hessianRoutine="none"</code> by default.</p>
</td></tr>
<tr><td><code id="apollo_bootstrap_+3A_bootstrap_settings">bootstrap_settings</code></td>
<td>
<p>List containing settings for the sampling procedure. User input is required for all settings except those with a default or marked as optional. 
</p>

<ul>
<li> <p><strong>calledByEstimate</strong>: Logical. TRUE if <code>apollo_bootstrap</code> is called by <a href="#topic+apollo_estimate">apollo_estimate</a>. FALSE by default.
</p>
</li>
<li> <p><strong>nRep</strong>: Numeric scalar. Number of times the model must be estimated with different samples. Default is 30.
</p>
</li>
<li> <p><strong>recycle</strong>: Logical. If TRUE, the function will look for old output files and append new repetitions to them. If FALSE, output files will be overwritten.
</p>
</li>
<li> <p><strong>samples</strong>: Numeric matrix or data.frame. Optional argument. Must have as many rows as 
observations in the <code>database</code>, and as many columns as number of repetitions
wanted. Each column represents a re-sample, and each element the number of times 
that observation must be included in the sample. If this argument is provided, 
then <code>nRep</code> is ignored. Note that this allows sampling at the observation 
rather than the individual level, which is not recommended for panel data.
</p>
</li>
<li> <p><strong>seed</strong>: <strong>DEPRECATED, <code>apollo_control$seed</code> is used since v0.2.5</strong>. Numeric scalar (integer). 
Random number generator seed to generate the bootstrap samples. Only used if <code>samples</code> 
is <code>NA</code>. Default is 24.
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>This function implements a basic block bootstrap. It estimates the model parameters on <code>nRep</code> different samples.
Each new sample is constructed by sampling <strong>with replacement</strong> from the original full sample. Each new sample has as many 
individuals as the original sample, though some of them may be repeated. Sampling is done at the <strong>individual</strong> level, 
therefore if different individuals have different number of observations, each re-sample does not necessarily have the same number of observations.
</p>
<p>If the sampling should be done at the individual level (not recommended for panel data), then the optional 
<code>bootstrap_settings$samples</code> argument should be provided.
</p>
<p>For each sample, only the parameters and log-likelihood are estimated. Standard errors are not calculated (they may be added in 
future versions). The composition of the re-samples is stored in a file, but is stable with the same seed.
</p>
<p>This function writes three different files to the working or output directory:
</p>

<ul>
<li> <p><strong><code>modelName_bootstrap_params.csv</code></strong>: estimated parameters, final log-likelihood, and number of observations for each re-sample
</p>
</li>
<li> <p><strong><code>modelName_bootstrap_samples.csv</code></strong>: composition of each re-sample.
</p>
</li>
<li> <p><strong><code>modelName_bootstrap_vcov.csv</code></strong>: variance-covariance matrix of the estimated parameters across re-samples.
</p>
</li></ul>

<p>The first two files are updated throughout the run of this function, while the last one is only written once the function finishes.
</p>
<p>When run, this function will look for the first two files above in the working/output directory. If they are found, the function will
attempt to pick up re-sampling from where those files left off. This is useful in cases where the original bootstrapping was 
interrupted, or when additional re-sampling runs are to be performed.
</p>


<h3>Value</h3>

<p>List with three elements.
</p>

<ul>
<li> <p><strong><code>estimates</code></strong>: Matrix containing the parameter estimates for each repetition. As many rows as repetitions and as many columns as parameters.
</p>
</li>
<li> <p><strong><code>LL</code></strong>: Vector of final log-likelihoods of each repetition.
</p>
</li>
<li> <p><strong><code>varcov</code></strong>: Covariance matrix of the estimated parameters across the repetitions.
</p>
</li></ul>

<p>This function also writes three output files to the working/output directory, with the following names ('x' represents the model name):
</p>

<ul>
<li> <p><strong>x_bootstrap_params.csv</strong>: Table containing the parameter estimates, log-likelihood, and number of observations for each repetition.
</p>
</li>
<li> <p><strong>x_bootstrap_samples.csv</strong>: Table containing the description of the sample used in each repetition. Same format than <code>bootstrap_settings$samples</code>.
</p>
</li>
<li> <p><strong>x_bootstrap_vcov</strong>: Table containing the covariance matrix of estimated parameters across the repetitions.
</p>
</li></ul>


<hr>
<h2 id='apollo_checkArguments'>Checks definitions of Apollo functions</h2><span id='topic+apollo_checkArguments'></span>

<h3>Description</h3>

<p>Checks that the user-defined functions used by Apollo are correctly defined by the user.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_checkArguments(
  apollo_probabilities = NA,
  apollo_randCoeff = NA,
  apollo_lcPars = NA
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_checkArguments_+3A_apollo_probabilities">apollo_probabilities</code></td>
<td>
<p>Function. Likelihood function as defined by the user.</p>
</td></tr>
<tr><td><code id="apollo_checkArguments_+3A_apollo_randcoeff">apollo_randCoeff</code></td>
<td>
<p>Function. Used with mixing models. Constructs the random parameters of a mixing model. Receives two arguments:
</p>

<ul>
<li> <p><strong><code>apollo_beta</code></strong>: Named numeric vector. Names and values of model parameters. 
</p>
</li>
<li> <p><strong><code>apollo_inputs</code></strong>: The output of this function (<code>apollo_validateInputs</code>).
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_checkArguments_+3A_apollo_lcpars">apollo_lcPars</code></td>
<td>
<p>Function. Used with latent class models. Constructs a list of parameters for each latent class. Receives two arguments:
</p>

<ul>
<li> <p><strong><code>apollo_beta</code></strong>: Named numeric vector. Names and values of model parameters. 
</p>
</li>
<li> <p><strong><code>apollo_inputs</code></strong>: The output of this function (<code>apollo_validateInputs</code>).
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>It only checks that the functions have the correct definition of inputs. It does not run the functions.
</p>


<h3>Value</h3>

<p>Returns (invisibly) TRUE if definitions are correct, and FALSE otherwise.
</p>

<hr>
<h2 id='apollo_choiceAnalysis'>Reports market share for subsamples</h2><span id='topic+apollo_choiceAnalysis'></span>

<h3>Description</h3>

<p>Compares market shares across subsamples in dataset, and conducts statistical tests.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_choiceAnalysis(choiceAnalysis_settings, apollo_control, database)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_choiceAnalysis_+3A_choiceanalysis_settings">choiceAnalysis_settings</code></td>
<td>
<p>List. Contains settings for this function. User input is required for all settings except those with a default or marked as optional. 
</p>

<ul>
<li> <p><strong><code>alternatives</code></strong>: Named numeric vector. Names of alternatives and their corresponding value in <code>choiceVar</code>. Note that these need not necessarily be the alternatives as defined in the model, but could e.g. relate to cheapest/most expensive.
</p>
</li>
<li> <p><strong><code>avail</code></strong>: Named list of numeric vectors or scalars. Availabilities of alternatives, one element per alternative. Names of elements must match those in <code>alternatives</code>. Values can be 0 or 1. A user can also specify <code>avail=1</code> to indicate universal availability, or omit the setting completely.
</p>
</li>
<li> <p><strong><code>choiceVar</code></strong>: Numeric vector. Contains choices for all observations. It will usually be a column from the database. Values are defined in <code>alternatives</code>.
</p>
</li>
<li> <p><strong><code>explanators</code></strong>: data.frame. Variables determining subsamples of the database. Values in each column must describe a group or groups of individuals (e.g. socio-demographics). Most usually a subset of columns from the database.
</p>
</li>
<li> <p><strong><code>printToScreen</code></strong>: Logical. TRUE for returning output to screen as well as file. TRUE by default.
</p>
</li>
<li> <p><strong><code>rows</code></strong>: Boolean vector. Consideration of which rows to include. Length equal to the number of observations (nObs), with entries equal to TRUE for rows to include, and FALSE for rows to exclude. Default is <code>"all"</code>, equivalent to <code>rep(TRUE, nObs)</code>.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_choiceAnalysis_+3A_apollo_control">apollo_control</code></td>
<td>
<p>List. Options controlling the running of the code. See <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
<tr><td><code id="apollo_choiceAnalysis_+3A_database">database</code></td>
<td>
<p>data.frame. Data used by model.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Saves the output to a csv file in the working/output directory.
</p>


<h3>Value</h3>

<p>Silently returns a matrix containing the mean value for each explanator for those cases where an alternative is chosen and where it is not chosen, 
as well as the t-test comparing those means (H0: equivalence).
The table is also written to a file called <code>modelName_choiceAnalysis.csv</code> and printed to screen.
</p>

<hr>
<h2 id='apollo_classAlloc'>Calculates class allocation probabilities for a Latent Class model</h2><span id='topic+apollo_classAlloc'></span>

<h3>Description</h3>

<p>Calculates class allocation probabilities for a Latent Class model using a Multinomial Logit model and can also perform other operations based on the value of the <code>functionality</code> argument.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_classAlloc(classAlloc_settings)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_classAlloc_+3A_classalloc_settings">classAlloc_settings</code></td>
<td>
<p>List of inputs of the MNL model. It should contain the following.
</p>

<ul>
<li> <p><strong><code>utilities</code></strong>: Named list of deterministic utilities . Utilities of the classes in class allocation model. Names of elements must match those in <code>avail</code>, if provided.
</p>
</li>
<li> <p><strong><code>avail</code></strong>: Named list of numeric vectors or scalars. Availabilities of classes, one element per class Names of elements must match those in <code>classes</code>. Values can be 0 or 1. These can be scalars or vectors (of length equal to rows in the database). A user can also specify <code>avail=1</code> to indicate universal availability, or omit the setting completely.
</p>
</li>
<li> <p><strong><code>rows</code></strong>: Boolean vector. Consideration of which rows to include. Length equal to the number of observations (nObs), with entries equal to TRUE for rows to include, and FALSE for rows to exclude. Default is <code>"all"</code>, equivalent to <code>rep(TRUE, nObs)</code>. 
</p>
</li>
<li> <p><strong><code>componentName</code></strong>: Character. Name given to model component. If not provided by the user, Apollo will set the name automatically according to the element in <code>P</code> to which the function output is directed.
</p>
</li></ul>
</td></tr>
</table>


<h3>Value</h3>

<p>The returned object depends on the value of argument <code>functionality</code>, which it fetches from the calling stack (see <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>).
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: Same as <code>"estimate"</code>.
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: Same as <code>"estimate"</code>.
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: List of vector/matrices/arrays with the allocation probabilities for each class.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: List containing the likelihood and gradient of the model component.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Same as <code>"estimate"</code>.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: Same as <code>"estimate"</code>.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Returns a list with pre-processed inputs, based on <code>classAlloc_settings</code>.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: Same as <code>"estimate"</code>.
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: Same as <code>"estimate"</code>.
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: List with probabilities for each class in an equal shares setting.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Same as <code>"estimate"</code>, but it also runs a set of tests to validate the function inputs.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: List with probabilities for each class in an equal shares setting.
</p>
</li></ul>


<hr>
<h2 id='apollo_cnl'>Calculates Cross-Nested Logit probabilities</h2><span id='topic+apollo_cnl'></span>

<h3>Description</h3>

<p>Calculates the probabilities of a Cross-nested Logit model and can also perform other operations based on the value of the <code>functionality</code> argument.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_cnl(cnl_settings, functionality)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_cnl_+3A_cnl_settings">cnl_settings</code></td>
<td>
<p>List of inputs of the CNL model. User input is required for all settings except those with a default or marked as optional. 
</p>

<ul>
<li> <p><strong><code>alternatives</code></strong>: Named numeric vector. Names of alternatives and their corresponding value in <code>choiceVar</code>.
</p>
</li>
<li> <p><strong><code>avail</code></strong>: Named list of numeric vectors or scalars. Availabilities of alternatives, one element per alternative. Names of elements must match those in <code>alternatives</code>. Values can be 0 or 1. These can be scalars or vectors (of length equal to rows in the database). A user can also specify <code>avail=1</code> to indicate universal availability, or omit the setting completely.
</p>
</li>
<li> <p><strong><code>choiceVar</code></strong>: Numeric vector. Contains choices for all observations. It will usually be a column from the database. Values are defined in <code>alternatives</code>.
</p>
</li>
<li> <p><strong><code>cnlNests</code></strong>: List of numeric scalars or vectors. Lambda parameters for each nest. Elements must be named according to nests. The lambda at the root is fixed to 1, and therefore does not need to be defined.
</p>
</li>
<li> <p><strong><code>cnlStructure</code></strong>: Numeric matrix. One row per nest and one column per alternative. Each element of the matrix is the alpha parameter of that (nest, alternative) pair.
</p>
</li>
<li> <p><strong><code>componentName</code></strong>: Character. Name given to model component. If not provided by the user, Apollo will set the name automatically according to the element in <code>P</code> to which the function output is directed.
</p>
</li>
<li> <p><strong><code>utilities</code></strong>: Named list of deterministic utilities . Utilities of the alternatives. Names of elements must match those in <code>alternatives.</code>
</p>
</li>
<li> <p><strong><code>rows</code></strong>: Boolean vector. Consideration of which rows to include. Length equal to the number of observations (nObs), with entries equal to TRUE for rows to include, and FALSE for rows to exclude. Default is <code>"all"</code>, equivalent to <code>rep(TRUE, nObs)</code>.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_cnl_+3A_functionality">functionality</code></td>
<td>
<p>Character. Setting instructing Apollo what processing to apply to the likelihood function. This is in general controlled by the functions that call <code>apollo_probabilities</code>, though the user can also call <code>apollo_probabilities</code> manually with a given functionality for testing/debugging. Possible values are:
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: For further processing/debugging, produces likelihood for each model component (if multiple components are present), at the level of individual draws and observations.
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: For conditionals, produces likelihood of the full model, at the level of individual inter-individual draws.
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: For model estimation, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: For model estimation, produces analytical gradients of the likelihood, where possible.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Prepares output for post-estimation reporting.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: For model prediction, produces probabilities for individual alternatives and individual model components (if multiple components are present) at the level of an observation, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Prepares likelihood functions for use in estimation.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: For debugging, produces probabilities of all alternatives and individual model components at the level of an observation, at the level of individual draws.
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: Prepares output summarising model and choiceset structure.
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: Produces overall model likelihood with constants only.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Validates model specification, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: Produces overall model likelihood with all parameters at zero.
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>For the model to be consistent with utility maximisation, the estimated value of the lambda parameter of all nests
should be between 0 and 1. Lambda parameters are inversely proportional to the correlation between the error terms of 
alternatives in a nest. If lambda=1,  there is no relevant correlation between the unobserved
utility of alternatives in that nest.
Alpha parameters inside <code>cnlStructure</code> should be between 0 and 1. Using a transformation to ensure
this constraint is satisfied is recommended for complex structures (e.g. logistic transformation).
</p>


<h3>Value</h3>

<p>The returned object depends on the value of argument <code>functionality</code> as follows.
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: vector/matrix/array. Returns the probabilities for the chosen alternative for each observation.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: Not implemented.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Same as <code>"estimate"</code> but also writes summary of input data to internal Apollo log.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: List of vectors/matrices/arrays. Returns a list with the probabilities for all alternatives, with an extra element for the chosen alternative probability.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Returns a list with pre-processed inputs, based on <code>cnl_settings</code>.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: Same as <code>"prediction"</code>.
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: List with tree structure and choice overview.
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: vector/matrix/array. Returns the probability of the chosen alternative when only constants are estimated.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Same as <code>"estimate"</code>.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: vector/matrix/array. Returns the probability of the chosen alternative when all parameters are zero.
</p>
</li></ul>


<hr>
<h2 id='apollo_combineModels'>Combines separate model components.</h2><span id='topic+apollo_combineModels'></span>

<h3>Description</h3>

<p>Combines model components to create likelihood for overall model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_combineModels(
  P,
  apollo_inputs,
  functionality,
  components = NULL,
  asList = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_combineModels_+3A_p">P</code></td>
<td>
<p>List of vectors, matrices or 3-dim arrays. Likelihood of the model components.</p>
</td></tr>
<tr><td><code id="apollo_combineModels_+3A_apollo_inputs">apollo_inputs</code></td>
<td>
<p>List grouping most common inputs. Created by function <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
<tr><td><code id="apollo_combineModels_+3A_functionality">functionality</code></td>
<td>
<p>Character. Setting instructing Apollo what processing to apply to the likelihood function. This is in general controlled by the functions that call <code>apollo_probabilities</code>, though the user can also call <code>apollo_probabilities</code> manually with a given functionality for testing/debugging. Possible values are:
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: For further processing/debugging, produces likelihood for each model component (if multiple components are present), at the level of individual draws and observations.
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: For conditionals, produces likelihood of the full model, at the level of individual inter-individual draws.
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: For model estimation, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: For model estimation, produces analytical gradients of the likelihood, where possible.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Prepares output for post-estimation reporting.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: For model prediction, produces probabilities for individual alternatives and individual model components (if multiple components are present) at the level of an observation, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Prepares likelihood functions for use in estimation.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: For debugging, produces probabilities of all alternatives and individual model components at the level of an observation, at the level of individual draws.
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: Prepares output summarising model and choiceset structure.
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: Produces overall model likelihood with constants only.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Validates model specification, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: Produces overall model likelihood with all parameters at zero.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_combineModels_+3A_components">components</code></td>
<td>
<p>Character vector. Optional argument. Names of elements in P that should be multiplied to construct the whole model likelihood. If a single element is provided, it is interpreted as a regular expression. Default is to include all components in P.</p>
</td></tr>
<tr><td><code id="apollo_combineModels_+3A_aslist">asList</code></td>
<td>
<p>Logical. Only used if <code>functionality</code> is <code>"conditionals","estimate","validate","zero_LL"</code> or <code>"output"</code>. If <code>TRUE</code>, it will return a list as described in the 'Value' section. If <code>FALSE</code>, it will only return a vector/matrix/3-dim array of the product of likelihoods inside P. Default is <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function should be called inside apollo_probabilities after all model components have been produced.
</p>
<p>It should be called before <a href="#topic+apollo_avgInterDraws">apollo_avgInterDraws</a>, <a href="#topic+apollo_avgIntraDraws">apollo_avgIntraDraws</a>, <a href="#topic+apollo_panelProd">apollo_panelProd</a> and <a href="#topic+apollo_prepareProb">apollo_prepareProb</a>, whichever apply, except where these functions are called inside any latent class components of the overall model.
</p>


<h3>Value</h3>

<p>Argument <code>P</code> with (for most functionalities) an extra element called &quot;model&quot;, which is the product of all the other elements. Shape depends on argument <code>functionality</code>.
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: Returns <code>P</code> without changes.
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: Returns <code>P</code> with an extra component called <code>"model"</code>, which is the product of all other elements of <code>P</code>.
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: Returns <code>P</code> with an extra component called <code>"model"</code>, which is the product of all other elements of <code>P</code>.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: Returns <code>P</code> containing the gradient of the likelihood after applying the product rule across model components.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Returns <code>P</code> with an extra component called <code>"model"</code>, which is the product of all other elements of <code>P</code>.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: Returns <code>P</code> without changes.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Returns <code>P</code> without changes.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: Returns <code>P</code> without changes.
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: Returns <code>P</code> with an extra component called <code>"model"</code>, which is the product of all other elements of <code>P</code>.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Returns <code>P</code> with an extra component called <code>"model"</code>, which is the product of all other elements of <code>P</code>.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: Returns <code>P</code> with an extra component called <code>"model"</code>, which is the product of all other elements of <code>P</code>.
</p>
</li></ul>


<hr>
<h2 id='apollo_combineResults'>Write model results to file</h2><span id='topic+apollo_combineResults'></span>

<h3>Description</h3>

<p>Writes results from various models to a single csv file.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_combineResults(combineResults_settings = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_combineResults_+3A_combineresults_settings">combineResults_settings</code></td>
<td>
<p>List. Contains settings for this function. User input is required for all settings except those with a default or marked as optional. 
</p>

<ul>
<li> <p><strong><code>modelNames</code></strong>: Character vector. Optional names of models to combine. Omit or use an empty vector to combine results from all models in the working/output directory.
</p>
</li>
<li> <p><strong><code>printClassical</code></strong>: Boolean. TRUE for printing classical standard errors. FALSE by default.
</p>
</li>
<li> <p><strong><code>printPVal</code></strong>: Boolean. TRUE for printing p-values. FALSE by default.
</p>
</li>
<li> <p><strong><code>printT1</code></strong>: Boolean. If TRUE, t-test for H0: apollo_beta=1 are printed. FALSE by default.
</p>
</li>
<li> <p><strong><code>estimateDigits</code></strong>: Numeric scalar. Number of decimal places to print for estimates. Default is 4.
</p>
</li>
<li> <p><strong><code>tDigits</code></strong>: Numeric scalar. Number of decimal places to print for t-ratios values. Default is 2.
</p>
</li>
<li> <p><strong><code>pDigits</code></strong>: Numeric scalar. Number of decimal places to print for p-values. Default is 2.
</p>
</li>
<li> <p><strong><code>sortByDate</code></strong>: Boolean. If TRUE, models are ordered by date. Default is TRUE.
</p>
</li></ul>
</td></tr>
</table>


<h3>Value</h3>

<p>Nothing, but writes a file called 'model_comparison_[date].csv' in the working/output directory.
</p>

<hr>
<h2 id='apollo_compareInputs'>Compares the content of apollo_inputs to their counterparts in the global environment</h2><span id='topic+apollo_compareInputs'></span>

<h3>Description</h3>

<p>Compares the content of apollo_inputs to their counterparts in the global environment
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_compareInputs(apollo_inputs)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_compareInputs_+3A_apollo_inputs">apollo_inputs</code></td>
<td>
<p>List grouping most common inputs. Created by function <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Logical. TRUE if the content of <code>apollo_inputs</code> is the same than the one in the global environment, FALSE otherwise.
</p>

<hr>
<h2 id='apollo_conditionals'>Calculates conditionals</h2><span id='topic+apollo_conditionals'></span>

<h3>Description</h3>

<p>Calculates posterior expected values (conditionals) of random coefficient models (continuous or discrete mixtures/latent class)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_conditionals(model, apollo_probabilities, apollo_inputs)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_conditionals_+3A_model">model</code></td>
<td>
<p>Model object. Estimated model object as returned by function <a href="#topic+apollo_estimate">apollo_estimate</a>.</p>
</td></tr>
<tr><td><code id="apollo_conditionals_+3A_apollo_probabilities">apollo_probabilities</code></td>
<td>
<p>Function. Returns probabilities of the model to be estimated. Must receive three arguments:
</p>

<ul>
<li> <p><strong><code>apollo_beta</code></strong>: Named numeric vector. Names and values of model parameters.
</p>
</li>
<li> <p><strong><code>apollo_inputs</code></strong>: List containing options of the model. See <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.
</p>
</li>
<li> <p><strong><code>functionality</code></strong>: Character. Can be either <strong><code>"components"</code></strong>, <strong><code>"conditionals"</code></strong>, <strong><code>"estimate"</code></strong> (default), <strong><code>"gradient"</code></strong>, <strong><code>"output"</code></strong>, <strong><code>"prediction"</code></strong>, <strong><code>"preprocess"</code></strong>, <strong><code>"raw"</code></strong>, <strong><code>"report"</code></strong>, <strong><code>"shares_LL"</code></strong>, <strong><code>"validate"</code></strong> or <strong><code>"zero_LL"</code></strong>.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_conditionals_+3A_apollo_inputs">apollo_inputs</code></td>
<td>
<p>List grouping most common inputs. Created by function <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This functions is only meant for use with models using either continuous distributions or latent classes, not both at the same time
</p>


<h3>Value</h3>

<p>Depends on whether the model uses continuous mixtures or latent class.
</p>

<ul>
<li><p> If the model contains a continuous mixture, the function returns a list of matrices. 
Each matrix has dimensions nIndiv x 3. One matrix per random component.
Each row of each matrix contains the indivID of an individual, and the
posterior mean and s.d. of this random component for this individual.
</p>
</li>
<li><p> If the model contains latent classes, the function returns a matrix with 
the posterior class allocation probabilities for each individual.
</p>
</li>
<li><p> If the model contains both continuous mixtures and latent classes,
the function fails.
</p>
</li></ul>


<hr>
<h2 id='apollo_deltaMethod'>Delta method for Apollo models</h2><span id='topic+apollo_deltaMethod'></span>

<h3>Description</h3>

<p>Applies the Delta method to calculate the standard errors of transformations of parameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_deltaMethod(model, deltaMethod_settings)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_deltaMethod_+3A_model">model</code></td>
<td>
<p>Model object. Estimated model object as returned by function <a href="#topic+apollo_estimate">apollo_estimate</a>.</p>
</td></tr>
<tr><td><code id="apollo_deltaMethod_+3A_deltamethod_settings">deltaMethod_settings</code></td>
<td>
<p>List. Contains settings for this function. User input is required for all settings except those with a default or marked as optional. 
</p>

<ul>
<li> <p><strong><code>expression</code></strong>: Character vector. A character vector with a single or multiple arbitrary functions of the estimated parameters, as text. 
For example: <code>c(VTT="b1/b2*60")</code>. Each expression can only contain model parameters (estimated or fixed), 
numeric values, and operands. At least one of the parameters used needs to not have been fixed in estimation. Variables in the database
cannot be included. If the user does not provide a name for an expression, then the expression itself is used in the output. If this setting is provided, then <code>operation</code>, 
<code>parName1</code>, <code>parName2</code>, <code>multPar1</code> and <code>multPar2</code> are
ignored.
</p>
</li>
<li> <p><strong><code>allPairs</code></strong>: Logical. If set to TRUE, Delta method calculations are carried out for the ratio and difference for all pairs of parameters and returned as two separate matrices with values and t-ratios. FALSE by default.
</p>
</li>
<li> <p><strong><code>varcov</code></strong>: Character. Type of variance-covariance matrix to use in calculations. 
It can take values <code>"classical"</code>, <code>"robust"</code> and 
<code>"bootstrap"</code>. Default is <code>"robust"</code>.
</p>
</li>
<li> <p><strong><code>printPVal</code></strong>: Logical or Scalar. TRUE or 1 for printing p-values for one-sided test, 2 for printing p-values for two-sided test, FALSE for not printing p-values. FALSE by default.
</p>
</li>
<li> <p><strong><code>operation</code></strong>: Character. Function to calculate the delta method for. See details. Not used if <code>expression</code> is provided.
</p>
</li>
<li> <p><strong><code>parName1</code></strong>: Character. Name of the first parameter if <code>operation</code> is used. See details. Not used if <code>expression</code> is provided.
</p>
</li>
<li> <p><strong><code>parName2</code></strong>: Character. Name of the second parameter if <code>operation</code> is used. See details. Not used if <code>expression</code> is provided.. Optional depending on <code>operation</code>.
</p>
</li>
<li> <p><strong><code>multPar1</code></strong>: Numeric scalar. An optional value to scale <code>parName1</code>. Not used if <code>expression</code> is provided.
</p>
</li>
<li> <p><strong><code>multPar2</code></strong>: Numeric scalar. An optional value to scale <code>parName2</code>. Not used if <code>expression</code> is provided.
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p><code>apollo_deltaMethod</code> can be used in two ways. The first and recommended way is to provide an 
element called <code>expression</code> inside its argument <code>deltaMethod_settings</code>. <code>expression</code> 
should contain the expression or expressions for which the standard error is/are to be calculated, as text. For 
example, to calculate the ratio between parameters b1 and b2, <code>expression=c(vtt="b1/b2")</code> should be used.
</p>
<p>The second method is to provide the name of a specific operation inside <code>deltaMethod_settings</code>.
The following five operations are supported.
</p>

<ul>
<li> <p><strong><code>sum</code></strong>: Calculates the s.e. of <code>parName1</code> + <code>parName2</code>
</p>
</li>
<li> <p><strong><code>diff</code></strong>: Calculates the s.e. of <code>parName1</code> - <code>parName2</code> and <code>parName2</code> - <code>parName1</code>
</p>
</li>
<li> <p><strong><code>prod</code></strong>: Calculates the s.e. of <code>parName1</code>*<code>parName2</code>
</p>
</li>
<li> <p><strong><code>ratio</code></strong>: Calculates the s.e. of <code>parName1</code>/<code>parName2</code> and <code>parName2</code>/<code>parName1</code>
</p>
</li>
<li> <p><strong><code>exp</code></strong>: Calculates the s.e. of <code>exp(parName1)</code>
</p>
</li>
<li> <p><strong><code>logistic</code></strong>: If only <code>parName1</code> is provided, it calculates the s.e. of
<code>exp(parName1)/(1+exp(parName1))</code> and <code>1/(1+exp(parName1))</code>.
If <code>parName1</code> and <code>parName2</code> are provided, it calculates
<code>exp(par_i)/(1+exp(parName1)+exp(parName2))</code> for i=1, 2, and 3 (par_3 = 1).
</p>
</li>
<li> <p><strong><code>lognormal</code></strong>: Calculates the mean and s.d. of a lognormal distribution based on the mean 
(<code>parName1</code>) and s.d. (<code>parName2</code>) of the underlying normal.
</p>
</li></ul>

<p>By default, <code>apollo_deltaMethod</code> uses the robust covariance matrix. However, the user can change this through the <code>varcov</code> setting.
</p>


<h3>Value</h3>

<p>Matrix containing value, s.e. and t-ratio resulting from the requested expression or operation. This is also printed to screen.
</p>

<hr>
<h2 id='apollo_detach'>Detaches parameters and the database.</h2><span id='topic+apollo_detach'></span>

<h3>Description</h3>

<p>Detaches variables attached by <a href="#topic+apollo_attach">apollo_attach</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_detach(apollo_beta = NA, apollo_inputs = NA)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_detach_+3A_apollo_beta">apollo_beta</code></td>
<td>
<p>Named numeric vector. Names and values for parameters.</p>
</td></tr>
<tr><td><code id="apollo_detach_+3A_apollo_inputs">apollo_inputs</code></td>
<td>
<p>List grouping most common inputs. Created by function <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function detaches the variables attached by <a href="#topic+apollo_attach">apollo_attach</a>. 
It should be called at the end of <code>apollo_probabilities</code>, only if 
<a href="#topic+apollo_attach">apollo_attach</a> was called and the beginning. This can also be achieved 
by adding the line <code>on.exit(apollo_detach(apollo_beta, apollo_inputs))</code> 
right after calling <a href="#topic+apollo_attach">apollo_attach</a>.
This function can also be called without any arguments, i.e. <code>apollo_detach()</code>.
</p>


<h3>Value</h3>

<p>Nothing.
</p>

<hr>
<h2 id='apollo_dft'>Calculate DFT probabilities</h2><span id='topic+apollo_dft'></span>

<h3>Description</h3>

<p>Calculate probabilities of a Decision Field Theory (DFT) model and can also perform other operations based on the value of the <code>functionality</code> argument.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_dft(dft_settings, functionality)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_dft_+3A_dft_settings">dft_settings</code></td>
<td>
<p>List of settings for the DFT model. It should contain the following elements.
</p>

<ul>
<li> <p><strong><code>alternatives</code></strong>: Named numeric vector. Names of alternatives and their corresponding value in <code>choiceVar</code>.
</p>
</li>
<li> <p><strong><code>avail</code></strong>: Named list of numeric vectors or scalars. Availabilities of alternatives, one element per alternative. Names of elements must match those in <code>alternatives</code>. Values can be 0 or 1. These can be scalars or vectors (of length equal to rows in the database). A user can also specify <code>avail=1</code> to indicate universal availability, or omit the setting completely.
</p>
</li>
<li> <p><strong>altStart</strong>: A named list with as many elements as alternatives. Each element can be a scalar or vector containing the starting preference value for the alternative.  
</p>
</li>
<li> <p><strong>attrScalings</strong>: A named list with as many elements as attributes, or fewer. Each element is a factor that scale the attribute, and can be a scalar, a vector or a matrix/array. They do not need to add up to one for each observation. <code>attrWeights</code> and <code>attrScalings</code> are incompatible, and they should not be both defined for an attribute. Default is 1 for all attributes.
</p>
</li>
<li> <p><strong>attrValues</strong>: A named list with as many elements as alternatives. Each element is itself a named list of vectors of the alternative attributes for each observation (usually a column from the database). All alternatives must have the same attributes (can be set to zero if not relevant).
</p>
</li>
<li> <p><strong>attrWeights</strong>: A named list with as many elements as attributes, or fewer. Each element is the weight of the attribute, and can be a scalar, a vector with as many elements as observations, or a matrix/array if random. They should add up to one for each observation and draw (if present), and will be re-scaled if they do not. <code>attrWeights</code> and <code>attrScalings</code> are incompatible, and they should not be both defined for an attribute. Default is 1 for all attributes.
</p>
</li>
<li> <p><strong><code>choiceVar</code></strong>: Numeric vector. Contains choices for all observations. It will usually be a column from the database. Values are defined in <code>alternatives</code>.
</p>
</li>
<li> <p><strong><code>componentName</code></strong>: Character. Name given to model component. If not provided by the user, Apollo will set the name automatically according to the element in <code>P</code> to which the function output is directed.
</p>
</li>
<li> <p><strong>procPars</strong>: A list containing the four DFT 'process parameters'
</p>

<ul>
<li> <p><strong>error_sd</strong>: Numeric scalar or vector. The standard deviation of the the error term in each timestep.
</p>
</li>
<li> <p><strong>timesteps</strong>: Numeric scalar or vector. Number of timesteps to consider. Should be an integer bigger than 0.
</p>
</li>
<li> <p><strong>phi1</strong>: Numeric scalar or vector. Sensitivity.
</p>
</li>
<li> <p><strong>phi2</strong>: Numeric scalar or vector. Process parameter.
</p>
</li></ul>

</li>
<li> <p><strong><code>rows</code></strong>: Boolean vector. Consideration of which rows to include. Length equal to the number of observations (nObs), with entries equal to TRUE for rows to include, and FALSE for rows to exclude. Default is <code>"all"</code>, equivalent to <code>rep(TRUE, nObs)</code>.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_dft_+3A_functionality">functionality</code></td>
<td>
<p>Character. Setting instructing Apollo what processing to apply to the likelihood function. This is in general controlled by the functions that call <code>apollo_probabilities</code>, though the user can also call <code>apollo_probabilities</code> manually with a given functionality for testing/debugging. Possible values are:
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: For further processing/debugging, produces likelihood for each model component (if multiple components are present), at the level of individual draws and observations.
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: For conditionals, produces likelihood of the full model, at the level of individual inter-individual draws.
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: For model estimation, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: For model estimation, produces analytical gradients of the likelihood, where possible.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Prepares output for post-estimation reporting.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: For model prediction, produces probabilities for individual alternatives and individual model components (if multiple components are present) at the level of an observation, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Prepares likelihood functions for use in estimation.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: For debugging, produces probabilities of all alternatives and individual model components at the level of an observation, at the level of individual draws.
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: Prepares output summarising model and choiceset structure.
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: Produces overall model likelihood with constants only.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Validates model specification, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: Produces overall model likelihood with all parameters at zero.
</p>
</li></ul>
</td></tr>
</table>


<h3>Value</h3>

<p>The returned object depends on the value of argument <code>functionality</code> as follows.
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: vector/matrix/array. Returns the probabilities for the chosen alternative for each observation.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: Not implemented.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Same as <code>"estimate"</code> but also writes summary of input data to internal Apollo log.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: List of vectors/matrices/arrays. Returns a list with the probabilities for all alternatives, with an extra element for the chosen alternative probability.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Returns a list with pre-processed inputs, based on <code>dft_settings</code>.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: Same as <code>"prediction"</code>
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: Choice overview.
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: Not implemented. Returns a vector of NA with as many elements as observations.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: vector/matrix/array. Returns the probability of the chosen alternative when all parameters are zero.
</p>
</li></ul>



<h3>References</h3>

<p>Hancock, T.; Hess, S. and Choudhury, C. (2018) Decision field theory: Improvements to current methodology and comparisons with standard choice modelling techniques. Transportation Research 107B, 18 - 40.
Hancock, T.; Hess, S. and Choudhury, C. (Submitted) An accumulation of preference: two alternative dynamic models for understanding transport choices.
Roe, R.; Busemeyer, J. and Townsend, J. (2001) Multialternative decision field theory: A dynamic connectionist model of decision making. Psychological Review 108, 370
</p>

<hr>
<h2 id='apollo_diagnostics'>Pre-process input for common models
return</h2><span id='topic+apollo_diagnostics'></span>

<h3>Description</h3>

<p>Pre-process input for common models
return
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_diagnostics(inputs, modelType, apollo_inputs, data = TRUE, param = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_diagnostics_+3A_inputs">inputs</code></td>
<td>
<p>List of settings</p>
</td></tr>
<tr><td><code id="apollo_diagnostics_+3A_modeltype">modelType</code></td>
<td>
<p>Character. Type of model, e.g. &quot;mnl&quot;, &quot;nl&quot;, &quot;cnl&quot;, etc.</p>
</td></tr>
<tr><td><code id="apollo_diagnostics_+3A_apollo_inputs">apollo_inputs</code></td>
<td>
<p>List of main inputs to the model estimation process. See <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
<tr><td><code id="apollo_diagnostics_+3A_data">data</code></td>
<td>
<p>Boolean. TRUE for printing report related to dependent and independent variables. FALSE for not printing it. Default is TRUE.</p>
</td></tr>
<tr><td><code id="apollo_diagnostics_+3A_param">param</code></td>
<td>
<p>Boolean. TRUE for printing report related to estimated parameters (e.g. model structure). FALSE for not printing it. Default is TRUE.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>(invisibly) TRUE if no error happend during execution.
</p>

<hr>
<h2 id='apollo_drugChoiceData'>Simulated dataset of medication choice.</h2><span id='topic+apollo_drugChoiceData'></span>

<h3>Description</h3>

<p>A simulated dataset containing 10,000 stated medication choices among four alternatives.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_drugChoiceData
</code></pre>


<h3>Format</h3>

<p>A data.frame with 10,000 rows and 33 variables:
</p>

<dl>
<dt>ID</dt><dd><p>Numeric. Identification number of the individual.</p>
</dd>
<dt>task</dt><dd><p>Numeric. Index of choice situations for each individual, going from 1 to 10.</p>
</dd>
<dt>best</dt><dd><p>Numeric. Index of alternative selected as best option.</p>
</dd>
<dt>second_pref</dt><dd><p>Numeric. Index of alternative selected as second-best option.</p>
</dd>
<dt>third_pref</dt><dd><p>Numeric. Index of alternative selected as third-best option.</p>
</dd>
<dt>worst</dt><dd><p>Numeric. Index of alternative selected as worst option.</p>
</dd>
<dt>brand_1</dt><dd><p>Character. Brand for alternative 1.</p>
</dd>
<dt>country_1</dt><dd><p>Character. Country of origin for alternative 1.</p>
</dd>
<dt>char_1</dt><dd><p>Character. Characteristics of alternative 1 (standard, fast acting, or double strength).</p>
</dd>
<dt>side_effects_1</dt><dd><p>Numeric. Chance of suffering negative side effects with alternative 1 (out of 100,000).</p>
</dd>
<dt>price_1</dt><dd><p>Numeric. Cost of alternative 1 in Pounds sterling (GBP).</p>
</dd>
<dt>brand_2</dt><dd><p>Character. Brand for alternative 2.</p>
</dd>
<dt>country_2</dt><dd><p>Character. Country of origin for alternative 2.</p>
</dd>
<dt>char_2</dt><dd><p>Character. Characteristics of alternative 2 (standard, fast acting, or double strength).</p>
</dd>
<dt>side_effects_2</dt><dd><p>Numeric. Chance of suffering negative side effects with alternative 2 (out of 100,000).</p>
</dd>
<dt>price_2</dt><dd><p>Numeric. Cost of alternative 2 in Pounds sterling (GBP).</p>
</dd>
<dt>brand_3</dt><dd><p>Character. Brand for alternative 3.</p>
</dd>
<dt>country_3</dt><dd><p>Character. Country of origin for alternative 3.</p>
</dd>
<dt>char_3</dt><dd><p>Character. Characteristics of alternative 3 (standard, fast acting, or double strength).</p>
</dd>
<dt>side_effects_3</dt><dd><p>Numeric. Chance of suffering negative side effects with alternative 3 (out of 100,000).</p>
</dd>
<dt>price_3</dt><dd><p>Numeric. Cost of alternative 3 in Pounds sterling (GBP).</p>
</dd>
<dt>brand_4</dt><dd><p>Character. Brand for alternative 4.</p>
</dd>
<dt>country_4</dt><dd><p>Character. Country of origin for alternative 4.</p>
</dd>
<dt>char_4</dt><dd><p>Character. Characteristics of alternative 4 (standard, fast acting, or double strength).</p>
</dd>
<dt>side_effects_4</dt><dd><p>Numeric. Chance of suffering negative side effects with alternative 4 (out of 100,000).</p>
</dd>
<dt>price_4</dt><dd><p>Numeric. Cost of alternative 4 in Pounds sterling (GBP).</p>
</dd>
<dt>regular_user</dt><dd><p>Numeric. 1 if the respondent is a regular user of headache medicine, 0 otherwise.</p>
</dd>
<dt>university_educated</dt><dd><p>Numeric. 1 if the respondent holds a university degree, 0 otherwise.</p>
</dd>
<dt>over_50</dt><dd><p>Numeric. 1 if the respondent is 50 years old or older, 0 otherwise.</p>
</dd>
<dt>attitude_quality</dt><dd><p>Numeric. Level of agreement from 1 (strongly disagree) to 5 (strongly agree) with the phrase 'I am concerned about the quality of drugs developed by unknown companies'.</p>
</dd>
<dt>attitude_ingredients</dt><dd><p>Numeric. Level of agreement from 1 (strongly disagree) to 5 (strongly agree) with the phrase 'I believe that ingredients are the same no matter what brand'.</p>
</dd>
<dt>attitude_patent</dt><dd><p>Numeric. Level of agreement from 1 (strongly disagree) to 5 (strongly agree) with the phrase 'The original patent holders have valuable experience with their medicines'.</p>
</dd>
<dt>attitude_dominance</dt><dd><p>Numeric. Level of agreement from 1 (strongly disagree) to 5 (strongly agree) with the phrase 'I believe the dominance of big pharmaceutical companies is unhelpful'.</p>
</dd>
</dl>



<h3>Details</h3>

<p>This dataset is to be used for discrete choice modelling.
Data comes from 1,000 individuals, each with ten stated 
choice (SC) scenarios involving a choice among headache medication. 
There are 10,000 choices in total. Data is simulated.
Each observation contains attributes of the alternatives,
characteristics of the respondent, and their answers to
four attitudinal questions. All four alternatives are
always available for all individuals. Alternatives 1 and
2 are branded, while alternatives 3 and 4 are generic.
Respondents provide a full ranking of alternatives for
each choice task (i.e. observation).
</p>


<h3>Source</h3>

<p><a href="http://www.apollochoicemodelling.com/">http://www.apollochoicemodelling.com/</a>
</p>

<hr>
<h2 id='apollo_dVdB'>Calculates gradients of utility functions</h2><span id='topic+apollo_dVdB'></span>

<h3>Description</h3>

<p>Calculates gradients (derivatives) of utility functions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_dVdB(apollo_beta, apollo_inputs, V)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_dVdB_+3A_apollo_beta">apollo_beta</code></td>
<td>
<p>Named numeric vector of parameters.</p>
</td></tr>
<tr><td><code id="apollo_dVdB_+3A_apollo_inputs">apollo_inputs</code></td>
<td>
<p>List grouping most common inputs. Created by function <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
<tr><td><code id="apollo_dVdB_+3A_v">V</code></td>
<td>
<p>List of functions</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Named list. Each element is itself a list of functions: the partial derivatives of the elements of V.
</p>

<hr>
<h2 id='apollo_dVdBOld'>Calculates gradients of utility functions</h2><span id='topic+apollo_dVdBOld'></span>

<h3>Description</h3>

<p>Calculates gradients (derivatives) of utility functions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_dVdBOld(apollo_beta, apollo_inputs, V)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_dVdBOld_+3A_apollo_beta">apollo_beta</code></td>
<td>
<p>Named numeric vector of parameters.</p>
</td></tr>
<tr><td><code id="apollo_dVdBOld_+3A_apollo_inputs">apollo_inputs</code></td>
<td>
<p>List grouping most common inputs. Created by function <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
<tr><td><code id="apollo_dVdBOld_+3A_v">V</code></td>
<td>
<p>List of functions</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Named list. Each element is a function that returns a list, where each element is the partial derivatives of the elements of V.
</p>

<hr>
<h2 id='apollo_el'>Calculates Exploded Logit probabilities</h2><span id='topic+apollo_el'></span>

<h3>Description</h3>

<p>Calculates the probabilities of an Exploded Logit model and can also perform other operations based on the value of the <code>functionality</code> argument.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_el(el_settings, functionality)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_el_+3A_el_settings">el_settings</code></td>
<td>
<p>List of inputs of the Exploded Logit model. It shoud contain the following.
</p>

<ul>
<li> <p><strong><code>alternatives</code></strong>: Named numeric vector. Names of alternatives and their corresponding value in <code>choiceVar</code>.
</p>
</li>
<li> <p><strong><code>avail</code></strong>: Named list of numeric vectors or scalars. Availabilities of alternatives, one element per alternative. Names of elements must match those in <code>alternatives</code>. Values can be 0 or 1. These can be scalars or vectors (of length equal to rows in the database). A user can also specify <code>avail=1</code> to indicate universal availability, or omit the setting completely.
</p>
</li>
<li> <p><strong><code>choiceVars</code></strong>: List of numeric vectors. Contain choices for each position of the ranking. The list must be ordered with the best choice first, second best second, etc. It will usually be a list of columns from the database. Use value -1 if a stage does not apply for a given observations (e.g. when some individuals have shorter rankings).
</p>
</li>
<li> <p><strong><code>componentName</code></strong>: Character. Name given to model component. If not provided by the user, Apollo will set the name automatically according to the element in <code>P</code> to which the function output is directed.
</p>
</li>
<li> <p><strong><code>utilities</code></strong>: Named list of deterministic utilities . Utilities of the alternatives. Names of elements must match those in <code>alternatives.</code>
</p>
</li>
<li> <p><strong><code>rows</code></strong>: Boolean vector. Consideration of which rows to include. Length equal to the number of observations (nObs), with entries equal to TRUE for rows to include, and FALSE for rows to exclude. Default is <code>"all"</code>, equivalent to <code>rep(TRUE, nObs)</code>.
</p>
</li>
<li> <p><strong><code>scales</code></strong>: List of vectors. Scale factors of each Logit model. At least one element should be normalized to 1. If omitted, scale=1 for all positions is assumed.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_el_+3A_functionality">functionality</code></td>
<td>
<p>Character. Setting instructing Apollo what processing to apply to the likelihood function. This is in general controlled by the functions that call <code>apollo_probabilities</code>, though the user can also call <code>apollo_probabilities</code> manually with a given functionality for testing/debugging. Possible values are:
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: For further processing/debugging, produces likelihood for each model component (if multiple components are present), at the level of individual draws and observations.
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: For conditionals, produces likelihood of the full model, at the level of individual inter-individual draws.
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: For model estimation, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: For model estimation, produces analytical gradients of the likelihood, where possible.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Prepares output for post-estimation reporting.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: For model prediction, produces probabilities for individual alternatives and individual model components (if multiple components are present) at the level of an observation, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Prepares likelihood functions for use in estimation.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: For debugging, produces probabilities of all alternatives and individual model components at the level of an observation, at the level of individual draws.
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: Prepares output summarising model and choiceset structure.
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: Produces overall model likelihood with constants only.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Validates model specification, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: Produces overall model likelihood with all parameters at zero.
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>The function calculates the probability of a ranking as a product of Multinomial Logit models with gradually reducing availability, where scale differences can be allowed for.
</p>


<h3>Value</h3>

<p>The returned object depends on the value of argument <code>functionality</code> as follows.
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: vector/matrix/array. Returns the probabilities for the chosen alternative for each observation.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: List containing the likelihood and gradient of the model component.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Same as <code>"estimate"</code> but also writes summary of input data to internal Apollo log.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: Not applicable (<code>NA</code>).
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Returns a list with pre-processed inputs, based on <code>el_settings</code>.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: Choice overview across stages.
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: Not implemented. Returns a vector of NA with as many elements as observations.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: vector/matrix/array. Returns the probability of the chosen alternative when all parameters are zero.
</p>
</li></ul>


<hr>
<h2 id='apollo_emdc'>MDC model with exogenous budget</h2><span id='topic+apollo_emdc'></span>

<h3>Description</h3>

<p>Calculates the likelihood function of the MDC model with exogenous budget. Can also predict and validate inputs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_emdc(emdc_settings, functionality = "estimate")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_emdc_+3A_emdc_settings">emdc_settings</code></td>
<td>
<p>List of settings for the model. It includes the following.
</p>

<ul>
<li> <p><strong><code>continuousChoice</code></strong>: Named list of numeric vectors. Amount consumed of each inside good. Outside good must not be included. Can also be called &quot;X&quot;.
</p>
</li>
<li> <p><strong><code>budget</code></strong>: Optional numeric vector. Budget. Must be bigger that the expenditure on all inside goods. Can also be called &quot;B&quot;.
</p>
</li>
<li> <p><strong><code>avail</code></strong>: Named list of numeric vectors. Availability of each product. Can also be called &quot;A&quot;.
</p>
</li>
<li> <p><strong><code>utilityOutside</code></strong>: Numeric vector (or matrix or array). Shadow price of the budget. Must be normalised to 0 for at least one individual. Default is 0 for every observation. Can also be called &quot;V0&quot;.
</p>
</li>
<li> <p><strong><code>utilities</code></strong>: Named list of numeric vectors (or matrices or arrays). Base utility of each product. Can also be called &quot;V&quot;.
</p>
</li>
<li> <p><strong><code>gamma</code></strong>: Named list of numeric vectors. Satiation parameter of each product.
</p>
</li>
<li> <p><strong><code>delta</code></strong>: Lower triangular numeric matrix, or list of lists. Complementarity/substitution parameter.
</p>
</li>
<li> <p><strong><code>cost</code></strong>: Named list of numeric vectors. Price of each product.
</p>
</li>
<li> <p><strong><code>sigma</code></strong>: Numeric vector or scalar. Standard deviation of the error term. Default is one.
</p>
</li>
<li> <p><strong><code>nRep</code></strong>: Scalar positive integer. Number of repetitions used when prediction
</p>
</li>
<li> <p><strong><code>tol</code></strong>: Positive scalar. Tolerance of the prediction algorithm.
</p>
</li>
<li> <p><strong><code>timeLimit</code></strong>: Positive scalar. Maximum amount of seconds the optimiser can spend calculating a prediction before setting it to NA.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_emdc_+3A_functionality">functionality</code></td>
<td>
<p>Character. Either &quot;validate&quot;, &quot;zero_LL&quot;, &quot;estimate&quot;, &quot;conditionals&quot;, &quot;raw&quot;, &quot;output&quot; or &quot;prediction&quot;</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This model extends the traditional multiple discrete-continuous (MDC) framework by (i) making the 
marginal utility of the outside good deterministic, and (ii) including complementarity and 
substitution in the model formulation. See the following working paper for more details:
</p>
<p>Palma, D. &amp; Hess, S. (2022) Extending the Multiple Discrete Continuous (MDC) modelling 
framework to consider complementarity, substitution, and an unobserved budget. Transportation 
Reserarch 161B, 13 - 35. https://doi.org/10.1016/j.trb.2022.04.005
</p>


<h3>Value</h3>

<p>The returned object depends on the value of argument <code>functionality</code> as follows.
</p>

<ul>
<li> <p><strong><code>"estimate"</code></strong>: vector/matrix/array. Returns the probabilities for the chosen alternative for each observation.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: List of vectors/matrices/arrays. Returns a list with the probabilities for all alternatives, with an extra element for the probability of the chosen alternative.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Same as <code>"estimate"</code>, but it also runs a set of tests to validate the function inputs.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: vector/matrix/array. Returns the probability of the chosen alternative when all parameters are zero.
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Same as <code>"estimate"</code> but also writes summary of input data to internal Apollo log.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: Same as <code>"prediction"</code>
</p>
</li></ul>


<hr>
<h2 id='apollo_emdc1'>MDC model with exogenous budget</h2><span id='topic+apollo_emdc1'></span>

<h3>Description</h3>

<p>Calculates the likelihood function of the MDC model with exogenous budget. Can also predict and validate inputs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_emdc1(emdc_settings, functionality = "estimate")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_emdc1_+3A_emdc_settings">emdc_settings</code></td>
<td>
<p>List of settings for the model. It includes the following.
</p>

<ul>
<li> <p><strong><code>continuousChoice</code></strong>: Named list of numeric vectors. Amount consumed of each inside good. Outside good must not be included. Can also be called &quot;X&quot;.
</p>
</li>
<li> <p><strong><code>budget</code></strong>: Numeric vector. Budget. Must be bigger that the expenditure on all inside goods. Can also be called &quot;B&quot;.
</p>
</li>
<li> <p><strong><code>avail</code></strong>: Named list of numeric vectors. Availability of each product. Can also be called &quot;A&quot;.
</p>
</li>
<li> <p><strong><code>utilityOutside</code></strong>: Numeric vector (or matrix or array). Shadow price of the budget. Must be normalised to 0 for at least one individual. Default is 0 for every observation. Can also be called &quot;V0&quot;.
</p>
</li>
<li> <p><strong><code>utilities</code></strong>: Named list of numeric vectors (or matrices or arrays). Base utility of each product. Can also be called &quot;V&quot;.
</p>
</li>
<li> <p><strong><code>gamma</code></strong>: Named list of numeric vectors. Satiation parameter of each product.
</p>
</li>
<li> <p><strong><code>delta</code></strong>: Lower triangular numeric matrix, or list of lists. Complementarity/substitution parameter.
</p>
</li>
<li> <p><strong><code>cost</code></strong>: Named list of numeric vectors. Price of each product.
</p>
</li>
<li> <p><strong><code>sigma</code></strong>: Numeric vector or scalar. Standard deviation of the error term. Default is one.
</p>
</li>
<li> <p><strong><code>nRep</code></strong>: Scalar positive integer. Number of repetitions used when prediction
</p>
</li>
<li> <p><strong><code>tol</code></strong>: Positive scalar. Tolerance of the prediction algorithm.
</p>
</li>
<li> <p><strong><code>timeLimit</code></strong>: Positive scalar. Maximum amount of seconds the optimiser can spend calculating a prediction before setting it to NA.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_emdc1_+3A_functionality">functionality</code></td>
<td>
<p>Character. Either &quot;validate&quot;, &quot;zero_LL&quot;, &quot;estimate&quot;, &quot;conditionals&quot;, &quot;raw&quot;, &quot;output&quot; or &quot;prediction&quot;</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This model extends the traditional multiple discrete-continuous (MDC) framework by (i) making the 
marginal utility of the outside good deterministic, and (ii) including complementarity and 
substitution in the model formulation. See the following working paper for more details:
</p>
<p>Palma, D. &amp; Hess, S. (2022) Extending the Multiple Discrete Continuous (MDC) modelling 
framework to consider complementarity, substitution, and an unobserved budget. Transportation 
Reserarch 161B, 13 - 35. https://doi.org/10.1016/j.trb.2022.04.005
</p>


<h3>Value</h3>

<p>The returned object depends on the value of argument <code>functionality</code> as follows.
</p>

<ul>
<li> <p><strong><code>"estimate"</code></strong>: vector/matrix/array. Returns the probabilities for the chosen alternative for each observation.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: List of vectors/matrices/arrays. Returns a list with the probabilities for all alternatives, with an extra element for the probability of the chosen alternative.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Same as <code>"estimate"</code>, but it also runs a set of tests to validate the function inputs.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: vector/matrix/array. Returns the probability of the chosen alternative when all parameters are zero.
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Same as <code>"estimate"</code> but also writes summary of input data to internal Apollo log.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: Same as <code>"prediction"</code>
</p>
</li></ul>


<hr>
<h2 id='apollo_emdc2'>Extended MDC</h2><span id='topic+apollo_emdc2'></span>

<h3>Description</h3>

<p>Calculates the likelihood function of the extended MDC model. Can also predict and validate inputs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_emdc2(emdc_settings, functionality = "estimate")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_emdc2_+3A_emdc_settings">emdc_settings</code></td>
<td>
<p>List of settings for the model. It includes the following.
</p>

<ul>
<li> <p><strong><code>continuousChoice</code></strong>: Named list of numeric vectors. Amount consumed of each inside good. Outside good must not be included. Can also be called &quot;X&quot;.
</p>
</li>
<li> <p><strong><code>avail</code></strong>: Named list of numeric vectors. Availability of each product. Can also be called &quot;A&quot;.
</p>
</li>
<li> <p><strong><code>utilityOutside</code></strong>: Numeric vector (or matrix or array). Shadow price of the budget. Must be normalised to 0 for at least one individual. Default is 0 for every observation. Can also be called &quot;V0&quot;.
</p>
</li>
<li> <p><strong><code>utilities</code></strong>: Named list of numeric vectors (or matrices or arrays). Base utility of each product. Can also be called &quot;V&quot;.
</p>
</li>
<li> <p><strong><code>gamma</code></strong>: Named list of numeric vectors. Satiation parameter of each product.
</p>
</li>
<li> <p><strong><code>sigma</code></strong>: Numeric scalar. Scale parameter.
</p>
</li>
<li> <p><strong><code>delta</code></strong>: Lower triangular numeric matrix, or list of lists. Complementarity/substitution parameter.
</p>
</li>
<li> <p><strong><code>cost</code></strong>: Named list of numeric vectors. Price of each product.
</p>
</li>
<li> <p><strong><code>nRep</code></strong>: Scalar positive integer. Number of repetitions used when predictiong
</p>
</li>
<li> <p><strong><code>nIter</code></strong>: Vector of two positive integers. Number of maximum iterations used during prediction, for the upper and lower iterative levels.
</p>
</li>
<li> <p><strong><code>tolerance</code></strong>: Positive scalar Tolerance of the prediction algorithm.
</p>
</li>
<li> <p><strong><code>rawPrediction</code></strong>: Scalar logical. When functionality is equal to &quot;prediction&quot;, it returns the full set of simulations. Defaults is FALSE.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_emdc2_+3A_functionality">functionality</code></td>
<td>
<p>Character. Either &quot;validate&quot;, &quot;zero_LL&quot;, &quot;estimate&quot;, &quot;conditionals&quot;, &quot;raw&quot;, &quot;output&quot; or &quot;prediction&quot;</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This model extends the traditional multiple discrete-continuous (MDC) framework by (i) dropping
the need to define a budget, (ii) making the marginal utility of the outside good deterministic, 
and (iii) including complementarity and substitution in the model formulation. See the following 
working paper for more details:
</p>
<p>Palma, D. &amp; Hess, S. (Working Paper) Some adaptations of Multiple Discrete-Continuous 
Extreme Value (MDCEV) models for a computationally tractable treatment of complementarity 
and substitution effects, and reduced influence of budget assumptions
</p>
<p>Avilable at: http://stephanehess.me.uk/publications.html
</p>


<h3>Value</h3>

<p>The returned object depends on the value of argument <code>functionality</code> as follows.
</p>

<ul>
<li> <p><strong><code>"estimate"</code></strong>: vector/matrix/array. Returns the probabilities for the chosen alternative for each observation.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: List of vectors/matrices/arrays. Returns a list with the probabilities for all alternatives, with an extra element for the probability of the chosen alternative.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Same as <code>"estimate"</code>, but it also runs a set of tests to validate the function inputs.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: vector/matrix/array. Returns the probability of the chosen alternative when all parameters are zero.
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Same as <code>"estimate"</code> but also writes summary of input data to internal Apollo log.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: Same as <code>"prediction"</code>
</p>
</li></ul>


<hr>
<h2 id='apollo_estimate'>Estimates model</h2><span id='topic+apollo_estimate'></span>

<h3>Description</h3>

<p>Estimates a model using the likelihood function defined by <code>apollo_probabilities</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_estimate(
  apollo_beta,
  apollo_fixed,
  apollo_probabilities,
  apollo_inputs,
  estimate_settings = NA
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_estimate_+3A_apollo_beta">apollo_beta</code></td>
<td>
<p>Named numeric vector. Names and values for parameters.</p>
</td></tr>
<tr><td><code id="apollo_estimate_+3A_apollo_fixed">apollo_fixed</code></td>
<td>
<p>Character vector. Names (as defined in <code>apollo_beta</code>) of parameters whose value should not change during estimation.</p>
</td></tr>
<tr><td><code id="apollo_estimate_+3A_apollo_probabilities">apollo_probabilities</code></td>
<td>
<p>Function. Returns probabilities of the model to be estimated. Must receive three arguments:
</p>

<ul>
<li> <p><strong><code>apollo_beta</code></strong>: Named numeric vector. Names and values of model parameters.
</p>
</li>
<li> <p><strong><code>apollo_inputs</code></strong>: List containing options of the model. See <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.
</p>
</li>
<li> <p><strong><code>functionality</code></strong>: Character. Can be either <strong><code>"components"</code></strong>, <strong><code>"conditionals"</code></strong>, <strong><code>"estimate"</code></strong> (default), <strong><code>"gradient"</code></strong>, <strong><code>"output"</code></strong>, <strong><code>"prediction"</code></strong>, <strong><code>"preprocess"</code></strong>, <strong><code>"raw"</code></strong>, <strong><code>"report"</code></strong>, <strong><code>"shares_LL"</code></strong>, <strong><code>"validate"</code></strong> or <strong><code>"zero_LL"</code></strong>.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_estimate_+3A_apollo_inputs">apollo_inputs</code></td>
<td>
<p>List grouping most common inputs. Created by function <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
<tr><td><code id="apollo_estimate_+3A_estimate_settings">estimate_settings</code></td>
<td>
<p>List. Contains settings for this function. User input is required for all settings except those with a default or marked as optional. 
</p>

<ul>
<li> <p><strong><code>bgw_settings</code></strong>: List. Additional arguments to the BGW optimisation method. See <a href="bgw.html#topic+bgw_mle">bgw_mle</a> for more details.
</p>
</li>
<li> <p><strong><code>bootstrapSE</code></strong>: Numeric. Number of bootstrap samples to calculate standard errors. Default is 0, meaning no bootstrap s.e. will be calculated. Number must zero or a positive integer. Only used if <code>apollo_control$estMethod!="HB"</code>.
</p>
</li>
<li> <p><strong><code>bootstrapSeed</code></strong>: Numeric scalar (integer). Random number generator seed to generate the bootstrap samples. Only used if <code>bootstrapSE&gt;0</code>. Default is 24.
</p>
</li>
<li> <p><strong><code>constraints</code></strong>: Character vector. Linear constraints on parameters to estimate. For example <code>c('b1&gt;0', 'b1 + 2*b2&gt;1')</code>. Only <code>&gt;</code>, <code>&lt;</code> and <code>=</code> can be used. Inequalities cannot be mixed with equality constraints, e.g. <code>c(b1-b2=0, b2&gt;0)</code> will fail. All parameter names must be on the left side. Fixed parameters cannot go into constraints. Alternatively, constraints can be defined as in <a href="maxLik.html#topic+maxLik">maxLik</a>. Constraints can only be used with maximum likelihood estimation and the BFGS routine in particular.
</p>
</li>
<li> <p><strong><code>estimationRoutine</code></strong>: Character. Estimation method. Can take values &quot;bfgs&quot;, &quot;bgw&quot;, &quot;bhhh&quot;, or &quot;nr&quot;. Used only if <code>apollo_control$HB</code> is FALSE. Default is &quot;bgw&quot;.
</p>
</li>
<li> <p><strong><code>hessianRoutine</code></strong>: Character. Name of routine used to calculate the Hessian of the log-likelihood function after estimation. Valid values are <code>"analytic"</code> (default), <code>"numDeriv"</code> (to use the numeric routine in package numDeric), <code>"maxLik"</code> (to use the numeric routine in packahe maxLik), and <code>"none"</code> to avoid calculating the Hessian and the covariance matrix. Only used if <code>apollo_control$HB=FALSE</code>.
</p>
</li>
<li> <p><strong><code>maxIterations</code></strong>: Numeric. Maximum number of iterations of the estimation routine before stopping. Used only if <code>apollo_control$HB</code> is FALSE. Default is 200.
</p>
</li>
<li> <p><strong><code>maxLik_settings</code></strong>: List. Additional settings for maxLik. See argument <code>control</code> in <a href="maxLik.html#topic+maxBFGS">maxBFGS</a>, <a href="maxLik.html#topic+maxBHHH">maxBHHH</a> and <a href="maxLik.html#topic+maxNM">maxNM</a> for more details. Only used for maximum likelihood estimation.
</p>
</li>
<li> <p><strong><code>numDeriv_method</code></strong>: Character. Method used for numerical differentiation when calculating the covariance matrix. Can be <code>"Richardson"</code> or <code>"simple"</code>, Only used if analytic gradients are available. See argument <code>method</code> in <a href="numDeriv.html#topic+grad">grad</a> for more details.
</p>
</li>
<li> <p><strong><code>numDeriv_settings</code></strong>: List. Additional arguments to the method used by numDeriv to calculate the Hessian. See argument <code>method.args</code> in <a href="numDeriv.html#topic+grad">grad</a> for more details.
</p>
</li>
<li> <p><strong><code>printLevel</code></strong>: Higher values render more verbous outputs. Can take values 0, 1, 2 or 3. Ignored if apollo_control$HB is TRUE. Default is 3.
</p>
</li>
<li> <p><strong><code>scaleAfterConvergence</code></strong>: Logical. Used to increase numerical precision of convergence. If TRUE, parameters are scaled to 1 after convergence, and the estimation is repeated from this new starting values. Results are reported scaled back, so it is a transparent process for the user. Default is TRUE.
</p>
</li>
<li> <p><strong><code>scaleHessian</code></strong>: Logical. If TRUE, parameters are scaled to 1 for Hessian estimation. Default is TRUE.
</p>
</li>
<li> <p><strong><code>scaling</code></strong>: Named vector. Names of elements should match those in <code>apollo_beta</code>. Optional scaling for parameters. If provided, for each parameter <code>i</code>, <code>(apollo_beta[i]/scaling[i])</code> is optimised, but <code>scaling[i]*(apollo_beta[i]/scaling[i])</code> is used during estimation. For example, if parameter b3=10, while b1 and b2 are close to 1, then setting <code>scaling = c(b3=10)</code> can help estimation, specially the calculation of the Hessian. Reports will still be based on the non-scaled parameters.
</p>
</li>
<li> <p><strong><code>silent</code></strong>: Logical. If TRUE, no information is printed to the console during estimation. Default is FALSE.
</p>
</li>
<li> <p><strong><code>validateGrad</code></strong>: Logical. If TRUE, the analytical gradient (if used) is compared to the numerical one. Default is FALSE.
</p>
</li>
<li> <p><strong><code>writeIter</code></strong>: Logical. Writes value of the parameters in each iteration to a csv file. Works only if <code>estimation_routine=="bfgs"|"bgw"</code>. Default is TRUE.
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>This is the main function of the Apollo package. The estimation process begins by running a number of checks on the 
<code>apollo_probabilities</code> function provided by the user.
If all checks are passed, estimation begins. There is no limit to estimation time other than reaching the maximum number of
iterations. If Bayesian estimation is used, estimation will finish once the predefined number of iterations are completed.
By default, this functions writes the estimated parameter values in each iteration to a file in the working/output directory. Writing 
can be turned off by setting <code>estimate_settings$writeIter</code> to <code>FALSE</code>.
By default, <strong>final results are not written into a file nor printed to the console</strong>, so users must make sure 
to call function <a href="#topic+apollo_modelOutput">apollo_modelOutput</a> and/or <a href="#topic+apollo_saveOutput">apollo_saveOutput</a> afterwards.
Users are strongly encouraged to visit <a href="http://www.apollochoicemodelling.com/">http://www.apollochoicemodelling.com/</a> to download examples on how to use the Apollo package.
The webpage also provides a detailed manual for the package, as well as a user-group to get further help.
</p>


<h3>Value</h3>

<p>model object
</p>

<hr>
<h2 id='apollo_estimateHB'>Estimates model using Bayesian estimation</h2><span id='topic+apollo_estimateHB'></span>

<h3>Description</h3>

<p>Estimates a model using Bayesian estimation on the likelihood function defined by <code>apollo_probabilities</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_estimateHB(
  apollo_beta,
  apollo_fixed,
  apollo_probabilities,
  apollo_inputs,
  estimate_settings = NA
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_estimateHB_+3A_apollo_beta">apollo_beta</code></td>
<td>
<p>Named numeric vector. Names and values for parameters.</p>
</td></tr>
<tr><td><code id="apollo_estimateHB_+3A_apollo_fixed">apollo_fixed</code></td>
<td>
<p>Character vector. Names (as defined in <code>apollo_beta</code>) of parameters whose value should not change during estimation.</p>
</td></tr>
<tr><td><code id="apollo_estimateHB_+3A_apollo_probabilities">apollo_probabilities</code></td>
<td>
<p>Function. Returns probabilities of the model to be estimated. Must receive three arguments:
</p>

<ul>
<li> <p><strong><code>apollo_beta</code></strong>: Named numeric vector. Names and values of model parameters.
</p>
</li>
<li> <p><strong><code>apollo_inputs</code></strong>: List containing options of the model. See <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.
</p>
</li>
<li> <p><strong><code>functionality</code></strong>: Character. Can be either <strong><code>"components"</code></strong>, <strong><code>"conditionals"</code></strong>, <strong><code>"estimate"</code></strong> (default), <strong><code>"gradient"</code></strong>, <strong><code>"output"</code></strong>, <strong><code>"prediction"</code></strong>, <strong><code>"preprocess"</code></strong>, <strong><code>"raw"</code></strong>, <strong><code>"report"</code></strong>, <strong><code>"shares_LL"</code></strong>, <strong><code>"validate"</code></strong> or <strong><code>"zero_LL"</code></strong>.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_estimateHB_+3A_apollo_inputs">apollo_inputs</code></td>
<td>
<p>List grouping most common inputs. Created by function <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
<tr><td><code id="apollo_estimateHB_+3A_estimate_settings">estimate_settings</code></td>
<td>
<p>List. Options controlling the estimation process, as used for in <a href="#topic+apollo_estimate">apollo_estimate</a>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is a sub function of <a href="#topic+apollo_estimate">apollo_estimate</a> which is called when using Bayesian estimation.
</p>


<h3>Value</h3>

<p>model object
</p>

<hr>
<h2 id='apollo_expandLoop'>Expands loops in a function or expression</h2><span id='topic+apollo_expandLoop'></span>

<h3>Description</h3>

<p>Expands loops replacing the index by its value. It also evaluates <code>paste</code> and <code>paste0</code>, and removes <code>get</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_expandLoop(f, apollo_inputs, validate = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_expandLoop_+3A_f">f</code></td>
<td>
<p>function (usually <code>apollo_probabilities</code>) inside which the name of the components are inserted.</p>
</td></tr>
<tr><td><code id="apollo_expandLoop_+3A_apollo_inputs">apollo_inputs</code></td>
<td>
<p>List grouping most common inputs. Created by function <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
<tr><td><code id="apollo_expandLoop_+3A_validate">validate</code></td>
<td>
<p>Logical. If TRUE, the new function will be validated before being returned</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For example, the expression
<code>for(j in 1:3) V[[paste0('alt',j)]] = b1*get(paste0('x',j)) + b2*X[,j]</code>
</p>
<p>would be expanded into:
</p>
<p><code>
V[[alt1]] = b1*x1 + b2*X[,1]
V[[alt2]] = b1*x2 + b2*X[,2]
V[[alt3]] = b1*x3 + b2*X[,3]
</code>
</p>


<h3>Value</h3>

<p>A function or an expression (same type as input <code>f</code>)
</p>

<hr>
<h2 id='apollo_firstRow'>Keeps only the first row for each individual</h2><span id='topic+apollo_firstRow'></span>

<h3>Description</h3>

<p>Given a multi-row input, keeps only the first row for each individual.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_firstRow(P, apollo_inputs)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_firstRow_+3A_p">P</code></td>
<td>
<p>List of vectors, matrices or 3-dim arrays. Likelihood of the model components (or other object).</p>
</td></tr>
<tr><td><code id="apollo_firstRow_+3A_apollo_inputs">apollo_inputs</code></td>
<td>
<p>List grouping most common inputs. Created by function <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This a function to keep only the first row of an object per indidividual. It can handle multiple types of components, including scalars, vectors and three-dimensional arrays (cubes).
The argument database MUST contain a column called 'apollo_sequence', which is created by <a href="#topic+apollo_validateData">apollo_validateData</a>.
</p>


<h3>Value</h3>

<p>If <code>P</code> is a list, then it returns a list where each element has only the first row of each individual.
If <code>P</code> is a single element, then it returns a single element with only the first row of each individual.
The size of the element is changed only in the first dimension. If input is a scalar, then it returns a vector with the element repeated as many
times as individuals in <code>database</code>. If the element is a vector, its length will be changed to the number of individuals. If the element is
a matrix, then its first dimension will be changed to the number of individuals, while keeping the size of the second dimension. If the element 
is a cube, then only the first dimension's length is changed, preserving the others.
</p>

<hr>
<h2 id='apollo_fitsTest'>Compares log-likelihood of model across categories</h2><span id='topic+apollo_fitsTest'></span>

<h3>Description</h3>

<p>Given the estimates of a model, it compares the log-likelihood at the observation level across categories of observations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_fitsTest(model, apollo_probabilities, apollo_inputs, fitsTest_settings)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_fitsTest_+3A_model">model</code></td>
<td>
<p>Model object. Estimated model object as returned by function <a href="#topic+apollo_estimate">apollo_estimate</a>.</p>
</td></tr>
<tr><td><code id="apollo_fitsTest_+3A_apollo_probabilities">apollo_probabilities</code></td>
<td>
<p>Function. Returns probabilities of the model to be estimated. Must receive three arguments:
</p>

<ul>
<li> <p><strong><code>apollo_beta</code></strong>: Named numeric vector. Names and values of model parameters.
</p>
</li>
<li> <p><strong><code>apollo_inputs</code></strong>: List containing options of the model. See <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.
</p>
</li>
<li> <p><strong><code>functionality</code></strong>: Character. Can be either <strong><code>"components"</code></strong>, <strong><code>"conditionals"</code></strong>, <strong><code>"estimate"</code></strong> (default), <strong><code>"gradient"</code></strong>, <strong><code>"output"</code></strong>, <strong><code>"prediction"</code></strong>, <strong><code>"preprocess"</code></strong>, <strong><code>"raw"</code></strong>, <strong><code>"report"</code></strong>, <strong><code>"shares_LL"</code></strong>, <strong><code>"validate"</code></strong> or <strong><code>"zero_LL"</code></strong>.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_fitsTest_+3A_apollo_inputs">apollo_inputs</code></td>
<td>
<p>List grouping most common inputs. Created by function <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
<tr><td><code id="apollo_fitsTest_+3A_fitstest_settings">fitsTest_settings</code></td>
<td>
<p>List. Contains settings for this function. User input is required for all settings except those with a default or marked as optional. 
</p>

<ul>
<li> <p><strong>subsamples</strong>: Named list of boolean vectors. Each element of the list defines whether a given observation belongs to a given subsample (e.g. by sociodemographics).
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>Prints a table comparing the average log-likelihood at the observation level for each category.
</p>


<h3>Value</h3>

<p>Matrix with average log-likelihood at observation level per category (invisibly).
</p>

<hr>
<h2 id='apollo_fmnl'>Calculates Fractional Multinomial Logit probabilities</h2><span id='topic+apollo_fmnl'></span>

<h3>Description</h3>

<p>Calculates the probabilities of a Fractional Multinomial Logit model and can also perform other operations based on the value of the <code>functionality</code> argument.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_fmnl(fmnl_settings, functionality)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_fmnl_+3A_fmnl_settings">fmnl_settings</code></td>
<td>
<p>List of inputs of the FMNL model. It should contain the following.
</p>

<ul>
<li> <p><strong><code>alternatives</code></strong>: Character vector. Names of alternatives, elements must match the names in list 'utilities'.
</p>
</li>
<li> <p><strong><code>avail</code></strong>: Named list of numeric vectors or scalars. Availabilities of alternatives, one element per alternative. Names of elements must match those in <code>alternatives</code>. Values can be 0 or 1. These can be scalars or vectors (of length equal to rows in the database). A user can also specify <code>avail=1</code> to indicate universal availability, or omit the setting completely.
</p>
</li>
<li> <p><strong><code>choiceShares</code></strong>: Named list of numeric vectors. Share allocated to each alternative. One element per alternative, as long as the number of observations or a scalar. Names must match those in <code>alternatives</code>.
</p>
</li>
<li> <p><strong><code>componentName</code></strong>: Character. Name given to model component. If not provided by the user, Apollo will set the name automatically according to the element in <code>P</code> to which the function output is directed.
</p>
</li>
<li> <p><strong><code>rows</code></strong>: Boolean vector. Consideration of which rows to include. Length equal to the number of observations (nObs), with entries equal to TRUE for rows to include, and FALSE for rows to exclude. Default is <code>"all"</code>, equivalent to <code>rep(TRUE, nObs)</code>.
</p>
</li>
<li> <p><strong><code>utilities</code></strong>: Named list of deterministic utilities . Utilities of the alternatives. Names of elements must match those in <code>alternatives.</code>
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_fmnl_+3A_functionality">functionality</code></td>
<td>
<p>Character. Setting instructing Apollo what processing to apply to the likelihood function. This is in general controlled by the functions that call <code>apollo_probabilities</code>, though the user can also call <code>apollo_probabilities</code> manually with a given functionality for testing/debugging. Possible values are:
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: For further processing/debugging, produces likelihood for each model component (if multiple components are present), at the level of individual draws and observations.
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: For conditionals, produces likelihood of the full model, at the level of individual inter-individual draws.
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: For model estimation, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: For model estimation, produces analytical gradients of the likelihood, where possible.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Prepares output for post-estimation reporting.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: For model prediction, produces probabilities for individual alternatives and individual model components (if multiple components are present) at the level of an observation, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Prepares likelihood functions for use in estimation.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: For debugging, produces probabilities of all alternatives and individual model components at the level of an observation, at the level of individual draws.
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: Prepares output summarising model and choiceset structure.
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: Produces overall model likelihood with constants only.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Validates model specification, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: Produces overall model likelihood with all parameters at zero.
</p>
</li></ul>
</td></tr>
</table>


<h3>Value</h3>

<p>The returned object depends on the value of argument <code>functionality</code> as follows.
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: vector/matrix/array. Returns the probabilities for the chosen alternative for each observation.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: List containing the likelihood and gradient of the model component.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Same as <code>"estimate"</code> but also writes summary of input data to internal Apollo log.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: List of vectors/matrices/arrays. Returns a list with the probabilities for all alternatives, with an extra element for the probability of the chosen alternative.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Returns a list with pre-processed inputs, based on <code>fmnl_settings</code>.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: Same as <code>"prediction"</code>
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: Overview of dependent variable
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: vector/matrix/array. Returns the probability of the chosen alternative when only constants are estimated.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Same as <code>"estimate"</code>, but it also runs a set of tests to validate the function inputs.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: vector/matrix/array. Returns the probability of the chosen alternative when all parameters are zero.
</p>
</li></ul>


<hr>
<h2 id='apollo_fnl'>Calculates Fractional Nested Logit probabilities</h2><span id='topic+apollo_fnl'></span>

<h3>Description</h3>

<p>Calculates the probabilities of a Fractional Nested Logit (FNL) model and can also perform other operations based on the value of the <code>functionality</code> argument.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_fnl(fnl_settings, functionality)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_fnl_+3A_fnl_settings">fnl_settings</code></td>
<td>
<p>List of inputs of the FNL model. It should contain the following.
</p>

<ul>
<li> <p><strong><code>alternatives</code></strong>: Character vector. Names of alternatives, elements must match the names in list 'utilities'.
</p>
</li>
<li> <p><strong><code>avail</code></strong>: Named list of numeric vectors or scalars. Availabilities of alternatives, one element per alternative. Names of elements must match those in <code>alternatives</code>. Values can be 0 or 1. These can be scalars or vectors (of length equal to rows in the database). A user can also specify <code>avail=1</code> to indicate universal availability, or omit the setting completely.
</p>
</li>
<li> <p><strong><code>choiceShares</code></strong>: Named list of numeric vectors. Share allocated to each alternative. One element per alternative, as long as the number of observations or a scalar. Names must match those in <code>alternatives</code>.
</p>
</li>
<li> <p><strong><code>componentName</code></strong>: Character. Name given to model component. If not provided by the user, Apollo will set the name automatically according to the element in <code>P</code> to which the function output is directed.
</p>
</li>
<li> <p><strong><code>nlNests</code></strong>: List of numeric scalars or vectors. Lambda parameters for each nest. Elements must be named with the nest name. The lambda at the root is automatically fixed to 1 if not provided by the user.
</p>
</li>
<li> <p><strong><code>nlStructure</code></strong>: Named list of character vectors. As many elements as nests, it must include the &quot;root&quot;. Each element contains the names of the nests or alternatives that belong to it. Element names must match those in <code>nlNests</code>.
</p>
</li>
<li> <p><strong><code>utilities</code></strong>: Named list of deterministic utilities . Utilities of the alternatives. Names of elements must match those in <code>alternatives.</code>
</p>
</li>
<li> <p><strong><code>rows</code></strong>: Boolean vector. Consideration of which rows to include. Length equal to the number of observations (nObs), with entries equal to TRUE for rows to include, and FALSE for rows to exclude. Default is <code>"all"</code>, equivalent to <code>rep(TRUE, nObs)</code>.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_fnl_+3A_functionality">functionality</code></td>
<td>
<p>Character. Setting instructing Apollo what processing to apply to the likelihood function. This is in general controlled by the functions that call <code>apollo_probabilities</code>, though the user can also call <code>apollo_probabilities</code> manually with a given functionality for testing/debugging. Possible values are:
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: For further processing/debugging, produces likelihood for each model component (if multiple components are present), at the level of individual draws and observations.
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: For conditionals, produces likelihood of the full model, at the level of individual inter-individual draws.
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: For model estimation, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: For model estimation, produces analytical gradients of the likelihood, where possible.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Prepares output for post-estimation reporting.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: For model prediction, produces probabilities for individual alternatives and individual model components (if multiple components are present) at the level of an observation, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Prepares likelihood functions for use in estimation.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: For debugging, produces probabilities of all alternatives and individual model components at the level of an observation, at the level of individual draws.
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: Prepares output summarising model and choiceset structure.
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: Produces overall model likelihood with constants only.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Validates model specification, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: Produces overall model likelihood with all parameters at zero.
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>In this implementation of the Nested Logit model, each nest must have a lambda parameter associated to it.
For the model to be consistent with utility maximisation, the estimated value of the Lambda parameter of all nests
should be between 0 and 1. Lambda parameters are inversely proportional to the correlation between the error terms of 
alternatives in a nest. If lambda=1, then there is no relevant correlation between the unobserved
utility of alternatives in that nest.
The tree must contain an upper nest called <code>"root"</code>. The lambda parameter of the root is automatically
set to 1 if not specified in <code>nlNests</code>, but can be changed by the user if desired (though not advised).
</p>


<h3>Value</h3>

<p>The returned object depends on the value of argument <code>functionality</code> as follows.
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: vector/matrix/array. Returns the probabilities for the chosen alternative for each observation.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: Not implemented.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Same as <code>"estimate"</code> but also writes summary of input data to internal Apollo log.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: List of vectors/matrices/arrays. Returns a list with the probabilities for all alternatives, with an extra element for the probability of the chosen alternative.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Returns a list with pre-processed inputs, based on <code>fnl_settings</code>.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: Same as <code>"prediction"</code>
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: List with tree structure and choice overview.
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: vector/matrix/array. Returns the probability of the chosen alternative when only constants are estimated.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Same as <code>"estimate"</code>, but it also runs a set of tests to validate the function inputs.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: vector/matrix/array. Returns the probability of the chosen alternative when all parameters are zero.
</p>
</li></ul>


<hr>
<h2 id='apollo_initialise'>Prepares environment</h2><span id='topic+apollo_initialise'></span>

<h3>Description</h3>

<p>Prepares environment (the global environment if called by the user) for model definition and estimation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_initialise()
</code></pre>


<h3>Details</h3>

<p>This function detaches variables and makes sure that output is directed to console. It does not delete variables from the working environment.
</p>


<h3>Value</h3>

<p>Nothing.
</p>

<hr>
<h2 id='apollo_insertComponentName'>Adds componentName2 to model calls</h2><span id='topic+apollo_insertComponentName'></span>

<h3>Description</h3>

<p>Adds componentName2 to model calls
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_insertComponentName(e)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_insertComponentName_+3A_e">e</code></td>
<td>
<p>An expression or a function. It will usually be apollo_probabilities.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The original argument 'e' but modified to incorporate a new setting
called 'componentName2' to every call to apollo_&lt;model&gt; (e.g. 
apollo_mnl, apollo_nl, etc.).
</p>

<hr>
<h2 id='apollo_insertFunc'>Modifies function to make it compatible with analytic gradients</h2><span id='topic+apollo_insertFunc'></span>

<h3>Description</h3>

<p>Takes a likelihood function and inserts <code>function ()</code> before key elements to allow for analytic gradient calculation
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_insertFunc(f, like = TRUE, randCoeff = FALSE, lcPars = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_insertFunc_+3A_f">f</code></td>
<td>
<p>Function. Expressions inside it will be turned into functions. Usually <code>apollo_probabilities</code> or 
<code>apollo_randCoeff</code>.</p>
</td></tr>
<tr><td><code id="apollo_insertFunc_+3A_like">like</code></td>
<td>
<p>Logical. Must be TRUE if <code>f</code> is <code>apollo_probabilities</code>. FALSE otherwise.</p>
</td></tr>
<tr><td><code id="apollo_insertFunc_+3A_randcoeff">randCoeff</code></td>
<td>
<p>Logical. Must be TRUE if <code>f</code> is <code>apollo_randCoeff</code>. FALSE otherwise.</p>
</td></tr>
<tr><td><code id="apollo_insertFunc_+3A_lcpars">lcPars</code></td>
<td>
<p>Logical. Must be TRUE if <code>f</code> is <code>apollo_lcPars</code>. FALSE otherwise.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>It modifies the definition of the following models.
</p>

<ul>
<li> <p><strong><code>apollo_mnl</code></strong>: Turns all elements inside <code>mnl_settings$V</code> into functions.
</p>
</li>
<li> <p><strong><code>apollo_ol</code></strong>: Turns <code>ol_settings$V</code> and all elements inside <code>ol_settings$tau</code> into functions.
</p>
</li>
<li> <p><strong><code>apollo_op</code></strong>: Turns <code>op_settings$V</code> and all elements inside <code>op_settings$tau</code> into functions.
</p>
</li>
<li> <p><strong><code>apollo_normalDensity</code></strong>: Turns <code>normalDensity_settings$xNormal</code>, <code>normalDensity_settings$mu</code> and <code>normalDensity_settings$sigma</code> into functions.
</p>
</li></ul>

<p>It can only track a maximum of 3 levels of depth in definitions. For example:
<code>
V &lt;- list()
V[["A"]] &lt;- b1*x1A + b2*x2A
V[["B"]] &lt;- b1*x1B + b2*x2B
mnl_settings1 &lt;- list(alternatives=c("A", "B"), V = V, choiceVar= Y, avail = 1, componentName="MNL1")
P[["MNL1"]] &lt;- apollo_mnl(mnl_settings1, functionality)
</code>
But it may not be able to deal with the following:
<code>
VA &lt;- b1*x1A + b2*x2A
V &lt;- list()
V[["A"]] &lt;- VA
V[["B"]] &lt;- b1*x1B + b2*x2B
mnl_settings1 &lt;- list(alternatives=c("A", "B"), V = V, choiceVar= Y, avail = 1, componentName="MNL1")
P[["MNL1"]] &lt;- apollo_mnl(mnl_settings1, functionality)
</code>
But that might be enough given how apollo_dVdB works.
</p>


<h3>Value</h3>

<p>Function <code>f</code> but with relevant expressions turned into function definitions.
</p>

<hr>
<h2 id='apollo_insertOLList'>Replaces <code>tau=c(...)</code> by <code>tau=list(...)</code> in calls to <code>apollo_ol</code></h2><span id='topic+apollo_insertOLList'></span>

<h3>Description</h3>

<p>Takes a function, looks for calls to apollo_ol, identifies the corresponding
ol_settings, then goes inside the definition of ol_settings and replaces
<code>tau=c(...)</code> for <code>tau=list(...)</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_insertOLList(f)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_insertOLList_+3A_f">f</code></td>
<td>
<p>Function. Usually <code>apollo_probabilities</code>, 
<code>apollo_randCoeff</code>, or <code>apollo_lcPars</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This only goes one level deep in definitions. For example, it will work
correctly in the following cases:
<code>
ol_settings = list(outcomeOrdered = y1, 
                   V   = b1*x1, 
                   tau = c(tau11, tau12))
P[["OL1"]] = apollo_ol(ol_settings, functionality)
P[["OL2"]] = apollo_ol(list(outcomeOrdered=y2, V=b2*x2, tau=c(tau21, tau22)),
                       functionality)
</code>
But it will not work on the following cases:
<code>
Tau = c(tau1, tau2, tau3)
ol_settings = list(outcomeOrdered = y2,
                   V = b2*x2, 
                   tau = Tau)
P[["OL1"]] = apollo_ol(ol_settings, functionality)
P[["OL2"]] = apollo_ol(list(outcomeOrdered=y1, V=b1*x1, tau=Tau), functionality)
</code>
</p>
<p>This function is called by apollo_modifyUserDefFunc to allow for analytical
gradients when using apollo_ol.
</p>


<h3>Value</h3>

<p>Function <code>f</code> with <code>tau=c(...)</code> replaced by 
<code>tau=list(...)</code>.
</p>

<hr>
<h2 id='apollo_insertRows'>Inserts rows</h2><span id='topic+apollo_insertRows'></span>

<h3>Description</h3>

<p>Given a numeric object (scalar, vector, matrix or 3-dim array) inserts rows in the specified places.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_insertRows(v, r, val)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_insertRows_+3A_v">v</code></td>
<td>
<p>Numeric scalar, vector, matrix or 3-dim array.</p>
</td></tr>
<tr><td><code id="apollo_insertRows_+3A_r">r</code></td>
<td>
<p>Boolean vector. TRUE for inserting a row from <code>utilities</code>, <code>FALSE</code> to insert a new row with value <code>val</code>.</p>
</td></tr>
<tr><td><code id="apollo_insertRows_+3A_val">val</code></td>
<td>
<p>Numeric scalar. Value that will fill new rows.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>In general, <code>r</code> should be longer than the number of rows in <code>utilities</code>, and <code>sum(r)=nrow(v)</code>.
If not, then a new object with as many rows as <code>r</code> will be returned. Old rows will be taken 
from <code>utilities</code> from the top down.
</p>


<h3>Value</h3>

<p>The same argument <code>utilities</code> but with the rows where <code>r==FALSE</code> removed.
</p>

<hr>
<h2 id='apollo_insertRRMQuotes'>Introduces quotes into rrm_settings</h2><span id='topic+apollo_insertRRMQuotes'></span>

<h3>Description</h3>

<p>Takes a function, looks for the definition of relevant parts of rrm_settings,
and introduces quotes on them. This is to facilitate their processing by
apollo_rrm under functionality=&quot;preprocessing&quot;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_insertRRMQuotes(f)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_insertRRMQuotes_+3A_f">f</code></td>
<td>
<p>Function. Usually <code>apollo_probabilities</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Function <code>f</code> with relevant expressions turned into character.
</p>

<hr>
<h2 id='apollo_insertScaling'>Scales variables inside a function</h2><span id='topic+apollo_insertScaling'></span>

<h3>Description</h3>

<p>It changes the syntax of the function by replacing variable names for their scaled form, 
e.g. x &ndash;&gt; x*apollo_inputs$apollo_scale[[&quot;x&quot;]]. In assignments, it only scales the
right side of the assignment.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_insertScaling(e, sca)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_insertScaling_+3A_e">e</code></td>
<td>
<p>Function, expression, call or symbol to alter.</p>
</td></tr>
<tr><td><code id="apollo_insertScaling_+3A_sca">sca</code></td>
<td>
<p>Named numeric vector with the scales. The names in these vectors determine which variables should be scaled.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A function, expression, call or symbol with the corresponding variables scaled.
</p>

<hr>
<h2 id='apollo_keepRows'>Keeps only some rows</h2><span id='topic+apollo_keepRows'></span>

<h3>Description</h3>

<p>Given a numeric object (scalar, vector, matrix or 3-dim array) keeps only the specified rows.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_keepRows(v, r)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_keepRows_+3A_v">v</code></td>
<td>
<p>Numeric scalar, vector, matrix or 3-dim array.</p>
</td></tr>
<tr><td><code id="apollo_keepRows_+3A_r">r</code></td>
<td>
<p>Boolean vector. As many elements as rows in <code>utilities</code>. TRUE for keeping the row. <code>FALSE</code> to drop it.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The same argument <code>utilities</code> but with the rows where <code>r==FALSE</code> removed.
</p>

<hr>
<h2 id='apollo_lc'>Calculates the likelihood of a latent class model</h2><span id='topic+apollo_lc'></span>

<h3>Description</h3>

<p>Given within class probabilities, and class allocation probabilities, calculates the probabilities of an Exploded Logit model and can also perform other operations based on the value of the <code>functionality</code> argument.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_lc(lc_settings, apollo_inputs, functionality)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_lc_+3A_lc_settings">lc_settings</code></td>
<td>
<p>List. Contains settings for this function. User input is required for all settings except those with a default or marked as optional. 
</p>

<ul>
<li> <p><strong>inClassProb</strong>: List of probabilities. Conditional likelihood for each class. One element per class, in the same order as <code>classProb</code>.
</p>
</li>
<li> <p><strong>classProb</strong>: List of probabilities. Allocation probability for each class. One element per class, in the same order as <code>inClassProb</code>.
</p>
</li>
<li> <p><strong>componentName</strong>: Character. Name given to model component (optional).
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_lc_+3A_apollo_inputs">apollo_inputs</code></td>
<td>
<p>List grouping most common inputs. Created by function <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
<tr><td><code id="apollo_lc_+3A_functionality">functionality</code></td>
<td>
<p>Character. Setting instructing Apollo what processing to apply to the likelihood function. This is in general controlled by the functions that call <code>apollo_probabilities</code>, though the user can also call <code>apollo_probabilities</code> manually with a given functionality for testing/debugging. Possible values are:
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: For further processing/debugging, produces likelihood for each model component (if multiple components are present), at the level of individual draws and observations.
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: For conditionals, produces likelihood of the full model, at the level of individual inter-individual draws.
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: For model estimation, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: For model estimation, produces analytical gradients of the likelihood, where possible.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Prepares output for post-estimation reporting.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: For model prediction, produces probabilities for individual alternatives and individual model components (if multiple components are present) at the level of an observation, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Prepares likelihood functions for use in estimation.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: For debugging, produces probabilities of all alternatives and individual model components at the level of an observation, at the level of individual draws.
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: Prepares output summarising model and choiceset structure.
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: Produces overall model likelihood with constants only.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Validates model specification, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: Produces overall model likelihood with all parameters at zero.
</p>
</li></ul>
</td></tr>
</table>


<h3>Value</h3>

<p>The returned object depends on the value of argument <code>functionality</code> as follows.
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: Returns nothing.
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: vector/matrix/array. Returns the probabilities for the chosen alternative for each observation.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: List containing the likelihood and gradient of the model component.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Same as <code>"estimate"</code> but also writes summary of input data to internal Apollo log.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: List of vectors/matrices/arrays. Returns a list with the probabilities for all models components, for each class.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Returns a list with pre-processed inputs, based on <code>lc_settings</code>.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: Same as <code>"prediction"</code>
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: Class allocation overview.
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Same as <code>"estimate"</code>, but also runs a set of tests on the given arguments.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: Same as <code>"estimate"</code>
</p>
</li></ul>


<hr>
<h2 id='apollo_lcConditionals'>Calculates conditionals for latent class models.</h2><span id='topic+apollo_lcConditionals'></span>

<h3>Description</h3>

<p>Calculates posterior expected values (conditionals) of class allocation probabilities for each individual.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_lcConditionals(model, apollo_probabilities, apollo_inputs)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_lcConditionals_+3A_model">model</code></td>
<td>
<p>Model object. Estimated model object as returned by function <a href="#topic+apollo_estimate">apollo_estimate</a>.</p>
</td></tr>
<tr><td><code id="apollo_lcConditionals_+3A_apollo_probabilities">apollo_probabilities</code></td>
<td>
<p>Function. Returns probabilities of the model to be estimated. Must receive three arguments:
</p>

<ul>
<li> <p><strong><code>apollo_beta</code></strong>: Named numeric vector. Names and values of model parameters.
</p>
</li>
<li> <p><strong><code>apollo_inputs</code></strong>: List containing options of the model. See <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.
</p>
</li>
<li> <p><strong><code>functionality</code></strong>: Character. Can be either <strong><code>"components"</code></strong>, <strong><code>"conditionals"</code></strong>, <strong><code>"estimate"</code></strong> (default), <strong><code>"gradient"</code></strong>, <strong><code>"output"</code></strong>, <strong><code>"prediction"</code></strong>, <strong><code>"preprocess"</code></strong>, <strong><code>"raw"</code></strong>, <strong><code>"report"</code></strong>, <strong><code>"shares_LL"</code></strong>, <strong><code>"validate"</code></strong> or <strong><code>"zero_LL"</code></strong>.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_lcConditionals_+3A_apollo_inputs">apollo_inputs</code></td>
<td>
<p>List grouping most common inputs. Created by function <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function can only be used with latent class models without continuous heterogeneity.
</p>


<h3>Value</h3>

<p>A matrix with the posterior class allocation probabilities for each individual.
</p>

<hr>
<h2 id='apollo_lcEM'>Uses EM for latent class model</h2><span id='topic+apollo_lcEM'></span>

<h3>Description</h3>

<p>Uses the EM algorithm for estimating a latent class model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_lcEM(
  apollo_beta,
  apollo_fixed,
  apollo_probabilities,
  apollo_inputs,
  lcEM_settings = NA,
  estimate_settings = NA
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_lcEM_+3A_apollo_beta">apollo_beta</code></td>
<td>
<p>Named numeric vector. Names and values for parameters.</p>
</td></tr>
<tr><td><code id="apollo_lcEM_+3A_apollo_fixed">apollo_fixed</code></td>
<td>
<p>Character vector. Names (as defined in <code>apollo_beta</code>) of parameters whose value should not 
change during estimation.</p>
</td></tr>
<tr><td><code id="apollo_lcEM_+3A_apollo_probabilities">apollo_probabilities</code></td>
<td>
<p>Function. Returns probabilities of the model to be estimated. Must receive three arguments:
</p>

<ul>
<li> <p><strong><code>apollo_beta</code></strong>: Named numeric vector. Names and values of model parameters.
</p>
</li>
<li> <p><strong><code>apollo_inputs</code></strong>: List containing options of the model. See <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.
</p>
</li>
<li> <p><strong><code>functionality</code></strong>: Character. Can be either 
<strong><code>"components"</code></strong>, <strong><code>"conditionals"</code></strong>, <strong><code>"estimate"</code></strong> (default), <strong><code>"gradient"</code></strong>, <strong><code>"output"</code></strong>, <strong><code>"prediction"</code></strong>, <strong><code>"preprocess"</code></strong>, <strong><code>"raw"</code></strong>, <strong><code>"report"</code></strong>, <strong><code>"shares_LL"</code></strong>, <strong><code>"validate"</code></strong> or <strong><code>"zero_LL"</code></strong>.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_lcEM_+3A_apollo_inputs">apollo_inputs</code></td>
<td>
<p>List grouping most common inputs. Created by function <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
<tr><td><code id="apollo_lcEM_+3A_lcem_settings">lcEM_settings</code></td>
<td>
<p>List. Options controlling the EM process.
</p>

<ul>
<li> <p><strong>EMmaxIterations</strong>: Numeric. Maximum number of iterations of the EM algorithm before 
stopping. Default is 100. 
</p>
</li>
<li> <p><strong>postEM</strong>: Numeric scalar. Determines the tasks performed by this function 
after the EM algorithm has converged. Can take values <code>0</code>, <code>1</code> 
or <code>2</code> only. If value is <code>0</code>, only the EM algorithm will be 
performed, and the results will be a model object without a covariance 
matrix (i.e. estimates only). If value is <code>1</code>, after the EM 
algorithm, the covariance matrix of the model will be calculated as well, 
and the result will be a model object with a covariance matrix. If value 
is <code>2</code>, after the EM algorithm, the estimated parameter values will 
be used as starting value for a maximum likelihood estimation process, 
which will render a model object with a covariance matrix. Performing 
maximum likelihood estimation after the EM algorithm is useful, as there 
may be room for further improvement. Default is <code>2</code>.
</p>
</li>
<li> <p><strong>silent</strong>: Boolean. If TRUE, no information is printed to the console during 
estimation. Default is FALSE.
</p>
</li>
<li> <p><strong>stoppingCriterion</strong>: Numeric. Convergence criterion. The EM process will stop when 
improvements in the log-likelihood fall below this value. 
Default is 10^-5.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_lcEM_+3A_estimate_settings">estimate_settings</code></td>
<td>
<p>List. Options controlling the estimation process within each EM iteration. See 
<a href="#topic+apollo_estimate">apollo_estimate</a> for details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function uses the EM algorithm for estimating a Latent Class model. It is only suitable for models without 
continuous mixing. All parameters need to vary across classes and need to be included in the <code>apollo_lcPars</code> 
function which is used by <code>apollo_lcEM</code>.
</p>


<h3>Value</h3>

<p>model object
</p>

<hr>
<h2 id='apollo_lcUnconditionals'>Returns unconditionals for a latent class model model</h2><span id='topic+apollo_lcUnconditionals'></span>

<h3>Description</h3>

<p>Returns values for random parameters and class allocation probabilities in a latent class model model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_lcUnconditionals(model, apollo_probabilities, apollo_inputs)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_lcUnconditionals_+3A_model">model</code></td>
<td>
<p>Model object. Estimated model object as returned by function <a href="#topic+apollo_estimate">apollo_estimate</a>.</p>
</td></tr>
<tr><td><code id="apollo_lcUnconditionals_+3A_apollo_probabilities">apollo_probabilities</code></td>
<td>
<p>Function. Returns probabilities of the model to be estimated. Must receive three arguments:
</p>

<ul>
<li> <p><strong><code>apollo_beta</code></strong>: Named numeric vector. Names and values of model parameters.
</p>
</li>
<li> <p><strong><code>apollo_inputs</code></strong>: List containing options of the model. See <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.
</p>
</li>
<li> <p><strong><code>functionality</code></strong>: Character. Can be either <strong><code>"components"</code></strong>, <strong><code>"conditionals"</code></strong>, <strong><code>"estimate"</code></strong> (default), <strong><code>"gradient"</code></strong>, <strong><code>"output"</code></strong>, <strong><code>"prediction"</code></strong>, <strong><code>"preprocess"</code></strong>, <strong><code>"raw"</code></strong>, <strong><code>"report"</code></strong>, <strong><code>"shares_LL"</code></strong>, <strong><code>"validate"</code></strong> or <strong><code>"zero_LL"</code></strong>.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_lcUnconditionals_+3A_apollo_inputs">apollo_inputs</code></td>
<td>
<p>List grouping most common inputs. Created by function <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List of object, one per random component and one for the class allocation probabilities.
</p>

<hr>
<h2 id='apollo_llCalc'>Calculates log-likelihood of all model components</h2><span id='topic+apollo_llCalc'></span>

<h3>Description</h3>

<p>Calculates the log-likelihood of each model component as well as the whole model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_llCalc(apollo_beta, apollo_probabilities, apollo_inputs, silent = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_llCalc_+3A_apollo_beta">apollo_beta</code></td>
<td>
<p>Named numeric vector. Names and values for parameters.</p>
</td></tr>
<tr><td><code id="apollo_llCalc_+3A_apollo_probabilities">apollo_probabilities</code></td>
<td>
<p>Function. Returns probabilities of the model to be estimated. Must receive three arguments:
</p>

<ul>
<li> <p><strong><code>apollo_beta</code></strong>: Named numeric vector. Names and values of model parameters.
</p>
</li>
<li> <p><strong><code>apollo_inputs</code></strong>: List containing options of the model. See <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.
</p>
</li>
<li> <p><strong><code>functionality</code></strong>: Character. Can be either <strong><code>"components"</code></strong>, <strong><code>"conditionals"</code></strong>, <strong><code>"estimate"</code></strong> (default), <strong><code>"gradient"</code></strong>, <strong><code>"output"</code></strong>, <strong><code>"prediction"</code></strong>, <strong><code>"preprocess"</code></strong>, <strong><code>"raw"</code></strong>, <strong><code>"report"</code></strong>, <strong><code>"shares_LL"</code></strong>, <strong><code>"validate"</code></strong> or <strong><code>"zero_LL"</code></strong>.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_llCalc_+3A_apollo_inputs">apollo_inputs</code></td>
<td>
<p>List grouping most common inputs. Created by function <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
<tr><td><code id="apollo_llCalc_+3A_silent">silent</code></td>
<td>
<p>Boolean. If TRUE, no information is printed to the console by the function. Default is FALSE.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function calls apollo_probabilities with functionality=&quot;output&quot;. It then reorders the list of likelihoods so that &quot;model&quot; goes first.
</p>


<h3>Value</h3>

<p>A list of vectors. Each vector corresponds to the log-likelihood of the whole model (first element) or a model component.
</p>

<hr>
<h2 id='apollo_loadModel'>Loads model from file</h2><span id='topic+apollo_loadModel'></span>

<h3>Description</h3>

<p>Loads a previously estimated model object from a file.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_loadModel(modelName)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_loadModel_+3A_modelname">modelName</code></td>
<td>
<p>Character. Name of the model to load.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function looks for a file named <code>modelName_model.rds</code> in the working or output directory, loads the object contained in it, and returns it.
</p>


<h3>Value</h3>

<p>A model object.
</p>

<hr>
<h2 id='apollo_longToWide'>Converts data from long to wide format.</h2><span id='topic+apollo_longToWide'></span>

<h3>Description</h3>

<p>Converts choice data from long to wide format, with one row per observation as opposed to one row per alternative/observation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_longToWide(longData, longToWide_settings)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_longToWide_+3A_longdata">longData</code></td>
<td>
<p>data.frame. Data in long format.</p>
</td></tr>
<tr><td><code id="apollo_longToWide_+3A_longtowide_settings">longToWide_settings</code></td>
<td>
<p>List. Contains settings for this function. User input is required for all settings. 
</p>

<ul>
<li> <p><strong><code>alternative_column</code></strong>: Character. Name of column in long data that contains the names of the alternatives (either numeric or character).
</p>
</li>
<li> <p><strong><code>alternative_specific_attributes</code></strong>: Character vector. Names of columns in long data with attributes that vary across alternatives within an observation.
</p>
</li>
<li> <p><strong><code>choice_column</code></strong>: Character. Name of column in long data that contains the choice.
</p>
</li>
<li> <p><strong><code>ID_column</code></strong>: Character. Name of column in long data that contains the ID of individuals.
</p>
</li>
<li> <p><strong><code>observation_column</code></strong>: Character. Name of column in long data that contains the observation index.
</p>
</li></ul>
</td></tr>
</table>


<h3>Value</h3>

<p>Silently returns a data.frame with the wide format version of the data.
An overview of the data is printed to screen.
</p>

<hr>
<h2 id='apollo_lrTest'>Likelihood ratio test</h2><span id='topic+apollo_lrTest'></span>

<h3>Description</h3>

<p>Calculates the likelihood ratio test value between two models and reports the corresponding p-value.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_lrTest(model1, model2)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_lrTest_+3A_model1">model1</code></td>
<td>
<p>Either a character variable with the name of a previously estimated model, or an estimated 
model in memory, as returned by <a href="#topic+apollo_estimate">apollo_estimate</a>.</p>
</td></tr>
<tr><td><code id="apollo_lrTest_+3A_model2">model2</code></td>
<td>
<p>Either a character variable with the name of a previously estimated model, or an estimated 
model in memory, as returned by <a href="#topic+apollo_estimate">apollo_estimate</a>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The two models need to have been estimated on the same data, and one model needs to be nested within the other model.
</p>


<h3>Value</h3>

<p>LR-test p-value (invisibly)
</p>

<hr>
<h2 id='apollo_makeCluster'>Creates cluster for estimation.</h2><span id='topic+apollo_makeCluster'></span>

<h3>Description</h3>

<p>Splits data, creates cluster and loads different pieces of the database on each worker.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_makeCluster(
  apollo_probabilities,
  apollo_inputs,
  silent = FALSE,
  cleanMemory = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_makeCluster_+3A_apollo_probabilities">apollo_probabilities</code></td>
<td>
<p>Function. Returns probabilities of the model to be estimated. Must receive three arguments:
</p>

<ul>
<li> <p><strong><code>apollo_beta</code></strong>: Named numeric vector. Names and values of model parameters.
</p>
</li>
<li> <p><strong><code>apollo_inputs</code></strong>: List containing options of the model. See <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.
</p>
</li>
<li> <p><strong><code>functionality</code></strong>: Character. Can be either <strong><code>"components"</code></strong>, <strong><code>"conditionals"</code></strong>, <strong><code>"estimate"</code></strong> (default), <strong><code>"gradient"</code></strong>, <strong><code>"output"</code></strong>, <strong><code>"prediction"</code></strong>, <strong><code>"preprocess"</code></strong>, <strong><code>"raw"</code></strong>, <strong><code>"report"</code></strong>, <strong><code>"shares_LL"</code></strong>, <strong><code>"validate"</code></strong> or <strong><code>"zero_LL"</code></strong>.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_makeCluster_+3A_apollo_inputs">apollo_inputs</code></td>
<td>
<p>List grouping most common inputs. Created by function <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
<tr><td><code id="apollo_makeCluster_+3A_silent">silent</code></td>
<td>
<p>Boolean. If TRUE, no messages are printed to the terminal. FALSE by default. It overrides <code>apollo_inputs$silent</code>.</p>
</td></tr>
<tr><td><code id="apollo_makeCluster_+3A_cleanmemory">cleanMemory</code></td>
<td>
<p>Boolean. If TRUE, it saves apollo_inputs to disc, and removes database and draws from 
the apollo_inputs in .GlobalEnv and the parent environment.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Internal use only. Called by <code>apollo_estimate</code> before estimation. Using multiple cores greatly increases memory consumption.
</p>


<h3>Value</h3>

<p>Cluster (i.e. an object of class cluster from package parallel)
</p>

<hr>
<h2 id='apollo_makeDraws'>Creates draws for models with mixing</h2><span id='topic+apollo_makeDraws'></span>

<h3>Description</h3>

<p>Creates a list containing all draws necessary to estimate a model with mixing.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_makeDraws(apollo_inputs, silent = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_makeDraws_+3A_apollo_inputs">apollo_inputs</code></td>
<td>
<p>List grouping most common inputs. Created by function <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
<tr><td><code id="apollo_makeDraws_+3A_silent">silent</code></td>
<td>
<p>Boolean. If true, then no information is printed to console or default output. FALSE by default.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Internal use only. Called by <code>apollo_validateInputs</code>.
This function creates a list whose elements are the sets of draws requested by the user for use in a model with mixing.
If the model does not include mixing, then it is not necessary to run this function.
The number of draws has a massive impact on memory usage and estimation time. Memory usage and number of computations
scale geometrically as N*interNDraws*intraNDraws (where N is the number of observations). Special care should be taken
when using both inter and intra-individual draws, as memory usage can easily reach the GB order of magnitude. Also, keep in
mind that using several threads (i.e. multicore) at least doubles the memory usage.
This function returns a list, with each element representing a random component of the mixing model. The dimensions 
of the array depend on the type of draws used.
</p>

<ol>
<li><p> If only inter-individual draws are used, then draws are stored as 2-dimensional arrays (i.e. matrices).
</p>
</li>
<li><p> If intra-individual draws are used, then draws are stored as 3-dimensional arrays.
</p>
</li>
<li><p> The first dimension of the arrays (rows) correspond with the observations in the database.
</p>
</li>
<li><p> The second dimension of the arrays (columns) correspond to the number of inter-individual draws.
</p>
</li>
<li><p> The third dimension of the arrays correspond to the number of intra-individual draws.
</p>
</li></ol>



<h3>Value</h3>

<p>List. Each element is an array of draws representing a random component of the mixing model.
</p>

<hr>
<h2 id='apollo_makeGrad'>Creates gradient function.</h2><span id='topic+apollo_makeGrad'></span>

<h3>Description</h3>

<p>Creates gradient function from the likelihood function apollo_probabilities provided by the user. Returns NULL if 
the creation of gradient function fails.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_makeGrad(
  apollo_beta,
  apollo_fixed,
  apollo_logLike,
  validateGrad = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_makeGrad_+3A_apollo_beta">apollo_beta</code></td>
<td>
<p>Named numeric vector. Names and values for parameters.</p>
</td></tr>
<tr><td><code id="apollo_makeGrad_+3A_apollo_fixed">apollo_fixed</code></td>
<td>
<p>Character vector. Names (as defined in <code>apollo_beta</code>) of parameters whose value should not 
change during estimation.</p>
</td></tr>
<tr><td><code id="apollo_makeGrad_+3A_apollo_loglike">apollo_logLike</code></td>
<td>
<p>Function to calculate the log-likelihood of the model, as created by <a href="#topic+apollo_makeLogLike">apollo_makeLogLike</a>
If provided, the value of the analytical gradient will be compared to the value of the
numerical gradient as calculated using apollo_logLike and the numDeriv package.
If the difference between the two is bigger than 1
that the analytical gradient is wrong and NULL will be returned.</p>
</td></tr>
<tr><td><code id="apollo_makeGrad_+3A_validategrad">validateGrad</code></td>
<td>
<p>Logical. If TRUE, it compares the value of the analytical gradient evaluated at apollo_beta
against the numeric gradient (using numDeriv) at the same value. If the difference is bigger
than 1
return NULL.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Internal use only. Called by <code>apollo_estimate</code> before estimation.
The returned function can be single-threaded or multi-threaded based on the model options.
</p>


<h3>Value</h3>

<p>apollo_gradient function. It receives the following arguments
</p>

<ul>
<li> <p><strong><code>b</code></strong> Numeric vector of _variable_ parameters (i.e. must not include fixed parameters).
</p>
</li>
<li> <p><strong><code>countIter</code></strong> Not used. Included only to mirror inputs of apollo_logLike.
</p>
</li>
<li> <p><strong><code>getNIter</code></strong> Not used. Included only to mirror inputs of apollo_logLike.
</p>
</li>
<li> <p><strong><code>sumLL</code></strong> Not used. Included only to mirror inputs of apollo_logLike.
</p>
</li>
<li> <p><strong><code>writeIter</code></strong> Not used. Included only to mirror inputs of apollo_logLike.
</p>
</li></ul>

<p>If the creation of the gradient function fails, then it returns NULL.
</p>

<hr>
<h2 id='apollo_makeHessian'>Creates hessian function.</h2><span id='topic+apollo_makeHessian'></span>

<h3>Description</h3>

<p>Creates hessian function from the likelihood function apollo_probabilities provided by the user. Returns NULL if 
the creation of gradient function fails.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_makeHessian(apollo_beta, apollo_fixed, apollo_logLike)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_makeHessian_+3A_apollo_beta">apollo_beta</code></td>
<td>
<p>Named numeric vector. Names and values for (all) parameters.</p>
</td></tr>
<tr><td><code id="apollo_makeHessian_+3A_apollo_fixed">apollo_fixed</code></td>
<td>
<p>Character vector. Names (as defined in <code>apollo_beta</code>) of parameters whose value should not 
change during estimation.</p>
</td></tr>
<tr><td><code id="apollo_makeHessian_+3A_apollo_loglike">apollo_logLike</code></td>
<td>
<p>Function to calculate the log-likelihood of the model, as created by <a href="#topic+apollo_makeLogLike">apollo_makeLogLike</a>
If provided, the value of the analytical gradient will be compared to the value of the
numerical gradient as calculated using apollo_logLike and the numDeriv package.
If the difference between the two is bigger than 1
that the analytical gradient is wrong and NULL will be returned.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Internal use only. Called by <code>apollo_estimate</code> before estimation.
The returned function can be single-threaded or multi-threaded based on the model options.
</p>


<h3>Value</h3>

<p>apollo_hessian function. It receives a single argument called <code>b</code>, which are the _variable_ 
parameters (i.e. must not include fixed parameters).
</p>

<hr>
<h2 id='apollo_makeLogLike'>Creates log-likelihood function.</h2><span id='topic+apollo_makeLogLike'></span>

<h3>Description</h3>

<p>Creates log-likelihood function from the likelihood function apollo_probabilities provided by the user.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_makeLogLike(
  apollo_beta,
  apollo_fixed,
  apollo_probabilities,
  apollo_inputs,
  apollo_estSet = list(estimationRoutine = "bgw"),
  cleanMemory = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_makeLogLike_+3A_apollo_beta">apollo_beta</code></td>
<td>
<p>Named numeric vector. Names and values for parameters.</p>
</td></tr>
<tr><td><code id="apollo_makeLogLike_+3A_apollo_fixed">apollo_fixed</code></td>
<td>
<p>Character vector. Names (as defined in <code>apollo_beta</code>) of parameters whose value should not change during estimation.</p>
</td></tr>
<tr><td><code id="apollo_makeLogLike_+3A_apollo_probabilities">apollo_probabilities</code></td>
<td>
<p>Function. Returns probabilities of the model to be estimated. Must receive three arguments:
</p>

<ul>
<li> <p><strong><code>apollo_beta</code></strong>: Named numeric vector. Names and values of model parameters.
</p>
</li>
<li> <p><strong><code>apollo_inputs</code></strong>: List containing options of the model. See <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.
</p>
</li>
<li> <p><strong><code>functionality</code></strong>: Character. Can be either <strong><code>"components"</code></strong>, <strong><code>"conditionals"</code></strong>, <strong><code>"estimate"</code></strong> (default), <strong><code>"gradient"</code></strong>, <strong><code>"output"</code></strong>, <strong><code>"prediction"</code></strong>, <strong><code>"preprocess"</code></strong>, <strong><code>"raw"</code></strong>, <strong><code>"report"</code></strong>, <strong><code>"shares_LL"</code></strong>, <strong><code>"validate"</code></strong> or <strong><code>"zero_LL"</code></strong>.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_makeLogLike_+3A_apollo_inputs">apollo_inputs</code></td>
<td>
<p>List grouping most common inputs. Created by function <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
<tr><td><code id="apollo_makeLogLike_+3A_apollo_estset">apollo_estSet</code></td>
<td>
<p>List of estimation options. It must contain at least one element called
estimationRoutine defining the estimation algorithm. See <a href="#topic+apollo_estimate">apollo_estimate</a>.</p>
</td></tr>
<tr><td><code id="apollo_makeLogLike_+3A_cleanmemory">cleanMemory</code></td>
<td>
<p>Logical. If TRUE, then <code>apollo_inputs$draws</code> and <code>apollo_inputs$database</code> are erased
throughout the calling stack. Used to reduce memory usage in case of multithreading and a large
database or number o draws.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Internal use only. Called by <code>apollo_estimate</code> before estimation.
The returned function can be single-threaded or multi-threaded based on the model options.
</p>


<h3>Value</h3>

<p>apollo_logLike function.
</p>

<hr>
<h2 id='apollo_mdcev'>Calculates MDCEV likelihoods</h2><span id='topic+apollo_mdcev'></span>

<h3>Description</h3>

<p>Calculates the likelihoods of a Multiple Discrete Continuous Extreme Value (MDCEV) model and can also perform other operations based on the value of the <code>functionality</code> argument.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_mdcev(mdcev_settings, functionality)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_mdcev_+3A_mdcev_settings">mdcev_settings</code></td>
<td>
<p>List. Contains settings for this function. User input is required for all settings except those with a default or marked as optional. 
</p>

<ul>
<li> <p><strong><code>alpha</code></strong>: Named list. Alpha parameters for each alternative, including for any outside good. As many elements as alternatives.
</p>
</li>
<li> <p><strong><code>alternatives</code></strong>: Character vector. Names of alternatives, elements must match the names in list 'utilities'.
</p>
</li>
<li> <p><strong><code>avail</code></strong>: Named list of numeric vectors or scalars. Availabilities of alternatives, one element per alternative. Names of elements must match those in <code>alternatives</code>. Values can be 0 or 1. These can be scalars or vectors (of length equal to rows in the database). A user can also specify <code>avail=1</code> to indicate universal availability, or omit the setting completely.
</p>
</li>
<li> <p><strong><code>budget</code></strong>: Numeric vector. Budget for each observation.
</p>
</li>
<li> <p><strong><code>componentName</code></strong>: Character. Name given to model component. If not provided by the user, Apollo will set the name automatically according to the element in <code>P</code> to which the function output is directed.
</p>
</li>
<li> <p><strong><code>continuousChoice</code></strong>: Named list of numeric vectors. Amount of consumption of each alternative. One element per alternative, as long as the number of observations or a scalar. Names must match those in <code>alternatives</code>.
</p>
</li>
<li> <p><strong><code>cost</code></strong>: Named list of numeric vectors. Price of each alternative. One element per alternative, each one as long as the number of observations or a scalar. Names must match those in <code>alternatives</code>.
</p>
</li>
<li> <p><strong><code>gamma</code></strong>: Named list. Gamma parameters for each alternative, excluding any outside good. As many elements as inside good alternatives.
</p>
</li>
<li> <p><strong><code>nRep</code></strong>: Numeric scalar. Number of simulations of the whole dataset used for forecasting. The forecast is the average of these simulations. Default is 100.
</p>
</li>
<li> <p><strong><code>outside</code></strong>: Character. Optional name of the outside good.
</p>
</li>
<li> <p><strong><code>rawPrediction</code></strong>: Logical scalar. TRUE for prediction to be returned at the draw level (a 3-dim array). FALSE for prediction to be returned averaged across draws. Default is FALSE.
</p>
</li>
<li> <p><strong><code>rows</code></strong>: Boolean vector. Consideration of which rows to include. Length equal to the number of observations (nObs), with entries equal to TRUE for rows to include, and FALSE for rows to exclude. Default is <code>"all"</code>, equivalent to <code>rep(TRUE, nObs)</code>.
</p>
</li>
<li> <p><strong><code>sigma</code></strong>: Numeric scalar. Scale parameter of the model extreme value type I error.
</p>
</li>
<li> <p><strong><code>utilities</code></strong>: Named list. Utilities of the alternatives. Names of elements must match those in argument 'alternatives'.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_mdcev_+3A_functionality">functionality</code></td>
<td>
<p>Character. Setting instructing Apollo what processing to apply to the likelihood function. This is in general controlled by the functions that call <code>apollo_probabilities</code>, though the user can also call <code>apollo_probabilities</code> manually with a given functionality for testing/debugging. Possible values are:
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: For further processing/debugging, produces likelihood for each model component (if multiple components are present), at the level of individual draws and observations.
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: For conditionals, produces likelihood of the full model, at the level of individual inter-individual draws.
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: For model estimation, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: For model estimation, produces analytical gradients of the likelihood, where possible.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Prepares output for post-estimation reporting.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: For model prediction, produces probabilities for individual alternatives and individual model components (if multiple components are present) at the level of an observation, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Prepares likelihood functions for use in estimation.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: For debugging, produces probabilities of all alternatives and individual model components at the level of an observation, at the level of individual draws.
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: Prepares output summarising model and choiceset structure.
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: Produces overall model likelihood with constants only.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Validates model specification, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: Produces overall model likelihood with all parameters at zero.
</p>
</li></ul>
</td></tr>
</table>


<h3>Value</h3>

<p>The returned object depends on the value of argument <code>functionality</code> as follows.
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: vector/matrix/array. Returns the probabilities for the observed consumption for each observation.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: Not implemented
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Same as <code>"estimate"</code> but also writes summary of input data to internal Apollo log.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: A matrix with one row per observation, and columns indicating means and s.d. of continuous and discrete predicted consumptions.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Returns a list with pre-processed inputs, based on <code>mdcev_settings</code>.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: Dependent variable overview.
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: Not implemented. Returns a vector of NA with as many elements as observations.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Same as <code>"estimate"</code>, but it also runs a set of tests to validate the function inputs.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: Not implemented. Returns a vector of NA with as many elements as observations.
</p>
</li></ul>


<hr>
<h2 id='apollo_mdcev2'>Calculates MDCEV likelihoods</h2><span id='topic+apollo_mdcev2'></span>

<h3>Description</h3>

<p>Calculates the likelihoods of a Multiple Discrete Continuous Extreme Value (MDCEV) model and can also perform other operations based on the value of the <code>functionality</code> argument.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_mdcev2(mdcev_settings, functionality)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_mdcev2_+3A_mdcev_settings">mdcev_settings</code></td>
<td>
<p>List. Contains settings for this function. User input is required for all settings except those with a default or marked as optional. 
</p>

<ul>
<li> <p><strong><code>alpha</code></strong>: Named list. Alpha parameters for each alternative, including for any outside good. As many elements as alternatives.
</p>
</li>
<li> <p><strong><code>alternatives</code></strong>: Character vector. Names of alternatives, elements must match the names in list 'utilities'.
</p>
</li>
<li> <p><strong><code>avail</code></strong>: Named list of numeric vectors or scalars. Availabilities of alternatives, one element per alternative. Names of elements must match those in <code>alternatives</code>. Values can be 0 or 1. These can be scalars or vectors (of length equal to rows in the database). A user can also specify <code>avail=1</code> to indicate universal availability, or omit the setting completely.
</p>
</li>
<li> <p><strong><code>budget</code></strong>: Numeric vector. Budget for each observation.
</p>
</li>
<li> <p><strong><code>componentName</code></strong>: Character. Name given to model component. If not provided by the user, Apollo will set the name automatically according to the element in <code>P</code> to which the function output is directed.
</p>
</li>
<li> <p><strong><code>continuousChoice</code></strong>: Named list of numeric vectors. Amount of consumption of each alternative. One element per alternative, as long as the number of observations or a scalar. Names must match those in <code>alternatives</code>.
</p>
</li>
<li> <p><strong><code>cost</code></strong>: Named list of numeric vectors. Price of each alternative. One element per alternative, each one as long as the number of observations or a scalar. Names must match those in <code>alternatives</code>.
</p>
</li>
<li> <p><strong><code>fastPred</code></strong>: Boolean scalar. TRUE to mix parameter draws with repetition draws. This is formally incorrect, but a good a approximation to the true prediction, and much faster. FALSE by default.
</p>
</li>
<li> <p><strong><code>gamma</code></strong>: Named list. Gamma parameters for each alternative, excluding any outside good. As many elements as inside good alternatives.
</p>
</li>
<li> <p><strong><code>nRep</code></strong>: Numeric scalar. Number of simulations of the whole dataset used for forecasting. The forecast is the average of these simulations. Default is 100.
</p>
</li>
<li> <p><strong><code>outside</code></strong>: Character. Optional name of the outside good.
</p>
</li>
<li> <p><strong><code>rawPrediction</code></strong>: Logical scalar. TRUE for prediction to be returned at the draw level (a 3-dim array). FALSE for prediction to be returned averaged across draws. Default is FALSE.
</p>
</li>
<li> <p><strong><code>rows</code></strong>: Boolean vector. Consideration of which rows to include. Length equal to the number of observations (nObs), with entries equal to TRUE for rows to include, and FALSE for rows to exclude. Default is <code>"all"</code>, equivalent to <code>rep(TRUE, nObs)</code>.
</p>
</li>
<li> <p><strong><code>sigma</code></strong>: Numeric scalar. Scale parameter of the model extreme value type I error.
</p>
</li>
<li> <p><strong><code>utilities</code></strong>: Named list. Utilities of the alternatives. Names of elements must match those in argument 'alternatives'.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_mdcev2_+3A_functionality">functionality</code></td>
<td>
<p>Character. Setting instructing Apollo what processing to apply to the likelihood function. This is in general controlled by the functions that call <code>apollo_probabilities</code>, though the user can also call <code>apollo_probabilities</code> manually with a given functionality for testing/debugging. Possible values are:
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: For further processing/debugging, produces likelihood for each model component (if multiple components are present), at the level of individual draws and observations.
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: For conditionals, produces likelihood of the full model, at the level of individual inter-individual draws.
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: For model estimation, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: For model estimation, produces analytical gradients of the likelihood, where possible.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Prepares output for post-estimation reporting.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: For model prediction, produces probabilities for individual alternatives and individual model components (if multiple components are present) at the level of an observation, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Prepares likelihood functions for use in estimation.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: For debugging, produces probabilities of all alternatives and individual model components at the level of an observation, at the level of individual draws.
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: Prepares output summarising model and choiceset structure.
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: Produces overall model likelihood with constants only.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Validates model specification, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: Produces overall model likelihood with all parameters at zero.
</p>
</li></ul>
</td></tr>
</table>


<h3>Value</h3>

<p>The returned object depends on the value of argument <code>functionality</code> as follows.
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: vector/matrix/array. Returns the probabilities for the observed consumption for each observation.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: Not implemented
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Same as <code>"estimate"</code> but also writes summary of input data to internal Apollo log.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: A matrix with one row per observation, and columns indicating means and s.d. of continuous and discrete predicted consumptions.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Returns a list with pre-processed inputs, based on <code>mdcev_settings</code>.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: Dependent variable overview.
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: Not implemented. Returns a vector of NA with as many elements as observations.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Same as <code>"estimate"</code>, but it also runs a set of tests to validate the function inputs.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: Not implemented. Returns a vector of NA with as many elements as observations.
</p>
</li></ul>


<hr>
<h2 id='apollo_mdcnev'>Calculates MDCNEV likelihoods</h2><span id='topic+apollo_mdcnev'></span>

<h3>Description</h3>

<p>Calculates the likelihoods of a Multiple Discrete Continuous Nested Extreme Value (MDCNEV) model with an outside good and can also perform other operations based on the value of the <code>functionality</code> argument.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_mdcnev(mdcnev_settings, functionality)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_mdcnev_+3A_mdcnev_settings">mdcnev_settings</code></td>
<td>
<p>List. Contains settings for this function. User input is required for all settings except those with a default or marked as optional. 
</p>

<ul>
<li> <p><strong><code>alpha</code></strong>: Named list. Alpha parameters for each alternative, including for the outside good. As many elements as alternatives.
</p>
</li>
<li> <p><strong><code>avail</code></strong>: Named list of numeric vectors or scalars. Availabilities of alternatives, one element per alternative. Names of elements must match those in <code>alternatives</code>. Values can be 0 or 1. These can be scalars or vectors (of length equal to rows in the database). A user can also specify <code>avail=1</code> to indicate universal availability, or omit the setting completely.
</p>
</li>
<li> <p><strong><code>alternatives</code></strong>: Character vector. Names of alternatives, elements must match the names in list 'utilities'.
</p>
</li>
<li> <p><strong><code>budget</code></strong>: Numeric vector. Budget for each observation.
</p>
</li>
<li> <p><strong><code>componentName</code></strong>: Character. Name given to model component. If not provided by the user, Apollo will set the name automatically according to the element in <code>P</code> to which the function output is directed.
</p>
</li>
<li> <p><strong><code>continuousChoice</code></strong>: Named list of numeric vectors. Amount of consumption of each alternative. One element per alternative, as long as the number of observations or a scalar. Names must match those in <code>alternatives</code>.
</p>
</li>
<li> <p><strong><code>cost</code></strong>: Named list of numeric vectors. Price of each alternative. One element per alternative, each one as long as the number of observations or a scalar. Names must match those in <code>alternatives</code>.
</p>
</li>
<li> <p><strong><code>gamma</code></strong>: Named list. Gamma parameters for each alternative, including for the outside good. As many elements as alternatives.
</p>
</li>
<li> <p><strong><code>mdcnevNests</code></strong>: Named list. Lambda parameters for each nest. Elements must be named with the nest name. The lambda at the root is fixed to 1, and therefore must be no be defined. The value of the estimated mdcnevNests parameters should be between 0 and 1 to ensure consistency with random utility maximization.
</p>
</li>
<li> <p><strong><code>mdcnevStructure</code></strong>: Numeric matrix. One row per nest and one column per alternative. Each element of the matrix is 1 if an alternative belongs to the corresponding nest.
</p>
</li>
<li> <p><strong><code>outside</code></strong>: Character. Alternative name for the outside good. Default is &quot;outside&quot;
</p>
</li>
<li> <p><strong><code>rows</code></strong>: Boolean vector. Consideration of which rows to include. Length equal to the number of observations (nObs), with entries equal to TRUE for rows to include, and FALSE for rows to exclude. Default is <code>"all"</code>, equivalent to <code>rep(TRUE, nObs)</code>.
</p>
</li>
<li> <p><strong><code>utilities</code></strong>: Named list. Utilities of the alternatives. Names of elements must match those in argument 'alternatives'.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_mdcnev_+3A_functionality">functionality</code></td>
<td>
<p>Character. Setting instructing Apollo what processing to apply to the likelihood function. This is in general controlled by the functions that call <code>apollo_probabilities</code>, though the user can also call <code>apollo_probabilities</code> manually with a given functionality for testing/debugging. Possible values are:
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: For further processing/debugging, produces likelihood for each model component (if multiple components are present), at the level of individual draws and observations.
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: For conditionals, produces likelihood of the full model, at the level of individual inter-individual draws.
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: For model estimation, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: For model estimation, produces analytical gradients of the likelihood, where possible.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Prepares output for post-estimation reporting.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: For model prediction, produces probabilities for individual alternatives and individual model components (if multiple components are present) at the level of an observation, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Prepares likelihood functions for use in estimation.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: For debugging, produces probabilities of all alternatives and individual model components at the level of an observation, at the level of individual draws.
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: Prepares output summarising model and choiceset structure.
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: Produces overall model likelihood with constants only.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Validates model specification, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: Produces overall model likelihood with all parameters at zero.
</p>
</li></ul>
</td></tr>
</table>


<h3>Value</h3>

<p>The returned object depends on the value of argument <code>functionality</code> as follows.
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: vector/matrix/array. Returns the probabilities for the observed consumption for each observation.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: Not implemented
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Same as <code>"estimate"</code> but also writes summary of input data to internal Apollo log.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: A matrix with one row per observation, and columns indicating means and s.d. of continuous and discrete predicted consumptions.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Returns a list with pre-processed inputs, based on <code>mdcnev_settings</code>.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: Dependent variable overview.
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: Not implemented. Returns a vector of NA with as many elements as observations.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Same as <code>"estimate"</code>, but it also runs a set of tests to validate the function inputs.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: Not implemented. Returns a vector of NA with as many elements as observations.
</p>
</li></ul>


<hr>
<h2 id='apollo_mixConditionals'>Calculates conditionals for continuous mixture models</h2><span id='topic+apollo_mixConditionals'></span>

<h3>Description</h3>

<p>Calculates posterior expected values (conditionals) of continuously distributed random coefficients, as well as their standard deviations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_mixConditionals(model, apollo_probabilities, apollo_inputs)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_mixConditionals_+3A_model">model</code></td>
<td>
<p>Model object. Estimated model object as returned by function <a href="#topic+apollo_estimate">apollo_estimate</a>.</p>
</td></tr>
<tr><td><code id="apollo_mixConditionals_+3A_apollo_probabilities">apollo_probabilities</code></td>
<td>
<p>Function. Returns probabilities of the model to be estimated. Must receive three arguments:
</p>

<ul>
<li> <p><strong><code>apollo_beta</code></strong>: Named numeric vector. Names and values of model parameters.
</p>
</li>
<li> <p><strong><code>apollo_inputs</code></strong>: List containing options of the model. See <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.
</p>
</li>
<li> <p><strong><code>functionality</code></strong>: Character. Can be either <strong><code>"components"</code></strong>, <strong><code>"conditionals"</code></strong>, <strong><code>"estimate"</code></strong> (default), <strong><code>"gradient"</code></strong>, <strong><code>"output"</code></strong>, <strong><code>"prediction"</code></strong>, <strong><code>"preprocess"</code></strong>, <strong><code>"raw"</code></strong>, <strong><code>"report"</code></strong>, <strong><code>"shares_LL"</code></strong>, <strong><code>"validate"</code></strong> or <strong><code>"zero_LL"</code></strong>.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_mixConditionals_+3A_apollo_inputs">apollo_inputs</code></td>
<td>
<p>List grouping most common inputs. Created by function <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This functions is only meant for use with continuous distributions
</p>


<h3>Value</h3>

<p>List of matrices. Each matrix has dimensions nIndiv x 3. One matrix per random component.
Each row of each matrix contains the indivID of an individual, and the
posterior mean and s.d. of this random component for this individual
</p>

<hr>
<h2 id='apollo_mixEM'>Uses EM for models with continuous random coefficients</h2><span id='topic+apollo_mixEM'></span>

<h3>Description</h3>

<p>Uses the EM algorithm for estimating a model with continuous random coefficients.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_mixEM(
  apollo_beta,
  apollo_fixed,
  apollo_probabilities,
  apollo_inputs,
  mixEM_settings = NA,
  estimate_settings = NA
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_mixEM_+3A_apollo_beta">apollo_beta</code></td>
<td>
<p>Named numeric vector. Names and values for parameters. These need to be provided in the following order. With K random parameters, K means for the underlying Normals, followed by the elements of the lower triangle of the Cholesky matrix, by row.</p>
</td></tr>
<tr><td><code id="apollo_mixEM_+3A_apollo_fixed">apollo_fixed</code></td>
<td>
<p>Character vector. Names (as defined in <code>apollo_beta</code>) of parameters whose value should not change during estimation.</p>
</td></tr>
<tr><td><code id="apollo_mixEM_+3A_apollo_probabilities">apollo_probabilities</code></td>
<td>
<p>Function. Returns probabilities of the model to be estimated. Must receive three arguments:
</p>

<ul>
<li> <p><strong><code>apollo_beta</code></strong>: Named numeric vector. Names and values of model parameters.
</p>
</li>
<li> <p><strong><code>apollo_inputs</code></strong>: List containing options of the model. See <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.
</p>
</li>
<li> <p><strong><code>functionality</code></strong>: Character. Can be either <strong><code>"components"</code></strong>, <strong><code>"conditionals"</code></strong>, <strong><code>"estimate"</code></strong> (default), <strong><code>"gradient"</code></strong>, <strong><code>"output"</code></strong>, <strong><code>"prediction"</code></strong>, <strong><code>"preprocess"</code></strong>, <strong><code>"raw"</code></strong>, <strong><code>"report"</code></strong>, <strong><code>"shares_LL"</code></strong>, <strong><code>"validate"</code></strong> or <strong><code>"zero_LL"</code></strong>.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_mixEM_+3A_apollo_inputs">apollo_inputs</code></td>
<td>
<p>List grouping most common inputs. Created by function <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
<tr><td><code id="apollo_mixEM_+3A_mixem_settings">mixEM_settings</code></td>
<td>
<p>List. Contains settings for this function. User input is required for all settings except those with a default or marked as optional. 
</p>

<ul>
<li> <p><strong>EMmaxIterations</strong>: Numeric. Maximum number of iterations of the EM algorithm before 
stopping. Default is 100. 
</p>
</li>
<li> <p><strong>postEM</strong>: Numeric scalar. Determines the tasks performed by this function 
after the EM algorithm has converged. Can take values <code>0</code>, <code>1</code> 
or <code>2</code> only. If value is <code>0</code>, only the EM algorithm will be 
performed, and the results will be a model object without a covariance 
matrix (i.e. estimates only). If value is <code>1</code>, after the EM 
algorithm, the covariance matrix of the model will be calculated as well, 
and the result will be a model object with a covariance matrix. If value 
is <code>2</code>, after the EM algorithm, the estimated parameter values will 
be used as starting value for a maximum likelihood estimation process, 
which will render a model object with a covariance matrix. Performing 
maximum likelihood estimation after the EM algorithm is useful, as there 
may be room for further improvement. Default is <code>2</code>.
</p>
</li>
<li> <p><strong>silent</strong>: Boolean. If TRUE, no information is printed to the console during 
estimation. Default is FALSE.
</p>
</li>
<li> <p><strong>stoppingCriterion</strong>: Numeric. Convergence criterion. The EM process will stop when 
improvements in the log-likelihood fall below this value. 
Default is 10^-5.
</p>
</li>
<li> <p><strong>transforms</strong>: List. Optional argument, with one entry per parameter, showing the inverse transform to return from beta to the underlying Normal. E.g. if the first parameter is specified as negative logormal inside apollo_randCoeff, then the entry in transforms should be transforms[[1]]=function(x) log(-x)
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_mixEM_+3A_estimate_settings">estimate_settings</code></td>
<td>
<p>List. Options controlling the estimation process within each EM iteration. See <a href="#topic+apollo_estimate">apollo_estimate</a> for details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function uses the EM algorithm for estimating a model with continuous random coefficients. It is only suitable for models where all parameters are random, with a full covariance matrix.
All random parameters need to be based on underlying Normals with a full covariance matrix, but any transform thereof can be used.
</p>


<h3>Value</h3>

<p>model object
</p>

<hr>
<h2 id='apollo_mixUnconditionals'>Returns draws for continuously distributed random parameters in mixture model</h2><span id='topic+apollo_mixUnconditionals'></span>

<h3>Description</h3>

<p>Returns draws (unconditionals) for random parameters in model, including interactions with deterministic covariates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_mixUnconditionals(model, apollo_probabilities, apollo_inputs)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_mixUnconditionals_+3A_model">model</code></td>
<td>
<p>Model object. Estimated model object as returned by function <a href="#topic+apollo_estimate">apollo_estimate</a>.</p>
</td></tr>
<tr><td><code id="apollo_mixUnconditionals_+3A_apollo_probabilities">apollo_probabilities</code></td>
<td>
<p>Function. Returns probabilities of the model to be estimated. Must receive three arguments:
</p>

<ul>
<li> <p><strong><code>apollo_beta</code></strong>: Named numeric vector. Names and values of model parameters.
</p>
</li>
<li> <p><strong><code>apollo_inputs</code></strong>: List containing options of the model. See <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.
</p>
</li>
<li> <p><strong><code>functionality</code></strong>: Character. Can be either <strong><code>"components"</code></strong>, <strong><code>"conditionals"</code></strong>, <strong><code>"estimate"</code></strong> (default), <strong><code>"gradient"</code></strong>, <strong><code>"output"</code></strong>, <strong><code>"prediction"</code></strong>, <strong><code>"preprocess"</code></strong>, <strong><code>"raw"</code></strong>, <strong><code>"report"</code></strong>, <strong><code>"shares_LL"</code></strong>, <strong><code>"validate"</code></strong> or <strong><code>"zero_LL"</code></strong>.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_mixUnconditionals_+3A_apollo_inputs">apollo_inputs</code></td>
<td>
<p>List grouping most common inputs. Created by function <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This functions is only meant for use with continuous distributions
</p>


<h3>Value</h3>

<p>List of object, one per random coefficient.
With inter-individual draws only, this will be a matrix, with one row per individual, and one column per draw.
With intra-individual draws, this will be a three-dimensional array, with one row per observation, inter-individual draws in the second dimension, and intra-individual draws in the third dimension.
</p>

<hr>
<h2 id='apollo_mlhs'>Generate random draws using MLHS algorithm</h2><span id='topic+apollo_mlhs'></span>

<h3>Description</h3>

<p>Generate random draws using the Modified Latin Hypercube Sampling algorithm.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_mlhs(N, d, i)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_mlhs_+3A_n">N</code></td>
<td>
<p>Numeric. The number of draws to generate in each dimension</p>
</td></tr>
<tr><td><code id="apollo_mlhs_+3A_d">d</code></td>
<td>
<p>Numeric. The number of dimensions to generate draws in</p>
</td></tr>
<tr><td><code id="apollo_mlhs_+3A_i">i</code></td>
<td>
<p>Numeric. The number of individuals to generate draws for</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Internal use only.
Algorithm described in
Hess, S., Train, K., and Polak, J. (2006) Transportation Research Part B, 40, 147 - 163.
</p>


<h3>Value</h3>

<p>A (N*i) x d matrix with random draws
</p>

<hr>
<h2 id='apollo_mnl'>Calculates Multinomial Logit probabilities</h2><span id='topic+apollo_mnl'></span>

<h3>Description</h3>

<p>Calculates the probabilities of a Multinomial Logit model and can also perform other operations based on the value of the <code>functionality</code> argument.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_mnl(mnl_settings, functionality)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_mnl_+3A_mnl_settings">mnl_settings</code></td>
<td>
<p>List of inputs of the MNL model. It should contain the following.
</p>

<ul>
<li> <p><strong><code>alternatives</code></strong>: Named numeric vector. Names of alternatives and their corresponding value in <code>choiceVar</code>.
</p>
</li>
<li> <p><strong><code>avail</code></strong>: Named list of numeric vectors or scalars. Availabilities of alternatives, one element per alternative. Names of elements must match those in <code>alternatives</code>. Values can be 0 or 1. These can be scalars or vectors (of length equal to rows in the database). A user can also specify <code>avail=1</code> to indicate universal availability, or omit the setting completely.
</p>
</li>
<li> <p><strong><code>choiceVar</code></strong>: Numeric vector. Contains choices for all observations. It will usually be a column from the database. Values are defined in <code>alternatives</code>.
</p>
</li>
<li> <p><strong><code>utilities</code></strong>: Named list of deterministic utilities . Utilities of the alternatives. Names of elements must match those in <code>alternatives.</code>
</p>
</li>
<li> <p><strong><code>rows</code></strong>: Boolean vector. Consideration of which rows to include. Length equal to the number of observations (nObs), with entries equal to TRUE for rows to include, and FALSE for rows to exclude. Default is <code>"all"</code>, equivalent to <code>rep(TRUE, nObs)</code>. Set to <code>"all"</code> by default if omitted.
</p>
</li>
<li> <p><strong><code>componentName</code></strong>: Character. Name given to model component. If not provided by the user, Apollo will set the name automatically according to the element in <code>P</code> to which the function output is directed.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_mnl_+3A_functionality">functionality</code></td>
<td>
<p>Character. Setting instructing Apollo what processing to apply to the likelihood function. This is in general controlled by the functions that call <code>apollo_probabilities</code>, though the user can also call <code>apollo_probabilities</code> manually with a given functionality for testing/debugging. Possible values are:
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: For further processing/debugging, produces likelihood for each model component (if multiple components are present), at the level of individual draws and observations.
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: For conditionals, produces likelihood of the full model, at the level of individual inter-individual draws.
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: For model estimation, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: For model estimation, produces analytical gradients of the likelihood, where possible.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Prepares output for post-estimation reporting.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: For model prediction, produces probabilities for individual alternatives and individual model components (if multiple components are present) at the level of an observation, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Prepares likelihood functions for use in estimation.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: For debugging, produces probabilities of all alternatives and individual model components at the level of an observation, at the level of individual draws.
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: Prepares output summarising model and choiceset structure.
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: Produces overall model likelihood with constants only.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Validates model specification, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: Produces overall model likelihood with all parameters at zero.
</p>
</li></ul>
</td></tr>
</table>


<h3>Value</h3>

<p>The returned object depends on the value of argument <code>functionality</code> as follows.
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: vector/matrix/array. Returns the probabilities for the chosen alternative for each observation.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: List containing the likelihood and gradient of the model component.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Same as <code>"estimate"</code> but also writes summary of input data to internal Apollo log.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: List of vectors/matrices/arrays. Returns a list with the probabilities for all alternatives, with an extra element for the probability of the chosen alternative.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Returns a list with pre-processed inputs, based on <code>mnl_settings</code>.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Same as <code>"estimate"</code>, but it also runs a set of tests to validate the function inputs.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: Same as <code>"prediction"</code>
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: Choice overview
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: vector/matrix/array. Returns the probability of the chosen alternative when only constants are estimated.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: vector/matrix/array. Returns the probability of the chosen alternative when all parameters are zero.
</p>
</li></ul>


<hr>
<h2 id='apollo_modeChoiceData'>Simulated dataset of mode choice.</h2><span id='topic+apollo_modeChoiceData'></span>

<h3>Description</h3>

<p>A simulated dataset containing 8,000 mode choices among four alternatives.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_modeChoiceData
</code></pre>


<h3>Format</h3>

<p>A data.frame with 8,000 rows and 25 variables:
</p>

<dl>
<dt>ID</dt><dd><p>Numeric. Identification number of the individual.</p>
</dd>
<dt>RP</dt><dd><p>Numeric. 1 if the row corresponds to a revealed preference (RP) observation. 0 otherwise.</p>
</dd>
<dt>RP_journey</dt><dd><p>Numeric. Consecutive ID of RP observations. 0 if SP observation.</p>
</dd>
<dt>SP</dt><dd><p>Numeric. 1 if the row corresponds to a stated preference (SP) observation. 0 otherwise.</p>
</dd>
<dt>SP_task</dt><dd><p>Numeric. Consecutive ID of SP choice tasks. 0 if RP observation.</p>
</dd>
<dt>access_air</dt><dd><p>Numeric. Access time (in minutes) of mode air.</p>
</dd>
<dt>access_bus</dt><dd><p>Numeric. Access time (in minutes) of mode bus.</p>
</dd>
<dt>access_rail</dt><dd><p>Numeric. Access time (in minutes) of mode rail.</p>
</dd>
<dt>av_air</dt><dd><p>Numeric. 1 if the mode air (plane) is available. 0 otherwise.</p>
</dd>
<dt>av_bus</dt><dd><p>Numeric. 1 if the mode bus is available. 0 otherwise.</p>
</dd>
<dt>av_car</dt><dd><p>Numeric. 1 if the mode car is available. 0 otherwise.</p>
</dd>
<dt>av_rail</dt><dd><p>Numeric. 1 if the mode rail (train) is available. 0 otherwise.</p>
</dd>
<dt>business</dt><dd><p>Numeric. Purpose of the trip. 1 for business, 0 for other.</p>
</dd>
<dt>choice</dt><dd><p>Numeric. Choice indicator, 1=car, 2=bus, 3=air, 4=rail.</p>
</dd>
<dt>cost_air</dt><dd><p>Numeric. Cost (in GBP) of mode air.</p>
</dd>
<dt>cost_bus</dt><dd><p>Numeric. Cost (in GBP) of mode bus.</p>
</dd>
<dt>cost_car</dt><dd><p>Numeric. Cost (in GBP) of mode car.</p>
</dd>
<dt>cost_rail</dt><dd><p>Numeric. Cost (in GBP) of mode rail.</p>
</dd>
<dt>female</dt><dd><p>Numeric. Sex of individual. 1 for female, 0 for male.</p>
</dd>
<dt>income</dt><dd><p>Numeric. Income (in GBP per annum) of the individual.</p>
</dd>
<dt>service_air</dt><dd><p>Numeric. Additional services for the air alternative. 1 for no-frills, 2 for wifi, 3 for food. This is not used in the RP data, where it is set to 0.</p>
</dd>
<dt>service_rail</dt><dd><p>Numeric. Additional services for the rail alternative. 1 for no-frills, 2 for wifi, 3 for food. This is not used in the RP data, where it is set to 0.</p>
</dd>
<dt>time_air</dt><dd><p>Numeric. Travel time (in minutes) of mode air.</p>
</dd>
<dt>time_bus</dt><dd><p>Numeric. Travel time (in minutes) of mode bus.</p>
</dd>
<dt>time_car</dt><dd><p>Numeric. Travel time (in minutes) of mode car.</p>
</dd>
<dt>time_rail</dt><dd><p>Numeric. Travel time (in minutes) of mode rail.</p>
</dd>
</dl>



<h3>Details</h3>

<p>This dataset is to be used for discrete choice modelling.
Data comes from 500 individuals, each with two revealed
preferences (RP) observation, and 14 stated stated
(SC) observations. There are 8,000 choices in total.
Data is simulated.
Each observation contains attributes for the alternatives,
availability of alternatives, and characteristics of the
individuals.
</p>


<h3>Source</h3>

<p><a href="http://www.apollochoicemodelling.com/">http://www.apollochoicemodelling.com/</a>
</p>

<hr>
<h2 id='apollo_modelOutput'>Prints estimation results to console</h2><span id='topic+apollo_modelOutput'></span>

<h3>Description</h3>

<p>Prints estimation results to console. Amount of information presented can be adjusted through arguments.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_modelOutput(model, modelOutput_settings = NA)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_modelOutput_+3A_model">model</code></td>
<td>
<p>Model object. Estimated model object as returned by function <a href="#topic+apollo_estimate">apollo_estimate</a>.</p>
</td></tr>
<tr><td><code id="apollo_modelOutput_+3A_modeloutput_settings">modelOutput_settings</code></td>
<td>
<p>List. Contains settings for this function. User input is required for all settings except those with a default or marked as optional. 
</p>

<ul>
<li> <p><strong><code>printChange</code></strong>: Logical. TRUE for printing difference between starting values and estimates. FALSE by default.
</p>
</li>
<li> <p><strong><code>printClassical</code></strong>: Logical. TRUE for printing classical standard errors. TRUE by default.
</p>
</li>
<li> <p><strong><code>printCorr</code></strong>: Boolean. TRUE for printing parameters correlation matrix. If <code>printClassical=TRUE</code>, both classical and robust matrices are printed. For Bayesian estimation, this setting is used for the covariane of random parameters. FALSE by default.
</p>
</li>
<li> <p><strong><code>printCovar</code></strong>: Boolean. TRUE for printing parameters covariance matrix. If <code>printClassical=TRUE</code>, both classical and robust matrices are printed. For Bayesian estimation, this setting is used for the correlation of random parameters. FALSE by default.
</p>
</li>
<li> <p><strong><code>printDataReport</code></strong>: Logical. TRUE for printing summary of choices in database and other diagnostics. FALSE by default.
</p>
</li>
<li> <p><strong><code>printFixed</code></strong>: Logical. TRUE for printing fixed parameters among estimated parameter. TRUE by default.
</p>
</li>
<li> <p><strong><code>printFunctions</code></strong>: Logical. TRUE for printing apollo_control, apollo_randCoeff (when available), apollo_lcPars (when available) and apollo_probabilities. FALSE by default.
</p>
</li>
<li> <p><strong><code>printHBconvergence</code></strong>: Boolean. TRUE for printing Geweke convergence tests. FALSE by default.                               
</p>
</li>
<li> <p><strong><code>printHBiterations</code></strong>: Boolean. TRUE for printing an iterations report for HB estimation. TRUE by default.                               
</p>
</li>
<li> <p><strong><code>printModelStructure</code></strong>: Logical. TRUE for printing model structure. TRUE by default.
</p>
</li>
<li> <p><strong><code>printOutliers</code></strong>: Logical or Scalar. TRUE for printing 20 individuals with worst average fit across observations. FALSE by default. If Scalar is given, this replaces the default of 20.
</p>
</li>
<li> <p><strong><code>printPVal</code></strong>: Logical or Scalar. TRUE or 1 for printing p-values for one-sided test, 2 for printing p-values for two-sided test, FALSE for not printing p-values. FALSE by default.
</p>
</li>
<li> <p><strong><code>printT1</code></strong>: Logical. If TRUE, t-test for H0: apollo_beta=1 are printed. FALSE by default.
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>Prints to screen the output of a model previously estimated by apollo_estimate()
</p>


<h3>Value</h3>

<p>A matrix of coefficients, s.d. and t-tests (invisible)
</p>

<hr>
<h2 id='apollo_modifyUserDefFunc'>Checks and modifies Apollo user-defined functions</h2><span id='topic+apollo_modifyUserDefFunc'></span>

<h3>Description</h3>

<p>Checks and enhances user defined functions apollo_probabilities, apollo_randCoeff and apollo_lcPars.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_modifyUserDefFunc(
  apollo_beta,
  apollo_fixed,
  apollo_probabilities,
  apollo_inputs,
  validate = TRUE,
  noModification = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_modifyUserDefFunc_+3A_apollo_beta">apollo_beta</code></td>
<td>
<p>Named numeric vector. Names and values for parameters.</p>
</td></tr>
<tr><td><code id="apollo_modifyUserDefFunc_+3A_apollo_fixed">apollo_fixed</code></td>
<td>
<p>Character vector. Names of parameters inside apollo_beta
whose values should be kept constant throughout estimation.</p>
</td></tr>
<tr><td><code id="apollo_modifyUserDefFunc_+3A_apollo_probabilities">apollo_probabilities</code></td>
<td>
<p>Function. Returns probabilities of the model to 
be estimated. Must receive three arguments:
</p>

<ul>
<li> <p><strong><code>apollo_beta</code></strong>: Named numeric vector. 
Names and values of 
model parameters.
</p>
</li>
<li> <p><strong><code>apollo_inputs</code></strong>: List containing 
options of the model. 
See <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.
</p>
</li>
<li> <p><strong><code>functionality</code></strong>: Character. Can be 
either <code>"components"</code>, 
<code>"conditionals"</code>, 
<code>"estimate"</code> (default), 
<code>"gradient"</code>, 
<code>"output"</code>, 
<code>"prediction"</code>, 
<code>"preprocess"</code>, 
<code>"raw"</code>, <code>"report"</code>, 
<code>"shares_LL"</code>, 
<code>"validate"</code> or 
<code>"zero_LL"</code>.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_modifyUserDefFunc_+3A_apollo_inputs">apollo_inputs</code></td>
<td>
<p>List grouping most common inputs. Created by function 
<a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
<tr><td><code id="apollo_modifyUserDefFunc_+3A_validate">validate</code></td>
<td>
<p>Logical. If TRUE, the original and modified 
<code>apollo_probabilities</code> functions are estimated. If their 
results do not match, then the original functions are 
returned, and <code>success</code> is set to <code>FALSE</code> inside 
the returned list.</p>
</td></tr>
<tr><td><code id="apollo_modifyUserDefFunc_+3A_nomodification">noModification</code></td>
<td>
<p>Logical. If TRUE, loop expansion etc are skipped.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Internal use only. Called by <code>apollo_estimate</code> before estimation.
Checks include: no re-definition of variables, no (direct) calls to database, 
calling of apollo_weighting if weights are defined.
</p>


<h3>Value</h3>

<p>List with four elements: apollo_probabilities, apollo_randCoeff, 
apollo_lcPars and a dummy called success (TRUE if modification was
successful, FALSE if not. FALSE will be only be returnes if
the modifications are validated).
</p>

<hr>
<h2 id='apollo_nl'>Calculates Nested Logit probabilities</h2><span id='topic+apollo_nl'></span>

<h3>Description</h3>

<p>Calculates the probabilities of a Nested Logit model and can also perform other operations based on the value of the <code>functionality</code> argument.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_nl(nl_settings, functionality)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_nl_+3A_nl_settings">nl_settings</code></td>
<td>
<p>List of inputs of the NL model. It should contain the following.
</p>

<ul>
<li> <p><strong><code>alternatives</code></strong>: Named numeric vector. Names of alternatives and their corresponding value in <code>choiceVar</code>.
</p>
</li>
<li> <p><strong><code>avail</code></strong>: Named list of numeric vectors or scalars. Availabilities of alternatives, one element per alternative. Names of elements must match those in <code>alternatives</code>. Values can be 0 or 1. These can be scalars or vectors (of length equal to rows in the database). A user can also specify <code>avail=1</code> to indicate universal availability, or omit the setting completely.
</p>
</li>
<li> <p><strong><code>choiceVar</code></strong>: Numeric vector. Contains choices for all observations. It will usually be a column from the database. Values are defined in <code>alternatives</code>.
</p>
</li>
<li> <p><strong><code>componentName</code></strong>: Character. Name given to model component. If not provided by the user, Apollo will set the name automatically according to the element in <code>P</code> to which the function output is directed.
</p>
</li>
<li> <p><strong><code>nlNests</code></strong>: List of numeric scalars or vectors. Lambda parameters for each nest. Elements must be named with the nest name. The lambda at the root is automatically fixed to 1 if not provided by the user.
</p>
</li>
<li> <p><strong><code>nlStructure</code></strong>: Named list of character vectors. As many elements as nests, it must include the &quot;root&quot;. Each element contains the names of the nests or alternatives that belong to it. Element names must match those in <code>nlNests</code>.
</p>
</li>
<li> <p><strong><code>utilities</code></strong>: Named list of deterministic utilities . Utilities of the alternatives. Names of elements must match those in <code>alternatives.</code>
</p>
</li>
<li> <p><strong><code>rows</code></strong>: Boolean vector. Consideration of which rows to include. Length equal to the number of observations (nObs), with entries equal to TRUE for rows to include, and FALSE for rows to exclude. Default is <code>"all"</code>, equivalent to <code>rep(TRUE, nObs)</code>.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_nl_+3A_functionality">functionality</code></td>
<td>
<p>Character. Setting instructing Apollo what processing to apply to the likelihood function. This is in general controlled by the functions that call <code>apollo_probabilities</code>, though the user can also call <code>apollo_probabilities</code> manually with a given functionality for testing/debugging. Possible values are:
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: For further processing/debugging, produces likelihood for each model component (if multiple components are present), at the level of individual draws and observations.
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: For conditionals, produces likelihood of the full model, at the level of individual inter-individual draws.
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: For model estimation, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: For model estimation, produces analytical gradients of the likelihood, where possible.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Prepares output for post-estimation reporting.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: For model prediction, produces probabilities for individual alternatives and individual model components (if multiple components are present) at the level of an observation, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Prepares likelihood functions for use in estimation.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: For debugging, produces probabilities of all alternatives and individual model components at the level of an observation, at the level of individual draws.
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: Prepares output summarising model and choiceset structure.
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: Produces overall model likelihood with constants only.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Validates model specification, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: Produces overall model likelihood with all parameters at zero.
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>In this implementation of the Nested Logit model, each nest must have a lambda parameter associated to it.
For the model to be consistent with utility maximisation, the estimated value of the Lambda parameter of all nests
should be between 0 and 1. Lambda parameters are inversely proportional to the correlation between the error terms of 
alternatives in a nest. If lambda=1, then there is no relevant correlation between the unobserved
utility of alternatives in that nest.
The tree must contain an upper nest called <code>"root"</code>. The lambda parameter of the root is automatically
set to 1 if not specified in <code>nlNests</code>, but can be changed by the user if desired (though not advised).
</p>


<h3>Value</h3>

<p>The returned object depends on the value of argument <code>functionality</code> as follows.
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: vector/matrix/array. Returns the probabilities for the chosen alternative for each observation.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: Not implemented.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Same as <code>"estimate"</code> but also writes summary of input data to internal Apollo log.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: List of vectors/matrices/arrays. Returns a list with the probabilities for all alternatives, with an extra element for the probability of the chosen alternative.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Returns a list with pre-processed inputs, based on <code>nl_settings</code>.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: Same as <code>"prediction"</code>
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: List with tree structure and choice overview.
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: vector/matrix/array. Returns the probability of the chosen alternative when only constants are estimated.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Same as <code>"estimate"</code>, but it also runs a set of tests to validate the function inputs.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: vector/matrix/array. Returns the probability of the chosen alternative when all parameters are zero.
</p>
</li></ul>


<hr>
<h2 id='apollo_normalDensity'>Calculates density for a Normal distribution</h2><span id='topic+apollo_normalDensity'></span>

<h3>Description</h3>

<p>Calculates density for a Normal distribution at a specific value with a specified mean and standard deviation and can also perform other operations based on the value of the <code>functionality</code> argument.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_normalDensity(normalDensity_settings, functionality)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_normalDensity_+3A_normaldensity_settings">normalDensity_settings</code></td>
<td>
<p>List of arguments to the functions. It must contain the following.
</p>

<ul>
<li> <p><strong><code>componentName</code></strong>: Character. Name given to model component. If not provided by the user, Apollo will set the name automatically according to the element in <code>P</code> to which the function output is directed.
</p>
</li>
<li> <p><strong><code>mu</code></strong>: Numeric scalar. Intercept of the linear model.
</p>
</li>
<li> <p><strong><code>outcomeNormal</code></strong>: Numeric vector. Dependent variable.
</p>
</li>
<li> <p><strong><code>rows</code></strong>: Boolean vector. Consideration of which rows to include. Length equal to the number of observations (nObs), with entries equal to TRUE for rows to include, and FALSE for rows to exclude. Default is <code>"all"</code>, equivalent to <code>rep(TRUE, nObs)</code>.
</p>
</li>
<li> <p><strong><code>sigma</code></strong>: Numeric scalar. Variance of error component of linear model to be estimated.
</p>
</li>
<li> <p><strong><code>xNormal</code></strong>: Numeric vector. Single explanatory variable.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_normalDensity_+3A_functionality">functionality</code></td>
<td>
<p>Character. Setting instructing Apollo what processing to apply to the likelihood function. This is in general controlled by the functions that call <code>apollo_probabilities</code>, though the user can also call <code>apollo_probabilities</code> manually with a given functionality for testing/debugging. Possible values are:
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: For further processing/debugging, produces likelihood for each model component (if multiple components are present), at the level of individual draws and observations.
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: For conditionals, produces likelihood of the full model, at the level of individual inter-individual draws.
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: For model estimation, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: For model estimation, produces analytical gradients of the likelihood, where possible.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Prepares output for post-estimation reporting.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: For model prediction, produces probabilities for individual alternatives and individual model components (if multiple components are present) at the level of an observation, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Prepares likelihood functions for use in estimation.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: For debugging, produces probabilities of all alternatives and individual model components at the level of an observation, at the level of individual draws.
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: Prepares output summarising model and choiceset structure.
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: Produces overall model likelihood with constants only.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Validates model specification, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: Produces overall model likelihood with all parameters at zero.
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>This function calcualtes the probability of the linear model outcomeNormal = mu + xNormal + epsilon, where epsilon is a random error distributed Normal(0,sigma).
If using this function in the context of an Integrated Choice and Latent Variable (ICLV) model with continuous
indicators, then <code>outcomeNormal</code> would be the value of the indicator, <code>xNormal</code> would be the value of the latent variable (possibly
multiplied by a parameter to measure its correlation with the indicator, e.g. xNormal=lambda*LV), and <code>mu</code> would be
an additional parameter to be estimated (the mean of the indicator, which should be fixed to zero if the indicator is
centered around its mean beforehand).
</p>


<h3>Value</h3>

<p>The returned object depends on the value of argument <code>functionality</code> as follows.
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: vector/matrix/array. Returns the likelihood for each observation.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: Not implemented
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Same as <code>"estimate"</code> but also writes summary of input data to internal Apollo log.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: Not implemented. Returns NA.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Returns a list with pre-processed inputs, based on <code>normalDensity_settings</code>.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: Dependent variable overview.
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: Not implemented. Returns a vector of NA with as many elements as observations.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Same as <code>"estimate"</code>, but it also runs a set of tests to validate the function inputs.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: Not implemented. Returns a vector of NA with as many elements as observations.
</p>
</li></ul>


<hr>
<h2 id='apollo_ol'>Calculates Ordered Logit probabilities</h2><span id='topic+apollo_ol'></span>

<h3>Description</h3>

<p>Calculates the probabilities of an Ordered Logit model and can also perform other operations based on the value of the <code>functionality</code> argument.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_ol(ol_settings, functionality)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_ol_+3A_ol_settings">ol_settings</code></td>
<td>
<p>List of settings for the OL model. It should include the following.
</p>

<ul>
<li> <p><strong><code>coding</code></strong>: Numeric or character vector. Optional argument. Defines the order of the levels in <code>outcomeOrdered</code>. The first value is associated with the lowest level of <code>outcomeOrdered</code>, and the last one with the highest value. If not provided, is assumed to be <code>1:(length(tau) + 1)</code>.
</p>
</li>
<li> <p><strong><code>componentName</code></strong>: Character. Name given to model component. If not provided by the user, Apollo will set the name automatically according to the element in <code>P</code> to which the function output is directed.
</p>
</li>
<li> <p><strong><code>outcomeOrdered</code></strong>: Numeric vector. Dependent variable. The coding of this variable is assumed to be from 1 to the maximum number of different levels. For example, if the ordered response has three possible values: &quot;never&quot;, &quot;sometimes&quot; and &quot;always&quot;, then it is assumed that outcomeOrdered contains &quot;1&quot; for &quot;never&quot;, &quot;2&quot; for &quot;sometimes&quot;, and 3 for &quot;always&quot;. If another coding is used, then it should be specified using the <code>coding</code> argument.
</p>
</li>
<li> <p><strong><code>rows</code></strong>: Boolean vector. TRUE if a row must be considered in the calculations, FALSE if it must be excluded. It must have length equal to the length of argument <code>outcomeOrdered</code>. Default value is <code>"all"</code>, meaning all rows are considered in the calculation.
</p>
</li>
<li> <p><strong><code>tau</code></strong>: List of numeric vectors/matrices/3-dim arrays. Thresholds. As many as number of different levels in the dependent variable - 1. Extreme thresholds are fixed at -inf and +inf. Mixing is allowed in thresholds. Can also be a matrix with as many rows as observations and as many columns as thresholds.
</p>
</li>
<li> <p><strong><code>utilities</code></strong>: Numeric vector/matrix/3-sim array. A single explanatory variable (usually a latent variable). Must have the same number of rows as outcomeOrdered.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_ol_+3A_functionality">functionality</code></td>
<td>
<p>Character. Setting instructing Apollo what processing to apply to the likelihood function. This is in general controlled by the functions that call <code>apollo_probabilities</code>, though the user can also call <code>apollo_probabilities</code> manually with a given functionality for testing/debugging. Possible values are:
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: For further processing/debugging, produces likelihood for each model component (if multiple components are present), at the level of individual draws and observations.
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: For conditionals, produces likelihood of the full model, at the level of individual inter-individual draws.
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: For model estimation, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: For model estimation, produces analytical gradients of the likelihood, where possible.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Prepares output for post-estimation reporting.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: For model prediction, produces probabilities for individual alternatives and individual model components (if multiple components are present) at the level of an observation, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Prepares likelihood functions for use in estimation.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: For debugging, produces probabilities of all alternatives and individual model components at the level of an observation, at the level of individual draws.
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: Prepares output summarising model and choiceset structure.
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: Produces overall model likelihood with constants only.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Validates model specification, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: Produces overall model likelihood with all parameters at zero.
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>This function estimates an Ordered Logit model of the type:
y* = V + epsilon
outcomeOrdered =  1 if   -Inf &lt; y* &lt; tau[1]
2 if tau[1] &lt; y* &lt; tau[2]
...
maxLvl if tau[length(tau)] &lt; y* &lt; +Inf
Where epsilon is distributed standard logistic, and the values 1, 2, ..., maxLvl can be
replaces by coding[1], coding[2], ..., coding[maxLvl].
The behaviour of the function changes depending on the value of the <code>functionality</code> argument.
</p>


<h3>Value</h3>

<p>The returned object depends on the value of argument <code>functionality</code> as follows.
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: vector/matrix/array. Returns the probabilities for the chosen alternative for each observation.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: List containing the likelihood and gradient of the model component.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Same as <code>"estimate"</code> but also writes summary of input data to internal Apollo log.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: List of vectors/matrices/arrays. Returns a list with the probabilities for all possible levels, with an extra element for the probability of the chosen alternative.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Returns a list with pre-processed inputs, based on <code>ol_settings</code>.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: Same as <code>"prediction"</code>
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: Dependent variable overview.
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: vector/matrix/array. Returns the probability of the chosen alternative when only constants are estimated.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Same as <code>"estimate"</code>, but it also runs a set of tests to validate the function inputs.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: Not implemented. Returns a vector of NA with as many elements as observations.
</p>
</li></ul>


<hr>
<h2 id='apollo_op'>Calculates Ordered Probit probabilities</h2><span id='topic+apollo_op'></span>

<h3>Description</h3>

<p>Calculates the probabilities of an Ordered Probit model and can also perform other operations based on the value of the <code>functionality</code> argument.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_op(op_settings, functionality)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_op_+3A_op_settings">op_settings</code></td>
<td>
<p>List of settings for the OP model. It should include the following.
</p>

<ul>
<li> <p><strong><code>coding</code></strong>: Numeric or character vector. Optional argument. Defines the order of the levels in <code>outcomeOrdered</code>. The first value is associated with the lowest level of <code>outcomeOrdered</code>, and the last one with the highest value. If not provided, is assumed to be <code>1:(length(tau) + 1)</code>.
</p>
</li>
<li> <p><strong><code>componentName</code></strong>: Character. Name given to model component. If not provided by the user, Apollo will set the name automatically according to the element in <code>P</code> to which the function output is directed.
</p>
</li>
<li> <p><strong><code>outcomeOrdered</code></strong>: Numeric vector. Dependent variable. The coding of this variable is assumed to be from 1 to the maximum number of different levels. For example, if the ordered response has three possible values: &quot;never&quot;, &quot;sometimes&quot; and &quot;always&quot;, then it is assumed that outcomeOrdered contains &quot;1&quot; for &quot;never&quot;, &quot;2&quot; for &quot;sometimes&quot;, and 3 for &quot;always&quot;. If another coding is used, then it should be specified using the <code>coding</code> argument.
</p>
</li>
<li> <p><strong><code>rows</code></strong>: Boolean vector. TRUE if a row must be considered in the calculations, FALSE if it must be excluded. It must have length equal to the length of argument <code>outcomeOrdered</code>. Default value is <code>"all"</code>, meaning all rows are considered in the calculation.
</p>
</li>
<li> <p><strong><code>tau</code></strong>: List of numeric vectors/matrices/3-dim arrays. Thresholds. As many as number of different levels in the dependent variable - 1. Extreme thresholds are fixed at -inf and +inf. Mixing is allowed in thresholds. Can also be a matrix with as many rows as observations and as many columns as thresholds.
</p>
</li>
<li> <p><strong><code>utilities</code></strong>: Numeric vector/matrix/3-sim array. A single explanatory variable (usually a latent variable). Must have the same number of rows as outcomeOrdered.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_op_+3A_functionality">functionality</code></td>
<td>
<p>Character. Setting instructing Apollo what processing to apply to the likelihood function. This is in general controlled by the functions that call <code>apollo_probabilities</code>, though the user can also call <code>apollo_probabilities</code> manually with a given functionality for testing/debugging. Possible values are:
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: For further processing/debugging, produces likelihood for each model component (if multiple components are present), at the level of individual draws and observations.
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: For conditionals, produces likelihood of the full model, at the level of individual inter-individual draws.
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: For model estimation, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: For model estimation, produces analytical gradients of the likelihood, where possible.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Prepares output for post-estimation reporting.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: For model prediction, produces probabilities for individual alternatives and individual model components (if multiple components are present) at the level of an observation, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Prepares likelihood functions for use in estimation.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: For debugging, produces probabilities of all alternatives and individual model components at the level of an observation, at the level of individual draws.
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: Prepares output summarising model and choiceset structure.
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: Produces overall model likelihood with constants only.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Validates model specification, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: Produces overall model likelihood with all parameters at zero.
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>This function estimates an ordered probit model of the type:
</p>
<p style="text-align: center;"><code class="reqn"> y^{*} = V + \epsilon \\
y = 1 if -\infty &lt; y^{*} &lt; \tau_1,
    2 if \tau_1 &lt; y^{*} &lt; \tau_2,
    ...,
    max(y) if \tau_{max(y)-1} &lt; y^{*} &lt; \infty</code>
</p>

<p>Where <code class="reqn">\epsilon</code> is distributed standard normal, and the values 1, 2, ..., <code class="reqn">max(y)</code> can be
replaced by <code>coding[1], coding[2], ..., coding[maxLvl]</code>.
The behaviour of the function changes depending on the value of the <code>functionality</code> argument.
</p>


<h3>Value</h3>

<p>The returned object depends on the value of argument <code>functionality</code> as follows.
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: vector/matrix/array. Returns the probabilities for the chosen alternative for each observation.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: List containing the likelihood and gradient of the model component.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Same as <code>"estimate"</code> but also writes summary of input data to internal Apollo log.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: List of vectors/matrices/arrays. Returns a list with the probabilities for all possible levels, with an extra element for the probability of the chosen alternative.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Returns a list with pre-processed inputs, based on <code>op_settings</code>.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: Same as <code>"prediction"</code>
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: Dependent variable overview.
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: vector/matrix/array. Returns the probability of the chosen alternative when only constants are estimated.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Same as <code>"estimate"</code>, but it also runs a set of tests to validate the function inputs.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: Not implemented. Returns a vector of NA with as many elements as observations.
</p>
</li></ul>


<hr>
<h2 id='apollo_outOfSample'>Cross-validation of fit (LL)</h2><span id='topic+apollo_outOfSample'></span>

<h3>Description</h3>

<p>Randomly generates estimation and validation samples, estimates the model on 
the first and calculates the likelihood for the second, then repeats.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_outOfSample(
  apollo_beta,
  apollo_fixed,
  apollo_probabilities,
  apollo_inputs,
  estimate_settings = list(estimationRoutine = "bgw", maxIterations = 200, writeIter =
    FALSE, hessianRoutine = "none", printLevel = 3L, silent = TRUE),
  outOfSample_settings = list(nRep = 10, validationSize = 0.1, samples = NA, rmse = NULL)
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_outOfSample_+3A_apollo_beta">apollo_beta</code></td>
<td>
<p>Named numeric vector. Names and values for parameters.</p>
</td></tr>
<tr><td><code id="apollo_outOfSample_+3A_apollo_fixed">apollo_fixed</code></td>
<td>
<p>Character vector. Names (as defined in 
<code>apollo_beta</code>) of parameters whose value should not 
change during estimation.</p>
</td></tr>
<tr><td><code id="apollo_outOfSample_+3A_apollo_probabilities">apollo_probabilities</code></td>
<td>
<p>Function. Returns probabilities of the model to 
be estimated. Must receive three arguments:
</p>

<ul>
<li> <p><strong><code>apollo_beta</code></strong>: Named numeric 
vector. Names and values of model parameters.
</p>
</li>
<li> <p><strong><code>apollo_inputs</code></strong>: List 
containing options of the model. See 
<a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.
</p>
</li>
<li> <p><strong><code>functionality</code></strong>: Character. 
Can be either <strong><code>"components"</code></strong>, 
<code>"conditionals"</code>, <code>"estimate"</code> 
(default), <code>"gradient"</code>, 
<code>"output"</code>, <code>"prediction"</code>, 
<code>"preprocess"</code>, <code>"raw"</code>, 
<code>"report"</code>, <code>"shares_LL"</code>, 
<code>"validate"</code> or <code>"zero_LL"</code>.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_outOfSample_+3A_apollo_inputs">apollo_inputs</code></td>
<td>
<p>List grouping most common inputs. Created by function 
<a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
<tr><td><code id="apollo_outOfSample_+3A_estimate_settings">estimate_settings</code></td>
<td>
<p>List. Options controlling the estimation process. 
See <a href="#topic+apollo_estimate">apollo_estimate</a>.</p>
</td></tr>
<tr><td><code id="apollo_outOfSample_+3A_outofsample_settings">outOfSample_settings</code></td>
<td>
<p>List. Contains settings for this function. User 
input is required for all settings except those 
with a default or marked as optional. 
</p>

<dl>
<dt>nRep</dt><dd><p>Numeric scalar. Number of 
times a different pair of 
estimation and validation 
sets are to be extracted 
from the full database.
Default is 30.</p>
</dd>
<dt>samples</dt><dd><p>Numeric matrix or 
data.frame. Optional 
argument. Must have as 
many rows as observations 
in the <code>database</code>, 
and as many columns as 
number of  repetitions 
wanted. Each column 
represents a re-sample, 
and each element must be 
a 0 if the observation 
should be assigned to the 
estimation sample, or 1 
if the observation should 
be assigned to the 
prediction sample. If this 
argument is provided, then 
<code>nRep</code> and 
<code>validationSize</code> are 
ignored. Note that this 
allows sampling at the 
observation rather than 
the individual level.</p>
</dd>
<dt>validationSize</dt><dd><p>Numeric scalar. 
Size of the 
validation sample. 
Can be a percentage 
of the sample (0-1) 
or the number of 
individuals in the 
validation sample 
(&gt;1). Default is 
0.1.</p>
</dd>
<dt>rmse</dt><dd><p>Character matrix with two
columns. Used to calculate 
Root Mean Squared Error (RMSE) 
of prediction. The first 
column must contain the names 
of observed outcomes in the 
database. The second column 
must contain the names of the 
predicted outcomes as 
returned by 
<code>apollo_prediction</code>. 
If omitted or NULL, no RMSE 
is calculated. This only 
works for models with a 
single component.</p>
</dd>
</dl>
</td></tr>
</table>


<h3>Details</h3>

<p>A common way to test for overfitting of a model is to measure its fit on a 
sample not used during estimation that is, measuring its out-of-sample fit. 
A simple way to do this is splitting the complete available dataset in two 
parts: an estimation sample, and a validation sample. 
The model of interest is estimated using only the estimation sample, and 
then those estimated parameters are used to measure the fit of the model 
(e.g. the log-likelihood of the model) on the validation sample. Doing this 
with only one validation sample, however, may lead to biased results, as a 
particular validation sample need not be representative of the population. 
One way to minimise this issue is to randomly draw several pairs of 
estimation and validation samples from the complete dataset, and apply the 
procedure to each pair.
</p>
<p>The splitting of the database into estimation and validation samples is done 
at the individual level, not at the observation level. If the sampling wants 
to be done at the individual level (not recommended on panel data), then the 
optional <code>outOfSample_settings$samples</code> argument should be provided.
</p>
<p>This function writes two different files to the working/output directory:
</p>

<ul>
<li> <p><strong><code>modelName_outOfSample_params.csv</code></strong>: Records the 
estimated parameters, final log-likelihood, and number of 
observations on each repetition.
</p>
</li>
<li> <p><strong><code>modelName_outOfSample_samples.csv</code></strong>: Records the 
sample composition of each repetition.
</p>
</li></ul>

<p>The first two files are updated throughout the run of this function, while 
the last one is only written once the function finishes.
</p>
<p>When run, this function will look for the two files above in the 
working/output directory. If they are found, the function will attempt to 
pick up re-sampling from where those files left off. This is useful in cases 
where the original bootstrapping was interrupted, or when additional 
re-sampling wants to be performed.
</p>


<h3>Value</h3>

<p>A matrix with the average log-likelihood per observation for both the 
estimation and validation samples, for each repetition. Two additional 
files with further details are written to the working/output directory.
</p>

<hr>
<h2 id='apollo_ownModel'>Calculates own model probabilities</h2><span id='topic+apollo_ownModel'></span>

<h3>Description</h3>

<p>Receives functions or expressions for each functionality so that a 
user-defined model can interface with Apollo.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_ownModel(ownModel_settings, functionality)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_ownModel_+3A_ownmodel_settings">ownModel_settings</code></td>
<td>
<p>List of arguments. Only likelihood is mandatory.
</p>

<ul>
<li> <p><strong><code>likelihood</code></strong>: Function or
expression used to calculate the likelihood
of the model. Should evaluate to a vector, 
matrix, or 3-dimensional array.
</p>
</li>
<li> <p><strong><code>prediction</code></strong>: Function or
expression used to calculate the prediction
of the model. Should evaluate to a vector, 
matrix, or 3-dimensional array.
</p>
</li>
<li> <p><strong><code>zero_LL</code></strong>: Function or
expression used to calculate the likelihood
of the base model (e.g. equiprobable model).
</p>
</li>
<li> <p><strong><code>shares_LL</code></strong>: Function or
expression used to calculate the likelihood
of the constants-only model.
</p>
</li>
<li> <p><strong><code>gradient</code></strong>: Function or
expression used to calculate the gradient
of the likelihood. If not provided, Apollo 
will attempt to calculate it automatically.
</p>
</li>
<li> <p><strong><code>report</code></strong>: List of functions or
expressions used to produce a text report 
summarising the input and parameter 
estimates of the model. Should contain two 
elements: &quot;data&quot; (with a summary of the 
input data), and &quot;param&quot; (with a summary of 
the estimated parameters).
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_ownModel_+3A_functionality">functionality</code></td>
<td>
<p>Character. Setting instructing Apollo what processing to apply to the likelihood function. This is in general controlled by the functions that call <code>apollo_probabilities</code>, though the user can also call <code>apollo_probabilities</code> manually with a given functionality for testing/debugging. Possible values are:
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: For further processing/debugging, produces likelihood for each model component (if multiple components are present), at the level of individual draws and observations.
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: For conditionals, produces likelihood of the full model, at the level of individual inter-individual draws.
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: For model estimation, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: For model estimation, produces analytical gradients of the likelihood, where possible.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Prepares output for post-estimation reporting.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: For model prediction, produces probabilities for individual alternatives and individual model components (if multiple components are present) at the level of an observation, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Prepares likelihood functions for use in estimation.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: For debugging, produces probabilities of all alternatives and individual model components at the level of an observation, at the level of individual draws.
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: Prepares output summarising model and choiceset structure.
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: Produces overall model likelihood with constants only.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Validates model specification, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: Produces overall model likelihood with all parameters at zero.
</p>
</li></ul>
</td></tr>
</table>


<h3>Value</h3>

<p>The returned object depends on the value of argument <code>functionality</code> as follows.
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: vector/matrix/array. Returns the probabilities for the chosen alternative for each observation.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: List containing the likelihood and gradient of the model component.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Same as <code>"estimate"</code> but also writes summary of input data to internal Apollo log.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: List of vectors/matrices/arrays. Returns a list with the probabilities for all alternatives, with an extra element for the probability of the chosen alternative.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Returns a list with pre-processed inputs, based on <code>mnl_settings</code>.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Same as <code>"estimate"</code>, but it also runs a set of tests to validate the function inputs.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: Same as <code>"prediction"</code>
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: Choice overview
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: vector/matrix/array. Returns the probability of the chosen alternative when only constants are estimated.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: vector/matrix/array. Returns the probability of the chosen alternative when all parameters are zero.
</p>
</li></ul>


<hr>
<h2 id='apollo_panelProd'>Calculates product across observations from same individual.</h2><span id='topic+apollo_panelProd'></span>

<h3>Description</h3>

<p>Multiplies likelihood of observations from the same individual, or adds the log of them.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_panelProd(P, apollo_inputs, functionality)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_panelProd_+3A_p">P</code></td>
<td>
<p>List of vectors, matrices or 3-dim arrays. Likelihood of the model components.</p>
</td></tr>
<tr><td><code id="apollo_panelProd_+3A_apollo_inputs">apollo_inputs</code></td>
<td>
<p>List grouping most common inputs. Created by function <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
<tr><td><code id="apollo_panelProd_+3A_functionality">functionality</code></td>
<td>
<p>Character. Setting instructing Apollo what processing to apply to the likelihood function. This is in general controlled by the functions that call <code>apollo_probabilities</code>, though the user can also call <code>apollo_probabilities</code> manually with a given functionality for testing/debugging. Possible values are:
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: For further processing/debugging, produces likelihood for each model component (if multiple components are present), at the level of individual draws and observations.
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: For conditionals, produces likelihood of the full model, at the level of individual inter-individual draws.
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: For model estimation, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: For model estimation, produces analytical gradients of the likelihood, where possible.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Prepares output for post-estimation reporting.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: For model prediction, produces probabilities for individual alternatives and individual model components (if multiple components are present) at the level of an observation, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Prepares likelihood functions for use in estimation.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: For debugging, produces probabilities of all alternatives and individual model components at the level of an observation, at the level of individual draws.
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: Prepares output summarising model and choiceset structure.
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: Produces overall model likelihood with constants only.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Validates model specification, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: Produces overall model likelihood with all parameters at zero.
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>This function should be called inside apollo_probabilities only if the data has a panel structure.
It should be called after apollo_avgIntraDraws if intra-individual draws are used.
</p>


<h3>Value</h3>

<p>Argument <code>P</code> with (for most functionalities) the original contents after multiplying across observations at the individual level. Shape depends on argument <code>functionality</code>.
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: Returns <code>P</code> without changes.
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: Returns <code>P</code> without averaging across draws. Drops all components except <code>"model"</code>.
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: Returns <code>P</code> containing the likelihood of the model after multiplying observations at the individual level. Drops all components except <code>"model"</code>.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: Returns <code>P</code> containing the gradient of the likelihood after applying the product rule across observations for the same individual.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Returns <code>P</code> containing the likelihood of the model after multiplying observations at the individual level.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: Returns <code>P</code> containing the probabilities/likelihoods of all alternatives for all model components averaged across inter-individual draws.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Returns <code>P</code> without changes.           
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: Returns <code>P</code> without changes.
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: Returns <code>P</code> without changes.
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: Returns <code>P</code> containing the likelihood of the model after multiplying observations at the individual level.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Returns <code>P</code> containing the likelihood of the model averaged across inter-individual draws. Drops all components except <code>"model"</code>.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: Returns <code>P</code> containing the likelihood of the model after multiplying observations at the individual level.
</p>
</li></ul>


<hr>
<h2 id='apollo_prediction'>Predicts using an estimated model</h2><span id='topic+apollo_prediction'></span>

<h3>Description</h3>

<p>Calculates <code>apollo_probabilities</code> with functionality=&quot;prediction&quot;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_prediction(
  model,
  apollo_probabilities,
  apollo_inputs,
  prediction_settings = list(),
  modelComponent = NA
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_prediction_+3A_model">model</code></td>
<td>
<p>Model object. Estimated model object as returned by function <a href="#topic+apollo_estimate">apollo_estimate</a>.</p>
</td></tr>
<tr><td><code id="apollo_prediction_+3A_apollo_probabilities">apollo_probabilities</code></td>
<td>
<p>Function. Returns probabilities of the model to be estimated. Must receive three arguments:
</p>

<ul>
<li> <p><strong><code>apollo_beta</code></strong>: Named numeric vector. Names and values of model parameters.
</p>
</li>
<li> <p><strong><code>apollo_inputs</code></strong>: List containing options of the model. See <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.
</p>
</li>
<li> <p><strong><code>functionality</code></strong>: Character. Can be either <strong><code>"components"</code></strong>, <strong><code>"conditionals"</code></strong>, <strong><code>"estimate"</code></strong> (default), <strong><code>"gradient"</code></strong>, <strong><code>"output"</code></strong>, <strong><code>"prediction"</code></strong>, <strong><code>"preprocess"</code></strong>, <strong><code>"raw"</code></strong>, <strong><code>"report"</code></strong>, <strong><code>"shares_LL"</code></strong>, <strong><code>"validate"</code></strong> or <strong><code>"zero_LL"</code></strong>.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_prediction_+3A_apollo_inputs">apollo_inputs</code></td>
<td>
<p>List grouping most common inputs. Created by function <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
<tr><td><code id="apollo_prediction_+3A_prediction_settings">prediction_settings</code></td>
<td>
<p>List. Contains settings for this function. User input is required for all settings except those with a default or marked as optional. 
</p>

<ul>
<li> <p><strong><code>modelComponent</code></strong>: Character. Name of component of apollo_probabilities output to calculate predictions for. Default is to predict for all components.
</p>
</li>
<li> <p><strong><code>nRep</code></strong>: Scalar integer. Only used for models that require simulation for prediction (e.g. MDCEV). Number of draws used to calculate prediction. Default is 100.
</p>
</li>
<li> <p><strong><code>runs</code></strong>: Numeric. Number of runs to use for computing confidence intervals of predictions.
</p>
</li>
<li> <p><strong><code>silent</code></strong>: Boolean. If TRUE, this function won't print any output to screen.
</p>
</li>
<li> <p><strong><code>summary</code></strong>: Boolean. If TRUE, a summary of the prediction is printed to screen. TRUE by default.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_prediction_+3A_modelcomponent">modelComponent</code></td>
<td>
<p><strong>Deprecated</strong>. Same as <code>modelComponent</code> inside <code>prediction_settings</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Structure of predictions are simplified before returning, e.g. list of vectors are turned into a matrix.
</p>


<h3>Value</h3>

<p>A list containing predictions for component <code>modelComponent</code> of the model described in <code>apollo_probabilities</code>.
The particular shape of the prediction will depend on the model component.
</p>

<hr>
<h2 id='apollo_prepareProb'>Checks likelihood function</h2><span id='topic+apollo_prepareProb'></span>

<h3>Description</h3>

<p>Checks that the likelihood function for the mode is in the appropriate format to be returned.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_prepareProb(P, apollo_inputs, functionality)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_prepareProb_+3A_p">P</code></td>
<td>
<p>List of vectors, matrices or 3-dim arrays. Likelihood of the model components.</p>
</td></tr>
<tr><td><code id="apollo_prepareProb_+3A_apollo_inputs">apollo_inputs</code></td>
<td>
<p>List grouping most common inputs. Created by function <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
<tr><td><code id="apollo_prepareProb_+3A_functionality">functionality</code></td>
<td>
<p>Character. Setting instructing Apollo what processing to apply to the likelihood function. This is in general controlled by the functions that call <code>apollo_probabilities</code>, though the user can also call <code>apollo_probabilities</code> manually with a given functionality for testing/debugging. Possible values are:
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: For further processing/debugging, produces likelihood for each model component (if multiple components are present), at the level of individual draws and observations.
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: For conditionals, produces likelihood of the full model, at the level of individual inter-individual draws.
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: For model estimation, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: For model estimation, produces analytical gradients of the likelihood, where possible.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Prepares output for post-estimation reporting.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: For model prediction, produces probabilities for individual alternatives and individual model components (if multiple components are present) at the level of an observation, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Prepares likelihood functions for use in estimation.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: For debugging, produces probabilities of all alternatives and individual model components at the level of an observation, at the level of individual draws.
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: Prepares output summarising model and choiceset structure.
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: Produces overall model likelihood with constants only.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Validates model specification, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: Produces overall model likelihood with all parameters at zero.
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>This function should be called inside <code>apollo_probabilities</code>, near the end of it, just before <code>return(P)</code>.
This function only performs checks on the shape of P, but does not change its values.
</p>


<h3>Value</h3>

<p>Argument <code>P</code> with (for most functionalities) the original contents. Output depends on argument <code>functionality</code>.
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: Returns <code>P</code> without changes.
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: Returns only the <code>"model"</code> component of argument <code>P</code>.
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: Returns only the <code>"model"</code> component of argument <code>P</code>.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: Returns only the <code>"model"</code> component of argument <code>P</code>.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Returns argument <code>P</code> without any changes to its content, but gives names to unnamed elements.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: Returns argument <code>P</code> without any changes.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Returns argument <code>P</code> without any changes to its content, but gives names to elements corresponding to componentNames.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: Returns argument <code>P</code> without any changes.
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: Returns <code>P</code> without changes.
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: Returns argument <code>P</code> without any changes to its content, but gives names to unnamed elements.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Returns argument <code>P</code> without any changes.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: Returns argument <code>P</code> without any changes to its content, but gives names to unnamed elements.
</p>
</li></ul>


<hr>
<h2 id='apollo_preprocess'>Pre-process input for multiple models
return</h2><span id='topic+apollo_preprocess'></span>

<h3>Description</h3>

<p>Pre-process input for multiple models
return
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_preprocess(inputs, modelType, functionality, apollo_inputs)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_preprocess_+3A_inputs">inputs</code></td>
<td>
<p>List of settings</p>
</td></tr>
<tr><td><code id="apollo_preprocess_+3A_modeltype">modelType</code></td>
<td>
<p>Character. Type of model, e.g. &quot;mnl&quot;, &quot;nl&quot;, &quot;cnl&quot;, etc.</p>
</td></tr>
<tr><td><code id="apollo_preprocess_+3A_functionality">functionality</code></td>
<td>
<p>Character. Setting instructing Apollo what processing to apply to the likelihood function. This is in general controlled by the functions that call <code>apollo_probabilities</code>, though the user can also call <code>apollo_probabilities</code> manually with a given functionality for testing/debugging. Possible values are:
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: For further processing/debugging, produces likelihood for each model component (if multiple components are present), at the level of individual draws and observations.
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: For conditionals, produces likelihood of the full model, at the level of individual inter-individual draws.
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: For model estimation, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: For model estimation, produces analytical gradients of the likelihood, where possible.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Prepares output for post-estimation reporting.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: For model prediction, produces probabilities for individual alternatives and individual model components (if multiple components are present) at the level of an observation, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Prepares likelihood functions for use in estimation.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: For debugging, produces probabilities of all alternatives and individual model components at the level of an observation, at the level of individual draws.
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: Prepares output summarising model and choiceset structure.
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: Produces overall model likelihood with constants only.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Validates model specification, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: Produces overall model likelihood with all parameters at zero.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_preprocess_+3A_apollo_inputs">apollo_inputs</code></td>
<td>
<p>List grouping most common inputs. Created by function <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The returned object is a pre-processed version of the model settings. This is independent of <code>functionality</code>, but the function is only called during preprocessing.
</p>

<hr>
<h2 id='apollo_print'>Prints message to terminal</h2><span id='topic+apollo_print'></span>

<h3>Description</h3>

<p>Prints message to terminal if <code>apollo_inputs$silent</code> is FALSE
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_print(txt, nSignifD = 4, widthLim = 11, pause = 0, type = "t")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_print_+3A_txt">txt</code></td>
<td>
<p>Character, what to print.</p>
</td></tr>
<tr><td><code id="apollo_print_+3A_nsignifd">nSignifD</code></td>
<td>
<p>Optional numeric integer. Minimum number of significant digits when printing numeric matrices. Default is 4.</p>
</td></tr>
<tr><td><code id="apollo_print_+3A_widthlim">widthLim</code></td>
<td>
<p>Optional numeric integer. Minimum width (in characters) of each column when printing numeric matrices. Default is 11</p>
</td></tr>
<tr><td><code id="apollo_print_+3A_pause">pause</code></td>
<td>
<p>Scalar integer. Number of seconds the execution will pause after printing the message. Default is 0.</p>
</td></tr>
<tr><td><code id="apollo_print_+3A_type">type</code></td>
<td>
<p>Character. &quot;t&quot; for regular text (default), &quot;w&quot; for warning, &quot;i&quot; for information.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Nothing
</p>

<hr>
<h2 id='apollo_readBeta'>Reads parameters from file</h2><span id='topic+apollo_readBeta'></span>

<h3>Description</h3>

<p>Reads in parameters from a previously estimated model and copies the values to the given <code>apollo_beta</code> vector, only for those parameters whose name matches.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_readBeta(
  apollo_beta,
  apollo_fixed,
  inputModelName,
  overwriteFixed = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_readBeta_+3A_apollo_beta">apollo_beta</code></td>
<td>
<p>Named numeric vector. Names and values for parameters.</p>
</td></tr>
<tr><td><code id="apollo_readBeta_+3A_apollo_fixed">apollo_fixed</code></td>
<td>
<p>Character vector. Names (as defined in <code>apollo_beta</code>) of parameters whose value should not change during estimation.</p>
</td></tr>
<tr><td><code id="apollo_readBeta_+3A_inputmodelname">inputModelName</code></td>
<td>
<p>Character. modelName for model from which results are used as starting values.</p>
</td></tr>
<tr><td><code id="apollo_readBeta_+3A_overwritefixed">overwriteFixed</code></td>
<td>
<p>Boolean. TRUE if starting values for fixed parameters should also be updated from input file.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function will update the values of the parameters in its argument <code>apollo_beta</code> with the matching values in the file
<code>(inputModelName)_estimates.csv</code>. If there is no match for a given parameter in <code>apollo_beta</code>, its value will not be updated.
</p>


<h3>Value</h3>

<p>Named numeric vector. Names and updated starting values for parameters.
</p>

<hr>
<h2 id='apollo_rrm'>Calculates Random Regret Minimisation model probabilities</h2><span id='topic+apollo_rrm'></span>

<h3>Description</h3>

<p>Calculates the probabilities of a Random Regret Minimisation model and can also perform other operations based on the value of the <code>functionality</code> argument.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_rrm(rrm_settings, functionality)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_rrm_+3A_rrm_settings">rrm_settings</code></td>
<td>
<p>List of inputs of the RRM model. It should contain the following.
</p>

<ul>
<li> <p><strong><code>alternatives</code></strong>: Named numeric vector. Names of alternatives and their corresponding value in <code>choiceVar</code>.
</p>
</li>
<li> <p><strong><code>avail</code></strong>: Named list of numeric vectors or scalars. Availabilities of alternatives, one element per alternative. Names of elements must match those in <code>alternatives</code>. Values can be 0 or 1. These can be scalars or vectors (of length equal to rows in the database). A user can also specify <code>avail=1</code> to indicate universal availability, or omit the setting completely.
</p>
</li>
<li> <p><strong><code>choiceVar</code></strong>: Numeric vector. Contains choices for all observations. It will usually be a column from the database. Values are defined in <code>alternatives</code>.
</p>
</li>
<li> <p><strong><code>rum_inputs</code></strong>: Named list of (optional) deterministic utilities. Utilities of the alternatives to be included in combined RUM-RRM models. Names of elements must match those in <code>alternatives.</code>
</p>
</li>
<li> <p><strong><code>regret_inputs</code></strong>: Named list of regret functions. This should contain one list per attribute, where these lists themselves contain two vectors, namely a vector of attributes (at the alternative level) and parameters (either generic or attribute specific). Zeros can be used for omitted attributes for some alternatives. The order for each attribute needs to be the same as the order in <code>alternatives.</code>.
</p>
</li>
<li> <p><strong><code>regret_scale</code></strong>: Named list of regret scales. This should have the same length as 'rrm_settings$regret_inputs' or be a single entry in the case of a generic scale parameter across regret attributes.
</p>
</li>
<li> <p><strong><code>choiceset_scaling</code></strong>: Vector. One entry per row in the database, often set to 2 divided by the number of available alternatives.
</p>
</li>
<li> <p><strong><code>rows</code></strong>: Boolean vector. Consideration of which rows to include. Length equal to the number of observations (nObs), with entries equal to TRUE for rows to include, and FALSE for rows to exclude. Default is <code>"all"</code>, equivalent to <code>rep(TRUE, nObs)</code>.
</p>
</li>
<li> <p><strong><code>componentName</code></strong>: Character. Name given to model component. If not provided by the user, Apollo will set the name automatically according to the element in <code>P</code> to which the function output is directed.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_rrm_+3A_functionality">functionality</code></td>
<td>
<p>Character. Setting instructing Apollo what processing to apply to the likelihood function. This is in general controlled by the functions that call <code>apollo_probabilities</code>, though the user can also call <code>apollo_probabilities</code> manually with a given functionality for testing/debugging. Possible values are:
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: For further processing/debugging, produces likelihood for each model component (if multiple components are present), at the level of individual draws and observations.
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: For conditionals, produces likelihood of the full model, at the level of individual inter-individual draws.
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: For model estimation, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: For model estimation, produces analytical gradients of the likelihood, where possible.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Prepares output for post-estimation reporting.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: For model prediction, produces probabilities for individual alternatives and individual model components (if multiple components are present) at the level of an observation, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Prepares likelihood functions for use in estimation.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: For debugging, produces probabilities of all alternatives and individual model components at the level of an observation, at the level of individual draws.
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: Prepares output summarising model and choiceset structure.
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: Produces overall model likelihood with constants only.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Validates model specification, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: Produces overall model likelihood with all parameters at zero.
</p>
</li></ul>
</td></tr>
</table>


<h3>Value</h3>

<p>The returned object depends on the value of argument <code>functionality</code> as follows.
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: vector/matrix/array. Returns the probabilities for the chosen alternative for each observation.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: List containing the likelihood and gradient of the model component.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Same as <code>"estimate"</code> but also writes summary of input data to internal Apollo log.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: List of vectors/matrices/arrays. Returns a list with the probabilities for all alternatives, with an extra element for the probability of the chosen alternative.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Returns a list with pre-processed inputs, based on <code>rrm_settings</code>.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Same as <code>"estimate"</code>, but it also runs a set of tests to validate the function inputs.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: Same as <code>"prediction"</code>
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: Choice overview
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: vector/matrix/array. Returns the probability of the chosen alternative when only constants are estimated.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Same as <code>"estimate"</code>
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: vector/matrix/array. Returns the probability of the chosen alternative when all parameters are zero.
</p>
</li></ul>


<hr>
<h2 id='apollo_saveOutput'>Saves estimation results to files.</h2><span id='topic+apollo_saveOutput'></span>

<h3>Description</h3>

<p>Writes files in the working/output directory with the estimation results.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_saveOutput(model, saveOutput_settings = NA)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_saveOutput_+3A_model">model</code></td>
<td>
<p>Model object. Estimated model object as returned by function <a href="#topic+apollo_estimate">apollo_estimate</a>.</p>
</td></tr>
<tr><td><code id="apollo_saveOutput_+3A_saveoutput_settings">saveOutput_settings</code></td>
<td>
<p>List. Contains settings for this function. User input is required for all settings except those with a default or marked as optional. 
</p>

<ul>
<li> <p><strong><code>printChange</code></strong>: Boolean. TRUE for printing difference between starting values and estimates. TRUE by default.
</p>
</li>
<li> <p><strong><code>printClassical</code></strong>: Boolean. TRUE for printing classical standard errors. TRUE by default.
</p>
</li>
<li> <p><strong><code>printCorr</code></strong>: Boolean. TRUE for printing parameters correlation matrix. If <code>printClassical=TRUE</code>, both classical and robust matrices are printed. For Bayesian estimation, this setting is used for the covariane of random parameters. TRUE by default.
</p>
</li>
<li> <p><strong><code>printCovar</code></strong>: Boolean. TRUE for printing parameters covariance matrix. If <code>printClassical=TRUE</code>, both classical and robust matrices are printed. For Bayesian estimation, this setting is used for the correlation of random parameters. TRUE by default.
</p>
</li>
<li> <p><strong><code>printDataReport</code></strong>: Boolean. TRUE for printing summary of choices in database and other diagnostics. FALSE by default.
</p>
</li>
<li> <p><strong><code>printFixed</code></strong>: Logical. TRUE for printing fixed parameters among estimated parameter. TRUE by default.
</p>
</li>
<li> <p><strong><code>printFunctions</code></strong>: Boolean. TRUE for printing apollo_control, apollo_randCoeff (when available), apollo_lcPars (when available) and apollo_probabilities. TRUE by default.                               
</p>
</li>
<li> <p><strong><code>printHBconvergence</code></strong>: Boolean. TRUE for printing Geweke convergence tests. TRUE by default.                               
</p>
</li>
<li> <p><strong><code>printHBiterations</code></strong>: Boolean. TRUE for printing an iterations report for HB estimation. TRUE by default.                               
</p>
</li>
<li> <p><strong><code>printModelStructure</code></strong>: Boolean. TRUE for printing model structure. TRUE by default.
</p>
</li>
<li> <p><strong><code>printOutliers</code></strong>: Boolean or Scalar. TRUE for printing 20 individuals with worst average fit across observations. FALSE by default. If Scalar is given, this replaces the default of 20.
</p>
</li>
<li> <p><strong><code>printPVal</code></strong>: Boolean or Scalar. TRUE or 1 for printing p-values for one-sided test, 2 for printing p-values for two-sided test, FALSE for not printing p-values. FALSE by default.
</p>
</li>
<li> <p><strong><code>printT1</code></strong>: Boolean. If TRUE, t-test for H0: apollo_beta=1 are printed. FALSE by default.
</p>
</li>
<li> <p><strong><code>saveEst</code></strong>: Boolean. TRUE for saving estimated parameters and standard errors to a CSV file. TRUE by default.
</p>
</li>
<li> <p><strong><code>saveCorr</code></strong>: Boolean. TRUE for saving estimated correlation matrix to a CSV file. FALSE by default.
</p>
</li>
<li> <p><strong><code>saveCov</code></strong>: Boolean. TRUE for saving estimated covariance matrix to a CSV file. FALSE by default.
</p>
</li>
<li> <p><strong><code>saveHBiterations</code></strong>: Boolean. TRUE for including HB iterations in the saved model object. FALSE by default.
</p>
</li>
<li> <p><strong><code>saveModelObject</code></strong>: Boolean. TRUE to save the R model object to a file (use <a href="#topic+apollo_loadModel">apollo_loadModel</a> to load it to memory). TRUE by default.
</p>
</li>
<li> <p><strong><code>saveOld</code></strong>: Boolean. If TRUE, existing files are kept with an added OLD suffix. If not, they are overwritten. TRUE by default.
</p>
</li>
<li> <p><strong><code>writeF12</code></strong>: Boolean. TRUE for writing results into an F12 file (ALOGIT format). FALSE by default.
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>Estimation results are saved different files in the working/output directory:
</p>

<ul>
<li> <p><strong><code>(modelName)_corr.csv</code></strong> CSV file with the estimated classical correlation matrix. Only when bayesian estimation was not used.
</p>
</li>
<li> <p><strong><code>(modelName)_covar.csv</code></strong> CSV file with the estimated classical covariance matrix. Only when bayesian estimation was not used.
</p>
</li>
<li> <p><strong><code>(modelName)_estimates.csv</code></strong> CSV file with the estimated parameter values, their standars errors, and t-ratios.
</p>
</li>
<li> <p><strong><code>(modelName).F12</code></strong> F12 file with model results. Compatible with ALOGIT.
</p>
</li>
<li> <p><strong><code>(modelName)_output.txt</code></strong> Text file with the output produced by function <code>apollo_modelOutput</code>.
</p>
</li>
<li> <p><strong><code>(modelName)_robcorr.csv</code></strong> CSV file with the estimated robust correlation matrix. Only when bayesian estimation was not used.
</p>
</li>
<li> <p><strong><code>(modelName)_robcovar.csv</code></strong> CSV file with the estimated robust covariance matrix. Only when bayesian estimation was not used.
</p>
</li></ul>



<h3>Value</h3>

<p>nothing
</p>

<hr>
<h2 id='apollo_searchStart'>Searches for better starting values.</h2><span id='topic+apollo_searchStart'></span>

<h3>Description</h3>

<p>Given a set of starting values and a range for them, searches for points with a better likelihood and steeper gradients.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_searchStart(
  apollo_beta,
  apollo_fixed,
  apollo_probabilities,
  apollo_inputs,
  searchStart_settings = NA
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_searchStart_+3A_apollo_beta">apollo_beta</code></td>
<td>
<p>Named numeric vector. Names and values for parameters.</p>
</td></tr>
<tr><td><code id="apollo_searchStart_+3A_apollo_fixed">apollo_fixed</code></td>
<td>
<p>Character vector. Names (as defined in <code>apollo_beta</code>) of parameters whose value should not change during estimation.</p>
</td></tr>
<tr><td><code id="apollo_searchStart_+3A_apollo_probabilities">apollo_probabilities</code></td>
<td>
<p>Function. Returns probabilities of the model to be estimated. Must receive three arguments:
</p>

<ul>
<li> <p><strong><code>apollo_beta</code></strong>: Named numeric vector. Names and values of model parameters.
</p>
</li>
<li> <p><strong><code>apollo_inputs</code></strong>: List containing options of the model. See <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.
</p>
</li>
<li> <p><strong><code>functionality</code></strong>: Character. Can be either <strong><code>"components"</code></strong>, <strong><code>"conditionals"</code></strong>, <strong><code>"estimate"</code></strong> (default), <strong><code>"gradient"</code></strong>, <strong><code>"output"</code></strong>, <strong><code>"prediction"</code></strong>, <strong><code>"preprocess"</code></strong>, <strong><code>"raw"</code></strong>, <strong><code>"report"</code></strong>, <strong><code>"shares_LL"</code></strong>, <strong><code>"validate"</code></strong> or <strong><code>"zero_LL"</code></strong>.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_searchStart_+3A_apollo_inputs">apollo_inputs</code></td>
<td>
<p>List grouping most common inputs. Created by function <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
<tr><td><code id="apollo_searchStart_+3A_searchstart_settings">searchStart_settings</code></td>
<td>
<p>List. Contains settings for this function. User input is required for all settings except those with a default or marked as optional. 
</p>

<ul>
<li> <p><strong><code>apolloBetaMax</code></strong>: Vector. Maximum possible value of parameters when generating candidates. Ignored if smartStart is TRUE. Default is <code>apollo_beta + 0.1</code>.
</p>
</li>
<li> <p><strong><code>apolloBetaMin</code></strong>: Vector. Minimum possible value of parameters when generating candidates. Ignored if smartStart is TRUE. Default is <code>apollo_beta - 0.1</code>.
</p>
</li>
<li> <p><strong><code>bfgsIter</code></strong>: Numeric scalar. Number od BFGS iterations to perform at each stage to each remaining candidate. Default is 20.
</p>
</li>
<li> <p><strong><code>dTest</code></strong>: Numeric scalar. Tolerance for test 1. A candidate is discarded if its distance in parameter space to a better one is smaller than <code>dTest</code>. Default is 1.
</p>
</li>
<li> <p><strong><code>gTest</code></strong>: Numeric scalar. Tolerance for test 2. A candidate is discarded if the norm of its gradient is smaller than <code>gTest</code> AND its LL is further than <code>llTest</code> from a better candidate. Default is <code>10^(-3)</code>.
</p>
</li>
<li> <p><strong><code>llTest</code></strong>: Numeric scalar. Tolerance for test 2. A candidate is discarded if the norm of its gradient is smaller than <code>gTest</code> AND its LL is further than <code>llTest</code> from a better candidate. Default is 3.
</p>
</li>
<li> <p><strong><code>maxStages</code></strong>: Numeric scalar. Maximum number of search stages. The algorithm will stop when there is only one candidate left, or if it reaches this number of stages. Default is 5.
</p>
</li>
<li> <p><strong><code>nCandidates</code></strong>: Numeric scalar. Number of candidate sets of parameters to be used at the start. Should be an integer bigger than 1. Default is 100.
</p>
</li>
<li> <p><strong><code>smartStart</code></strong>: Boolean. If TRUE, candidates are randomly generated with more chances in the directions the Hessian indicates improvement of the LL function. Default is FALSE.
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>This function implements a simplified version of the algorithm proposed by Bierlaire, M., Themans, M. &amp; Zufferey, N. (2010), A Heuristic for Nonlinear Global Optimization, INFORMS Journal on Computing, 22(1), pp.59-70. The main difference
lies in it implementing only two out of three tests on the candidates described by the authors. The implemented algorithm has the
following steps.
</p>

<ol>
<li><p> Randomly draw <code>nCandidates</code> candidates from an interval given by the user.
</p>
</li>
<li><p> Label all candidates with a valid log-likelihood (LL) as active.
</p>
</li>
<li><p> Apply <code>bfgsIter</code> iterations of the BFGS algorithm to each active candidate.
</p>
</li>
<li><p> Apply the following tests to each active candidate:
</p>

<ol>
<li><p> Has the BGFS search converged?
</p>
</li>
<li><p> Are the candidate parameters after BFGS closer than <code>dTest</code> from any other candidate with higher LL?
</p>
</li>
<li><p> Is the LL of the candidate after BFGS further than <code>distLL</code> from a candidate with better LL, and its gradient smaller than <code>gTest</code>?
</p>
</li></ol>

</li>
<li><p> Mark any candidates for which at least one test results in yes as inactive.
</p>
</li>
<li><p> Go back to step 3, unless only one candidate is active, or the maximum number of iterations (<code>maxStages</code>) has been reached.
</p>
</li></ol>

<p>This function will write a CSV file to the working/output directory summarising progress. This file is called <code>modelName</code>_searchStart.csv .
</p>


<h3>Value</h3>

<p>named vector of model parameters. These are the best values found.
</p>

<hr>
<h2 id='apollo_setRows'>Sets specified rows to a given value</h2><span id='topic+apollo_setRows'></span>

<h3>Description</h3>

<p>Given a numeric object (scalar, vector, matrix or 3-dim array) sets a subset of rows to a given value.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_setRows(v, r, val)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_setRows_+3A_v">v</code></td>
<td>
<p>Numeric scalar, vector, matrix or 3-dim array. Rows of this object will be replaced by <code>val</code> and</p>
</td></tr>
<tr><td><code id="apollo_setRows_+3A_r">r</code></td>
<td>
<p>Boolean vector. As many elements as rows in <code>utilities</code>. TRUE for replacing that row, FALSE for not changing it.</p>
</td></tr>
<tr><td><code id="apollo_setRows_+3A_val">val</code></td>
<td>
<p>Numeric scalar. Value to which the specified rows must be set to.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The same argument <code>utilities</code> but with the rows where <code>r==TRUE</code> set to <code>val</code>.
</p>

<hr>
<h2 id='apollo_sharesTest'>Compares predicted and observed shares</h2><span id='topic+apollo_sharesTest'></span>

<h3>Description</h3>

<p>Comparing the shares predicted by the model with the shares observed in the data, and conducts statistical tests.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_sharesTest(
  model,
  apollo_probabilities,
  apollo_inputs,
  sharesTest_settings
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_sharesTest_+3A_model">model</code></td>
<td>
<p>Model object. Estimated model object as returned by function <a href="#topic+apollo_estimate">apollo_estimate</a>.</p>
</td></tr>
<tr><td><code id="apollo_sharesTest_+3A_apollo_probabilities">apollo_probabilities</code></td>
<td>
<p>Function. Returns probabilities of the model to be estimated. Must receive three arguments:
</p>

<ul>
<li> <p><strong><code>apollo_beta</code></strong>: Named numeric vector. Names and values of model parameters.
</p>
</li>
<li> <p><strong><code>apollo_inputs</code></strong>: List containing options of the model. See <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.
</p>
</li>
<li> <p><strong><code>functionality</code></strong>: Character. Can be either <strong><code>"components"</code></strong>, <strong><code>"conditionals"</code></strong>, <strong><code>"estimate"</code></strong> (default), <strong><code>"gradient"</code></strong>, <strong><code>"output"</code></strong>, <strong><code>"prediction"</code></strong>, <strong><code>"preprocess"</code></strong>, <strong><code>"raw"</code></strong>, <strong><code>"report"</code></strong>, <strong><code>"shares_LL"</code></strong>, <strong><code>"validate"</code></strong> or <strong><code>"zero_LL"</code></strong>.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_sharesTest_+3A_apollo_inputs">apollo_inputs</code></td>
<td>
<p>List grouping most common inputs. Created by function <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
<tr><td><code id="apollo_sharesTest_+3A_sharestest_settings">sharesTest_settings</code></td>
<td>
<p>List. Contains settings for this function. User input is required for all settings except those with a default or marked as optional. 
</p>

<ul>
<li> <p><strong><code>alternatives</code></strong>: Named numeric vector. Names of alternatives and their corresponding value in <code>choiceVar</code>.
</p>
</li>
<li> <p><strong><code>choiceVar</code></strong>: Numeric vector. Contains choices for all observations. It will usually be a column from the database. Values are defined in <code>alternatives</code>.
</p>
</li>
<li> <p><strong><code>modelComponent</code></strong>: Name of model component. Set to model by default.
</p>
</li>
<li> <p><strong><code>newAlts</code></strong>: Optional list describing the new alternatives to be used by apollo_sharesTest. This should have as many elements as new alternatives, with each entry being a matrix of 0-1 entries, with one row per observation, and one column per alternative used in the model.
</p>
</li>
<li> <p><strong><code>newAltsOnly</code></strong>: Boolean. If TRUE, results will only be printed for the 'new' alternatives defined in newAlts, not the original alternatives used in the model. Set to FALSE by default.
</p>
</li>
<li> <p><strong><code>subsamples</code></strong>: Named list of boolean vectors. Each element of the list defines whether a given observation belongs to a given subsample (e.g. by sociodemographics).
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>This is an auxiliary function to help guide the definition of utility functions in a choice model. 
By comparing the predicted and observed shares of alternatives for different categories of the data, 
it is possible to identify what additional explanatory variables could improve the fit of the model.
</p>


<h3>Value</h3>

<p>Nothing
</p>

<hr>
<h2 id='apollo_sink'>Starts or stops writing output to a text file.</h2><span id='topic+apollo_sink'></span>

<h3>Description</h3>

<p>Starts or stops writing the output shown in the console to a file named &quot;modelName_additional_output.txt&quot;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_sink(apollo_inputs = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_sink_+3A_apollo_inputs">apollo_inputs</code></td>
<td>
<p>List grouping most common inputs. Created by function <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.
If not provided, it will be looked for in the global environment.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>After the first time this function is called, all output shown in the console will also be written to a
text file called &quot;modelName_additional_output.txt&quot;, where &quot;modelName&quot; is the modelName set inside
apollo_control. 
The second time this function is called, it stops writing the console output to the file. The user 
should always call this function an even number of times to close the output file and prevents data loss.
</p>


<h3>Value</h3>

<p>Nothing.
</p>

<hr>
<h2 id='apollo_speedTest'>Measures evaluation time of a model</h2><span id='topic+apollo_speedTest'></span>

<h3>Description</h3>

<p>Measures the evaluation time of a model for different number of cores and draws.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_speedTest(
  apollo_beta,
  apollo_fixed,
  apollo_probabilities,
  apollo_inputs,
  speedTest_settings = NA
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_speedTest_+3A_apollo_beta">apollo_beta</code></td>
<td>
<p>Named numeric vector. Names and values for parameters.</p>
</td></tr>
<tr><td><code id="apollo_speedTest_+3A_apollo_fixed">apollo_fixed</code></td>
<td>
<p>Character vector. Names (as defined in <code>apollo_beta</code>) of parameters whose value should not change during estimation.</p>
</td></tr>
<tr><td><code id="apollo_speedTest_+3A_apollo_probabilities">apollo_probabilities</code></td>
<td>
<p>Function. Returns probabilities of the model to be estimated. Must receive three arguments:
</p>

<ul>
<li> <p><strong><code>apollo_beta</code></strong>: Named numeric vector. Names and values of model parameters.
</p>
</li>
<li> <p><strong><code>apollo_inputs</code></strong>: List containing options of the model. See <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.
</p>
</li>
<li> <p><strong><code>functionality</code></strong>: Character. Can be either <strong><code>"components"</code></strong>, <strong><code>"conditionals"</code></strong>, <strong><code>"estimate"</code></strong> (default), <strong><code>"gradient"</code></strong>, <strong><code>"output"</code></strong>, <strong><code>"prediction"</code></strong>, <strong><code>"preprocess"</code></strong>, <strong><code>"raw"</code></strong>, <strong><code>"report"</code></strong>, <strong><code>"shares_LL"</code></strong>, <strong><code>"validate"</code></strong> or <strong><code>"zero_LL"</code></strong>.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_speedTest_+3A_apollo_inputs">apollo_inputs</code></td>
<td>
<p>List grouping most common inputs. Created by function <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
<tr><td><code id="apollo_speedTest_+3A_speedtest_settings">speedTest_settings</code></td>
<td>
<p>List. Contains settings for this function. User input is required for all settings except those with a default or marked as optional. 
</p>

<ul>
<li> <p><strong><code>nCoresTry</code></strong>: Numeric vector. Number of threads to try. Default is from 1 to the detected number of cores.
</p>
</li>
<li> <p><strong><code>nDrawsTry</code></strong>: Numeric vector. Number of inter and intra-person draws to try. Default value is c(50, 100, 200).
</p>
</li>
<li> <p><strong><code>nRep</code></strong>: Numeric scalar. Number of times the likelihood is evaluated for each combination of threads and draws. Default is 10.
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>This function evaluates the function <code>apollo_probabilities</code> several times using different number of threads (a.k.a. processor cores),
and draws (if the model uses mixing). It then plots the estimation time for each combination.
Estimation time grows at least linearly with number of draws, while time savings decrease with the number of threads.
This function can help decide what number of draws and cores to use for estimation, though a high number of draws is always
recommended. If the computer will be used for additional activities during estimation, no more than (machine number of cores - 1) should be used.
Using more threads than cores available in the machine will lead to reduce dperformance.
The use of additional cores come at the expense of additional memory usage. If R uses more memory than the physical RAM available,
then significant slow-downs in processing time can be expected. This function can help avoiding such pitfalls.
</p>


<h3>Value</h3>

<p>A matrix with the average time per evaluation for each number of threads and draws combination. A graph is also plotted.
</p>

<hr>
<h2 id='apollo_swissRouteChoiceData'>Dataset of route choice.</h2><span id='topic+apollo_swissRouteChoiceData'></span>

<h3>Description</h3>

<p>A Stated Preference dataset containing 3,492 route choices among two alternatives.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_swissRouteChoiceData
</code></pre>


<h3>Format</h3>

<p>A data frame with 3,492 rows and 16 variables:
</p>

<dl>
<dt>ID</dt><dd><p>Numeric. Identification number of the individual.</p>
</dd>
<dt>choice</dt><dd><p>Numeric. Choice indicator, 1 for alternative 1, and 2 for alternative 2.</p>
</dd>
<dt>tt1</dt><dd><p>Numeric. Travel time (in minutes) for alternative 1.</p>
</dd>
<dt>tc1</dt><dd><p>Numeric. Travel cost (in CHF) for alternative 1.</p>
</dd>
<dt>hw1</dt><dd><p>Numeric. Headway time (in minutes) for alternative 1.</p>
</dd>
<dt>ch1</dt><dd><p>Numeric. Number of interchanges for alternative 1.</p>
</dd>
<dt>tt2</dt><dd><p>Numeric. Travel time (in minutes) for alternative 2.</p>
</dd>
<dt>tc2</dt><dd><p>Numeric. Travel cost (in CHF) for alternative 2.</p>
</dd>
<dt>hw2</dt><dd><p>Numeric. Headway time (in minutes) for alternative 2.</p>
</dd>
<dt>ch2</dt><dd><p>Numeric. Number of interchanges for alternative 2.</p>
</dd>
<dt>hh_inc_abs</dt><dd><p>Numeric. Household income (in CHF per annum).</p>
</dd>
<dt>car_availability</dt><dd><p>Numeric. 1 if respondent has a car available, 0 otherwise.</p>
</dd>
<dt>commute</dt><dd><p>Numeric. 1 if the purpose of the trip is commuting. 0 otherwise.</p>
</dd>
<dt>shopping</dt><dd><p>Numeric. 1 if the purpose of the trip is shopping. 0 otherwise.</p>
</dd>
<dt>business</dt><dd><p>Numeric. 1 if the purpose of the trip is business. 0 otherwise.</p>
</dd>
<dt>leisure</dt><dd><p>Numeric. 1 if the purpose of the trip is leisure. 0 otherwise.</p>
</dd>
</dl>



<h3>Details</h3>

<p>This dataset is to be used for discrete choice modelling.
Data comes from 388 individuals who participated in a Stated
Choice (SC) survey, providing a total of 3,492 observations.
Each choice scenario includes two alternatives described in
terms of travel time, cost, headway and interchanges. Additional
information on respondents is available.
This dataset comes from the following publication.
Vrtic, M. &amp; Axhausen, K.W. (2003), The impact of tilting trains in 
Switzerland: A route choice model of regional and long
distance public transport trips. 82nd annual meeting of 
the transportation research board, Washington, DC.
</p>


<h3>Source</h3>

<p><a href="http://www.apollochoicemodelling.com/">http://www.apollochoicemodelling.com/</a>
</p>

<hr>
<h2 id='apollo_timeUseData'>Dataset of time use.</h2><span id='topic+apollo_timeUseData'></span>

<h3>Description</h3>

<p>A Revealed Preference dataset containing 2,826 full-day observations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_timeUseData
</code></pre>


<h3>Format</h3>

<p>An object of class <code>data.frame</code> with 2826 rows and 20 columns.
</p>


<h3>Details</h3>

<p>This dataset is to be used for Multiple Discrete Continuous (MDC) modelling.
Data comes from 447 individuals who provided activitry diaries for a total
of 2,826 days. Each observation summarizes the amount of time spent in each 
of twelve different activities. The dataset also incluides characteristics
of the participants.
This dataset comes from the following publication.
Calastri, C., Crastes dit Sourd, R. and Hess, S. (2020) We want it all: experiences 
from a survey seeking to capture social network structures, lifetime events 
and short-term travel and activity planning. Transportation, 47(1), pp. 175-201.
</p>

<dl>
<dt>indivID</dt><dd><p>Numeric. Identification number of the individual.</p>
</dd>
<dt>day</dt><dd><p>Numeric. Index of the day for each observation (day 1 was excluded).</p>
</dd>
<dt>date</dt><dd><p>Numeric. Date in format yyyymmdd.</p>
</dd>
<dt>budget</dt><dd><p>Numeric. Total amount of time registered during the day (in minutes).</p>
</dd>
<dt>t_a01</dt><dd><p>Numeric. Time spent dropping-of or picking up other people (in minutes).</p>
</dd>
<dt>t_a02</dt><dd><p>Numeric. Time spent working (in minutes).</p>
</dd>
<dt>t_a03</dt><dd><p>Numeric. Time spent on educational activities (in minutes).</p>
</dd>
<dt>t_a04</dt><dd><p>Numeric. Time spent shopping (in minutes).</p>
</dd>
<dt>t_a05</dt><dd><p>Numeric. Time spent on private business (in minutes).</p>
</dd>
<dt>t_a06</dt><dd><p>Numeric. Time spent getting petrol (in minutes).</p>
</dd>
<dt>t_a07</dt><dd><p>Numeric. Time spent on social or leasure activities (in minutes).</p>
</dd>
<dt>t_a08</dt><dd><p>Numeric. Time spent on vacation or long (inter-city) travel (in minutes).</p>
</dd>
<dt>t_a09</dt><dd><p>Numeric. Time spent doing exercise (in minutes).</p>
</dd>
<dt>t_a10</dt><dd><p>Numeric. Time spent at home (in minutes).</p>
</dd>
<dt>t_a11</dt><dd><p>Numeric. Time spent travelling (everyday travelling) (in minutes).</p>
</dd>
<dt>t_a12</dt><dd><p>Numeric. Non-allocated time (in minutes).</p>
</dd>
<dt>female</dt><dd><p>Numeric. 1 if respondent is female. 0 otherwise.</p>
</dd>
<dt>age</dt><dd><p>Numeric. Age of respondent (in years, approximate).</p>
</dd>
<dt>occ_full_time</dt><dd><p>Numeric. 1 if the respondent works full time.</p>
</dd>
<dt>weekend</dt><dd><p>Numeric. 1 if the current date is a weekend.</p>
</dd>
</dl>



<h3>Source</h3>

<p><a href="http://www.apollochoicemodelling.com/">http://www.apollochoicemodelling.com/</a>
</p>

<hr>
<h2 id='apollo_unconditionals'>Returns unconditionals for models with random heterogeneity</h2><span id='topic+apollo_unconditionals'></span>

<h3>Description</h3>

<p>Returns unconditionals for random parameters in model, both for continuous mixtures and latent class.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_unconditionals(model, apollo_probabilities, apollo_inputs)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_unconditionals_+3A_model">model</code></td>
<td>
<p>Model object. Estimated model object as returned by function <a href="#topic+apollo_estimate">apollo_estimate</a>.</p>
</td></tr>
<tr><td><code id="apollo_unconditionals_+3A_apollo_probabilities">apollo_probabilities</code></td>
<td>
<p>Function. Returns probabilities of the model to be estimated. Must receive three arguments:
</p>

<ul>
<li> <p><strong><code>apollo_beta</code></strong>: Named numeric vector. Names and values of model parameters.
</p>
</li>
<li> <p><strong><code>apollo_inputs</code></strong>: List containing options of the model. See <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.
</p>
</li>
<li> <p><strong><code>functionality</code></strong>: Character. Can be either <strong><code>"components"</code></strong>, <strong><code>"conditionals"</code></strong>, <strong><code>"estimate"</code></strong> (default), <strong><code>"gradient"</code></strong>, <strong><code>"output"</code></strong>, <strong><code>"prediction"</code></strong>, <strong><code>"preprocess"</code></strong>, <strong><code>"raw"</code></strong>, <strong><code>"report"</code></strong>, <strong><code>"shares_LL"</code></strong>, <strong><code>"validate"</code></strong> or <strong><code>"zero_LL"</code></strong>.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_unconditionals_+3A_apollo_inputs">apollo_inputs</code></td>
<td>
<p>List grouping most common inputs. Created by function <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This functions is only meant for use with models using continuous distributions or latent classes, or both at the same time.
</p>


<h3>Value</h3>

<p>Depends on whether the model uses continuous mixtures or latent class. 
</p>

<ul>
<li><p> If the model contains a continuous mixture, it returns a list with one object per
random coefficient. When using inter-individual draws only, each element will be 
a matrix with one row per individual, and one column per draw. When using intra-
individual draws, each element will be a three-dimensional array, with one row 
per observation, inter-individual draws in the second dimension, and intra-
individual draws in the third dimension.
</p>
</li>
<li><p> If the model contains latent classes, it returns a list with as many elements
as random coefficients in the model, plus one additional element containing 
the class allocation probabilities.
</p>
</li>
<li><p> If the model contains both continuous mixing and latent classes, a list with the
two elements described above will be returned.
</p>
</li></ul>


<hr>
<h2 id='apollo_validate'>Pre-process input for common models
return</h2><span id='topic+apollo_validate'></span>

<h3>Description</h3>

<p>Pre-process input for common models
return
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_validate(inputs, modelType, functionality, apollo_inputs)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_validate_+3A_inputs">inputs</code></td>
<td>
<p>List of settings</p>
</td></tr>
<tr><td><code id="apollo_validate_+3A_modeltype">modelType</code></td>
<td>
<p>Character. Type of model, e.g. &quot;mnl&quot;, &quot;nl&quot;, &quot;cnl&quot;, etc.</p>
</td></tr>
<tr><td><code id="apollo_validate_+3A_functionality">functionality</code></td>
<td>
<p>Character. Setting instructing Apollo what processing to apply to the likelihood function. This is in general controlled by the functions that call <code>apollo_probabilities</code>, though the user can also call <code>apollo_probabilities</code> manually with a given functionality for testing/debugging. Possible values are:
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: For further processing/debugging, produces likelihood for each model component (if multiple components are present), at the level of individual draws and observations.
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: For conditionals, produces likelihood of the full model, at the level of individual inter-individual draws.
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: For model estimation, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: For model estimation, produces analytical gradients of the likelihood, where possible.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Prepares output for post-estimation reporting.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: For model prediction, produces probabilities for individual alternatives and individual model components (if multiple components are present) at the level of an observation, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Prepares likelihood functions for use in estimation.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: For debugging, produces probabilities of all alternatives and individual model components at the level of an observation, at the level of individual draws.
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: Prepares output summarising model and choiceset structure.
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: Produces overall model likelihood with constants only.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Validates model specification, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: Produces overall model likelihood with all parameters at zero.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_validate_+3A_apollo_inputs">apollo_inputs</code></td>
<td>
<p>List of main inputs to the model estimation process. See <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The returned object depends on the value of argument operation
</p>

<hr>
<h2 id='apollo_validateControl'>Validates apollo_control</h2><span id='topic+apollo_validateControl'></span>

<h3>Description</h3>

<p>Validates the options controlling the running of the code <code>apollo_control</code> and sets default values for the omitted ones.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_validateControl(database, apollo_control, silent = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_validateControl_+3A_database">database</code></td>
<td>
<p>data.frame. Data used by model.</p>
</td></tr>
<tr><td><code id="apollo_validateControl_+3A_apollo_control">apollo_control</code></td>
<td>
<p>List. Options controlling the running of the code. User input is required for all settings except those with a default or marked as optional. 
</p>

<ul>
<li> <p><strong><code>calculateLLC</code></strong>: Boolean. TRUE if user wants to calculate LL at constants (if applicable). - TRUE by default.
</p>
</li>
<li> <p><strong><code>HB</code></strong>: Boolean. TRUE if using RSGHB for Bayesian estimation of model.
</p>
</li>
<li> <p><strong><code>indivID</code></strong>: Character. Name of column in the database with each decision maker's ID.
</p>
</li>
<li> <p><strong><code>mixing</code></strong>: Boolean. TRUE for models that include random parameters.
</p>
</li>
<li> <p><strong><code>modelDescr</code></strong>: Character. Description of the model. Used in output files.
</p>
</li>
<li> <p><strong><code>modelName</code></strong>: Character. Name of the model. Used when saving the output to files.
</p>
</li>
<li> <p><strong><code>nCores</code></strong>: Numeric&gt;0. Number of cores to use in calculations of the model likelihood.
</p>
</li>
<li> <p><strong><code>noDiagnostics</code></strong>: Boolean. TRUE if user does not wish model diagnostics to be printed - FALSE by default.
</p>
</li>
<li> <p><strong><code>noValidation</code></strong>: Boolean. TRUE if user does not wish model input to be validated before estimation - FALSE by default.
</p>
</li>
<li> <p><strong><code>outputDirectory</code></strong>: Character. Optional directory for outputs if different from working director - empty by default
</p>
</li>
<li> <p><strong><code>panelData</code></strong>: Boolean. TRUE if there are multiple observations (i.e. rows) for each decision maker - Automatically set based on <code>indivID</code> by default.
</p>
</li>
<li> <p><strong><code>seed</code></strong>: Numeric. Seed for random number generation.
</p>
</li>
<li> <p><strong><code>weights</code></strong>: Character. Name of column in database containing weights for estimation.
</p>
</li>
<li> <p><strong><code>workInLogs</code></strong>: Boolean. TRUE for increased numeric precision in models with panel data - FALSE by default.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_validateControl_+3A_silent">silent</code></td>
<td>
<p>Boolean. If TRUE, no messages are printed to screen.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function should be run before running <code>apollo_validateData</code>.
</p>


<h3>Value</h3>

<p>Validated version of <code>apollo_control</code>, with additional element called <code>panelData</code> set to TRUE for repeated choice data.
</p>

<hr>
<h2 id='apollo_validateData'>Validates data</h2><span id='topic+apollo_validateData'></span>

<h3>Description</h3>

<p>Checks consistency of the database with <code>apollo_control</code>, sorts it by 
indivID, and adds an internal ID variable (<code>apollo_sequence</code>)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_validateData(database, apollo_control, silent)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_validateData_+3A_database">database</code></td>
<td>
<p>data.frame. Data used by model.</p>
</td></tr>
<tr><td><code id="apollo_validateData_+3A_apollo_control">apollo_control</code></td>
<td>
<p>List. Options controlling the running of the code. See 
<a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
<tr><td><code id="apollo_validateData_+3A_silent">silent</code></td>
<td>
<p>Boolean. TRUE to prevent the function from printing to the 
console. Default is FALSE.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function should be called after calling <a href="#topic+apollo_validateControl">apollo_validateControl</a>.
Observations are sorted only if <code>apollo_control$panelData=TRUE</code>.
</p>


<h3>Value</h3>

<p>Data.frame. Validated version of database.
</p>

<hr>
<h2 id='apollo_validateHBControl'>Validates the <code>apollo_HB</code> list of parameters</h2><span id='topic+apollo_validateHBControl'></span>

<h3>Description</h3>

<p>Validates the <code>apollo_HB</code> list of parameters and sets default values for the omitted ones.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_validateHBControl(
  apollo_HB,
  apollo_beta,
  apollo_fixed,
  apollo_control,
  silent = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_validateHBControl_+3A_apollo_hb">apollo_HB</code></td>
<td>
<p>List. Contains options for Bayesian estimation. See <code>?RSGHB::doHB</code> for details.
Parameters <code>modelname</code>, <code>gVarNamesFixed</code>, <code>gVarNamesNormal</code>,
<code>gDIST</code>, <code>svN</code> and <code>FC</code> are automatically set based on the
other arguments of this function.
Other settings to include are the following.
</p>

<ul>
<li> <p><strong><code>constraintNorm</code></strong>: Character vector. Constraints for <em>random</em> coefficients 
in bayesian estimation. Constraints can be written as 
&quot;b1&gt;b2&quot;, &quot;b1&lt;b2&quot;, &quot;b1&gt;0&quot;, or &quot;b1&lt;0&quot;.
</p>
</li>
<li> <p><strong><code>fixedA</code></strong>: Named numeric vector. Contains the names and fixed mean values of 
random parameters. For example, c(b1=0) fixes the mean of b1 to zero.
</p>
</li>
<li> <p><strong><code>fixedD</code></strong>: Named numeric vector. Contains the names and fixed variance of 
random parameters. For example, c(b1=1) fixes the variance of b1 to zero.
</p>
</li>
<li> <p><strong><code>gFULLCV:</code></strong> Boolean. Whether the full variance-covariance structure should be used for random parameters (TRUE by default).
</p>
</li>
<li> <p><strong><code>gNCREP</code></strong>: Numeric. Number of burn-in iterations to use prior to convergence (default=10^5).
</p>
</li>
<li> <p><strong><code>gNEREP</code></strong>: Numeric. Number of iterations to keep for averaging after convergence has been reached (default=10^5).
</p>
</li>
<li> <p><strong><code>gINFOSKIP</code></strong>: Numeric. Number of iterations between printing/plotting information about the iteration process (default=250).
</p>
</li>
<li> <p><strong><code>hbDist</code></strong>: <em>Mandatory</em> setting. A named character vector determining
the distribution of each parameter to be estimated. Possible 
values are as follows.
</p>

<ul>
<li> <p><strong><code>"CN+"</code></strong>: Positive censored normal.
</p>
</li>
<li> <p><strong><code>"CN-"</code></strong>: Negative censored normal.
</p>
</li>
<li> <p><strong><code>"JSB"</code></strong>: Johnson SB.
</p>
</li>
<li> <p><strong><code>"LN+"</code></strong>: Positive log-normal.
</p>
</li>
<li> <p><strong><code>"LN-"</code></strong>: Negative log-normal.
</p>
</li>
<li> <p><strong><code>"N"</code></strong>: Normal.
</p>
</li>
<li> <p><strong><code>"NR"</code></strong>: Fixed (as in non-random) parameter.
</p>
</li></ul>

</li>
<li> <p><strong><code>nodiagnostics</code></strong>: Boolean. Turn off pre-estimation diagnostics for RSGHB. Set to TRUE by default.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_validateHBControl_+3A_apollo_beta">apollo_beta</code></td>
<td>
<p>Named numeric vector. Names and values for parameters.</p>
</td></tr>
<tr><td><code id="apollo_validateHBControl_+3A_apollo_fixed">apollo_fixed</code></td>
<td>
<p>Character vector. Names (as defined in <code>apollo_beta</code>) of parameters whose value should not change during estimation.
value is constant throughout estimation).</p>
</td></tr>
<tr><td><code id="apollo_validateHBControl_+3A_apollo_control">apollo_control</code></td>
<td>
<p>List. Options controlling the running of the code. See <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
<tr><td><code id="apollo_validateHBControl_+3A_silent">silent</code></td>
<td>
<p>Boolean. TRUE to keep the function from printing to the console. Default is FALSE.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function is only necessary when using bayesian estimation.
</p>


<h3>Value</h3>

<p>Validated apollo_HB
</p>

<hr>
<h2 id='apollo_validateInputs'>Prepares input for <code>apollo_estimate</code></h2><span id='topic+apollo_validateInputs'></span>

<h3>Description</h3>

<p>Searches the user work space (.GlobalEnv) for all necessary input to run <code>apollo_estimate</code>, and packs it in a single list.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_validateInputs(
  apollo_beta = NA,
  apollo_fixed = NA,
  database = NA,
  apollo_control = NA,
  apollo_HB = NA,
  apollo_draws = NA,
  apollo_randCoeff = NA,
  apollo_lcPars = NA,
  recycle = FALSE,
  silent = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_validateInputs_+3A_apollo_beta">apollo_beta</code></td>
<td>
<p>Named numeric vector. Names and values for parameters.</p>
</td></tr>
<tr><td><code id="apollo_validateInputs_+3A_apollo_fixed">apollo_fixed</code></td>
<td>
<p>Character vector. Names (as defined in <code>apollo_beta</code>) of parameters whose value should not change during estimation.</p>
</td></tr>
<tr><td><code id="apollo_validateInputs_+3A_database">database</code></td>
<td>
<p>data.frame. Data used by model.</p>
</td></tr>
<tr><td><code id="apollo_validateInputs_+3A_apollo_control">apollo_control</code></td>
<td>
<p>List. Options controlling the running of the code. User input is required for all settings except those with a default or marked as optional. 
</p>

<ul>
<li> <p><strong><code>analyticGrad</code></strong>: Boolean. TRUE to use analytical gradients during parameter estimation, if they are available. FALSE to use numerical gradients. - TRUE by default.
</p>
</li>
<li> <p><strong><code>calculateLLC</code></strong>: Boolean. TRUE if user wants to calculate LL at constants (if applicable). - TRUE by default.
</p>
</li>
<li> <p><strong><code>HB</code></strong>: Boolean. TRUE if using RSGHB for Bayesian estimation of model.
</p>
</li>
<li> <p><strong><code>indivID</code></strong>: Character. Name of column in the database with each decision maker's ID.
</p>
</li>
<li> <p><strong><code>mixing</code></strong>: Boolean. TRUE for models that include random parameters.
</p>
</li>
<li> <p><strong><code>modelDescr</code></strong>: Character. Description of the model. Used in output files.
</p>
</li>
<li> <p><strong><code>modelName</code></strong>: Character. Name of the model. Used when saving the output to files.
</p>
</li>
<li> <p><strong><code>nCores</code></strong>: Numeric&gt;0. Number of cores to use in calculations of the model likelihood.
</p>
</li>
<li> <p><strong><code>noDiagnostics</code></strong>: Boolean. TRUE if user does not wish model diagnostics to be printed - FALSE by default.
</p>
</li>
<li> <p><strong><code>noValidation</code></strong>: Boolean. TRUE if user does not wish model input to be validated before estimation - FALSE by default.
</p>
</li>
<li> <p><strong><code>outputDirectory</code></strong>: Character. Optional directory for outputs if different from working director - empty by default
</p>
</li>
<li> <p><strong><code>panelData</code></strong>: Boolean. TRUE if there are multiple observations (i.e. rows) for each decision maker - Automatically set based on <code>indivID</code> by default.
</p>
</li>
<li> <p><strong><code>seed</code></strong>: Numeric. Seed for random number generation.
</p>
</li>
<li> <p><strong><code>weights</code></strong>: Character. Name of column in database containing weights for estimation.
</p>
</li>
<li> <p><strong><code>workInLogs</code></strong>: Boolean. TRUE for increased numeric precision in models with panel data - FALSE by default.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_validateInputs_+3A_apollo_hb">apollo_HB</code></td>
<td>
<p>List. Contains options for Bayesian estimation. See <code>?RSGHB::doHB</code> for details.
Parameters <code>modelname</code>, <code>gVarNamesFixed</code>, <code>gVarNamesNormal</code>,
<code>gDIST</code>, <code>svN</code> and <code>FC</code> are automatically set based on the
other arguments of this function.
Other settings to include are the following.
</p>

<ul>
<li> <p><strong><code>constraintNorm</code></strong>: Character vector. Constraints for <em>random</em> coefficients 
in bayesian estimation. Constraints can be written as 
&quot;b1&gt;b2&quot;, &quot;b1&lt;b2&quot;, &quot;b1&gt;0&quot;, or &quot;b1&lt;0&quot;.
</p>
</li>
<li> <p><strong><code>fixedA</code></strong>: Named numeric vector. Contains the names and fixed mean values of 
random parameters. For example, c(b1=0) fixes the mean of b1 to zero.
</p>
</li>
<li> <p><strong><code>fixedD</code></strong>: Named numeric vector. Contains the names and fixed variance of 
random parameters. For example, c(b1=1) fixes the variance of b1 to zero.
</p>
</li>
<li> <p><strong><code>gNCREP</code></strong>: Numeric. Number of burn-in iterations to use prior to convergence (default=10^5).
</p>
</li>
<li> <p><strong><code>gNEREP</code></strong>: Numeric. Number of iterations to keep for averaging after convergence has been reached (default=10^5).
</p>
</li>
<li> <p><strong><code>gINFOSKIP</code></strong>: Numeric. Number of iterations between printing/plotting information about the iteration process (default=250).
</p>
</li>
<li> <p><strong><code>hbDist</code></strong>: <em>Mandatory</em> setting. A named character vector determining
the distribution of each parameter to be estimated. Possible 
values are as follows.
</p>

<ul>
<li> <p><strong><code>"CN+"</code></strong>: Positive censored normal.
</p>
</li>
<li> <p><strong><code>"CN-"</code></strong>: Negative censored normal.
</p>
</li>
<li> <p><strong><code>"DNE"</code></strong>: Parameter kept at its starting value (not estimated).
</p>
</li>
<li> <p><strong><code>"JSB"</code></strong>: Johnson SB.
</p>
</li>
<li> <p><strong><code>"LN+"</code></strong>: Positive log-normal.
</p>
</li>
<li> <p><strong><code>"LN-"</code></strong>: Negative log-normal.
</p>
</li>
<li> <p><strong><code>"N"</code></strong>: Normal.
</p>
</li>
<li> <p><strong><code>"NR"</code></strong>: Fixed (as in non-random) parameter.
</p>
</li></ul>

</li></ul>
</td></tr>
<tr><td><code id="apollo_validateInputs_+3A_apollo_draws">apollo_draws</code></td>
<td>
<p>List of arguments describing the inter and intra individual draws. Required only if <code>apollo_control$mixing = TRUE</code>. Unused elements can be ommited.
</p>

<ul>
<li> <p><strong><code>interDrawsType</code></strong>: Character. Type of inter-individual draws ('halton','mlhs','pmc','sobol','sobolOwen',
'sobolFaureTezuka', 'sobolOwenFaureTezuka' or the name of an object loaded in memory,
see manual in www.ApolloChoiceModelling.com for details).
</p>
</li>
<li> <p><strong><code>interNDraws</code></strong>: Numeric scalar (&gt;=0). Number of inter-individual draws per individual. Should be set to 0 if not using them.
</p>
</li>
<li> <p><strong><code>interNormDraws</code></strong>: Character vector. Names of normaly distributed inter-individual draws.
</p>
</li>
<li> <p><strong><code>interUnifDraws</code></strong>: Character vector. Names of uniform-distributed inter-individual draws.
</p>
</li>
<li> <p><strong><code>intraDrawsType</code></strong>: Character. Type of intra-individual draws ('halton','mlhs','pmc','sobol','sobolOwen','sobolFaureTezuka', 'sobolOwenFaureTezuka' or the name of an object loaded in memory).
</p>
</li>
<li> <p><strong><code>intraNDraws</code></strong>: Numeric scalar (&gt;=0). Number of intra-individual draws per individual. Should be set to 0 if not using them.
</p>
</li>
<li> <p><strong><code>intraUnifDraws</code></strong>: Character vector. Names of uniform-distributed intra-individual draws.
</p>
</li>
<li> <p><strong><code>intraNormDraws</code></strong>: Character vector. Names of normaly distributed intra-individual draws.
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_validateInputs_+3A_apollo_randcoeff">apollo_randCoeff</code></td>
<td>
<p>Function. Used with mixing models. Constructs the random parameters of a mixing model. Receives two arguments:
</p>

<ul>
<li> <p><strong><code>apollo_beta</code></strong>: Named numeric vector. Names and values of model parameters. 
</p>
</li>
<li> <p><strong><code>apollo_inputs</code></strong>: The output of this function (<code>apollo_validateInputs</code>).
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_validateInputs_+3A_apollo_lcpars">apollo_lcPars</code></td>
<td>
<p>Function. Used with latent class models. Constructs a list of parameters for each latent class. Receives two arguments:
</p>

<ul>
<li> <p><strong><code>apollo_beta</code></strong>: Named numeric vector. Names and values of model parameters. 
</p>
</li>
<li> <p><strong><code>apollo_inputs</code></strong>: The output of this function (<code>apollo_validateInputs</code>).
</p>
</li></ul>
</td></tr>
<tr><td><code id="apollo_validateInputs_+3A_recycle">recycle</code></td>
<td>
<p>Logical. If TRUE, an older version of <code>apollo_inputs</code> is looked for in the calling environment (parent frame), and any
element in that old version created by the user is copied into the new <code>apollo_inputs</code> returned by this function.
For <code>recycle=TRUE</code> to work, the old version of <code>apollo_inputs</code> <strong>must</strong> be named &quot;apollo_inputs&quot;.
If FALSE, nothing is copied from any older version of apollo_inputs. FALSE is the default.</p>
</td></tr>
<tr><td><code id="apollo_validateInputs_+3A_silent">silent</code></td>
<td>
<p>Logical. TRUE to keep the function from printing to the console. Default is FALSE.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>All arguments to this function are optional. If the function is called without arguments, then it it will look in
the user workspace (i.e. the global environment) for variables with the same name as its omitted arguments.
We strongly recommend users to visit <a href="http://www.apollochoicemodelling.com/">http://www.apollochoicemodelling.com/</a> for examples on how to use Apollo.
In the website, users will also find a detailed manual and a user-group for help and further reference.
</p>


<h3>Value</h3>

<p>List grouping several required input for model estimation.
</p>

<hr>
<h2 id='apollo_varcov'>Calculates variance-covariance matrix of an Apollo model</h2><span id='topic+apollo_varcov'></span>

<h3>Description</h3>

<p>Calculates the Hessian, variance-covariance matrix and standard errors of an Apollo model as defined by its likelihood function 
and <code>apollo_inputs</code> list of settings. Performs automatic scaling for increased numeric stability.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_varcov(apollo_beta, apollo_fixed, varcov_settings)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_varcov_+3A_apollo_beta">apollo_beta</code></td>
<td>
<p>Named numeric vector. Names and values of parameters at which to calculate the covariance matrix.
Values <strong>must not be scaled</strong>, and they must include any fixed parameter.</p>
</td></tr>
<tr><td><code id="apollo_varcov_+3A_apollo_fixed">apollo_fixed</code></td>
<td>
<p>Character vector. Names of fixed parameters.</p>
</td></tr>
<tr><td><code id="apollo_varcov_+3A_varcov_settings">varcov_settings</code></td>
<td>
<p>List of settings defining the behaviour of this function. It must contain at least one of
the following: <code>apollo_logLike</code>, <code>apollo_grad</code> or <code>apollo_inputs</code> together with <code>apollo_probabilities</code>.
</p>

<ul>
<li> <p><strong><code>apollo_grad</code></strong>: Function to calculate the gradient of the model, as returned by <a href="#topic+apollo_makeGrad">apollo_makeGrad</a>.
</p>
</li>
<li> <p><strong><code>apollo_hessian</code></strong>: Function to calculate the hessian of the model, as returned by <a href="#topic+apollo_makeHessian">apollo_makeHessian</a>.
</p>
</li>
<li> <p><strong><code>apollo_inputs</code></strong>: List grouping most common inputs. Created by function <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.
</p>
</li>
<li> <p><strong><code>apollo_logLike</code></strong>: Function to calculate the log-likelihood of the model, as returned by <a href="#topic+apollo_makeLogLike">apollo_makeLogLike</a>.
</p>
</li>
<li> <p><strong><code>apollo_probabilities</code></strong>: apollo_probabilities Function. Returns probabilities of the model to be estimated. Must receive three arguments:
</p>

<ul>
<li> <p><strong><code>apollo_beta</code></strong>: Named numeric vector. Names and values of model parameters.
</p>
</li>
<li> <p><strong><code>apollo_inputs</code></strong>: List containing options of the model. See <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.
</p>
</li>
<li> <p><strong><code>functionality</code></strong>: Character. Can be either 
<strong><code>"components"</code></strong>, <strong><code>"conditionals"</code></strong>, <strong><code>"estimate"</code></strong> (default), <strong><code>"gradient"</code></strong>, <strong><code>"output"</code></strong>, <strong><code>"prediction"</code></strong>, <strong><code>"preprocess"</code></strong>, <strong><code>"raw"</code></strong>, <strong><code>"report"</code></strong>, <strong><code>"shares_LL"</code></strong>, <strong><code>"validate"</code></strong> or <strong><code>"zero_LL"</code></strong>.
</p>
</li></ul>

</li>
<li> <p><strong><code>BHHH_matrix</code></strong>: Matrix. Optional input, providing the BHHH matrix so it does not get recalculated.
</p>
</li>
<li> <p><strong><code>hessianRoutine</code></strong>: Character. Name of routine used to calculate the Hessian. Valid values are <code>"analytic"</code>, <code>"numDeriv"</code>, <code>"maxLik"</code> or <code>"none"</code> to avoid estimating the Hessian and covariance matrix.
</p>
</li>
<li> <p><strong><code>numDeriv_method</code></strong>: Character. Method used for numerical differentiation. Can be <code>"Richardson"</code> or <code>"simple"</code>, Only used if analytic gradients are available. See argument <code>method</code> in <a href="numDeriv.html#topic+grad">grad</a> for more details.
</p>
</li>
<li> <p><strong><code>numDeriv_settings</code></strong>: List. Additional arguments to the Richardson method used by numDeriv to calculate the Hessian. See argument <code>method.args</code> in <a href="numDeriv.html#topic+grad">grad</a> for more details.
</p>
</li>
<li> <p><strong><code>scaleBeta</code></strong>: Logical. If TRUE (default), parameters are scaled by their own value before calculating the Hessian to increase numerical stability. However, the output is de-scaled, so they are in the same scale as the <code>apollo_beta</code> argument.
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>It calculates the Hessian, variance-covariance, and standard errors at <code>apollo_beta</code> values of an 
estimated model. At least one of the following settings must be provided (ordered by speed of computation): <code>apollo_grad</code>, 
<code>apollo_logLike</code>, or (<code>apollo_probabilities</code> and <code>apollo_inputs</code>). If more than one is provided, 
then the priority is: <code>apollo_grad</code>, <code>apollo_logLike</code>, (<code>apollo_probabilities</code> and <code>apollo_inputs</code>).
</p>


<h3>Value</h3>

<p>List with the following elements
</p>

<ul>
<li> <p><strong><code>apollo_beta</code></strong>: Named numerical vector. Parameter estimates (<code>model$estimate</code>, not scaled).
</p>
</li>
<li> <p><strong><code>corrmat</code></strong>: Numerical matrix. Correlation between parameter estimates.
</p>
</li>
<li> <p><strong><code>hessian</code></strong>: Numerical matrix. Hessian of the model at parameter estimates (<code>model$estimate</code>).
</p>
</li>
<li> <p><strong><code>hessianScaling</code></strong>: Named numeric vector. Scales used on the paramaters to calculate the Hessian (non-fixed only).
</p>
</li>
<li> <p><strong><code>methodsAttempted</code></strong>: Character vector. Name of methods attempted to calculate the Hessian.
</p>
</li>
<li> <p><strong><code>methodUsed</code></strong>: Character. Name of method used to calculate the Hessian.
</p>
</li>
<li> <p><strong><code>robcorrmat</code></strong>: Numerical matrix. Robust correlation between parameter estimates.
</p>
</li>
<li> <p><strong><code>robse</code></strong>: Named numerical vector. Robust standard errors of parameter estimates.
</p>
</li>
<li> <p><strong><code>robvarcov</code></strong>: Numerical matrix. Robust variance-covariance matrix.
</p>
</li>
<li> <p><strong><code>se</code></strong>: Named numerical vector. Standard errors of parameter estimates.
</p>
</li>
<li> <p><strong><code>varcov</code></strong>: Numerical matrix. Variance-covariance matrix.
</p>
</li></ul>


<hr>
<h2 id='apollo_varList'>Lists variable names and definitions used inside a function</h2><span id='topic+apollo_varList'></span>

<h3>Description</h3>

<p>Returns a list containing the names and definitions of variables in f, <code>apollo_randCoeff</code> and <code>apollo_lcPars</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_varList(f, apollo_inputs)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_varList_+3A_f">f</code></td>
<td>
<p>A function, usually <code>apollo_probabilities</code></p>
</td></tr>
<tr><td><code id="apollo_varList_+3A_apollo_inputs">apollo_inputs</code></td>
<td>
<p>List grouping most common inputs. Created by function <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>It looks for variable definitions inside f, <code>apollo_randCoeff</code>, and <code>apollo_lcPars</code>. It returns 
them in a list.
</p>


<h3>Value</h3>

<p>A list of expressions containing all definitions in f, <code>apollo_randCoeff</code> and <code>apollo_probabilities</code>
</p>

<hr>
<h2 id='apollo_weighting'>Applies weights</h2><span id='topic+apollo_weighting'></span>

<h3>Description</h3>

<p>Applies weights to individual observations in likelihood function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_weighting(P, apollo_inputs, functionality)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_weighting_+3A_p">P</code></td>
<td>
<p>List of vectors, matrices or 3-dim arrays. Likelihood of the model components.</p>
</td></tr>
<tr><td><code id="apollo_weighting_+3A_apollo_inputs">apollo_inputs</code></td>
<td>
<p>List grouping most common inputs. Created by function <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
<tr><td><code id="apollo_weighting_+3A_functionality">functionality</code></td>
<td>
<p>Character. Setting instructing Apollo what processing to apply to the likelihood function. This is in general controlled by the functions that call <code>apollo_probabilities</code>, though the user can also call <code>apollo_probabilities</code> manually with a given functionality for testing/debugging. Possible values are:
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: For further processing/debugging, produces likelihood for each model component (if multiple components are present), at the level of individual draws and observations.
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: For conditionals, produces likelihood of the full model, at the level of individual inter-individual draws.
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: For model estimation, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: For model estimation, produces analytical gradients of the likelihood, where possible.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Prepares output for post-estimation reporting.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: For model prediction, produces probabilities for individual alternatives and individual model components (if multiple components are present) at the level of an observation, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Prepares likelihood functions for use in estimation.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: For debugging, produces probabilities of all alternatives and individual model components at the level of an observation, at the level of individual draws.
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: Prepares output summarising model and choiceset structure.
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: Produces overall model likelihood with constants only.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Validates model specification, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: Produces overall model likelihood with all parameters at zero.
</p>
</li></ul>
</td></tr>
</table>


<h3>Value</h3>

<p>The likelihood (i.e. probability in the case of choice models) of the model in the appropriate form for the 
given functionality, multiplied by individual-specific weights.
</p>

<hr>
<h2 id='apollo_writeF12'>Writes an F12 file</h2><span id='topic+apollo_writeF12'></span>

<h3>Description</h3>

<p>Writes an F12 file (ALogit format) with the results of a model estimation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_writeF12(model, truncateCoeffNames = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_writeF12_+3A_model">model</code></td>
<td>
<p>Model object. Estimated model object as returned by function <a href="#topic+apollo_estimate">apollo_estimate</a>.</p>
</td></tr>
<tr><td><code id="apollo_writeF12_+3A_truncatecoeffnames">truncateCoeffNames</code></td>
<td>
<p>Boolean. TRUE to truncate parameter names to 10 characters.
TRUE by default.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Nothing.
</p>

<hr>
<h2 id='apollo_writeTheta'>Writes the vector [beta,ll] to a file called <code>modelname_iterations.csv</code></h2><span id='topic+apollo_writeTheta'></span>

<h3>Description</h3>

<p>Writes the vector [beta,ll] to a file called <code>modelname_iterations.csv</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apollo_writeTheta(
  beta,
  ll,
  modelName,
  scaling = NULL,
  outDir = NULL,
  apollo_beta = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apollo_writeTheta_+3A_beta">beta</code></td>
<td>
<p>vector of parameters to be written (including fixed ones).</p>
</td></tr>
<tr><td><code id="apollo_writeTheta_+3A_ll">ll</code></td>
<td>
<p>scalar representing the log-likelihood of the whole model.</p>
</td></tr>
<tr><td><code id="apollo_writeTheta_+3A_modelname">modelName</code></td>
<td>
<p>Character. Name of the model.</p>
</td></tr>
<tr><td><code id="apollo_writeTheta_+3A_scaling">scaling</code></td>
<td>
<p>Numeric vector of scales applied to beta</p>
</td></tr>
<tr><td><code id="apollo_writeTheta_+3A_outdir">outDir</code></td>
<td>
<p>Scalar character. Name of output directory</p>
</td></tr>
<tr><td><code id="apollo_writeTheta_+3A_apollo_beta">apollo_beta</code></td>
<td>
<p>Named numeric vector of starting values.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Nothing.
</p>

<hr>
<h2 id='aux_validateRows'>Validates and expands rows if necessary.</h2><span id='topic+aux_validateRows'></span>

<h3>Description</h3>

<p>Validates and expands rows if necessary.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>aux_validateRows(rows, componentName = NULL, apollo_inputs = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="aux_validateRows_+3A_rows">rows</code></td>
<td>
<p>Boolean vector. Consideration of which rows to include. Length equal to the number of observations (nObs), with entries equal to TRUE for rows to include, and FALSE for rows to exclude. Default is <code>"all"</code>, equivalent to <code>rep(TRUE, nObs)</code>. Set to <code>"all"</code> by default if omitted.</p>
</td></tr>
<tr><td><code id="aux_validateRows_+3A_componentname">componentName</code></td>
<td>
<p>Character. Name given to model component. If not provided by the user, Apollo will set the name automatically according to the element in <code>P</code> to which the function output is directed.</p>
</td></tr>
<tr><td><code id="aux_validateRows_+3A_apollo_inputs">apollo_inputs</code></td>
<td>
<p>List grouping most common inputs. Created by function <a href="#topic+apollo_validateInputs">apollo_validateInputs</a>.</p>
</td></tr>
</table>

<hr>
<h2 id='print.apollo'>Prints brief summary of Apollo model</h2><span id='topic+print.apollo'></span>

<h3>Description</h3>

<p>Receives an estimated model object and prints a brief summary using the generic print function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'apollo'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.apollo_+3A_x">x</code></td>
<td>
<p>Model object. Estimated model object as returned by function <a href="#topic+apollo_estimate">apollo_estimate</a>.</p>
</td></tr>
<tr><td><code id="print.apollo_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>nothing.
</p>

<hr>
<h2 id='summary.apollo'>Prints summary of Apollo model</h2><span id='topic+summary.apollo'></span>

<h3>Description</h3>

<p>Receives an estimated model object and prints a summary using the generic summary function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'apollo'
summary(object, ..., pTwoSided = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.apollo_+3A_object">object</code></td>
<td>
<p>Model object. Estimated model object as returned by function <a href="#topic+apollo_estimate">apollo_estimate</a>.</p>
</td></tr>
<tr><td><code id="summary.apollo_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
<tr><td><code id="summary.apollo_+3A_ptwosided">pTwoSided</code></td>
<td>
<p>Logical. Should two-sided p-values be printed instead of one-sided p-values. FALSE by default.
#' @return nothing.</p>
</td></tr>
</table>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
