<!DOCTYPE html><html><head><title>Help for package factReg</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<script type="text/javascript" src="mathjax-config.js"></script>
<script type="text/javascript" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {factReg}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#factReg-package'><p>factReg: Multi-Environment Genomic Prediction with Penalized Factorial Regression</p></a></li>
<li><a href='#drops_GE'><p>DROPS data sets</p></a></li>
<li><a href='#GnE'><p>Penalized factorial regression using glmnet</p></a></li>
<li><a href='#perGeno'><p>Genomic prediction using glmnet, with a genotype-specific penalized</p>
regression model.</a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Multi-Environment Genomic Prediction with Penalized Factorial
Regression</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.0</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-07-05</td>
</tr>
<tr>
<td>Description:</td>
<td>Multi-environment genomic prediction for training and test 
    environments using penalized factorial regression. Predictions are made 
    using genotype-specific environmental sensitivities as in Millet et al. 
    (2019) &lt;<a href="https://doi.org/10.1038%2Fs41588-019-0414-y">doi:10.1038/s41588-019-0414-y</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.6)</td>
</tr>
<tr>
<td>Imports:</td>
<td>glmnet, mathjaxr, Matrix, rrBLUP, stats</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>LazyDataCompression:</td>
<td>gzip</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>RdMacros:</td>
<td>mathjaxr</td>
</tr>
<tr>
<td>Suggests:</td>
<td>tinytest</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-07-06 13:25:37 UTC; rossu027</td>
</tr>
<tr>
<td>Author:</td>
<td>Kruijer Willem <a href="https://orcid.org/0000-0001-7179-1733"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Bart-Jan van Rossum
    <a href="https://orcid.org/0000-0002-8673-2514"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut, cre],
  Vahe Avagyan <a href="https://orcid.org/0000-0001-5838-4850"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Bart-Jan van Rossum &lt;bart-jan.vanrossum@wur.nl&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-07-07 09:10:04 UTC</td>
</tr>
</table>
<hr>
<h2 id='factReg-package'>factReg: Multi-Environment Genomic Prediction with Penalized Factorial Regression</h2><span id='topic+factReg'></span><span id='topic+factReg-package'></span>

<h3>Description</h3>

<p>Multi-environment genomic prediction for training and test environments using penalized factorial regression. Predictions are made using genotype-specific environmental sensitivities as in Millet et al. (2019) <a href="https://doi.org/10.1038/s41588-019-0414-y">doi:10.1038/s41588-019-0414-y</a>.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Bart-Jan van Rossum <a href="mailto:bart-jan.vanrossum@wur.nl">bart-jan.vanrossum@wur.nl</a> (<a href="https://orcid.org/0000-0002-8673-2514">ORCID</a>)
</p>
<p>Authors:
</p>

<ul>
<li><p> Kruijer Willem (<a href="https://orcid.org/0000-0001-7179-1733">ORCID</a>)
</p>
</li></ul>

<p>Other contributors:
</p>

<ul>
<li><p> Vahe Avagyan (<a href="https://orcid.org/0000-0001-5838-4850">ORCID</a>) [contributor]
</p>
</li></ul>


<hr>
<h2 id='drops_GE'>DROPS data sets</h2><span id='topic+drops_GE'></span><span id='topic+drops_GnE'></span><span id='topic+drops_nGnE'></span><span id='topic+drops_K'></span>

<h3>Description</h3>

<p>These datasets come from the European Union project DROPS (DROught-tolerant
yielding PlantS). A panel of 256 maize hybrids was grown with two water
regimes (irrigated or rainfed), in seven fields in 2012 and 2013,
respectively, spread along a climatic transect from western to eastern
Europe, plus one site in Chile in 2013. This resulted in 28 experiments
defined as the combination of one year, one site and one water regime, with
two and three repetitions for rainfed and irrigated treatments, respectively.
A detailed environmental characterisation was carried out, with hourly
records of micrometeorological data and soil water status, and associated
with precise measurement of phenology. Grain yield and its components were
measured at the end of the experiment.<br />
The data sets contain the genotypic BLUEs for eight traits for 246 genotypes
in 37 environments. Additionally information on 11 environmental indices
is included. The environments are split in three data sets for training
(<code>drops_GE</code>) and testing (<code>drops_GnE</code>, <code>drops_nGnE</code>)
purposes. <code>drops_K</code> contains the kinship matrix for the 246 genotypes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>drops_GE

drops_GnE

drops_nGnE

drops_K
</code></pre>


<h3>Format</h3>

<p>data.frames with 24 variables.
</p>

<dl>
<dt>Experiment</dt><dd><p>experiments ID described by the three first letters of the
city’s name followed by the year of experiment and the water regime with W
for watered and R for rain-fed.</p>
</dd>
<dt>Code_ID, Variety_ID, Accession_ID</dt><dd><p>identifier of the genotype</p>
</dd>
<dt>grain.yield</dt><dd><p>genotypic mean for yield adjusted at 15\
in ton per hectare (t ha^-1)</p>
</dd>
<dt>grain.number</dt><dd><p>genotypic mean for number of grain per square meter</p>
</dd>
<dt>grain.weight</dt><dd><p>genotypic mean for individual grain weight in milligram
(mg)</p>
</dd>
<dt>anthesis</dt><dd><p>genotypic mean for male flowering (pollen shed), in thermal
time cumulated since emergence (d_20°C)</p>
</dd>
<dt>silking</dt><dd><p>genotypic mean for female flowering (silking emergence), in
thermal time cumulated since emergence (d_20°C)</p>
</dd>
<dt>plant.height</dt><dd><p>genotypic mean for plant height, from ground level to
the base of the flag leaf (highest) leaf in centimeter (cm)</p>
</dd>
<dt>tassel.height</dt><dd><p>genotypic mean for plant height including tassel, from
ground level to the highest point of the tassel in centimeter (cm)</p>
</dd>
<dt>ear.height</dt><dd><p>genotypic mean for ear insertion height, from ground level
to ligule of the highest ear leaf in centimeter (cm)</p>
</dd>
<dt><code>Tnight.Early</code></dt><dd><p>night temperature averaged between the floral
transition and the silk initiation</p>
</dd>
<dt><code>Tnight.Flo</code></dt><dd><p>night temperature averaged between the silk
initiation and the end of grain abortion</p>
</dd>
<dt><code>Tnight.Fill</code></dt><dd><p>night temperature averaged between the end of
grain abortion and the physiological maturity of the grain</p>
</dd>
<dt><code>Ri.Early</code></dt><dd><p>intercepted radiation cumulated between the floral
transition and the silk initiation</p>
</dd>
<dt><code>Ri.Flo</code></dt><dd><p>intercepted radiation cumulated between the silk
initiation and the end of grain abortion</p>
</dd>
<dt><code>Ri.Fill</code></dt><dd><p>intercepted radiation cumulated between the end of
grain abortion and the physiological maturity of the grain</p>
</dd>
<dt><code>Psi.Flo</code></dt><dd><p>soil water potential averaged between the silk
initiation and the end of grain abortion. The soil water potential used
here was the median between 30 and 60cm depth.</p>
</dd>
<dt><code>Psi.Fill</code></dt><dd><p>soil water potential averaged between the end of
grain abortion and the physiological maturity of the grain</p>
</dd>
<dt><code>Tmax.Early</code></dt><dd><p>maximum temperature averaged between the floral
transition and the silk initiation</p>
</dd>
<dt><code>Tmax.Flo</code></dt><dd><p>maximum temperature averaged between the silk
initiation and the end of grain abortion</p>
</dd>
<dt><code>Tmax.Fill</code></dt><dd><p>maximum temperature averaged between the end
of grain abortion and the physiological maturity of the grain</p>
</dd>
<dt><code>type</code></dt><dd><p>code corresponding to the data set. GE for drops_GE,
GnE for drops_GnE and nGnE for drops_nGnE.</p>
</dd>
</dl>

<p>An object of class <code>data.frame</code> with 384 rows and 24 columns.
</p>
<p>An object of class <code>data.frame</code> with 224 rows and 24 columns.
</p>
<p>An object of class <code>matrix</code> (inherits from <code>array</code>) with 302 rows and 302 columns.
</p>


<h3>Source</h3>

<p><a href="https://doi.org/10.15454/IASSTN">doi:10.15454/IASSTN</a>
</p>


<h3>References</h3>

<p>Millet, E. J., Pommier, C., et al. (2019). A multi-site
experiment in a network of European fields for assessing the maize yield
response to environmental scenarios (Data set).
<a href="https://doi.org/10.15454/IASSTN">doi:10.15454/IASSTN</a>
</p>

<hr>
<h2 id='GnE'>Penalized factorial regression using glmnet</h2><span id='topic+GnE'></span>

<h3>Description</h3>

<script id="MathJax-script" async src="../../mathjaxr/doc/mathjax/es5/tex-chtml-full.js"></script>
<p>Based on multi-environment field trials, fits the factorial regression model
\(Y_{ij} = \mu + e_j + g_i + \sum_{k=1}^s \beta_{ik} x_{ij} +
\epsilon_{ij},\) with environmental main effects \(e_j\),
genotypic main effects \(g_{i}\) and genotype-specific
environmental sensitivities \(\beta_{ik}\). See e.g. Millet
et al 2019 and Bustos-Korts et al 2019. There are \(s\)
environmental indices with values \(x_{ij}\). Optionally,
predictions can be made for a set of test environments, for which
environmental indices are available. The new environments must contain the
same set of genotypes, or a subset.
</p>
<p>Penalization: the model above is fitted using glmnet, simultaneously
penalizing \(e_j\), \(g_i\) and
\(\beta_{ik}\). If <code>penG = 0</code> and <code>penE = 0</code>, the main
effects \(g_i\) and \(e_j\) are not penalized. If these
parameters are 1, the the main effects are penalized to the same degree as
the sensitivities. Any non negative values are allowed. Cross validation is
performed with each fold containing a number of environments (details below).
</p>
<p>After fitting the model, it is possible to replace the estimated
genotypic main effects and sensitivities by
their predicted genetic values. Specifically, if a kinship matrix <code>K</code>
is assigned the function performs genomic prediction with g-BLUP for the
genotypic main effect and each of the sensitivities in turn.
</p>
<p>Predictions for the test environments are first constructed using the
estimated genotypic main effects and sensitivities; next, predicted
environmental main effects are added. The latter are obtained by
regressing the estimated environmental main effects for the training
environments on the average values of the indices in these environments,
as in Millet et al. 2019.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>GnE(
  dat,
  Y,
  G,
  E,
  K = NULL,
  indices = NULL,
  indicesData = NULL,
  testEnv = NULL,
  weight = NULL,
  outputFile = NULL,
  corType = c("pearson", "spearman"),
  partition = data.frame(),
  nfolds = 10,
  alpha = 1,
  lambda = NULL,
  penG = 0,
  penE = 0,
  scaling = c("train", "all", "no"),
  quadratic = FALSE,
  verbose = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="GnE_+3A_dat">dat</code></td>
<td>
<p>A <code>data.frame</code> with data from multi-environment trials.
Each row corresponds to a particular genotype in a particular environment.
The data do not need to be balanced, i.e. an environment does not need to
contain all genotypes. <code>dat</code> should contain the training as well as the
test environments (see testEnv)</p>
</td></tr>
<tr><td><code id="GnE_+3A_y">Y</code></td>
<td>
<p>The trait to be analyzed: either of type character, in which case
it should be one of the column names in <code>dat</code>, or numeric, in which
case the Yth column of <code>dat</code> will be analyzed.</p>
</td></tr>
<tr><td><code id="GnE_+3A_g">G</code></td>
<td>
<p>The column in <code>dat</code> containing the factor genotype (either
character or numeric).</p>
</td></tr>
<tr><td><code id="GnE_+3A_e">E</code></td>
<td>
<p>The column in <code>dat</code> containing the factor environment
(either character or numeric).</p>
</td></tr>
<tr><td><code id="GnE_+3A_k">K</code></td>
<td>
<p>A kinship matrix. Used for replacing the estimated genotypic main
effect and each of the sensitivities by genomic prediction from a g-BLUP
model for each of them. If <code>NULL</code>, the estimated effects from the model
are returned and used for constructing predictions.</p>
</td></tr>
<tr><td><code id="GnE_+3A_indices">indices</code></td>
<td>
<p>The columns in <code>dat</code> containing the environmental
indices (vector of type character). Alternatively, if the indices are always
constant within environments (i.e. not genotype dependent), the
environmental data can also be provided using the argument <code>indicesData</code>
(see below).</p>
</td></tr>
<tr><td><code id="GnE_+3A_indicesdata">indicesData</code></td>
<td>
<p>An optional <code>data.frame</code> containing environmental
indices (covariates); one value for each environment and index. It should
have the environment names as row names (corresponding to the names
contained in <code>dat$E</code>); the column names are the indices. If
<code>indices</code> (see before) is also provided, the latter will be ignored.</p>
</td></tr>
<tr><td><code id="GnE_+3A_testenv">testEnv</code></td>
<td>
<p>vector (character). Data from these environments are not used
for fitting the model. Accuracy is evaluated for training and test
environments separately. The default is <code>NULL</code>, i.e. no test
environments, in which case the whole data set is training. It is also
possible that there are test environments, but without any data; in this
case, no accuracy is reported for test environments (CHECK correctness).</p>
</td></tr>
<tr><td><code id="GnE_+3A_weight">weight</code></td>
<td>
<p>Numeric vector of length <code>nrow(dat)</code>, specifying the
weight (inverse variance) of each observation, used in glmnet. Default
<code>NULL</code>, giving constant weights.</p>
</td></tr>
<tr><td><code id="GnE_+3A_outputfile">outputFile</code></td>
<td>
<p>The file name of the output files, without .csv extension
which is added by the function. If not <code>NULL</code> the prediction accuracies
for training and test environments are written to separate files. If
<code>NULL</code> the output is not written to file.</p>
</td></tr>
<tr><td><code id="GnE_+3A_cortype">corType</code></td>
<td>
<p>type of correlation: Pearson (default) or Spearman rank sum.</p>
</td></tr>
<tr><td><code id="GnE_+3A_partition">partition</code></td>
<td>
<p><code>data.frame</code> with columns E and partition. The column
E should contain the training environments (type character); partition
should be of type integer. Environments in the same fold should have
the same integer value. Default is <code>data.frame()</code>, in which case the
function uses a leave-one-environment out cross-validation. If <code>NULL</code>,
the (inner) training sets used for cross-validation will be drawn randomly
from all observations, ignoring the environment structure. In the latter
case, the number of folds (nfolds) can be specified.</p>
</td></tr>
<tr><td><code id="GnE_+3A_nfolds">nfolds</code></td>
<td>
<p>Default <code>NULL</code>. If <code>partition == NULL</code>, this can be
used to specify the number of folds to be used in glmnet.</p>
</td></tr>
<tr><td><code id="GnE_+3A_alpha">alpha</code></td>
<td>
<p>Type of penalty, as in glmnet (1 = LASSO, 0 = ridge; in between
= elastic net). Default is 1.</p>
</td></tr>
<tr><td><code id="GnE_+3A_lambda">lambda</code></td>
<td>
<p>Numeric vector; defines the grid over which the penalty lambda
is optimized in cross validation. Default: NULL (defined by glmnet).
Important special case: lambda = 0 (no penalty).</p>
</td></tr>
<tr><td><code id="GnE_+3A_peng">penG</code></td>
<td>
<p>numeric; default 0. If 1, genotypic main effects are
penalized. If 0, they are not. Any non negative real number is allowed.</p>
</td></tr>
<tr><td><code id="GnE_+3A_pene">penE</code></td>
<td>
<p>numeric; default 0. If 1, environmental main effects are
penalized. If 0, they are not. Any non negative real number is allowed.</p>
</td></tr>
<tr><td><code id="GnE_+3A_scaling">scaling</code></td>
<td>
<p>determines how the environmental variables are scaled.
&quot;train&quot; : all data (test and training environments) are scaled
using the mean and and standard deviation in the training environments.
&quot;all&quot; : using the mean and standard deviation of all environments.
&quot;no&quot; : No scaling.</p>
</td></tr>
<tr><td><code id="GnE_+3A_quadratic">quadratic</code></td>
<td>
<p>boolean; default <code>FALSE</code>. If <code>TRUE</code>, quadratic
terms (i.e., squared indices) are added to the model.</p>
</td></tr>
<tr><td><code id="GnE_+3A_verbose">verbose</code></td>
<td>
<p>boolean; default <code>FALSE</code>. If <code>TRUE</code>, the accuracies
per environment are printed on screen.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with the following elements:
</p>

<dl>
<dt>predTrain</dt><dd><p>A data.frame with predictions for the training set</p>
</dd>
<dt>predTest</dt><dd><p>A data.frame with predictions for the test set</p>
</dd>
<dt>resTrain</dt><dd><p>A data.frame with residuals for the training set</p>
</dd>
<dt>resTest</dt><dd><p>A data.frame with residuals for the test set</p>
</dd>
<dt>mu</dt><dd><p>the estimated overall mean</p>
</dd>
<dt>envInfoTrain</dt><dd><p>The estimated environmental main effects, and the
predicted effects, obtained when the former are regressed on the averaged
indices, using penalized regression</p>
</dd>
<dt>envInfoTest</dt><dd><p>The predicted environmental main effects for the test
environments, obtained from penalized regression using the estimated
main effects for the training environments and the averaged indices</p>
</dd>
<dt>parGeno</dt><dd><p>data.frame containing the estimated genotypic main effects
(first column) and sensitivities (subsequent columns)</p>
</dd>
<dt>trainAccuracyEnv</dt><dd><p>a data.frame with the accuracy (r) for each
training environment, as well as the root mean square error (RMSE), mean
absolute deviation (MAD) and rank (the latter is a proportion: how many
of the best 5 genotypes are in the top 10). To be removed or further
developed. All these quantities are also evaluated for a model with only
genotypic and environmental main effects (columns rMain, RMSEMain and
rankMain)</p>
</dd>
<dt>testAccuracyEnv</dt><dd><p>A data.frame with the accuracy for each test
environment, with the same columns as trainAccuracyEnv</p>
</dd>
<dt>trainAccuracyGeno</dt><dd><p>a data.frame with the accuracy (r) for each
genotype, averaged over the training environments</p>
</dd>
<dt>testAccuracyGeno</dt><dd><p>a data.frame with the accuracy (r) for each
genotype, averaged over the test environments</p>
</dd>
<dt>lambda</dt><dd><p>The value of lambda selected using cross validation</p>
</dd>
<dt>lambdaSequence</dt><dd><p>The values of lambda used in the fits of glmnet. If
<code>lambda</code> was provided as input, the value of <code>lambda</code> is
returned</p>
</dd>
<dt>RMSEtrain</dt><dd><p>The root mean squared error on the training environments</p>
</dd>
<dt>RMSEtest</dt><dd><p>The root mean squared error on the test environments</p>
</dd>
<dt>Y</dt><dd><p>The name of the trait that was predicted, i.e. the column name
in <code>dat</code> that was used</p>
</dd>
<dt>G</dt><dd><p>The genotype label that was used, i.e. the argument G that was
used</p>
</dd>
<dt>E</dt><dd><p>The environment label that was used, i.e. the argument E that
was used</p>
</dd>
<dt>indices</dt><dd><p>The indices that were used, i.e. the argument indices that
was used</p>
</dd>
<dt>quadratic</dt><dd><p>The quadratic option that was used</p>
</dd>
</dl>



<h3>References</h3>

<p>Millet, E.J., Kruijer, W., Coupel-Ledru, A. et al. Genomic
prediction of maize yield across European environmental conditions. Nat
Genet 51, 952–956 (2019). <a href="https://doi.org/10.1038/s41588-019-0414-y">doi:10.1038/s41588-019-0414-y</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## load the data, which are contained in the package
data(drops_GE)
data(drops_GnE)

## We remove identifiers that we don't need.
drops_GE_GnE &lt;- rbind(drops_GE[, -c(2, 4)], drops_GnE[, -c(2, 4)])

## Define indeces.
ind &lt;- colnames(drops_GE)[13:23]

## Define test environments.
testenv &lt;- levels(drops_GnE$Experiment)

## Additive model, only main effects (set the penalty parameter to a large value).
Additive_model &lt;- GnE(drops_GE_GnE, Y = "grain.yield", lambda = 100000,
                      G = "Variety_ID", E = "Experiment", testEnv = testenv,
                      indices = ind, penG = FALSE, penE = FALSE,
                      alpha = 0.5, scaling = "train")

## Full model, no penalization (set the penalty parameter to zero).
Full_model &lt;- GnE(drops_GE_GnE, Y = "grain.yield", lambda = 0,
                  G = "Variety_ID", E = "Experiment", testEnv = testenv,
                  indices = ind, penG = FALSE, penE = FALSE,
                  alpha = 0.5, scaling = "train")

## Elastic Net model, set alpha parameter to 0.5.
Elnet_model &lt;- GnE(drops_GE_GnE, Y = "grain.yield", lambda = NULL,
                   G = "Variety_ID", E = "Experiment", testEnv = testenv,
                   indices = ind, penG = FALSE, penE = FALSE,
                   alpha = 0.5, scaling = "train")

## Lasso model, set alpha parameter to 1.
Lasso_model &lt;- GnE(drops_GE_GnE, Y = "grain.yield", lambda = NULL,
                   G = "Variety_ID", E = "Experiment", testEnv = testenv,
                   indices = ind, penG = FALSE, penE = FALSE,
                   alpha = 1, scaling = "train")

## Ridge model, set alpha parameter to 0.
Ridge_model &lt;- GnE(drops_GE_GnE, Y = "grain.yield", lambda = NULL,
                   G = "Variety_ID", E = "Experiment", testEnv = testenv,
                   indices = ind, penG = FALSE, penE = FALSE,
                   alpha = 0, scaling = "train")


</code></pre>

<hr>
<h2 id='perGeno'>Genomic prediction using glmnet, with a genotype-specific penalized
regression model.</h2><span id='topic+perGeno'></span>

<h3>Description</h3>

<script id="MathJax-script" async src="../../mathjaxr/doc/mathjax/es5/tex-chtml-full.js"></script>
<p>.... These models can be fitted either for the original
data, or on the residuals of a model with only main effects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>perGeno(
  dat,
  Y,
  G,
  E,
  indices = NULL,
  indicesData = NULL,
  testEnv = NULL,
  weight = NULL,
  useRes = TRUE,
  outputFile = NULL,
  corType = c("pearson", "spearman"),
  partition = data.frame(),
  nfolds = 10,
  alpha = 1,
  scaling = c("train", "all", "no"),
  quadratic = FALSE,
  verbose = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="perGeno_+3A_dat">dat</code></td>
<td>
<p>A <code>data.frame</code> with data from multi-environment trials.
Each row corresponds to a particular genotype in a particular environment.
The data do not need to be balanced, i.e. an environment does not need to
contain all genotypes. <code>dat</code> should contain the training as well as the
test environments (see testEnv)</p>
</td></tr>
<tr><td><code id="perGeno_+3A_y">Y</code></td>
<td>
<p>The trait to be analyzed: either of type character, in which case
it should be one of the column names in <code>dat</code>, or numeric, in which
case the Yth column of <code>dat</code> will be analyzed.</p>
</td></tr>
<tr><td><code id="perGeno_+3A_g">G</code></td>
<td>
<p>The column in <code>dat</code> containing the factor genotype (either
character or numeric).</p>
</td></tr>
<tr><td><code id="perGeno_+3A_e">E</code></td>
<td>
<p>The column in <code>dat</code> containing the factor environment
(either character or numeric).</p>
</td></tr>
<tr><td><code id="perGeno_+3A_indices">indices</code></td>
<td>
<p>The columns in <code>dat</code> containing the environmental
indices (vector of type character). Alternatively, if the indices are always
constant within environments (i.e. not genotype dependent), the
environmental data can also be provided using the argument <code>indicesData</code>
(see below).</p>
</td></tr>
<tr><td><code id="perGeno_+3A_indicesdata">indicesData</code></td>
<td>
<p>An optional <code>data.frame</code> containing environmental
indices (covariates); one value for each environment and index. It should
have the environment names as row names (corresponding to the names
contained in <code>dat$E</code>); the column names are the indices. If
<code>indices</code> (see before) is also provided, the latter will be ignored.</p>
</td></tr>
<tr><td><code id="perGeno_+3A_testenv">testEnv</code></td>
<td>
<p>vector (character). Data from these environments are not used
for fitting the model. Accuracy is evaluated for training and test
environments separately. The default is <code>NULL</code>, i.e. no test
environments, in which case the whole data set is training. It is also
possible that there are test environments, but without any data; in this
case, no accuracy is reported for test environments (CHECK correctness).</p>
</td></tr>
<tr><td><code id="perGeno_+3A_weight">weight</code></td>
<td>
<p>Numeric vector of length <code>nrow(dat)</code>, specifying the
weight (inverse variance) of each observation, used in glmnet. Default
<code>NULL</code>, giving constant weights.</p>
</td></tr>
<tr><td><code id="perGeno_+3A_useres">useRes</code></td>
<td>
<p>Indicates whether the genotype-specific regressions are to be
fitted on the residuals of a model with main effects. If <code>TRUE</code>
residuals of a model with environmental main effects are used, if
<code>FALSE</code> the regressions are fitted on the original data.</p>
</td></tr>
<tr><td><code id="perGeno_+3A_outputfile">outputFile</code></td>
<td>
<p>The file name of the output files, without .csv extension
which is added by the function. If not <code>NULL</code> the prediction accuracies
for training and test environments are written to separate files. If
<code>NULL</code> the output is not written to file.</p>
</td></tr>
<tr><td><code id="perGeno_+3A_cortype">corType</code></td>
<td>
<p>type of correlation: Pearson (default) or Spearman rank sum.</p>
</td></tr>
<tr><td><code id="perGeno_+3A_partition">partition</code></td>
<td>
<p><code>data.frame</code> with columns E and partition. The column
E should contain the training environments (type character); partition
should be of type integer. Environments in the same fold should have
the same integer value. Default is <code>data.frame()</code>, in which case the
function uses a leave-one-environment out cross-validation. If <code>NULL</code>,
the (inner) training sets used for cross-validation will be drawn randomly
from all observations, ignoring the environment structure. In the latter
case, the number of folds (nfolds) can be specified.</p>
</td></tr>
<tr><td><code id="perGeno_+3A_nfolds">nfolds</code></td>
<td>
<p>Default <code>NULL</code>. If <code>partition == NULL</code>, this can be
used to specify the number of folds to be used in glmnet.</p>
</td></tr>
<tr><td><code id="perGeno_+3A_alpha">alpha</code></td>
<td>
<p>Type of penalty, as in glmnet (1 = LASSO, 0 = ridge; in between
= elastic net). Default is 1.</p>
</td></tr>
<tr><td><code id="perGeno_+3A_scaling">scaling</code></td>
<td>
<p>determines how the environmental variables are scaled.
&quot;train&quot; : all data (test and training environments) are scaled
using the mean and and standard deviation in the training environments.
&quot;all&quot; : using the mean and standard deviation of all environments.
&quot;no&quot; : No scaling.</p>
</td></tr>
<tr><td><code id="perGeno_+3A_quadratic">quadratic</code></td>
<td>
<p>boolean; default <code>FALSE</code>. If <code>TRUE</code>, quadratic
terms (i.e., squared indices) are added to the model.</p>
</td></tr>
<tr><td><code id="perGeno_+3A_verbose">verbose</code></td>
<td>
<p>boolean; default <code>FALSE</code>. If <code>TRUE</code>, the accuracies
per environment are printed on screen.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with the following elements:
</p>

<dl>
<dt>predTrain</dt><dd><p>Vector with predictions for the training set (to do: Add
the factors genotype and environment; make a data.frame)</p>
</dd>
<dt>predTest</dt><dd><p>Vector with predictions for the test set (to do: Add the
factors genotype and environment; make a data.frame). To do: add estimated
environmental main effects, not only predicted environmental main effects</p>
</dd>
<dt>mu</dt><dd><p>the estimated overall (grand) mean</p>
</dd>
<dt>envInfoTrain</dt><dd><p>The estimated environmental main effects, and the
predicted effects, obtained when the former are regressed on the averaged
indices, using penalized regression.</p>
</dd>
<dt>envInfoTest</dt><dd><p>The predicted environmental main effects for the test
environments, obtained from penalized regression using the estimated
main effects for the training environments and the averaged indices.</p>
</dd>
<dt>parGeno</dt><dd><p>data.frame containing the estimated genotypic
main effects (first column) and sensitivities (subsequent columns)</p>
</dd>
<dt>testAccuracyEnv</dt><dd><p>a <code>data.frame</code> with the accuracy (r) for each
test environment</p>
</dd>
<dt>trainAccuracyEnv</dt><dd><p>a <code>data.frame</code> with the accuracy (r) for each
training environment</p>
</dd>
<dt>trainAccuracyGeno</dt><dd><p>a <code>data.frame</code> with the accuracy (r) for
each genotype, averaged over the training environments</p>
</dd>
<dt>testAccuracyGeno</dt><dd><p>a <code>data.frame</code> with the accuracy (r) for
each genotype, averaged over the test environments</p>
</dd>
<dt>RMSEtrain</dt><dd><p>The root mean squared error on the training environments</p>
</dd>
<dt>RMSEtest</dt><dd><p>The root mean squared error on the test environments</p>
</dd>
<dt>Y</dt><dd><p>The name of the trait that was predicted, i.e. the column name
in dat that was used</p>
</dd>
<dt>G</dt><dd><p>The genotype label that was used, i.e. the argument G that was
used</p>
</dd>
<dt>E</dt><dd><p>The environment label that was used, i.e. the argument E that was
used</p>
</dd>
<dt>indices</dt><dd><p>The indices that were used, i.e. the argument indices that
was used</p>
</dd>
<dt>lambdaOpt</dt><dd></dd>
<dt>pargeno</dt><dd></dd>
<dt>quadratic</dt><dd><p>The quadratic option that was used</p>
</dd>
</dl>


</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
