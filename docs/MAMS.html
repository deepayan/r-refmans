<!DOCTYPE html><html><head><title>Help for package MAMS</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {MAMS}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#MAMS'>
<p>Designing Multi-Arm Multi-Stage Studies</p></a></li>
<li><a href='#mams'>
<p>Function to design multi-arm multi-stage studies with normal endpoints</p></a></li>
<li><a href='#mams.sim'>
<p>Simulating multi-arm multi-stage designs</p></a></li>
<li><a href='#MAMSNews'><p>Shows changes and news</p></a></li>
<li><a href='#new.bounds'>
<p>Function to update boundaries based on observed sample sizes</p></a></li>
<li><a href='#ordinal.mams'>
<p>Function to design multi-arm multi-stage studies with ordinal or binary endpoints</p></a></li>
<li><a href='#plot'><p>Different generic functions for class MAMS.</p></a></li>
<li><a href='#stepdown.mams'>
<p>Function to find stopping boundaries for a 2- or 3-stage (step-down) multiple-comparisons-with-control test.</p></a></li>
<li><a href='#stepdown.update'>
<p>Update the stopping boundaries of multi-arm multi-stage study at an interim analysis, allowing for unplanned treatment selection and/or sample-size reassessment.</p></a></li>
<li><a href='#tite.mams'>
<p>Function to design multi-arm multi-stage studies with time-to-event endpoints</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Designing Multi-Arm Multi-Stage Studies</td>
</tr>
<tr>
<td>Version:</td>
<td>2.0.2</td>
</tr>
<tr>
<td>Depends:</td>
<td>mvtnorm, methods, future, future.apply</td>
</tr>
<tr>
<td>Imports:</td>
<td>knitr</td>
</tr>
<tr>
<td>Description:</td>
<td>Designing multi-arm multi-stage studies with (asymptotically) normal endpoints and known variance.</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://tjaki.github.io/MAMS/">https://tjaki.github.io/MAMS/</a></td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>mvtnorm</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-04-12 11:02:43 UTC; jack</td>
</tr>
<tr>
<td>Author:</td>
<td>Thomas Jaki <a href="https://orcid.org/0000-0002-1096-188X"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut,
    cre],
  Dominique-Laurent Couturier
    <a href="https://orcid.org/0000-0001-5774-5036"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut],
  Dominic Magirr [aut],
  Nikita Mozgunov <a href="https://orcid.org/0000-0003-0941-718X"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Philip Pallmann [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Thomas Jaki &lt;thomas.jaki@pm.me&gt;</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-04-12 11:40:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='MAMS'>
Designing Multi-Arm Multi-Stage Studies
</h2><span id='topic+MAMS-package'></span><span id='topic+MAMS'></span>

<h3>Description</h3>

<p>This package allows to design multi-arm multi-stage (MAMS)
studies with asymptotically normal endpoints and known variance.
It considers normal, binary, ordinal and time-to-event endpoints 
in which either the single best treatment or all promising treatments 
are continued at the interim analyses. 
</p>


<h3>Details</h3>

<p>Currently implemented functions are:
</p>

<ul>
<li> <p><code><a href="#topic+mams">mams()</a></code>: a function allowing to design multi-arm multi-stage studies with normal endpoints,
</p>
</li>
<li> <p><code><a href="#topic+new.bounds">new.bounds()</a></code>: a function allowing to update the lower and upper boundaries of a multi-arm multi-stage study, typically initally defined by <code><a href="#topic+mams">mams()</a></code>, based on observed sample sizes,
</p>
</li>
<li> <p><code><a href="#topic+mams.sim">mams.sim()</a></code>: a function allowing to simulate multi-arm multi-stage studies given chosen boundaries and sample size, and estimates power and expected sample size,
</p>
</li>
<li> <p><code><a href="#topic+stepdown.mams">stepdown.mams()</a></code>: a function allowing to find stopping boundaries for a 2- or 3-stage (step-down) multiple-comparisons-with-control test,
</p>
</li>
<li> <p><code><a href="#topic+stepdown.update">stepdown.update()</a></code>: a function allowing to update the stopping boundaries of a multi-arm multi-stage study, typically initally defined by <code><a href="#topic+stepdown.mams">stepdown.mams()</a></code>, at an interim analysis as well as allowing for unplanned treatment selection and/or sample-size reassessment,
</p>
</li>
<li> <p><code><a href="#topic+ordinal.mams">ordinal.mams()</a></code>: a function allowing to design multi-arm multi-stage studies with ordinal or binary endpoints,
</p>
</li>
<li> <p><code><a href="#topic+tite.mams">tite.mams()</a></code>: a function allowing to design multi-arm multi-stage studies with time-to-event endpoints.
</p>
</li></ul>

<p>We refer to Jaki et al (2019) for an overview of the package as well as to Magirr et al (2012) and Magirr et al (2014) for theoretical details.
</p>
<p><b>Parallelisation</b>
</p>
<p>Since version 2.0.0, <span class="pkg">MAMS</span> relies on the package <span class="pkg">future.apply</span> for parallel computation. The package <span class="pkg">future.apply</span> is part of the <span class="pkg">future</span> parallelisation framework that requires users to define their parallelisation strategy by means of the function <code><a href="future.html#topic+plan">future::plan()</a></code>. This function takes several options like, for example, <code>sequential</code> (default strategy corresponding to a computation without parallelisation), <code>multicore</code> (using separate forked <span class="pkg">R</span> processes, available to unix/osx users) and <code>multisession</code> (using separate <span class="pkg">R</span> sessions, available to all users). We refer to Bengtsson H. (2022) for an overview of the <span class="pkg">future</span> framework.
</p>
<p>Note that, for the functions of <span class="pkg">MAMS</span> to be available to workers defined by <code><a href="future.html#topic+plan">future::plan()</a></code>, <span class="pkg">MAMS</span> has to be installed at a location available under <code><a href="base.html#topic+.libPaths">.libPaths</a></code> (by default, <span class="pkg">R</span> installs packages in the directory corresponding to the first element of <code><a href="base.html#topic+.libPaths">.libPaths</a></code>).  
</p>
<p><b>Reproducibility</b>
</p>
<p>Results of the <span class="pkg">MAMS</span> package for studies involving more than 2 stages are seed-dependent (as the Gaussian quadrature integration of the multivariate normal distribution relies on probabilities estimated by means of the randomised Quasi-Monte-Carlo procedure of Genz and Bretz in <code><a href="mvtnorm.html#topic+pmvnorm">mvtnorm::pmvnorm()</a></code>).
</p>
<p>Results are reproducible if a seed is set before the evaluation of a function of the <span class="pkg">MAMS</span> package (typically by means of the function <code><a href="base.html#topic+set.seed">set.seed</a></code>).
</p>
<p>When <code>parallel=TRUE</code>, the <span class="pkg">future</span> package assigns independent streams of L'Ecuyer pseudo-random numbers to each parallelised task, allowing results to be reproducible when a seed is set, even when using a different parallelisation strategy and/or a different number of workers. When <code>parallel=FALSE</code>, the random number generation is handled by base <span class="pkg">R</span> directly instead of by the <span class="pkg">future</span> package, so that, if the number of stages is larger than 2, evaluations using the same seed will not lead to the same exact results with <code>parallel=FALSE</code> and <code>parallel=TRUE</code>. 
</p>


<h3>Author(s)</h3>

<p>Thomas Jaki, Dominique-Laurent Couturier, Dominic Magirr and Philip Pallmann
</p>
<p>Maintainer: Thomas Jaki <a href="mailto:thomas.jaki@pm.me">thomas.jaki@pm.me</a>.
</p>


<h3>References</h3>

<p>Jaki T., Pallmann P. and Magirr D. (2019), <em>The R Package MAMS for Designing Multi-Arm Multi-Stage Clinical Trials</em>, <b>Journal of Statistical Software</b>, 88(4), 1-25. Link: <a href="https://doi.org/10.18637/jss.v088.i04">doi:10.18637/jss.v088.i04</a>
</p>
<p>Magirr D., Jaki T. and Whitehead J. (2012), <em>A generalized Dunnett test for multi-arm multi-stage clinical studies with treatment selection</em>, <b>Biometrika</b>, 99(2), 494-501. Link: <a href="https://doi.org/10.1093/biomet/ass002">doi:10.1093/biomet/ass002</a>
</p>
<p>Magirr D., Stallard N. and Jaki T. (2014), <em>Flexible sequential designs for multi-arm clinical trials</em>, <b>Statistics in Medicine</b>, 33(19), 3269-3279. Link: <a href="https://doi.org/10.1002/sim.6183">doi:10.1002/sim.6183</a>
</p>
<p>Bengtsson H. (2022), <em>A Unifying Framework for Parallel and Distributed Processing in R using Futures</em>, to appear in <b>The R Journal</b>. Link: <a href="https://journal.r-project.org/archive/2021/RJ-2021-048/index.html">accepted version</a>
</p>

<hr>
<h2 id='mams'>
Function to design multi-arm multi-stage studies with normal endpoints
</h2><span id='topic+mams'></span>

<h3>Description</h3>

<p>The function determines the boundaries of a multi-arm multi-stage study for a given boundary shape and finds the required number of subjects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mams(K=4, J=2, alpha=0.05, power=0.9, r=1:2, r0=1:2, p=0.75, p0=0.5, 
     delta=NULL, delta0=NULL, sd=NULL, ushape="obf", lshape="fixed",
     ufix=NULL, lfix=0, nstart=1, nstop=NULL, sample.size=TRUE, N=20,
     type="normal", parallel=TRUE, print=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mams_+3A_k">K</code></td>
<td>
<p>Number of experimental treatments (default=<code>4</code>).</p>
</td></tr>
<tr><td><code id="mams_+3A_j">J</code></td>
<td>
<p>Number of stages (default=<code>2</code>).</p>
</td></tr>
<tr><td><code id="mams_+3A_alpha">alpha</code></td>
<td>
<p>One-sided familywise error rate (default=<code>0.05</code>).</p>
</td></tr>
<tr><td><code id="mams_+3A_power">power</code></td>
<td>
<p>Desired power (default=<code>0.9</code>).</p>
</td></tr>
<tr><td><code id="mams_+3A_r">r</code></td>
<td>
<p>Vector of allocation ratios (default=<code>1:2</code>).</p>
</td></tr>
<tr><td><code id="mams_+3A_r0">r0</code></td>
<td>
<p>Vector ratio on control (default=<code>1:2</code>).</p>
</td></tr>
<tr><td><code id="mams_+3A_p">p</code></td>
<td>
<p>Interesting treatment effect on the probability scale. See Details (default=<code>0.75</code>).</p>
</td></tr>
<tr><td><code id="mams_+3A_p0">p0</code></td>
<td>
<p>Uninteresting treatment effect on the probability scale. See Details (default=<code>0.5</code>).</p>
</td></tr>
<tr><td><code id="mams_+3A_delta">delta</code></td>
<td>
<p>Interesting treatment effect on the traditional scale. See Details (default=<code>NULL</code>).</p>
</td></tr>
<tr><td><code id="mams_+3A_delta0">delta0</code></td>
<td>
<p>Uninteresting treatment effect on the traditional scale. See Details (default=<code>NULL</code>).</p>
</td></tr>
<tr><td><code id="mams_+3A_sd">sd</code></td>
<td>
<p>Standard deviation, assumed to be known. See Details (default=<code>NULL</code>).</p>
</td></tr>
<tr><td><code id="mams_+3A_ushape">ushape</code></td>
<td>
<p>Shape of upper boundary. Either a function specifying the shape or one of <code>"pocock"</code>, <code>"obf"</code> (the default), <code>"triangular"</code> and <code>"fixed"</code>. See details.</p>
</td></tr>
<tr><td><code id="mams_+3A_lshape">lshape</code></td>
<td>
<p>Shape of lower boundary. Either a function specifying the shape or one of <code>"pocock"</code>, <code>"obf"</code>, <code>"triangular"</code> and <code>"fixed"</code> (the default). See details.</p>
</td></tr>
<tr><td><code id="mams_+3A_ufix">ufix</code></td>
<td>
<p>Fixed upper boundary (default=<code>NULL</code>). Only used if <code>shape="fixed"</code>.</p>
</td></tr>
<tr><td><code id="mams_+3A_lfix">lfix</code></td>
<td>
<p>Fixed lower boundary (default=<code>0</code>). Only used if <code>shape="fixed"</code>.</p>
</td></tr>
<tr><td><code id="mams_+3A_nstart">nstart</code></td>
<td>
<p>Starting point for finding the sample size (default=<code>1</code>).</p>
</td></tr>
<tr><td><code id="mams_+3A_nstop">nstop</code></td>
<td>
<p>Stopping point for finding the sample size (default=<code>NULL</code>).</p>
</td></tr>
<tr><td><code id="mams_+3A_sample.size">sample.size</code></td>
<td>
<p>Logical if sample size should be found as well (default=<code>TRUE</code>).</p>
</td></tr>
<tr><td><code id="mams_+3A_n">N</code></td>
<td>
<p>Number of quadrature points per dimension in the outer integral (default=<code>20</code>).</p>
</td></tr>
<tr><td><code id="mams_+3A_type">type</code></td>
<td>
<p>Will be changed automatically by the wrappers <code><a href="#topic+tite.mams">tite.mams()</a></code> (to <code>"tite"</code>) and <code><a href="#topic+ordinal.mams">ordinal.mams()</a></code> (to <code>"ordinal"</code>) to customise the output.</p>
</td></tr>
<tr><td><code id="mams_+3A_parallel">parallel</code></td>
<td>
<p>if <code>TRUE</code> (default), allows parallelisation of the computation via a user-defined strategy specified by means of the function <code><a href="future.html#topic+plan">future::plan()</a></code>. If not set differently, the default strategy is <code>sequential</code>, which corresponds to a computation without parallelisation.</p>
</td></tr>
<tr><td><code id="mams_+3A_print">print</code></td>
<td>
<p>if <code>TRUE</code> (default), indicate at which stage the computation is.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function finds the boundaries and sample size of a multi-arm multi-stage study with K active treatments plus control in which all promising treatments are continued at interim analyses as described in Magirr et al (2012). At each interim analysis the test statistics are compared to the lower (futility) bound and any treatment whose corresponding test statistic falls below that bound is discontinued. Similarly if any test statistic exceeds the upper (efficacy) bound the null hypothesis corresponding to that treatment can be rejected and superiority of that treatment over control claimed. At the same time the study is stopped. If at least one test statistic exceeds the lower bound and none exceeds the upper bound the study is continued and further patients are recruited to all remaining experimental treatments plus control.<br />
</p>
<p>The design is found under the least favorable configuration, which requires an interesting treatment effect <code>p</code> that if present we would like to find with high probability and an uninteresting effect <code>p0</code>. Both <code>p</code> and <code>p0</code> are parameterized as <code class="reqn">P(X_k &gt; X_0 ) = p</code>, that is the probability of a randomly selected person on treatment k observing a better outcome than a random person on control. For <code>p=0.5</code> the experimental treatment and control perform equally well. The advantage of this paramterization is that no knowledge about the variance is required. To convert traditional effect sizes, <code class="reqn">\delta</code> to this format use <code class="reqn">p=\Phi(\frac{\delta}{\sqrt{2}\sigma})</code>. Alternatively, the interesting and uninteresting effect size can also be specified directly on the traditional scale of <code>delta</code> and <code>delta</code> with an additional specification of the standard deviation <code>sd</code> assumed to be known.<br />
</p>
<p>The shape of the boundaries (<code>ushape</code>, <code>lshape</code>) are either using the predefined shapes following Pocock (1977), O'Brien &amp; Fleming (1979) or the triangular Test (Whitehead, 1997) using options <code>"pocock"</code>, <code>"obf"</code> or <code>"triangular"</code> respectively, are constant (option <code>"fixed"</code>) or supplied in as a function. If a function is passed it should require exactly one argument specifying the number of stages and return a vector of the same length. The lower boundary shape is required to be non-decreasing while the upper boundary shape needs to be non-increasing. If a fixed lower boundary is used, <code>lfix</code> must be smaller than <code class="reqn">\Phi^{-1}(1-\alpha)/2</code> to ensure that it is smaller than the upper boundary.<br />
</p>
<p>The default starting point for finding the sample size is <code>nstart=1</code>, and the default point where the search is stopped (when <code>nstop=NULL</code>) is 3 times the sample size of the corresponding fixed single-stage design.<br />
</p>
<p>Computation of designs with more than four stages are very time consuming and not advised. The parameter <code>sample.size</code> controls whether the required sample size is computed as well. Setting to <code>FALSE</code> approximately halves the compuation time. 
</p>
<p>For designs with more than 2 stages, parallelisation of the computation by means of the packages <code>future</code> and <code>future.apply</code> lead to decreased computation times when choosing a parallelisation strategy like, for example, <code>multicore</code> (using separate forked <span class="pkg">R</span> processes, available to unix/osx users) or <code>multisession</code> (using separate <span class="pkg">R</span> sessions, available to all users) (refer to <code><a href="future.html#topic+plan">future::plan()</a></code> for detail). <br /> 
</p>


<h3>Value</h3>

<p>An object of the class MAMS containing the following components:<br /> 
</p>
<table>
<tr><td><code>l</code></td>
<td>
<p>Lower boundary.</p>
</td></tr>
<tr><td><code>u</code></td>
<td>
<p>Upper boundary.</p>
</td></tr>
<tr><td><code>n</code></td>
<td>
<p>Sample size on control in stage 1.</p>
</td></tr>
<tr><td><code>N</code></td>
<td>
<p>Maximum total sample size.</p>
</td></tr>
<tr><td><code>K</code></td>
<td>
<p>Number of experimental treatments.</p>
</td></tr>
<tr><td><code>J</code></td>
<td>
<p>Number of stages in the trial.</p>
</td></tr>
<tr><td><code>alpha</code></td>
<td>
<p>Familywise error rate.</p>
</td></tr>
<tr><td><code>alpha.star</code></td>
<td>
<p>Cumulative familywise error rate spent by each analysis.</p>
</td></tr>
<tr><td><code>power</code></td>
<td>
<p>Power under least favorable configuration.</p>
</td></tr>
<tr><td><code>rMat</code></td>
<td>
<p>Matrix of allocation ratios. First row corresponds to control while subsequent rows are for the experimental treatments.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Thomas Jaki, Dominic Magirr and Dominique-Laurent Couturier</p>


<h3>References</h3>

<p>Jaki T., Pallmann P. and Magirr D. (2019), <em>The R Package MAMS for Designing Multi-Arm Multi-Stage Clinical Trials</em>, <b>Journal of Statistical Software</b>, 88(4), 1-25. Link: <a href="https://doi.org/10.18637/jss.v088.i04">doi:10.18637/jss.v088.i04</a>
</p>
<p>Magirr D., Jaki T. and Whitehead J. (2012), <em>A generalized Dunnett test for multi-arm multi-stage clinical studies with treatment selection</em>, <b>Biometrika</b>, 99(2), 494-501. Link: <a href="https://doi.org/10.1093/biomet/ass002">doi:10.1093/biomet/ass002</a>
</p>
<p>Pocock S.J. (1977), <em>Group sequential methods in the design and analysis of clinical trials</em>, <b>Biometrika</b>, 64(2), 191-199.<br />
</p>
<p>O'Brien P.C., Fleming T.R. (1979), <em>A multiple testing procedure for clinical trials</em>, <b>Biometrics</b>, 35(3), 549-556.<br /> 
</p>
<p>Whitehead J. (1997), <em>The Design and Analysis of Sequential Clinical Trials</em>, <b>Wiley</b>: Chichester, UK.<br /> 
</p>


<h3>See Also</h3>

<p><code><a href="#topic+print.MAMS">print.MAMS</a></code>, <code><a href="#topic+summary.MAMS">summary.MAMS</a></code>, <code><a href="#topic+plot.MAMS">plot.MAMS</a></code>, <code><a href="#topic+new.bounds">new.bounds</a></code>, <code><a href="#topic+ordinal.mams">ordinal.mams</a></code>, <code><a href="#topic+tite.mams">tite.mams</a></code>, <code><a href="#topic+MAMS">MAMS</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## A fixed sample (single stage) design specified on the p scale
mams(K=4, J=1, alpha=0.05, power=0.9, r=1, r0=1, p=0.65, p0=0.55)

## The same design specified on the delta scale
mams(K=4, J=1, alpha=0.05, power=0.9, r=1, r0=1, p=NULL, p0=NULL,
     delta=0.545, delta0=0.178, sd=1)

## An example in Table 1 of Magirr et al (2012)
# 2-stage design with O'Brien &amp; Fleming efficacy and zero futility boundary
mams(K=4, J=2, alpha=0.05, power=0.9, r=1:2, r0=1:2, p=0.65, p0=0.55, 
     ushape="obf", lshape="fixed", lfix=0, nstart=40)

# Note that these examples may take a few minutes to run

## 3-stage design with Triangular efficacy and futility boundary
mams(K=4, J=3, alpha=0.05, power=0.9, r=1:3, r0=1:3, p=0.65, p0=0.55, 
     ushape="triangular", lshape="triangular", nstart=30)

## Example of a custom boundary function without sample size evaluation
mams(K=6, J=3, alpha=0.05, power=0.9, r=1:3, r0=1:3, p=0.7, p0=0.5, 
     ushape=function(x)return(x:1), lshape="fixed", lfix=0, 
     sample.size=FALSE)

## Different allocation ratios between control and experimental treatments. 
## Twice as many patients are randomized to control at each stage.
mams(K=4, J=2, alpha=0.05, power=0.9, r=1:2, r0=c(2, 4), p=0.65, p0=0.55, 
     ushape="obf", lshape="fixed", lfix=0, nstart=30)

## 
## example considering different parallelisation strategies 
## 


# parallel = FALSE (future framework not used)
set.seed(1)
system.time(
print(mams(K=4, J=3, alpha=0.05, power=0.9, r=1:3, r0=1:3, p=0.65, p0=0.55, 
     ushape="triangular", lshape="triangular", nstart=30, parallel = FALSE))
)
# parallel = TRUE (default) with default strategy (sequential computation)
plan(sequential)
set.seed(1)
system.time(
print(mams(K=4, J=3, alpha=0.05, power=0.9, r=1:3, r0=1:3, p=0.65, p0=0.55, 
     ushape="triangular", lshape="triangular", nstart=30))
)
# parallel = TRUE(default) with multisession strategy (parallel computation)
plan(multisession)
set.seed(1)
system.time(
print(mams(K=4, J=3, alpha=0.05, power=0.9, r=1:3, r0=1:3, p=0.65, p0=0.55, 
     ushape="triangular", lshape="triangular", nstart=30))
)
plan("default")       
     
</code></pre>

<hr>
<h2 id='mams.sim'>
Simulating multi-arm multi-stage designs
</h2><span id='topic+mams.sim'></span>

<h3>Description</h3>

<p>The function simulates multi-arm multi-stage designs and estimates power and expected sample size.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mams.sim(nsim=10000, nMat=matrix(c(44, 88), nrow=2, ncol=5),
         u=c(3.068, 2.169), l=c(0.000, 2.169),
         pv=rep(0.5, 4), deltav=NULL, sd=NULL, ptest=1, parallel=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mams.sim_+3A_nsim">nsim</code></td>
<td>
<p>Number of simulations (default=<code>10000</code>).</p>
</td></tr>
<tr><td><code id="mams.sim_+3A_nmat">nMat</code></td>
<td>
<p>Jx(K+1) dimensional matrix of observed/expected sample sizes. Rows correspond to stages and columns to arms. First column is control (default: 2x5 matrix with 44 subjects per stage and arm).</p>
</td></tr>
<tr><td><code id="mams.sim_+3A_u">u</code></td>
<td>
<p>Vector of previously used upper boundaries (default=<code>NULL</code>).</p>
</td></tr>
<tr><td><code id="mams.sim_+3A_l">l</code></td>
<td>
<p>Vector of previously used upper boundaries (default=<code>NULL</code>).</p>
</td></tr>
<tr><td><code id="mams.sim_+3A_pv">pv</code></td>
<td>
<p>Vector of size K of true treatment effects on the probability scale. See Details (default=<code>rep(0.5, 4)</code>).</p>
</td></tr>
<tr><td><code id="mams.sim_+3A_deltav">deltav</code></td>
<td>
<p>Vector of size K of true treatment effects on the traditional scale. See Details (default=<code>NULL</code>).</p>
</td></tr>
<tr><td><code id="mams.sim_+3A_sd">sd</code></td>
<td>
<p>Standard deviation. See Details (default=<code>NULL</code>).</p>
</td></tr>
<tr><td><code id="mams.sim_+3A_ptest">ptest</code></td>
<td>
<p>Vector of treatment numbers for determining power. For example, c(1, 2) will count rejections of one or both hypotheses for testing treatments 1 and 2 against control.</p>
</td></tr>
<tr><td><code id="mams.sim_+3A_parallel">parallel</code></td>
<td>
<p>if <code>TRUE</code> (default), allows parallelisation of the computation via a user-defined strategy specified by means of the function <code><a href="future.html#topic+plan">future::plan()</a></code>. If not set differently, the default strategy is <code>sequential</code>, which corresponds to a computation without parallelisation.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function simulates multi-arm multi-stage studies for a given matrix of sample sizes and boundaries given by the vectors <code>u</code> and <code>l</code>. The effect difference between each experimental treatment and control is given by <code>pv</code> and is parameterized as <code class="reqn">P(X_k &gt; X_0 ) = p</code>. That is the probability of a randomly selected person on treatment k observing a better outcome than a random person on control. For <code>pv=rep(0.5,4</code> the experimental treatments and control perform equally well (i.e. the global null hypothesis is true). The advantage of this paramterization is that no knowledge about the variance is required. To convert traditional effect sizes, <code class="reqn">\delta</code> to this format use <code class="reqn">p=\Phi(\frac{\delta}{\sqrt{2}\sigma})</code>. Alternatively, the effect size can also be specified directly on the traditional scale of <code>deltav</code> with an additional specification of the standard deviation <code>sd</code>.<br />
</p>
<p>The function returns the probability of rejecting any hypothesis (<code>typeI</code>), the power to reject the first hypothesis when the first treatment has the largest estimated effect, the proportion of rejections of the hypothesis specified by <code>ptest</code> (<code>prop.rej</code>) as well as the expected sample size. <br />
</p>


<h3>Value</h3>

<p>An object of the class MAMS.sim containing the following components: <br /> 
</p>
<pre>res$typeI &lt;- mean(unlist(reps["rej",]))</pre>
<pre>res$power &lt;- mean(unlist(reps["pow",]))</pre>
<pre>res$prop.rej &lt;- rej/nsim</pre>
<pre>res$exss &lt;- mean(unlist(reps["ess",]))</pre>
<table>
<tr><td><code>l</code></td>
<td>
<p>Lower boundary.</p>
</td></tr> 
<tr><td><code>u</code></td>
<td>
<p>Upper boundary.</p>
</td></tr>
<tr><td><code>n</code></td>
<td>
<p>Sample size on control in stage 1.</p>
</td></tr>
<tr><td><code>N</code></td>
<td>
<p>Maximum total sample size.</p>
</td></tr>
<tr><td><code>K</code></td>
<td>
<p>Number of experimental treatments.</p>
</td></tr>
<tr><td><code>J</code></td>
<td>
<p>Number of stages in the trial.</p>
</td></tr>
<tr><td><code>rMat</code></td>
<td>
<p>Matrix of allocation ratios. First row corresponds to control and second row to experimental treatments.</p>
</td></tr>
<tr><td><code>nsim</code></td>
<td>
<p>Number of simulation runs.</p>
</td></tr>
<tr><td><code>typeI</code></td>
<td>
<p>The proportion any hypothesis is rejected.</p>
</td></tr>
<tr><td><code>power</code></td>
<td>
<p>The proportion the first hypothesis is rejected and the corresponding test statistic is largest.</p>
</td></tr>
<tr><td><code>ptest</code></td>
<td>
<p>The vector <code>ptest</code>.</p>
</td></tr>
<tr><td><code>prop.rej</code></td>
<td>
<p>The proportion of times at least one of the hypothesis specified by <code>ptest</code> is rejected.</p>
</td></tr>
<tr><td><code>exss</code></td>
<td>
<p>The expected sample size.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Thomas Jaki, Dominic Magirr and Dominique-Laurent Couturier</p>


<h3>References</h3>

<p>Jaki T., Pallmann P. and Magirr D. (2019), <em>The R Package MAMS for Designing Multi-Arm Multi-Stage Clinical Trials</em>, <b>Journal of Statistical Software</b>, 88(4), 1-25. Link: <a href="https://doi.org/10.18637/jss.v088.i04">doi:10.18637/jss.v088.i04</a>
</p>
<p>Magirr D., Jaki T. and Whitehead J. (2012), <em>A generalized Dunnett test for multi-arm multi-stage clinical studies with treatment selection</em>, <b>Biometrika</b>, 99(2), 494-501. Link: <a href="https://doi.org/10.1093/biomet/ass002">doi:10.1093/biomet/ass002</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+print.MAMS.sim">print.MAMS.sim</a></code>, <code><a href="#topic+summary.MAMS.sim">summary.MAMS.sim</a></code>, <code><a href="#topic+mams">mams</a></code>, <code><a href="#topic+MAMS">MAMS</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Note that some of these examples may take a few minutes to run

# 2-stage design with O'Brien &amp; Fleming efficacy and zero futility boundary with 
# equal sample size per arm and stage. Design can be found using
# mams(K=4, J=2, alpha=0.05, power=0.9, r=1:2, r0=1:2, ushape="obf", lshape="fixed", 
#      lfix=0, p=0.65, p0=0.55)

# under global null hypothesis (using the pv scale)
mams.sim(nsim=10000, nMat=matrix(c(44, 88), nrow=2, ncol=5), u=c(3.068, 2.169),
         l=c(0.000, 2.169), pv=rep(0.5, 4), ptest=1)

# under global null hypothesis (using the deltav scale)
mams.sim(nsim=10000, nMat=matrix(c(44, 88), nrow=2, ncol=5), u=c(3.068, 2.169),
         l=c(0.000, 2.169), pv=NULL, deltav=rep(0, 4), sd=1, ptest=1)

# under LFC
mams.sim(nsim=10000, nMat=matrix(c(44, 88), nrow=2, ncol=5), u=c(3.068, 2.169),
         l=c(0.000, 2.169), pv=c(0.65, 0.55, 0.55, 0.55), ptest=1:2)

# when all treatments doing similarly well
mams.sim(nsim=10000, nMat=matrix(c(44, 88), nrow=2, ncol=5), u=c(3.068, 2.169),
         l=c(0.000, 2.169), pv=c(0.63, 0.62, 0.60, 0.61), ptest=4)

## 
## example considering different parallelisation strategies 
## 

# parallel = FALSE (future framework not used)
set.seed(1)
system.time(
print(mams.sim(nsim=25000, nMat=matrix(c(44, 88), nrow=2, ncol=5), u=c(3.068, 2.169),
         l=c(0.000, 2.169), pv=c(0.65, 0.55, 0.55, 0.55), ptest=1:2, parallel=FALSE))
)
# parallel = TRUE (default) with default strategy (sequential computation)
plan(sequential)
set.seed(1)
system.time(
print(mams.sim(nsim=25000, nMat=matrix(c(44, 88), nrow=2, ncol=5), u=c(3.068, 2.169),
         l=c(0.000, 2.169), pv=c(0.65, 0.55, 0.55, 0.55), ptest=1:2))
)
# parallel = TRUE (default) with multisession strategy (parallel computation)
plan(multisession)
set.seed(1)
system.time(
print(mams.sim(nsim=25000, nMat=matrix(c(44, 88), nrow=2, ncol=5), u=c(3.068, 2.169),
         l=c(0.000, 2.169), pv=c(0.65, 0.55, 0.55, 0.55), ptest=1:2))
)
plan("default")       

</code></pre>

<hr>
<h2 id='MAMSNews'>Shows changes and news</h2><span id='topic+MAMSNews'></span>

<h3>Description</h3>

<p>Functions showing changes since previous versions.</p>


<h3>Usage</h3>

<pre><code class='language-R'>MAMSNews()
</code></pre>


<h3>Details</h3>

<p>Displays the changes and news given in the NEWS file of the package.
</p>


<h3>Value</h3>

<p>Screen output.</p>


<h3>Author(s)</h3>

<p>Thomas Jaki</p>


<h3>Examples</h3>

<pre><code class='language-R'>MAMSNews()
</code></pre>

<hr>
<h2 id='new.bounds'>
Function to update boundaries based on observed sample sizes
</h2><span id='topic+new.bounds'></span>

<h3>Description</h3>

<p>The function determines updated boundaries of a multi-arm multi-stage study based on observed number of observations per arm.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>new.bounds(K=3, J=2, alpha=0.05, nMat=matrix(c(10, 20), nrow=2, ncol=4), 
           u=NULL, l=NULL, ushape="obf", lshape="fixed", ufix=NULL,
           lfix=0, N=20, parallel=TRUE, print=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="new.bounds_+3A_k">K</code></td>
<td>
<p>Number of experimental treatments (default=<code>3</code>).</p>
</td></tr>
<tr><td><code id="new.bounds_+3A_j">J</code></td>
<td>
<p>Number of stages (default=<code>2</code>).</p>
</td></tr>
<tr><td><code id="new.bounds_+3A_alpha">alpha</code></td>
<td>
<p>One-sided familywise error rate (default=<code>0.05</code>).</p>
</td></tr>
<tr><td><code id="new.bounds_+3A_nmat">nMat</code></td>
<td>
<p>Jx(K+1) dimensional matrix of observed/expected sample sizes. Rows correspond to stages and columns to arms. First column is control (default: 2x4 matrix with 10 subjects per stage and arm).</p>
</td></tr>
<tr><td><code id="new.bounds_+3A_u">u</code></td>
<td>
<p>Vector of previously used upper boundaries (default=<code>NULL</code>).</p>
</td></tr>
<tr><td><code id="new.bounds_+3A_l">l</code></td>
<td>
<p>Vector of previously used upper boundaries (default=<code>NULL</code>).</p>
</td></tr>
<tr><td><code id="new.bounds_+3A_ushape">ushape</code></td>
<td>
<p>Shape of upper boundary. Either a function specifying the shape or one of <code>"pocock"</code>, <code>"obf"</code> (the default), <code>"triangular"</code> and <code>"fixed"</code>. See details.</p>
</td></tr>
<tr><td><code id="new.bounds_+3A_lshape">lshape</code></td>
<td>
<p>Shape of lower boundary. Either a function specifying the shape or one of <code>"pocock"</code>, <code>"obf"</code>, <code>"triangular"</code> and <code>"fixed"</code> (the default). See details.</p>
</td></tr>
<tr><td><code id="new.bounds_+3A_ufix">ufix</code></td>
<td>
<p>Fixed upper boundary (default=<code>NULL</code>). Only used if <code>shape="fixed"</code>.</p>
</td></tr>
<tr><td><code id="new.bounds_+3A_lfix">lfix</code></td>
<td>
<p>Fixed lower boundary (default=<code>0</code>). Only used if <code>shape="fixed"</code>.</p>
</td></tr>
<tr><td><code id="new.bounds_+3A_n">N</code></td>
<td>
<p>Number of quadrature points per dimension in the outer integral (default=20).</p>
</td></tr>
<tr><td><code id="new.bounds_+3A_parallel">parallel</code></td>
<td>
<p>if <code>TRUE</code> (default), allows parallelisation of the computation via a user-defined strategy specified by means of the function <code><a href="future.html#topic+plan">future::plan()</a></code>. If not set differently, the default strategy is <code>sequential</code>, which corresponds to a computation without parallelisation.</p>
</td></tr>
<tr><td><code id="new.bounds_+3A_print">print</code></td>
<td>
<p>if <code>TRUE</code> (default), indicate at which stage the computation is.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function finds the boundaries for a given matrix of sample sizes in multi-arm multi-stage study with K active treatments plus control. The vectors <code>u</code> and <code>l</code> are the boundaries used so far while <code>u.shape</code> and <code>l.shape</code> specify the shape to the boundaries for the remaining analysis. By specifying <code>u</code> and <code>l</code> as <code>NULL</code>, a design using only the shapes given by <code>ushape</code> and <code>lshape</code> can be found for any sample sizes per stage and arm.<br />
</p>
<p>The shape of the boundaries (<code>ushape</code>, <code>lshape</code>) are either using the predefined shapes following Pocock (1977), O'Brien &amp; Fleming (1979) or the triangular Test (Whitehead, 1997) using options <code>"pocock"</code>, <code>"obf"</code> or <code>"triangular"</code> respectively, are constant (option <code>"fixed"</code>) or supplied in as a function. If a function is passed it should require exactly one argument specifying the number of stages and return a vector of the same length. The lower boundary shape is required to be non-decreasing while the upper boundary shape needs to be non-increasing. If a fixed lower boundary is used, <code>lfix</code> must be smaller than <code class="reqn">\Phi^{-1}(1-\alpha)/2</code> to ensure that it is smaller than the upper boundary.<br />
</p>


<h3>Value</h3>

<p>An object of the class MAMS containing the following components: <br /> 
</p>
<table>
<tr><td><code>l</code></td>
<td>
<p>Lower boundary.</p>
</td></tr> 
<tr><td><code>u</code></td>
<td>
<p>Upper boundary.</p>
</td></tr>
<tr><td><code>n</code></td>
<td>
<p>Sample size on control in stage 1.</p>
</td></tr>
<tr><td><code>N</code></td>
<td>
<p>Maximum total sample size.</p>
</td></tr>
<tr><td><code>K</code></td>
<td>
<p>Number of experimental treatments.</p>
</td></tr>
<tr><td><code>J</code></td>
<td>
<p>Number of stages in the trial.</p>
</td></tr>
<tr><td><code>alpha</code></td>
<td>
<p>Familywise error rate.</p>
</td></tr>
<tr><td><code>power</code></td>
<td>
<p>Power under least favorable configuration.</p>
</td></tr>
<tr><td><code>rMat</code></td>
<td>
<p>Matrix of allocation ratios. First row corresponds to control and second row to experimental treatments.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Thomas Jaki, Dominic Magirr and Dominique-Laurent Couturier</p>


<h3>References</h3>

<p>Jaki T., Pallmann P. and Magirr D. (2019), <em>The R Package MAMS for Designing Multi-Arm Multi-Stage Clinical Trials</em>, <b>Journal of Statistical Software</b>, 88(4), 1-25. Link: <a href="https://doi.org/10.18637/jss.v088.i04">doi:10.18637/jss.v088.i04</a>
</p>
<p>Magirr D., Jaki T. and Whitehead J. (2012), <em>A generalized Dunnett test for multi-arm multi-stage clinical studies with treatment selection</em>, <b>Biometrika</b>, 99(2), 494-501. Link: <a href="https://doi.org/10.1093/biomet/ass002">doi:10.1093/biomet/ass002</a>
</p>
<p>Magirr D., Stallard N. and Jaki T. (2014), <em>Flexible sequential designs for multi-arm clinical trials</em>, <b>Statistics in Medicine</b>, 33(19), 3269-3279. Link: <a href="https://doi.org/10.1002/sim.6183">doi:10.1002/sim.6183</a>
</p>
<p>Pocock S.J. (1977), <em>Group sequential methods in the design and analysis of clinical trials</em>, <b>Biometrika</b>, 64(2), 191-199.<br />
</p>
<p>O'Brien P.C., Fleming T.R. (1979), <em>A multiple testing procedure for clinical trials</em>, <b>Biometrics</b>, 35(3), 549-556.<br /> 
</p>
<p>Whitehead J. (1997), <em>The Design and Analysis of Sequential Clinical Trials</em>, <b>Wiley</b>: Chichester, UK.<br /> 
</p>


<h3>See Also</h3>

<p><code><a href="#topic+print.MAMS">print.MAMS</a></code>, <code><a href="#topic+summary.MAMS">summary.MAMS</a></code>, <code><a href="#topic+plot.MAMS">plot.MAMS</a></code>, <code><a href="#topic+mams">mams</a></code>, <code><a href="#topic+MAMS">MAMS</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Note that some of these examples may take a few minutes to run

# 2-stage design with O'Brien &amp; Fleming efficacy and zero futility boundary with 
# equal sample size per arm and stage. Results are equivalent to using 
# mams(K=4, J=2, alpha=0.05, power=0.9, r=1:2, r0=1:2, ushape="obf", lshape="fixed", 
#      lfix=0, sample.size=FALSE)

new.bounds(K=4, J=2, alpha=0.05, nMat=matrix(c(10, 20), nrow=2, ncol=5), u=NULL, l=NULL, 
           ushape="obf", lshape="fixed", lfix=0)

# A 2-stage design that was designed to use an O'Brien &amp; Fleming efficacy and 
# zero futility boundary with equal sample size per arm and stage (n=14).
# The observed sample size after stage one are 10, 10, 18, 10, 13 for each arm 
# while the original upper bounds used are (3.068, 2.169) for stage 1. 
# The updated bounds are (3.068, 2.167).

new.bounds(K=4, J=2, alpha=0.05, 
           nMat=matrix(c(10, 28, 10, 28, 18, 28, 10, 28, 13, 28), nrow=2, ncol=5), 
           u=3.068, l=0, ushape="obf", lshape="fixed", lfix=0)
           
# same using parallelisation via separate R sessions running in the background
future::plan(multisession)
new.bounds(K=4, J=2, alpha=0.05, 
           nMat=matrix(c(10, 28, 10, 28, 18, 28, 10, 28, 13, 28), nrow=2, ncol=5), 
           u=3.068, l=0, ushape="obf", lshape="fixed", lfix=0)
future::plan("default")
           
</code></pre>

<hr>
<h2 id='ordinal.mams'>
Function to design multi-arm multi-stage studies with ordinal or binary endpoints
</h2><span id='topic+ordinal.mams'></span>

<h3>Description</h3>

<p>The function determines (approximately) the boundaries of a multi-arm multi-stage study with ordinal or binary endpoints for a given boundary shape and finds the required number of subjects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ordinal.mams(prob=c(0.35, 0.4, 0.25), or=2, or0=1.2, K=4, J=2, alpha=0.05,
     power=0.9, r=1:2, r0=1:2, ushape="obf", lshape="fixed", ufix=NULL,
     lfix=0, nstart=1, nstop=NULL, sample.size=TRUE, N=20, 
     parallel=TRUE, print=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ordinal.mams_+3A_prob">prob</code></td>
<td>
<p>Vector of expected probabilities of falling into each category under control conditions. The elements must sum up to one (default=<code>c(0.35, 0.4, 0.25)</code>).</p>
</td></tr>
<tr><td><code id="ordinal.mams_+3A_or">or</code></td>
<td>
<p>Interesting treatment effect on the scale of odds ratios (default=<code>2</code>).</p>
</td></tr>
<tr><td><code id="ordinal.mams_+3A_or0">or0</code></td>
<td>
<p>Uninteresting treatment effect on the scale of odds ratios (default=<code>1.2</code>).</p>
</td></tr>
<tr><td><code id="ordinal.mams_+3A_k">K</code></td>
<td>
<p>Number of experimental treatments (default=<code>4</code>).</p>
</td></tr>
<tr><td><code id="ordinal.mams_+3A_j">J</code></td>
<td>
<p>Number of stages (default=<code>2</code>).</p>
</td></tr>
<tr><td><code id="ordinal.mams_+3A_alpha">alpha</code></td>
<td>
<p>One-sided familywise error rate (default=<code>0.05</code>).</p>
</td></tr>
<tr><td><code id="ordinal.mams_+3A_power">power</code></td>
<td>
<p>Desired power (default=<code>0.9</code>).</p>
</td></tr>
<tr><td><code id="ordinal.mams_+3A_r">r</code></td>
<td>
<p>Vector of allocation ratios (default=<code>1:2</code>).</p>
</td></tr>
<tr><td><code id="ordinal.mams_+3A_r0">r0</code></td>
<td>
<p>Vector ratio on control (default=<code>1:2</code>).</p>
</td></tr>
<tr><td><code id="ordinal.mams_+3A_ushape">ushape</code></td>
<td>
<p>Shape of upper boundary. Either a function specifying the shape or one of <code>"pocock"</code>, <code>"obf"</code> (the default), <code>"triangular"</code> and <code>"fixed"</code>.</p>
</td></tr>
<tr><td><code id="ordinal.mams_+3A_lshape">lshape</code></td>
<td>
<p>Shape of lower boundary. Either a function specifying the shape or one of <code>"pocock"</code>, <code>"obf"</code>, <code>"triangular"</code> and <code>"fixed"</code> (the default).</p>
</td></tr>
<tr><td><code id="ordinal.mams_+3A_ufix">ufix</code></td>
<td>
<p>Fixed upper boundary (default=<code>NULL</code>). Only used if <code>shape="fixed"</code>.</p>
</td></tr>
<tr><td><code id="ordinal.mams_+3A_lfix">lfix</code></td>
<td>
<p>Fixed lower boundary (default=<code>0</code>). Only used if <code>shape="fixed"</code>.</p>
</td></tr>
<tr><td><code id="ordinal.mams_+3A_nstart">nstart</code></td>
<td>
<p>Starting point for finding the sample size (default=<code>1</code>).</p>
</td></tr>
<tr><td><code id="ordinal.mams_+3A_nstop">nstop</code></td>
<td>
<p>Stopping point for finding the sample size (default=<code>NULL</code>).</p>
</td></tr>
<tr><td><code id="ordinal.mams_+3A_sample.size">sample.size</code></td>
<td>
<p>Logical if sample size should be found as well (default=<code>TRUE</code>).</p>
</td></tr>
<tr><td><code id="ordinal.mams_+3A_n">N</code></td>
<td>
<p>Number of quadrature points per dimension in the outer integral (default=<code>20</code>).</p>
</td></tr>
<tr><td><code id="ordinal.mams_+3A_parallel">parallel</code></td>
<td>
<p>if <code>TRUE</code> (default), allows parallelisation of the computation via a user-defined strategy specified by means of the function <code><a href="future.html#topic+plan">future::plan()</a></code>. If not set differently, the default strategy is <code>sequential</code>, which corresponds to a computation without parallelisation.</p>
</td></tr>
<tr><td><code id="ordinal.mams_+3A_print">print</code></td>
<td>
<p>if <code>TRUE</code> (default), indicate at which stage the computation is.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function finds the (approximate) boundaries and sample size of a multi-arm multi-stage study with ordinal or binary endpoints with K active treatments plus control in which all promising treatments are continued at interim analyses as described in Magirr et al (2012). It is a wrapper around the basic <code><a href="#topic+mams">mams</a></code> function to facilitate its use with ordinal and binary endpoints, following ideas of Whitehead &amp; Jaki (2009) and Jaki &amp; Magirr (2013). For a binary endpoint the vector <code>prob</code> has only two elements (success/failure, yes/no, etc.). See <code><a href="#topic+mams">mams</a></code> for further details on the basic methodology.<br />
</p>


<h3>Value</h3>

<p>An object of the class MAMS containing the following components:<br /> 
</p>
<table>
<tr><td><code>l</code></td>
<td>
<p>Lower boundary.</p>
</td></tr>
<tr><td><code>u</code></td>
<td>
<p>Upper boundary.</p>
</td></tr>
<tr><td><code>n</code></td>
<td>
<p>Sample size on control in stage 1.</p>
</td></tr>
<tr><td><code>N</code></td>
<td>
<p>Maximum total sample size.</p>
</td></tr>
<tr><td><code>K</code></td>
<td>
<p>Number of experimental treatments.</p>
</td></tr>
<tr><td><code>J</code></td>
<td>
<p>Number of stages in the trial.</p>
</td></tr>
<tr><td><code>alpha</code></td>
<td>
<p>Familywise error rate.</p>
</td></tr>
<tr><td><code>alpha.star</code></td>
<td>
<p>Cumulative familywise error rate spent by each analysis.</p>
</td></tr>
<tr><td><code>power</code></td>
<td>
<p>Power under least favorable configuration.</p>
</td></tr>
<tr><td><code>rMat</code></td>
<td>
<p>Matrix of allocation ratios. First row corresponds to control while subsequent rows are for the experimental treatments.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Philip Pallmann</p>


<h3>References</h3>

<p>Jaki T., Pallmann P. and Magirr D. (2019), <em>The R Package MAMS for Designing Multi-Arm Multi-Stage Clinical Trials</em>, <b>Journal of Statistical Software</b>, 88(4), 1-25. Link: <a href="https://doi.org/10.18637/jss.v088.i04">doi:10.18637/jss.v088.i04</a>
</p>
<p>Magirr D., Jaki T. and Whitehead J. (2012), <em>A generalized Dunnett test for multi-arm multi-stage clinical studies with treatment selection</em>, <b>Biometrika</b>, 99(2), 494-501. Link: <a href="https://doi.org/10.1093/biomet/ass002">doi:10.1093/biomet/ass002</a>
</p>
<p>Magirr D., Stallard N. and Jaki T. (2014), <em>Flexible sequential designs for multi-arm clinical trials</em>, <b>Statistics in Medicine</b>, 33(19), 3269-3279. Link: <a href="https://doi.org/10.1002/sim.6183">doi:10.1002/sim.6183</a>
</p>
<p>Pocock S.J. (1977), <em>Group sequential methods in the design and analysis of clinical trials</em>, <b>Biometrika</b>, 64(2), 191-199.<br />
</p>
<p>O'Brien P.C., Fleming T.R. (1979), <em>A multiple testing procedure for clinical trials</em>, <b>Biometrics</b>, 35(3), 549-556.<br /> 
</p>
<p>Whitehead J. (1997), <em>The Design and Analysis of Sequential Clinical Trials</em>, <b>Wiley</b>: Chichester, UK.<br /> 
</p>


<h3>See Also</h3>

<p><code><a href="#topic+print.MAMS">print.MAMS</a></code>, <code><a href="#topic+summary.MAMS">summary.MAMS</a></code>, <code><a href="#topic+plot.MAMS">plot.MAMS</a></code>, <code><a href="#topic+mams">mams</a></code>, <code><a href="#topic+MAMS">MAMS</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## An example based on the example in Whitehead &amp; Jaki (2009)
# 2-stage design with triangular efficacy and futility boundaries
prob &lt;- c(0.075, 0.182, 0.319, 0.243, 0.015, 0.166)
ordinal.mams(prob=prob, or=3.06, or0=1.32, K=3, J=2, alpha=0.05,
                 power=0.9, r=1:2, r0=1:2, ushape="triangular",
                 lshape="triangular")
# same example with parallelisation via separate R sessions running in the background
future::plan(multisession)
ordinal.mams(prob=prob, or=3.06, or0=1.32, K=3, J=2, alpha=0.05,
                 power=0.9, r=1:2, r0=1:2, ushape="triangular",
                 lshape="triangular", parallel=TRUE)
future::plan("default")
</code></pre>

<hr>
<h2 id='plot'>Different generic functions for class MAMS.</h2><span id='topic+plot.MAMS'></span><span id='topic+print.MAMS'></span><span id='topic+summary.MAMS'></span><span id='topic+print.MAMS.sim'></span><span id='topic+summary.MAMS.sim'></span><span id='topic+print.MAMS.stepdown'></span><span id='topic+summary.MAMS.stepdown'></span><span id='topic+plot.MAMS.stepdown'></span>

<h3>Description</h3>

<p>Generic functions for summarizing an object of class MAMS.</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'MAMS'
print(x, digits=max(3, getOption("digits") - 4), ...)

## S3 method for class 'MAMS'
summary(object, digits=max(3, getOption("digits") - 4), ...)

## S3 method for class 'MAMS'
plot(x, col=NULL, pch=NULL, lty=NULL, main=NULL, xlab="Analysis", 
     ylab="Test statistic", ylim=NULL, type=NULL, las=1, ...)

## S3 method for class 'MAMS.sim'
print(x, digits=max(3, getOption("digits") - 4), ...)

## S3 method for class 'MAMS.sim'
summary(object, digits=max(3, getOption("digits") - 4), ...)

## S3 method for class 'MAMS.stepdown'
print(x, digits=max(3, getOption("digits") - 4), ...)

## S3 method for class 'MAMS.stepdown'
summary(object, digits=max(3, getOption("digits") - 4), ...)

## S3 method for class 'MAMS.stepdown'
plot(x, col=NULL, pch=NULL, lty=NULL, main=NULL, xlab="Analysis", 
     ylab="Test statistic", ylim=NULL, type=NULL, bty="n", las=1, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_+3A_x">x</code></td>
<td>
<p>An output object of class MAMS.</p>
</td></tr>
<tr><td><code id="plot_+3A_digits">digits</code></td>
<td>
<p>Number of significant digits to be printed.</p>
</td></tr>
<tr><td><code id="plot_+3A_object">object</code></td>
<td>
<p>An output object of class MAMS.</p>
</td></tr>
<tr><td><code id="plot_+3A_col">col</code></td>
<td>
<p>A specification for the default plotting color (default=<code>NULL</code>). See <code>par</code> for more details.</p>
</td></tr>
<tr><td><code id="plot_+3A_pch">pch</code></td>
<td>
<p>Either an integer specifying a symbol or a single character to be used as the default in plotting points (default=<code>NULL</code>). See <code>par</code> for more details.</p>
</td></tr>
<tr><td><code id="plot_+3A_lty">lty</code></td>
<td>
<p>A specification for the default line type to be used between analyses (default=<code>NULL</code>). Setting to zero supresses ploting of the lines. See <code>par</code> for more details.</p>
</td></tr>
<tr><td><code id="plot_+3A_main">main</code></td>
<td>
<p>An overall title for the plot (default=<code>NULL</code>).</p>
</td></tr>
<tr><td><code id="plot_+3A_xlab">xlab</code></td>
<td>
<p>A title for the x axis (default=<code>"Analysis"</code>).</p>
</td></tr>
<tr><td><code id="plot_+3A_ylab">ylab</code></td>
<td>
<p>A title for the y axis (default=<code>"Test statistic"</code>).</p>
</td></tr>
<tr><td><code id="plot_+3A_ylim">ylim</code></td>
<td>
<p>Numeric vector of length 2, giving the y coordinates range (default=<code>NULL</code>).</p>
</td></tr>
<tr><td><code id="plot_+3A_type">type</code></td>
<td>
<p>Type of plot to be used (default=<code>NULL</code>). See <code>plot</code> for more details.</p>
</td></tr>
<tr><td><code id="plot_+3A_bty">bty</code></td>
<td>
<p>Should a box be drawn around the legend? The default <code>"n"</code> does not draw a box, the alternative option <code>"o"</code> does.</p>
</td></tr>
<tr><td><code id="plot_+3A_las">las</code></td>
<td>
<p>A specification of the axis labeling style. The default <code>1</code> ensures the labels are always horizontal. See <code>?par</code> for details.</p>
</td></tr>
<tr><td><code id="plot_+3A_...">...</code></td>
<td>
<p>Further (graphical) arguments to be passed to methods.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>print.MAMS</code> produces a summary of an object from class MAMS including boundaries and requires sample size if initially requested.<br />
</p>
<p><code>summary.MAMS</code> produces same output as <code>print.MAMS</code>.<br />
</p>
<p><code>plot.MAMS</code> produces as plot of the boundaries.
</p>
<p><code>print.MAMS.sim</code> produces a summary of an object from class MAMS.sim including type-I-error and expected sample size.<br />
</p>
<p><code>summary.MAMS.sim</code> produces same output as <code>print.MAMS.sim</code>.<br />
</p>
<p><code>print.MAMS.stepdown</code> produces a summary of an object from class MAMS including boundaries and requires sample size if initially requested.<br />
</p>
<p><code>summary.MAMS.stepdown</code> produces same output as <code>print.stepdown.mams</code>.<br />
</p>
<p><code>plot.MAMS.stepdown</code> produces a plot of the boundaries. When used with <code>stepdown.update</code>, pluses indicate observed values of test statistics.
</p>


<h3>Value</h3>

<p>Screen or graphics output.</p>


<h3>Author(s)</h3>

<p>Thomas Jaki, Dominic Magirr, Philip Pallmann</p>


<h3>References</h3>

<p>Magirr D, Jaki T, Whitehead J (2012) A generalized Dunnett test for multi-arm multi-stage clinical studies with treatment selection. Biometrika, 99(2), 494-501.<br />
</p>
<p>Stallard N, Todd S (2003) Sequential designs for phase III clinical trials incorporating treatment selection. Statistics in Medicine, 22(5), 689-703.<br />
</p>
<p>Magirr D, Stallard N, Jaki T (2014) Flexible sequential designs for multi-arm clinical trials. Statistics in Medicine, 33(19), 3269-3279. 
</p>


<h3>See Also</h3>

<p><code><a href="#topic+mams">mams</a></code>, <code><a href="#topic+stepdown.mams">stepdown.mams</a></code>, <code><a href="#topic+MAMS">MAMS</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# 2-stage design with triangular boundaries
res &lt;- mams(K=4, J=2, alpha=0.05, power=0.9, r=1:2, r0=1:2, p=0.65, p0=0.55, 
            ushape="triangular", lshape="triangular", nstart=30)

print(res)
summary(res)
plot(res)

res &lt;- mams.sim(nsim=10000, nMat=matrix(c(44, 88), nrow=2, ncol=5), u=c(3.068, 2.169),
                l=c(0.000, 2.169), pv=c(0.65, 0.55, 0.55, 0.55), ptest=c(1:2, 4))

print(res)

# 2-stage 3-treatments versus control design, all promising treatments are selected:
res &lt;- stepdown.mams(nMat=matrix(c(10, 20), nrow=2, ncol=4), 
                     alpha.star=c(0.01, 0.05), lb=0, 
                     selection="all.promising")

print(res)
summary(res)
plot(res)
</code></pre>

<hr>
<h2 id='stepdown.mams'>
Function to find stopping boundaries for a 2- or 3-stage (step-down) multiple-comparisons-with-control test.
</h2><span id='topic+stepdown.mams'></span>

<h3>Description</h3>

<p>The function determines stopping boundaries for all intersection hypothesis tests in a multi-arm multi-stage study, given the amount of alpha (familywise error rate) to be spent at each analysis.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stepdown.mams(nMat=matrix(c(10, 20), nrow=2, ncol=4),
              alpha.star=c(0.01, 0.025), lb=0,
              selection="all.promising")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="stepdown.mams_+3A_nmat">nMat</code></td>
<td>
<p>Matrix containing the cumulative sample sizes in each treatment arm (columns: control, trt 1, ..., trt K), at each analysis (rows). The number of analyses must be either 2 or 3 (default=matrix(c(10, 20), nrow=2, ncol=4)).</p>
</td></tr>
<tr><td><code id="stepdown.mams_+3A_alpha.star">alpha.star</code></td>
<td>
<p>Cumulative familywise error rate to be spent at each analysis (default=c(0.01, 0.025)).</p>
</td></tr>
<tr><td><code id="stepdown.mams_+3A_lb">lb</code></td>
<td>
<p>Fixed lower boundary (default=0).</p>
</td></tr>
<tr><td><code id="stepdown.mams_+3A_selection">selection</code></td>
<td>
<p>How are treatments selected for the next stage? Using the default &quot;all.promising&quot; method, all treatments with a test statistic exceeding the lower boundary are taken forward to the next stage. If &quot;select.best&quot;, only the treatment with the largest statistic may be selected for future stages. (default=&quot;all.promising&quot;).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function implements the methods described in Magirr et al (2014) to find individual boundaries for all intersection hypotheses.
</p>


<h3>Value</h3>

<p>An object of the class MAMS.stepdown containing the following components: <br /> 
</p>
<table>
<tr><td><code>l</code></td>
<td>
<p>Lower boundaries.</p>
</td></tr> 
<tr><td><code>u</code></td>
<td>
<p>Upper boundaries.</p>
</td></tr>
<tr><td><code>nMat</code></td>
<td>
<p>Cumulative sample sizes on each treatment arm.</p>
</td></tr>
<tr><td><code>K</code></td>
<td>
<p>Number of experimental treatments.</p>
</td></tr>
<tr><td><code>J</code></td>
<td>
<p>Number of stages in the trial.</p>
</td></tr>
<tr><td><code>alpha.star</code></td>
<td>
<p>Cumulative familywise error rate spent at each analysis.</p>
</td></tr>
<tr><td><code>selection</code></td>
<td>
<p>Pre-specified method of treatment selection.</p>
</td></tr>
<tr><td><code>zscores</code></td>
<td>
<p>A list containing the observed test statistics at analyses so far (at the design stage this is NULL).</p>
</td></tr>
<tr><td><code>selected.trts</code></td>
<td>
<p>A list containing the treatments selected for each stage.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Dominic Magirr</p>


<h3>References</h3>

<p>Jaki T., Pallmann P. and Magirr D. (2019), <em>The R Package MAMS for Designing Multi-Arm Multi-Stage Clinical Trials</em>, <b>Journal of Statistical Software</b>, 88(4), 1-25. Link: <a href="https://doi.org/10.18637/jss.v088.i04">doi:10.18637/jss.v088.i04</a>
</p>
<p>Magirr D., Jaki T. and Whitehead J. (2012), <em>A generalized Dunnett test for multi-arm multi-stage clinical studies with treatment selection</em>, <b>Biometrika</b>, 99(2), 494-501. Link: <a href="https://doi.org/10.1093/biomet/ass002">doi:10.1093/biomet/ass002</a>
</p>
<p>Magirr D., Stallard N. and Jaki T. (2014), <em>Flexible sequential designs for multi-arm clinical trials</em>, <b>Statistics in Medicine</b>, 33(19), 3269-3279. Link: <a href="https://doi.org/10.1002/sim.6183">doi:10.1002/sim.6183</a>
</p>
<p>Stallard N. and Todd S. (2003), <em>Sequential designs for phase III clinical trials incorporating treatment selection</em>, <b>Statistics in Medicine</b>, 22(5), 689-703.<br />
</p>


<h3>See Also</h3>

<p><code><a href="#topic+print.MAMS.stepdown">print.MAMS.stepdown</a></code>, <code><a href="#topic+summary.MAMS.stepdown">summary.MAMS.stepdown</a></code>, <code><a href="#topic+plot.MAMS.stepdown">plot.MAMS.stepdown</a></code>, <code><a href="#topic+stepdown.update">stepdown.update</a></code>, <code><a href="#topic+MAMS">MAMS</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Note that some of these examples may take a few minutes to run

# 2-stage 3-treatments versus control design, all promising treatments are selected:
stepdown.mams(nMat=matrix(c(10, 20), nrow=2, ncol=4), 
              alpha.star=c(0.01, 0.05), lb=0, 
              selection="all.promising")

# select the best treatment after the first stage:
stepdown.mams(nMat=matrix(c(10, 20), nrow=2, ncol=4), 
              alpha.star=c(0.01, 0.05), lb=0, 
              selection="select.best")

# 3 stages and unequal randomization:
stepdown.mams(nMat=matrix(c(20, 40, 60, rep(c(10, 20, 30), 3)), nrow=3, ncol=4), 
              alpha.star=c(0.01, 0.025, 0.05), lb=c(0, 0.75), 
              selection="all.promising")
</code></pre>

<hr>
<h2 id='stepdown.update'>
Update the stopping boundaries of multi-arm multi-stage study at an interim analysis, allowing for unplanned treatment selection and/or sample-size reassessment. 
</h2><span id='topic+stepdown.update'></span>

<h3>Description</h3>

<p>Function to update a planned multi-arm multi-stage design to account for unplanned adaptations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stepdown.update(current.mams=stepdown.mams(), nobs=NULL, 
                zscores=NULL, selected.trts=NULL, nfuture=NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="stepdown.update_+3A_current.mams">current.mams</code></td>
<td>
<p>The planned step-down MAMS design prior to the current interim analysis (=<code>defaultstepdown.mams()</code>).</p>
</td></tr>
<tr><td><code id="stepdown.update_+3A_nobs">nobs</code></td>
<td>
<p>Cumulative sample sizes observed on each treatment arm up to and including the current interim analysis.</p>
</td></tr>
<tr><td><code id="stepdown.update_+3A_zscores">zscores</code></td>
<td>
<p>Observed vector of test statistics at the current interim analysis.</p>
</td></tr>
<tr><td><code id="stepdown.update_+3A_selected.trts">selected.trts</code></td>
<td>
<p>The set of experimental treatments to be taken forward to the next stage of testing. This argument should be omitted at the final analysis.</p>
</td></tr>
<tr><td><code id="stepdown.update_+3A_nfuture">nfuture</code></td>
<td>
<p>A matrix of future cumulative sample sizes. The number of rows must be equal to the originally planned number of stages (2 or 3) minus the number of stages already observed. The number of columns must be equal to the number of treatment arms (default=<code>NULL</code>).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function implements the ideas described in Magirr et al. (2014) to update a design according to unplanned design modifications. It takes as input the planned multi-arm multi-stage design prior to the interim analysis, together with the actually observed cumulative sample sizes and test statistics. Treatments to be included in future stages, as well as future sample sizes, can be chosen without following pre-specified rules. The output is a new multi-arm multi-stage design for the remaining stages such that the familywise error remains controlled at the pre-specified level. 
</p>


<h3>Value</h3>

<p>An object of the class MAMS.stepdown containing the following components: <br /> 
</p>
<table>
<tr><td><code>l</code></td>
<td>
<p>Lower boundaries.</p>
</td></tr> 
<tr><td><code>u</code></td>
<td>
<p>Upper boundaries.</p>
</td></tr>
<tr><td><code>sample.sizes</code></td>
<td>
<p>Cumulative sample sizes on each treatment arm.</p>
</td></tr>
<tr><td><code>K</code></td>
<td>
<p>Number of experimental treatments.</p>
</td></tr>
<tr><td><code>J</code></td>
<td>
<p>Number of stages in the trial.</p>
</td></tr>
<tr><td><code>alpha.star</code></td>
<td>
<p>Cumulative familywise error rate spent at each analysis, conditional on results so far.</p>
</td></tr>
<tr><td><code>selection</code></td>
<td>
<p>Pre-specified method of treatment selection.</p>
</td></tr>
<tr><td><code>zscores</code></td>
<td>
<p>A list containing the observed test statistics at analyses so far (at the design stage this is NULL).</p>
</td></tr>
<tr><td><code>selected.trts</code></td>
<td>
<p>A list containing the treatments selected for each stage.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Dominic Magirr</p>


<h3>References</h3>

<p>Jaki T., Pallmann P. and Magirr D. (2019), <em>The R Package MAMS for Designing Multi-Arm Multi-Stage Clinical Trials</em>, <b>Journal of Statistical Software</b>, 88(4), 1-25. Link: <a href="https://doi.org/10.18637/jss.v088.i04">doi:10.18637/jss.v088.i04</a>
</p>
<p>Magirr D., Jaki T. and Whitehead J. (2012), <em>A generalized Dunnett test for multi-arm multi-stage clinical studies with treatment selection</em>, <b>Biometrika</b>, 99(2), 494-501. Link: <a href="https://doi.org/10.1093/biomet/ass002">doi:10.1093/biomet/ass002</a>
</p>
<p>Magirr D., Stallard N. and Jaki T. (2014), <em>Flexible sequential designs for multi-arm clinical trials</em>, <b>Statistics in Medicine</b>, 33(19), 3269-3279. Link: <a href="https://doi.org/10.1002/sim.6183">doi:10.1002/sim.6183</a>
</p>
<p>Stallard N. and Todd S. (2003), <em>Sequential designs for phase III clinical trials incorporating treatment selection</em>, <b>Statistics in Medicine</b>, 22(5), 689-703.<br />
</p>


<h3>See Also</h3>

<p><code><a href="#topic+print.MAMS.stepdown">print.MAMS.stepdown</a></code>, <code><a href="#topic+summary.MAMS.stepdown">summary.MAMS.stepdown</a></code>, <code><a href="#topic+plot.MAMS.stepdown">plot.MAMS.stepdown</a></code>, <code><a href="#topic+stepdown.mams">stepdown.mams</a></code>, <code><a href="#topic+MAMS">MAMS</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# 2-stage 3-treatments versus control design
# all promising treatments are selected:
orig_mams &lt;- stepdown.mams(nMat=matrix(c(10, 20), nrow=2, ncol=4), 
                           alpha.star=c(0.01, 0.05), lb=0, 
                           selection="all.promising")

# make adjustment for the observed sample sizes 
# not being exactly as planned:
stepdown.update(orig_mams, nobs=c(9, 8, 13, 11), zscores=c(1.1, -0.5, 0.2), 
                selected.trts=1:3, nfuture=NULL)

# make adjustment for the observed sample sizes 
# not being exactly as planned. In addition, drop treatment 2:
stepdown.update(orig_mams, nobs=c(9, 8, 13, 11), zscores=c(1.1, -0.5, 0.2), 
                selected.trts=c(1, 3), nfuture=NULL)

# make adjustment for the observed sample sizes not being 
# exactly as planned. In addition, drop treatment 2. In addition, 
# double the planed cumulative second stage sample sizes:
updated_mams &lt;- stepdown.update(orig_mams, nobs=c(9, 8, 13, 11), 
                                 zscores=c(1.1, -0.5, 0.2), selected.trts=c(1, 3), 
                                 nfuture=matrix(c(40, 40, 13, 40), nrow=1, ncol=4))

# Account for the observed second stage sample sizes:
stepdown.update(updated_mams, nobs=c(38, 41, 13, 36), zscores=c(1.9, -Inf, 1.2), 
                selected.trts=NULL)

# 'select.best' design. Account for actually observed sample sizes 
# in first stage, and drop treatment 2:
orig_mams &lt;- stepdown.mams(nMat=matrix(c(10, 20), nrow=2, ncol=4), 
                           alpha.star=c(0.01, 0.05), lb=0, selection="select.best")

stepdown.update(orig_mams, nobs=c(9, 8, 13, 11), zscores=c(1.1, -0.5, 0.2), 
                selected.trts=c(1, 3), nfuture=NULL)
</code></pre>

<hr>
<h2 id='tite.mams'>
Function to design multi-arm multi-stage studies with time-to-event endpoints
</h2><span id='topic+tite.mams'></span>

<h3>Description</h3>

<p>The function determines (approximately) the boundaries of a multi-arm multi-stage study with time-to-event endpoints for a given boundary shape and finds the required number of events.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tite.mams(hr=1.5, hr0=1.1, K=4, J=2, alpha=0.05, power=0.9,
           r=1:2, r0=1:2, ushape="obf", lshape="fixed", ufix=NULL,
           lfix=0, nstart=1, nstop=NULL, sample.size=TRUE, N=20,
           parallel=TRUE, print=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="tite.mams_+3A_hr">hr</code></td>
<td>
<p>Interesting treatment effect on the scale of hazard ratios (default=<code>2</code>).</p>
</td></tr>
<tr><td><code id="tite.mams_+3A_hr0">hr0</code></td>
<td>
<p>Uninteresting treatment effect on the scale of hazard ratios (default=<code>1.2</code>).</p>
</td></tr>
<tr><td><code id="tite.mams_+3A_k">K</code></td>
<td>
<p>Number of experimental treatments (default=<code>4</code>).</p>
</td></tr>
<tr><td><code id="tite.mams_+3A_j">J</code></td>
<td>
<p>Number of stages (default=<code>2</code>).</p>
</td></tr>
<tr><td><code id="tite.mams_+3A_alpha">alpha</code></td>
<td>
<p>One-sided familywise error rate (default=<code>0.05</code>).</p>
</td></tr>
<tr><td><code id="tite.mams_+3A_power">power</code></td>
<td>
<p>Desired power (default=<code>0.9</code>).</p>
</td></tr>
<tr><td><code id="tite.mams_+3A_r">r</code></td>
<td>
<p>Vector of allocation ratios (default=<code>1:2</code>).</p>
</td></tr>
<tr><td><code id="tite.mams_+3A_r0">r0</code></td>
<td>
<p>Vector ratio on control (default=<code>1:2</code>).</p>
</td></tr>
<tr><td><code id="tite.mams_+3A_ushape">ushape</code></td>
<td>
<p>Shape of upper boundary. Either a function specifying the shape or one of <code>"pocock"</code>, <code>"obf"</code> (the default), <code>"triangular"</code> and <code>"fixed"</code>.</p>
</td></tr>
<tr><td><code id="tite.mams_+3A_lshape">lshape</code></td>
<td>
<p>Shape of lower boundary. Either a function specifying the shape or one of <code>"pocock"</code>, <code>"obf"</code>, <code>"triangular"</code> and <code>"fixed"</code> (the default).</p>
</td></tr>
<tr><td><code id="tite.mams_+3A_ufix">ufix</code></td>
<td>
<p>Fixed upper boundary (default=<code>NULL</code>). Only used if <code>shape="fixed"</code>.</p>
</td></tr>
<tr><td><code id="tite.mams_+3A_lfix">lfix</code></td>
<td>
<p>Fixed lower boundary (default=<code>0</code>). Only used if <code>shape="fixed"</code>.</p>
</td></tr>
<tr><td><code id="tite.mams_+3A_nstart">nstart</code></td>
<td>
<p>Starting point for finding the sample size (default=<code>1</code>).</p>
</td></tr>
<tr><td><code id="tite.mams_+3A_nstop">nstop</code></td>
<td>
<p>Stopping point for finding the sample size (default=<code>NULL</code>).</p>
</td></tr>
<tr><td><code id="tite.mams_+3A_sample.size">sample.size</code></td>
<td>
<p>Logical if sample size should be found as well (default=<code>TRUE</code>).</p>
</td></tr>
<tr><td><code id="tite.mams_+3A_n">N</code></td>
<td>
<p>Number of quadrature points per dimension in the outer integral (default=20).</p>
</td></tr>
<tr><td><code id="tite.mams_+3A_parallel">parallel</code></td>
<td>
<p>if <code>TRUE</code> (default), allows parallelisation of the computation via a user-defined strategy specified by means of the function <code><a href="future.html#topic+plan">future::plan()</a></code>. If not set differently, the default strategy is <code>sequential</code>, which corresponds to a computation without parallelisation.</p>
</td></tr>
<tr><td><code id="tite.mams_+3A_print">print</code></td>
<td>
<p>if <code>TRUE</code> (default), indicate at which stage the computation is.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function finds the (approximate) boundaries and sample size of a multi-arm multi-stage study with time-to-event endpoints with K active treatments plus control in which all promising treatments are continued at interim analyses as described in Magirr et al (2012). It is a wrapper around the basic <code><a href="#topic+mams">mams</a></code> function to facilitate its use with time-to-event endpoints, following ideas of Jaki &amp; Magirr (2013). Note that the sample size is calculated as the required number of events, from which the total sample size can be estimated (e.g., Whitehead 2001). See <code>?mams</code> for further details on the basic methodology.<br />
</p>


<h3>Value</h3>

<p>An object of the class MAMS containing the following components:<br /> 
</p>
<table>
<tr><td><code>l</code></td>
<td>
<p>Lower boundary.</p>
</td></tr>
<tr><td><code>u</code></td>
<td>
<p>Upper boundary.</p>
</td></tr>
<tr><td><code>n</code></td>
<td>
<p>Sample size on control in stage 1.</p>
</td></tr>
<tr><td><code>N</code></td>
<td>
<p>Maximum total sample size.</p>
</td></tr>
<tr><td><code>K</code></td>
<td>
<p>Number of experimental treatments.</p>
</td></tr>
<tr><td><code>J</code></td>
<td>
<p>Number of stages in the trial.</p>
</td></tr>
<tr><td><code>alpha</code></td>
<td>
<p>Familywise error rate.</p>
</td></tr>
<tr><td><code>alpha.star</code></td>
<td>
<p>Cumulative familywise error rate spent by each analysis.</p>
</td></tr>
<tr><td><code>power</code></td>
<td>
<p>Power under least favorable configuration.</p>
</td></tr>
<tr><td><code>rMat</code></td>
<td>
<p>Matrix of allocation ratios. First row corresponds to control while subsequent rows are for the experimental treatments.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Philip Pallmann, Dominic Magirr</p>


<h3>References</h3>

<p>Jaki T. and Magirr D. (2013), <em>Considerations on covariates and endpoints in multi-arm multi-stage clinical trials selecting all promising treatments</em>, 
<b>Statistics in Medicine</b>, 32(7), 1150-1163. Link: <a href="https://doi.org/10.1002/sim.5669">doi:10.1002/sim.5669</a>
</p>
<p>Jaki T., Pallmann P. and Magirr D. (2019), <em>The R Package MAMS for Designing Multi-Arm Multi-Stage Clinical Trials</em>, <b>Journal of Statistical Software</b>, 88(4), 1-25. Link: <a href="https://doi.org/10.18637/jss.v088.i04">doi:10.18637/jss.v088.i04</a>
</p>
<p>Magirr D., Jaki T. and Whitehead J. (2012), <em>A generalized Dunnett test for multi-arm multi-stage clinical studies with treatment selection</em>, <b>Biometrika</b>, 99(2), 494-501. Link: <a href="https://doi.org/10.1093/biomet/ass002">doi:10.1093/biomet/ass002</a>
</p>
<p>Whitehead J. (2001), <em>Predicting the duration of sequential survival studies</em>, <b>Drug Information Journal</b>, 35(4), 1387-1400.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+print.MAMS">print.MAMS</a></code>, <code><a href="#topic+summary.MAMS">summary.MAMS</a></code>, <code><a href="#topic+plot.MAMS">plot.MAMS</a></code>, <code><a href="#topic+mams">mams</a></code>, <code><a href="#topic+MAMS">MAMS</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## An example 2-stage design with triangular efficacy and futility boundaries
tite.mams(hr=2, hr0=1.5, K=3, J=2, alpha=0.05, power=0.9,
          r=1:2, r0=1:2, ushape="triangular", lshape="triangular")
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
