<!DOCTYPE html><html><head><title>Help for package causalCmprsk</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {causalCmprsk}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#causalCmprsk'><p>Estimation of Average Treatment Effects (ATE) of Point Intervention on Time-to-Event Outcomes with Competing Risks</p></a></li>
<li><a href='#fit.cox'><p>Cox-based estimation of ATE corresponding to the target population</p></a></li>
<li><a href='#fit.nonpar'><p>Nonparametric estimation of ATE corresponding to the target population</p></a></li>
<li><a href='#get.numAtRisk'><p>Number-at-risk in raw and weighted data</p></a></li>
<li><a href='#get.pointEst'><p>Returns point estimates and <code>conf.level</code>% confidence intervals corresponding to a specific time point</p></a></li>
<li><a href='#get.weights'><p>Fitting a logistic regression model for propensity scores and estimating weights</p></a></li>
<li><a href='#summary.cmprsk'><p>Summary of Event-specific Cumulative Hazards, Cumulative Incidence Functions and Various Treatment Effects</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Nonparametric and Cox-Based Estimation of Average Treatment
Effects in Competing Risks</td>
</tr>
<tr>
<td>Version:</td>
<td>2.0.0</td>
</tr>
<tr>
<td>Description:</td>
<td>Estimation of average treatment effects (ATE) of point interventions on time-to-event outcomes with K competing risks (K can be 1). The method uses propensity scores and inverse probability weighting for emulation of baseline randomization, which is described in Charpignon et al. (2022) &lt;<a href="https://doi.org/10.1038%2Fs41467-022-35157-w">doi:10.1038/s41467-022-35157-w</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.0.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>survival, inline, doParallel, parallel, utils, foreach,
data.table, purrr, methods</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, bookdown, tidyverse, ggalt, cobalt, ggsci,
modEvA, naniar, DT, Hmisc, hrbrthemes, summarytools</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/Bella2001/causalCmprsk">https://github.com/Bella2001/causalCmprsk</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/Bella2001/causalCmprsk/issues">https://github.com/Bella2001/causalCmprsk/issues</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-07-04 14:40:06 UTC; blagun</td>
</tr>
<tr>
<td>Author:</td>
<td>Bella Vakulenko-Lagun [aut, cre],
  Colin Magdamo [aut],
  Marie-Laure Charpignon [aut],
  Bang Zheng [aut],
  Mark Albers [aut],
  Sudeshna Das [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Bella Vakulenko-Lagun &lt;blagun@stat.haifa.ac.il&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-07-04 17:23:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='causalCmprsk'>Estimation of Average Treatment Effects (ATE) of Point Intervention on Time-to-Event Outcomes with Competing Risks</h2><span id='topic+causalCmprsk'></span>

<h3>Description</h3>

<p>The package accompanies the paper of Charpignon et al. (2022).
It can be applied to data with any number of competing events, including the case of only one type of event.
The method uses propensity scores weighting for emulation of baseline randomization.
The package implements different types of weights: ATE, stabilized ATE,
ATT, ATC and overlap weights, as described in Li et al. (2018),
and different treatment effect measures (hazard ratios, risk differences, risk ratios,
and restricted mean time differences).
</p>


<h3>Details</h3>

<p>The <span class="pkg">causalCmprsk</span> package provides two main functions:
<code><a href="#topic+fit.cox">fit.cox</a></code> that assumes Cox proportional hazards structural models for cause-specific hazards,
and <code><a href="#topic+fit.nonpar">fit.nonpar</a></code> that does not assume any model for potential outcomes.
The function <code><a href="#topic+get.weights">get.weights</a></code> returns estimated weights that are aimed for
emulation of a baseline randomization in observational data where the treatment was not assigned randomly, and where conditional exchangeability is assumed.
The function <code><a href="#topic+get.pointEst">get.pointEst</a></code> extracts a point estimate corresponding to a specific time point
from the time-varying functionals returned by <code><a href="#topic+fit.cox">fit.cox</a></code> and <code><a href="#topic+fit.nonpar">fit.nonpar</a></code>.
The function <code><a href="#topic+get.numAtRisk">get.numAtRisk</a></code> allows to obtain the number-at-risk statistic
in the raw and weighted data.
</p>


<h3>References</h3>

<p>M.-L. Charpignon, B. Vakulenko-Lagun, B. Zheng, C. Magdamo, B. Su, K.E. Evans, S. Rodriguez, et al. 2022. Causal inference in medical records and complementary systems pharmacology for metformin drug repurposing towards dementia. Nature Communications 13:7652.
</p>
<p>F. Li, K.L. Morgan, and A.M. Zaslavsky. 2018. Balancing Covariates via Propensity Score Weighting. Journal of the American Statistical Association 113 (521): 390–400.
</p>

<hr>
<h2 id='fit.cox'>Cox-based estimation of ATE corresponding to the target population</h2><span id='topic+fit.cox'></span>

<h3>Description</h3>

<p>Implements Cox-based estimation  of ATE assuming a structural proportional hazards model for two potential outcomes.
It provides three measures of treatment effects on time-to-event outcomes:
(1) cause-specific hazard ratios which are time-dependent measures under a nonparametric model,
(2) risk-based measures such as cause-specific risk differences and cause-specific risk ratios, and
(3) restricted-mean-time differences which quantify how much time on average was lost (or gained)
due to treatment by some specified time point.
Please see our package vignette for more details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fit.cox(
  df,
  X,
  E,
  trt.formula,
  A,
  C = NULL,
  wtype = "unadj",
  cens = 0,
  conf.level = 0.95,
  bs = FALSE,
  nbs.rep = 400,
  seed = 17,
  parallel = FALSE,
  verbose = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fit.cox_+3A_df">df</code></td>
<td>
<p>a data frame that includes time-to-event <code>X</code>, type of event <code>E</code>,
a treatment indicator <code>A</code>  and covariates <code>C</code>.</p>
</td></tr>
<tr><td><code id="fit.cox_+3A_x">X</code></td>
<td>
<p>a character string specifying the name of the time-to-event variable in <code>df</code>.</p>
</td></tr>
<tr><td><code id="fit.cox_+3A_e">E</code></td>
<td>
<p>a character string specifying the name of the &quot;event type&quot; variable in <code>df</code>.</p>
</td></tr>
<tr><td><code id="fit.cox_+3A_trt.formula">trt.formula</code></td>
<td>
<p>a formula expression, of the form <code>response ~ predictors</code>.
The <code>response</code> is a binary treatment/exposure variable,
for which a logistic regression model (a  Propensity Scores model) will be fit using <code>glm</code>.
See the documentation of <code>glm</code> and <code>formula</code> for details. As an alternative to specifying <code>formula</code>,
arguments <code>A</code> and <code>C</code>, defined below, can be specified.
Either <code>formula</code> or a pair of <code>A</code> and <code>C</code> must be specified.</p>
</td></tr>
<tr><td><code id="fit.cox_+3A_a">A</code></td>
<td>
<p>a character specifying the name of the treatment/exposure variable.
It is assumed that <code>A</code> is a numeric binary indicator with 0/1 values, where <code>A</code>=1
is assumed a treatment group, and <code>A</code>=0 a control group.</p>
</td></tr>
<tr><td><code id="fit.cox_+3A_c">C</code></td>
<td>
<p>a vector of character strings with variable names (potential confounders)
in the logistic regression model for Propensity Scores, i.e. P(A=1|C=c).
The default value of <code>C</code> is NULL corresponding to <code>wtype</code>=&quot;unadj&quot;
that will estimate treatment effects in the raw (observed) data.</p>
</td></tr>
<tr><td><code id="fit.cox_+3A_wtype">wtype</code></td>
<td>
<p>a character string variable indicating the type of weights that will define the target
population for which the ATE will be estimated.
The default is &quot;unadj&quot; - this will not adjust for possible
treatment selection bias and will not use propensity scores weighting. It can be used, for example,
in data from a randomized controlled trial (RCT) where there is no need for emulation of baseline randomization.
Other possible values are &quot;stab.ATE&quot;, &quot;ATE&quot;, &quot;ATT&quot;, &quot;ATC&quot; and &quot;overlap&quot;.
See Table 1 from Li, Morgan, and Zaslavsky (2018).
&quot;stab.ATE&quot; is defined as P(A=a)/P(A=a|C=c) - see Hernán et al. (2000).</p>
</td></tr>
<tr><td><code id="fit.cox_+3A_cens">cens</code></td>
<td>
<p>an integer value in <code>E</code> that corresponds to censoring times recorded in <code>X</code>.
By default <code>fit.nonpar</code> assumes <code>cens</code>=0</p>
</td></tr>
<tr><td><code id="fit.cox_+3A_conf.level">conf.level</code></td>
<td>
<p>the confidence level that will be used in the bootstrap confidence intervals.
The default is 0.95</p>
</td></tr>
<tr><td><code id="fit.cox_+3A_bs">bs</code></td>
<td>
<p>a logical flag indicating whether to perform bootstrap in order to obtain confidence intervals. There are no
analytical confidence intervals in <code>fit.nonpar</code></p>
</td></tr>
<tr><td><code id="fit.cox_+3A_nbs.rep">nbs.rep</code></td>
<td>
<p>number of bootstrap replications</p>
</td></tr>
<tr><td><code id="fit.cox_+3A_seed">seed</code></td>
<td>
<p>the random seed for the bootstrap, in order to make the results reproducible</p>
</td></tr>
<tr><td><code id="fit.cox_+3A_parallel">parallel</code></td>
<td>
<p>a logical flag indicating whether to perform bootstrap sequentially or in parallel,
using several cores simultaneously. The default value is FALSE. In parallel execution, the number
of available cores is detected, and the parallel jobs are assigned to the number of
detected available cores minus one.</p>
</td></tr>
<tr><td><code id="fit.cox_+3A_verbose">verbose</code></td>
<td>
<p>a logical flag indicating whether to show a progress of bootstrap.
The progress bar is shown only for sequential bootstrap computation.
The default value is FALSE.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of class <code>cmprsk</code> with the following fields:
</p>

<table>
<tr>
 <td style="text-align: left;">
<code>time</code>  </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;"> a vector of time points for which all the parameters are estimated </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>trt.0</code> </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;"> a list of estimates of the counterfactual parameters
corresponding to <code>A</code>=0 and the type of event <code>E</code>. <code>trt.0</code>
has K
 fields as the number of competing events in the data set.
For each competing risk there is a list of point estimates, their standard errors and
<code>conf.level</code>% confidence intervals:  </td>
</tr>
<tr>
 <td style="text-align: left;"> </td>
</tr>

</table>


<ul>
<li><p><code>CumHaz</code> a vector of cumulative hazard estimates
</p>
</li>
<li><p><code>CIF</code> a vector of cumulative incidence functions (CIF)
</p>
</li>
<li><p><code>RMT</code> a vector of restricted mean time (RMT) estimates
</p>
</li>
<li><p><code>CumHaz.CI.L</code> a vector of bootstrap-based quantile estimate of
lower confidence limits for cumulative hazard estimates
</p>
</li>
<li><p><code>CumHaz.CI.U</code> a vector of bootstrap-based quantile estimate of
upper confidence limits for cumulative hazard estimates
</p>
</li>
<li><p><code>CumHaz.SE</code> a vector of the bootstrap-based estimated standard errors
of cumulative hazard estimates
</p>
</li>
<li><p><code>CIF.CI.L</code> a vector of bootstrap-based quantile estimate of
lower confidence limits for CIF estimates
</p>
</li>
<li><p><code>CIF.CI.U</code> a vector of bootstrap-based quantile estimate of
upper confidence limits for CIF estimates
</p>
</li>
<li><p><code>CIF.SE</code> a vector of bootstrap-based estimated standard error
of CIF estimates
</p>
</li>
<li><p><code>RMT.CI.L</code> a vector of bootstrap-based quantile estimate of
lower confidence limits for RMT estimates
</p>
</li>
<li><p><code>RMT.CI.U</code> a vector of bootstrap-based quantile estimate of
upper confidence limits for RMT estimates
</p>
</li>
<li><p><code>RMT.SE</code> a vector of the bootstrap-based estimated standard errors
of RMT estimates
</p>
</li>
<li><p><code>bs.CumHaz</code> a matrix of dimension <code>nbs.rep</code> by the length of <code>time</code> vector,
with cumulative hazard estimates for <code>nbs.rep</code> bootstrap samples
</p>
</li></ul>


<table>
<tr>
 <td style="text-align: left;">
<code>trt.1</code> </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;"> a list of estimates of the counterfactual parameters
corresponding to <code>A</code>=1 and the type of event <code>E</code>. <code>trt.1</code> has K
 fields as the number of competing events (risks) in the data set.
For each competing risk there is a list of point estimates:  </td>
</tr>
<tr>
 <td style="text-align: left;"> </td>
</tr>

</table>


<ul>
<li><p><code>CumHaz</code> a vector of cumulative hazard estimates
</p>
</li>
<li><p><code>CIF</code> a vector of cumulative incidence functions
</p>
</li>
<li><p><code>RMT</code> a vector of restricted mean time estimates
</p>
</li>
<li><p><code>CumHaz.CI.L</code> a vector of bootstrap-based quantile estimate of
lower confidence limits for cumulative hazard estimates
</p>
</li>
<li><p><code>CumHaz.CI.U</code> a vector of bootstrap-based quantile estimate of
upper confidence limits for cumulative hazard estimates
</p>
</li>
<li><p><code>CumHaz.SE</code> a vector of the bootstrap-based estimated standard errors
of cumulative hazard estimates
</p>
</li>
<li><p><code>CIF.CI.L</code> a vector of bootstrap-based quantile estimate of
lower confidence limits for CIF estimates
</p>
</li>
<li><p><code>CIF.CI.U</code> a vector of bootstrap-based quantile estimate of
upper confidence limits for CIF estimates
</p>
</li>
<li><p><code>CIF.SE</code> a vector of bootstrap-based estimated standard error
for CIF estimates
</p>
</li>
<li><p><code>RMT.CI.L</code> a vector of bootstrap-based quantile estimate of
lower confidence limits for RMT estimates
</p>
</li>
<li><p><code>RMT.CI.U</code> a vector of bootstrap-based quantile estimate of
upper confidence limits for RMT estimates
</p>
</li>
<li><p><code>RMT.SE</code> a vector of the bootstrap-based estimated standard errors
of the RMT estimates
</p>
</li>
<li><p><code>bs.CumHaz</code> a matrix of dimension <code>nbs.rep</code> by the length of <code>time</code> vector,
with cumulative hazard estimates for <code>nbs.rep</code> bootstrap samples
</p>
</li></ul>


<table>
<tr>
 <td style="text-align: left;">
<code>trt.eff</code> </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;"> a list of estimates of the treatment effect measures
corresponding to the type of event <code>E</code>. <code>trt.eff</code> has the number of
 fields as the number of different types of events (risks)  in the data set.
For each competing risk there is a list of estimates: </td>
</tr>

</table>


<ul>
<li><p><code>log.CumHazR</code> an estimate of the log of the hazard ratio.
It is a scalar since the Cox model is assumed.
</p>
</li>
<li><p><code>RD</code> a vector of time-varying Risk Difference between two treatment arms
</p>
</li>
<li><p><code>RR</code> a vector of time-varying Risk Ratio between two treatment arms
</p>
</li>
<li><p><code>ATE.RMT</code> a vector of the time-varying Restricted Mean Time Difference
between two treatment arms
</p>
</li>
<li><p><code>log.CumHazR.CI.L</code> a bootstrap-based quantile estimate of the
lower confidence limit of <code>log.CumHazR</code>
</p>
</li>
<li><p><code>log.CumHazR.CI.U</code> a bootstrap-based quantile estimate of the
upper confidence limit of <code>log.CumHazR</code>
</p>
</li>
<li><p><code>log.CumHazR.SE</code> a bootstrap-based estimated standard error
of <code>log.CumHazR</code>
</p>
</li>
<li><p><code>log.CumHazR.pvalue</code> p-value from a Wald test of a two-sided hypothesis H0: HR(A=1)/HR(A=0)=1
</p>
</li>
<li><p><code>RD.CI.L</code> a vector of bootstrap-based quantile estimates of the
lower confidence limits of the Risk Difference estimates
</p>
</li>
<li><p><code>RD.CI.U</code> a vector of bootstrap-based quantile estimate of the
upper confidence limits of the Risk Difference estimates
</p>
</li>
<li><p><code>RD.SE</code> a vector of the bootstrap-based estimated standard errors
of the Risk Difference
</p>
</li>
<li><p><code>RR.CI.L</code> a vector of bootstrap-based quantile estimates of the
lower confidence limits of the Risk Ratio estimates
</p>
</li>
<li><p><code>RR.CI.U</code> a vector of bootstrap-based quantile estimate of the
upper confidence limits of the Risk Ratio estimates
</p>
</li>
<li><p><code>RR.SE</code> a vector of the bootstrap-based estimated standard errors
of the Risk Ratio
</p>
</li>
<li><p><code>ATE.RMT.CI.L</code> a vector of bootstrap-based quantile estimate of
lower confidence limits for the RMT difference estimates
</p>
</li>
<li><p><code>ATE.RMT.CI.U</code> a vector of bootstrap-based quantile estimate of
upper confidence limits for the RMT difference estimates
</p>
</li>
<li><p><code>ATE.RMT.SE</code> a vector of bootstrap-based estimated standard errors
of the RMT difference estimates
</p>
</li></ul>



<h3>References</h3>

<p>F. Li, K.L. Morgan, and A.M. Zaslavsky. 2018. Balancing Covariates via Propensity Score Weighting. Journal of the American Statistical Association, 113 (521): 390–400.
</p>
<p>M.A. Hernán, B. Brumback, and J.M. Robins. 2000. Marginal structural models and to estimate the causal effect of zidovudine on the survival of HIV-positive men. Epidemiology, 11 (5): 561-570.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fit.nonpar">fit.nonpar</a></code>, <code><a href="#topic+get.pointEst">get.pointEst</a></code>, <code><a href="#topic+causalCmprsk">causalCmprsk</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># create a data set
n &lt;- 1000
set.seed(7)
c1 &lt;- runif(n)
c2 &lt;- as.numeric(runif(n)&lt; 0.2)
set.seed(77)
cf.m.T1 &lt;- rweibull(n, shape=1, scale=exp(-(-1 + 2*c1)))
cf.m.T2 &lt;-  rweibull(n, shape=1, scale=exp(-(1 + 1*c2)))
cf.m.T &lt;- pmin( cf.m.T1, cf.m.T2)
cf.m.E &lt;- rep(0, n)
cf.m.E[cf.m.T1&lt;=cf.m.T2] &lt;- 1
cf.m.E[cf.m.T2&lt;cf.m.T1] &lt;- 2
set.seed(77)
cf.s.T1 &lt;- rweibull(n, shape=1, scale=exp(-1*c1 ))
cf.s.T2 &lt;-  rweibull(n, shape=1, scale=exp(-2*c2))
cf.s.T &lt;- pmin( cf.s.T1, cf.s.T2)
cf.s.E &lt;- rep(0, n)
cf.s.E[cf.s.T1&lt;=cf.s.T2] &lt;- 1
cf.s.E[cf.s.T2&lt;cf.s.T1] &lt;- 2
exp.z &lt;- exp(0.5 + 1*c1 - 1*c2)
pr &lt;- exp.z/(1+exp.z)
TRT &lt;- ifelse(runif(n)&lt; pr, 1, 0)
X &lt;- ifelse(TRT==1, cf.m.T, cf.s.T)
E &lt;- ifelse(TRT==1, cf.m.E, cf.s.E)
covs.names &lt;- c("c1", "c2")
data &lt;- data.frame(X=X, E=E, TRT=TRT, c1=c1, c2=c2)
form.txt &lt;- paste0("TRT", " ~ ", paste0(covs.names, collapse = "+"))
trt.formula &lt;- as.formula(form.txt)
wei &lt;- get.weights(formula=trt.formula, data=data, wtype = "overlap")
hist(wei$ps[data$TRT==1], col="red", breaks = seq(0,1,0.05))
hist(wei$ps[data$TRT==0], col="blue", breaks = seq(0,1,0.05))
# Cox-based estimation:
res.cox.ATE &lt;- fit.cox(df=data, X="X", E="E", trt.formula=trt.formula, wtype="stab.ATE")
cox.pe &lt;- get.pointEst(res.cox.ATE, 0.5)
cox.pe$trt.eff[[1]]$RD

# please see our package vignette for practical examples

</code></pre>

<hr>
<h2 id='fit.nonpar'>Nonparametric estimation of ATE corresponding to the target population</h2><span id='topic+fit.nonpar'></span>

<h3>Description</h3>

<p>Implements nonparametric estimation (based on the weighted Aalen-Johansen estimator) of ATE meaning that
it does not assume any model for potential outcomes.
It provides three measures of treatment effects on time-to-event outcomes:
(1) cause-specific hazard ratios which are time-dependent measures under a nonparametric model,
(2) risk-based measures such as cause-specific risk differences and cause-specific risk ratios, and
(3) restricted-mean-time differences which quantify how much time on average was lost (or gained)
due to treatment by some specified time point.
Please see our package vignette for more details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fit.nonpar(
  df,
  X,
  E,
  trt.formula,
  A,
  C = NULL,
  wtype = "unadj",
  cens = 0,
  conf.level = 0.95,
  bs = FALSE,
  nbs.rep = 400,
  seed = 17,
  parallel = FALSE,
  verbose = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fit.nonpar_+3A_df">df</code></td>
<td>
<p>a data frame that includes time-to-event <code>X</code>, type of event <code>E</code>,
a treatment indicator <code>A</code>  and covariates <code>C</code>.</p>
</td></tr>
<tr><td><code id="fit.nonpar_+3A_x">X</code></td>
<td>
<p>a character string specifying the name of the time-to-event variable in <code>df</code>.</p>
</td></tr>
<tr><td><code id="fit.nonpar_+3A_e">E</code></td>
<td>
<p>a character string specifying the name of the &quot;event type&quot; variable in <code>df</code>.</p>
</td></tr>
<tr><td><code id="fit.nonpar_+3A_trt.formula">trt.formula</code></td>
<td>
<p>a formula expression, of the form <code>response ~ predictors</code>.
The <code>response</code> is a binary treatment/exposure variable,
for which a logistic regression model (a  Propensity Scores model) will be fit using <code>glm</code>.
See the documentation of <code>glm</code> and <code>formula</code> for details. As an alternative to specifying <code>formula</code>,
arguments <code>A</code> and <code>C</code>, defined below, can be specified.
Either <code>formula</code> or a pair of <code>A</code> and <code>C</code> must be specified.</p>
</td></tr>
<tr><td><code id="fit.nonpar_+3A_a">A</code></td>
<td>
<p>a character specifying the name of the treatment/exposure variable.
It is assumed that <code>A</code> is a numeric binary indicator with 0/1 values, where <code>A</code>=1
is assumed a treatment group, and <code>A</code>=0 a control group.</p>
</td></tr>
<tr><td><code id="fit.nonpar_+3A_c">C</code></td>
<td>
<p>a vector of character strings with variable names (potential confounders)
in the logistic regression model for Propensity Scores, i.e. P(A=1|C=c).
The default value of <code>C</code> is NULL corresponding to <code>wtype</code>=&quot;unadj&quot;
that will estimate treatment effects in the raw (observed) data.</p>
</td></tr>
<tr><td><code id="fit.nonpar_+3A_wtype">wtype</code></td>
<td>
<p>a character string variable indicating the type of weights that will define the target
population for which the ATE will be estimated.
The default is &quot;unadj&quot; - this will not adjust for possible
treatment selection bias and will not use propensity scores weighting. It can be used, for example,
in data from a randomized controlled trial (RCT) where there is no need for emulation of baseline randomization.
Other possible values are &quot;stab.ATE&quot;, &quot;ATE&quot;, &quot;ATT&quot;, &quot;ATC&quot; and &quot;overlap&quot;.
See Table 1 from Li, Morgan, and Zaslavsky (2018).
&quot;stab.ATE&quot; is defined as P(A=a)/P(A=a|C=c) - see Hernán et al. (2000).</p>
</td></tr>
<tr><td><code id="fit.nonpar_+3A_cens">cens</code></td>
<td>
<p>an integer value in <code>E</code> that corresponds to censoring times recorded in <code>X</code>.
By default <code>fit.nonpar</code> assumes <code>cens</code>=0</p>
</td></tr>
<tr><td><code id="fit.nonpar_+3A_conf.level">conf.level</code></td>
<td>
<p>the confidence level that will be used in the bootstrap confidence intervals.
The default is 0.95</p>
</td></tr>
<tr><td><code id="fit.nonpar_+3A_bs">bs</code></td>
<td>
<p>a logical flag indicating whether to perform bootstrap in order to obtain confidence intervals. There are no
analytical confidence intervals in <code>fit.nonpar</code></p>
</td></tr>
<tr><td><code id="fit.nonpar_+3A_nbs.rep">nbs.rep</code></td>
<td>
<p>number of bootstrap replications</p>
</td></tr>
<tr><td><code id="fit.nonpar_+3A_seed">seed</code></td>
<td>
<p>the random seed for the bootstrap, in order to make the results reproducible</p>
</td></tr>
<tr><td><code id="fit.nonpar_+3A_parallel">parallel</code></td>
<td>
<p>a logical flag indicating whether to perform bootstrap sequentially or in parallel,
using several cores simultaneously. The default value is FALSE. In parallel execution, the number
of available cores is detected, and the parallel jobs are assigned to the number of
detected available cores minus one.</p>
</td></tr>
<tr><td><code id="fit.nonpar_+3A_verbose">verbose</code></td>
<td>
<p>a logical flag indicating whether to show a progress of bootstrap.
The progress bar is shown only for sequential bootstrap computation.
The default value is FALSE.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of class <code>cmprsk</code> with the following fields:
</p>

<table>
<tr>
 <td style="text-align: left;">
<code>time</code>  </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;"> a vector of time points for which all the parameters are estimated </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>trt.0</code> </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;"> a list of estimates of the absolute counterfactual parameters
corresponding to <code>A</code>=0 and the type of event <code>E</code>. <code>trt.0</code> has the number of
 fields as the number of different types of events in the data set.
For each type of event there is a list of estimates:  </td>
</tr>
<tr>
 <td style="text-align: left;"> </td>
</tr>

</table>


<ul>
<li><p><code>CumHaz</code> a vector of cumulative hazard estimates
</p>
</li>
<li><p><code>CIF</code> a vector of cumulative incidence functions (CIF)
</p>
</li>
<li><p><code>RMT</code> a vector of restricted mean time (RMT) estimates
</p>
</li>
<li><p><code>CumHaz.CI.L</code> a vector of bootstrap-based quantile estimate of
lower confidence limits for cumulative hazard estimates
</p>
</li>
<li><p><code>CumHaz.CI.U</code> a vector of bootstrap-based quantile estimate of
upper confidence limits for cumulative hazard estimates
</p>
</li>
<li><p><code>CumHaz.SE</code> a vector of the bootstrap-based estimated standard errors
of cumulative hazard estimates
</p>
</li>
<li><p><code>CIF.CI.L</code> a vector of bootstrap-based quantile estimate of
lower confidence limits for CIF estimates
</p>
</li>
<li><p><code>CIF.CI.U</code> a vector of bootstrap-based quantile estimate of
upper confidence limits for CIF estimates
</p>
</li>
<li><p><code>CIF.SE</code> a vector of bootstrap-based estimated standard error
of CIF estimates
</p>
</li>
<li><p><code>RMT.CI.L</code> a vector of bootstrap-based quantile estimate of
lower confidence limits for RMT estimates
</p>
</li>
<li><p><code>RMT.CI.U</code> a vector of bootstrap-based quantile estimate of
upper confidence limits for RMT estimates
</p>
</li>
<li><p><code>RMT.SE</code> a vector of the bootstrap-based estimated standard errors
of RMT estimates
</p>
</li>
<li><p><code>bs.CumHaz</code> a matrix of dimension <code>nbs.rep</code> by the length of <code>time</code> vector,
with cumulative hazard estimates for <code>nbs.rep</code> bootstrap samples
</p>
</li></ul>


<table>
<tr>
 <td style="text-align: left;">
<code>trt.1</code> </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;"> a list of estimates of the absolute counterfactual parameters
corresponding to <code>A</code>=1 and the type of event <code>E</code>. <code>trt.1</code> has the number of
 fields as the number of different types of events  in the data set.
For each type of event there is a list of estimates:  </td>
</tr>
<tr>
 <td style="text-align: left;"> </td>
</tr>

</table>


<ul>
<li><p><code>CumHaz</code> a vector of cumulative hazard estimates
</p>
</li>
<li><p><code>CIF</code> a vector of cumulative incidence functions
</p>
</li>
<li><p><code>RMT</code> a vector of restricted mean time estimates
</p>
</li>
<li><p><code>CumHaz.CI.L</code> a vector of bootstrap-based quantile estimate of
lower confidence limits for cumulative hazard estimates
</p>
</li>
<li><p><code>CumHaz.CI.U</code> a vector of bootstrap-based quantile estimate of
upper confidence limits for cumulative hazard estimates
</p>
</li>
<li><p><code>CumHaz.SE</code> a vector of the bootstrap-based estimated standard errors
of cumulative hazard estimates
</p>
</li>
<li><p><code>CIF.CI.L</code> a vector of bootstrap-based quantile estimate of
lower confidence limits for CIF estimates
</p>
</li>
<li><p><code>CIF.CI.U</code> a vector of bootstrap-based quantile estimate of
upper confidence limits for CIF estimates
</p>
</li>
<li><p><code>CIF.SE</code> a vector of bootstrap-based estimated standard error
for CIF estimates
</p>
</li>
<li><p><code>RMT.CI.L</code> a vector of bootstrap-based quantile estimate of
lower confidence limits for RMT estimates
</p>
</li>
<li><p><code>RMT.CI.U</code> a vector of bootstrap-based quantile estimate of
upper confidence limits for RMT estimates
</p>
</li>
<li><p><code>RMT.SE</code> a vector of the bootstrap-based estimated standard errors
of the RMT estimates
</p>
</li>
<li><p><code>bs.CumHaz</code> a matrix of dimension <code>nbs.rep</code> by the length of <code>time</code> vector,
with cumulative hazard estimates for <code>nbs.rep</code> bootstrap samples
</p>
</li></ul>


<table>
<tr>
 <td style="text-align: left;">
<code>trt.eff</code> </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;"> a list of estimates of the treatment effect measures
corresponding to the type of event <code>E</code>. <code>trt.eff</code> has the number of
 fields as the number of different types of events  in the data set.
For each type of event there is a list of estimates: </td>
</tr>

</table>


<ul>
<li><p><code>log.CumHazR</code> a vector of the log of the time-varying ratio of hazards in two treatment arms
</p>
</li>
<li><p><code>RD</code> a vector of time-varying Risk Difference between two treatment arms
</p>
</li>
<li><p><code>RR</code> a vector of time-varying Risk Ratio between two treatment arms
</p>
</li>
<li><p><code>ATE.RMT</code> a vector of the time-varying Restricted Mean Time Difference
between two treatment arms
</p>
</li>
<li><p><code>log.CumHazR.CI.L</code> a vector of bootstrap-based quantile estimates of the
lower confidence limits of <code>log.CumHazR</code>
</p>
</li>
<li><p><code>log.CumHazR.CI.U</code> a vector of bootstrap-based quantile estimates of the
upper confidence limits of <code>log.CumHazR</code>
</p>
</li>
<li><p><code>log.CumHazR.SE</code> a vector of bootstrap-based estimated standard errors
of <code>log.CumHazR</code>
</p>
</li>
<li><p><code>RD.CI.L</code> a vector of bootstrap-based quantile estimates of the
lower confidence limits of the Risk Difference estimates
</p>
</li>
<li><p><code>RD.CI.U</code> a vector of bootstrap-based quantile estimate of the
upper confidence limits of the Risk Difference estimates
</p>
</li>
<li><p><code>RD.SE</code> a vector of the bootstrap-based estimated standard errors
of the Risk Difference
</p>
</li>
<li><p><code>RR.CI.L</code> a vector of bootstrap-based quantile estimates of the
lower confidence limits of the Risk Ratio estimates
</p>
</li>
<li><p><code>RR.CI.U</code> a vector of bootstrap-based quantile estimate of the
upper confidence limits of the Risk Ratio estimates
</p>
</li>
<li><p><code>RR.SE</code> a vector of the bootstrap-based estimated standard errors
of the Risk Ratio
</p>
</li>
<li><p><code>ATE.RMT.CI.L</code> a vector of bootstrap-based quantile estimate of
lower confidence limits for the RMT difference estimates
</p>
</li>
<li><p><code>ATE.RMT.CI.U</code> a vector of bootstrap-based quantile estimate of
upper confidence limits for the RMT difference estimates
</p>
</li>
<li><p><code>ATE.RMT.SE</code> a vector of bootstrap-based estimated standard errors
of the RMT difference estimates
</p>
</li></ul>



<h3>References</h3>

<p>F. Li, K.L. Morgan, and A.M. Zaslavsky. 2018. Balancing Covariates via Propensity Score Weighting. Journal of the American Statistical Association 113 (521): 390–400.
</p>
<p>M.A. Hernán, B. Brumback, and J.M. Robins. 2000. Marginal structural models and to estimate the causal effect of zidovudine on the survival of HIV-positive men. Epidemiology, 11 (5): 561-570.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fit.cox">fit.cox</a></code>, <code><a href="#topic+get.pointEst">get.pointEst</a></code>, <code><a href="#topic+causalCmprsk">causalCmprsk</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># create a data set
n &lt;- 1000
set.seed(7)
c1 &lt;-  runif(n)
c2 &lt;- as.numeric(runif(n)&lt; 0.2)
set.seed(77)
cf.m.T1 &lt;- rweibull(n, shape=1, scale=exp(-(-1 + 2*c1)))
cf.m.T2 &lt;-  rweibull(n, shape=1, scale=exp(-(1 + 1*c2)))
cf.m.T &lt;- pmin( cf.m.T1, cf.m.T2)
cf.m.E &lt;- rep(0, n)
cf.m.E[cf.m.T1&lt;=cf.m.T2] &lt;- 1
cf.m.E[cf.m.T2&lt;cf.m.T1] &lt;- 2
set.seed(77)
cf.s.T1 &lt;- rweibull(n, shape=1, scale=exp(-1*c1 ))
cf.s.T2 &lt;-  rweibull(n, shape=1, scale=exp(-2*c2))
cf.s.T &lt;- pmin( cf.s.T1, cf.s.T2)
cf.s.E &lt;- rep(0, n)
cf.s.E[cf.s.T1&lt;=cf.s.T2] &lt;- 1
cf.s.E[cf.s.T2&lt;cf.s.T1] &lt;- 2
exp.z &lt;- exp(0.5 + 1*c1 - 1*c2)
pr &lt;- exp.z/(1+exp.z)
TRT &lt;- ifelse(runif(n)&lt; pr, 1, 0)
X &lt;- ifelse(TRT==1, cf.m.T, cf.s.T)
E &lt;- ifelse(TRT==1, cf.m.E, cf.s.E)
covs.names &lt;- c("c1", "c2")
data &lt;- data.frame(X=X, E=E, TRT=TRT, c1=c1, c2=c2)
form.txt &lt;- paste0("TRT", " ~ ", paste0(covs.names, collapse = "+"))
trt.formula &lt;- as.formula(form.txt)
wei &lt;- get.weights(formula=trt.formula, data=data, wtype = "overlap")
hist(wei$ps[data$TRT==1], col="red", breaks = seq(0,1,0.05))
hist(wei$ps[data$TRT==0], col="blue", breaks = seq(0,1,0.05))
# Nonparametric estimation:
res.ATE &lt;- fit.nonpar(df=data, X="X", E="E", trt.formula=trt.formula, wtype="stab.ATE")
nonpar.pe &lt;- get.pointEst(res.ATE, 0.5)
nonpar.pe$trt.eff[[1]]$RD

# please see our package vignette for practical examples

</code></pre>

<hr>
<h2 id='get.numAtRisk'>Number-at-risk in raw and weighted data</h2><span id='topic+get.numAtRisk'></span>

<h3>Description</h3>

<p>Obtaining time-varying number-at-risk statistic in both raw and weighted data
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get.numAtRisk(df, X, E, A, C = NULL, wtype = "unadj", cens = 0)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get.numAtRisk_+3A_df">df</code></td>
<td>
<p>a data frame that includes time-to-event <code>X</code>, type of event <code>E</code>,
a treatment indicator <code>A</code>  and covariates <code>C</code>.</p>
</td></tr>
<tr><td><code id="get.numAtRisk_+3A_x">X</code></td>
<td>
<p>a character string specifying the name of the time-to-event variable in <code>df</code>.</p>
</td></tr>
<tr><td><code id="get.numAtRisk_+3A_e">E</code></td>
<td>
<p>a character string specifying the name of the &quot;event type&quot; variable in <code>df</code>.</p>
</td></tr>
<tr><td><code id="get.numAtRisk_+3A_a">A</code></td>
<td>
<p>a character specifying the name of the treatment/exposure variable.
It is assumed that <code>A</code> is a numeric binary indicator with 0/1 values, where <code>A</code>=1
is assumed a treatment group, and <code>A</code>=0 a control group.</p>
</td></tr>
<tr><td><code id="get.numAtRisk_+3A_c">C</code></td>
<td>
<p>a vector of character strings with variable names (potential confounders)
in the logistic regression model for Propensity Scores, i.e. P(A=1|C=c).
The default value of <code>C</code> is NULL corresponding to <code>wtype</code>=&quot;unadj&quot;
that will estimate treatment effects in the raw (observed) data.</p>
</td></tr>
<tr><td><code id="get.numAtRisk_+3A_wtype">wtype</code></td>
<td>
<p>a character string variable indicating the type of weights that will define the target
population for which the ATE will be estimated.
The default is &quot;unadj&quot; - this will not adjust for possible
treatment selection bias and will not use propensity scores weighting. It can be used, for example,
in data from a randized controlled trial (RCT) where there is no need for emulation of baseline randomization.
Other possible values are &quot;stab.ATE&quot;, &quot;ATE&quot;, &quot;ATT&quot;, &quot;ATC&quot; and &quot;overlap&quot;.
See Table 1 from Li, Morgan, and Zaslavsky (2018).
&quot;stab.ATE&quot; is defined as P(A=a)/P(A=a|C=c) - see Hernán et al. (2000).</p>
</td></tr>
<tr><td><code id="get.numAtRisk_+3A_cens">cens</code></td>
<td>
<p>an integer value in <code>E</code> that corresponds to censoring times recorded in <code>X</code>.
By default <code>fit.nonpar</code> assumes <code>cens</code>=0</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with two fields:
</p>

<ul>
<li><p><code>trt.0</code> a matrix with three columns, <code>time</code>, <code>num</code> and <code>sample</code>
corresponding to the treatment arm with <code>A</code>=0.
The results for both weighted and unadjusted number-at-risk are returnd in  a long-format matrix.
The column <code>time</code> is a vector of time points at which we calculate the number-at-risk.
The column <code>num</code> is the number-at-risk.
The column <code>sample</code> is a factor variable that gets one of two values, &quot;Weighted&quot; or &quot;Unadjusted&quot;.
The estimated number-at-risk in the weighted sample corresponds to the rows with <code>sample="Weighted"</code>.
</p>
</li>
<li><p><code>trt.1</code> a matrix with three columns, <code>time</code>, <code>num</code> and <code>sample</code>
corresponding to the treatment arm with <code>A</code>=1.
The results for both weighted and unadjusted number-at-risk are returnd in  a long-format matrix.
The column <code>time</code> is a vector of time points at which we calculate the number-at-risk.
The column <code>num</code> is the number-at-risk.
The column <code>sample</code> is a factor variable that gets one of two values, &quot;Weighted&quot; or &quot;Unadjusted&quot;.
The estimated number-at-risk in the weighted sample corresponds to the rows with <code>sample="Weighted"</code>.</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+get.weights">get.weights</a></code>, <code><a href="#topic+get.pointEst">get.pointEst</a></code>, <code><a href="#topic+causalCmprsk">causalCmprsk</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># create a data set
n &lt;- 1000
set.seed(7)
c1 &lt;- runif(n)
c2 &lt;- as.numeric(runif(n)&lt; 0.2)
set.seed(77)
cf.m.T1 &lt;- rweibull(n, shape=1, scale=exp(-(-1 + 2*c1)))
cf.m.T2 &lt;-  rweibull(n, shape=1, scale=exp(-(1 + 1*c2)))
cf.m.T &lt;- pmin( cf.m.T1, cf.m.T2)
cf.m.E &lt;- rep(0, n)
cf.m.E[cf.m.T1&lt;=cf.m.T2] &lt;- 1
cf.m.E[cf.m.T2&lt;cf.m.T1] &lt;- 2
set.seed(77)
cf.s.T1 &lt;- rweibull(n, shape=1, scale=exp(-1*c1 ))
cf.s.T2 &lt;-  rweibull(n, shape=1, scale=exp(-2*c2))
cf.s.T &lt;- pmin( cf.s.T1, cf.s.T2)
cf.s.E &lt;- rep(0, n)
cf.s.E[cf.s.T1&lt;=cf.s.T2] &lt;- 1
cf.s.E[cf.s.T2&lt;cf.s.T1] &lt;- 2
exp.z &lt;- exp(0.5 + 1*c1 - 1*c2)
pr &lt;- exp.z/(1+exp.z)
TRT &lt;- ifelse(runif(n)&lt; pr, 1, 0)
X &lt;- ifelse(TRT==1, cf.m.T, cf.s.T)
E &lt;- ifelse(TRT==1, cf.m.E, cf.s.E)
covs.names &lt;- c("c1", "c2")
data &lt;- data.frame(X=X, E=E, TRT=TRT, c1=c1, c2=c2)

num.atrisk &lt;- get.numAtRisk(data, "X", "E", "TRT", C=covs.names, wtype="overlap", cens=0)
plot(num.atrisk$trt.1$time[num.atrisk$trt.1$sample=="Weighted"],
     num.atrisk$trt.1$num[num.atrisk$trt.1$sample=="Weighted"], col="red", type="s",
     xlab="time", ylab="number at risk",
     main="Number at risk in TRT=1", ylim=c(0, max(num.atrisk$trt.1$num)))
lines(num.atrisk$trt.1$time[num.atrisk$trt.1$sample=="Unadjusted"],
      num.atrisk$trt.1$num[num.atrisk$trt.1$sample=="Unadjusted"], col="blue", type="s")
legend("topright", legend=c("Weighted", "Unadjusted"), lty=1:1,  col=c("red", "blue"))
plot(num.atrisk$trt.0$time[num.atrisk$trt.0$sample=="Weighted"],
     num.atrisk$trt.0$num[num.atrisk$trt.0$sample=="Weighted"], col="red", type="s",
     xlab="time", ylab="number at risk",
     main="Number at risk in TRT=0", ylim=c(0, max(num.atrisk$trt.0$num)))
lines(num.atrisk$trt.0$time[num.atrisk$trt.0$sample=="Unadjusted"],
      num.atrisk$trt.0$num[num.atrisk$trt.0$sample=="Unadjusted"], col="blue", type="s")
legend("topright", legend=c("Weighted", "Unadjusted"), lty=1:1,  col=c("red", "blue"))

</code></pre>

<hr>
<h2 id='get.pointEst'>Returns point estimates and <code>conf.level</code>% confidence intervals corresponding to a specific time point</h2><span id='topic+get.pointEst'></span>

<h3>Description</h3>

<p>The confidence interval returned by this function corresponds to the value <code>conf.level</code> passed to the function
<code>fit.cox</code> or <code>fit.nonpar</code>. The first input argument <code>cmprsk.obj</code> is a result corresponding to <code>conf.level</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get.pointEst(cmprsk.obj, timepoint)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get.pointEst_+3A_cmprsk.obj">cmprsk.obj</code></td>
<td>
<p>a <code>cmprsk</code> object returned by one of the functions <code>fit.cox</code> or <code>fit.nonpar</code></p>
</td></tr>
<tr><td><code id="get.pointEst_+3A_timepoint">timepoint</code></td>
<td>
<p>a scalar value of the time point of interest</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with the following fields:
</p>

<table>
<tr>
 <td style="text-align: left;">
<code>time</code>  </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;"> a scalar timepoint passed into the function </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>trt.0</code> </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;"> a list of estimates of the absolute counterfactual parameters
corresponding to <code>A</code>=0 and the type of event <code>E</code>. <code>trt.0</code> has the number of
 fields as the number of different types of events in the data set.
For each type of event there is a list of estimates:  </td>
</tr>
<tr>
 <td style="text-align: left;"> </td>
</tr>

</table>


<ul>
<li><p><code>CumHaz</code> a point estimate of the cumulative hazard
</p>
</li>
<li><p><code>CumHaz.CI.L</code> a bootstrap-based quantile estimate of a lower bound of a <code>conf.level</code>% confidence
interval for the cumulative hazard
</p>
</li>
<li><p><code>CumHaz.CI.U</code> a bootstrap-based quantile estimate of an upper bound of a <code>conf.level</code>% confidence
interval for the cumulative hazard
</p>
</li>
<li><p><code>CIF</code> a point estimate of the cumulative incidence function
</p>
</li>
<li><p><code>CIF.CI.L</code> a bootstrap-based quantile estimate of a lower bound of a <code>conf.level</code>% confidence
interval for the  cumulative incidence function
</p>
</li>
<li><p><code>CIF.CI.U</code> a bootstrap-based quantile estimate of an upper bound of a <code>conf.level</code>% confidence
interval for the cumulative incidence function
</p>
</li>
<li><p><code>RMT</code> a point estimate of the restricted mean time
</p>
</li>
<li><p><code>RMT.CI.L</code> a bootstrap-based quantile estimate of a lower bound of a <code>conf.level</code>% confidence
interval for the restricted mean time
</p>
</li>
<li><p><code>RMT.CI.U</code> a bootstrap-based quantile estimate of an upper bound of a <code>conf.level</code>% confidence
interval for the restricted mean time</p>
</li></ul>


<table>
<tr>
 <td style="text-align: left;">
<code>trt.1</code> </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;"> a list of estimates of the absolute counterfactual parameters
corresponding to <code>A</code>=1 and the type of event <code>E</code>. <code>trt.1</code> has the number of
 fields as the number of different types of events  in the data set.
For each type of event there is a list of estimates:  </td>
</tr>
<tr>
 <td style="text-align: left;"> </td>
</tr>

</table>


<ul>
<li><p><code>CumHaz</code> a point estimate of the cumulative hazard
</p>
</li>
<li><p><code>CumHaz.CI.L</code> a bootstrap-based quantile estimate of a lower bound of a <code>conf.level</code>% confidence
interval for the cumulative hazard
</p>
</li>
<li><p><code>CumHaz.CI.U</code> a bootstrap-based quantile estimate of an upper bound of a <code>conf.level</code>% confidence
interval for the cumulative hazard
</p>
</li>
<li><p><code>CIF</code> a point estimate of the cumulative incidence function
</p>
</li>
<li><p><code>CIF.CI.L</code> a bootstrap-based quantile estimate of a lower bound of a <code>conf.level</code>% confidence
interval for the  cumulative incidence function
</p>
</li>
<li><p><code>CIF.CI.U</code> a bootstrap-based quantile estimate of an upper bound of a <code>conf.level</code>% confidence
interval for the cumulative incidence function
</p>
</li>
<li><p><code>RMT</code> a point estimate of the restricted mean time
</p>
</li>
<li><p><code>RMT.CI.L</code> a bootstrap-based quantile estimate of a lower bound of a <code>conf.level</code>% confidence
interval for the restricted mean time
</p>
</li>
<li><p><code>RMT.CI.U</code> a bootstrap-based quantile estimate of an upper bound of a <code>conf.level</code>% confidence
interval for the restricted mean time</p>
</li></ul>


<table>
<tr>
 <td style="text-align: left;">
<code>trt.eff</code> </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;"> a list of estimates of the treatment effect measures
corresponding to the type of event <code>E</code>. <code>trt.eff</code> has the number of
 fields as the number of different types of events  in the data set.
For each type of event there is a list of estimates: </td>
</tr>

</table>


<ul>
<li><p><code>log.CumHazR</code> a point estimate of the log of the ratio of hazards between two treatment arms
</p>
</li>
<li><p><code>log.CumHazR.CI.L</code> a bootstrap-based quantile estimate of a lower bound of a <code>conf.level</code>% confidence
interval for the log of the ratio of hazards between two treatment arms
</p>
</li>
<li><p><code>log.CumHazR.CI.U</code> a bootstrap-based quantile estimate of an upper bound of a <code>conf.level</code>% confidence
interval for the log of the ratio of hazards between two treatment arms
</p>
</li>
<li><p><code>RD</code> a point estimate of the risk difference between two treatment arms
</p>
</li>
<li><p><code>RD.CI.L</code> a bootstrap-based quantile estimate of a lower bound of a <code>conf.level</code>% confidence
interval for the risk difference between two treatment arms
</p>
</li>
<li><p><code>RD.CI.U</code> a bootstrap-based quantile estimate of an upper bound of a <code>conf.level</code>% confidence
interval for the risk difference between two treatment arms
</p>
</li>
<li><p><code>RR</code> a point estimate of the risk ratio between two treatment arms
</p>
</li>
<li><p><code>RR.CI.L</code> a bootstrap-based quantile estimate of a lower bound of a <code>conf.level</code>% confidence
interval for the risk ratio between two treatment arms
</p>
</li>
<li><p><code>RR.CI.U</code> a bootstrap-based quantile estimate of an upper bound of a <code>conf.level</code>% confidence
interval for the risk ratio between two treatment arms
</p>
</li>
<li><p><code>ATE.RMT</code> a point estimate of the restricted mean time difference
between two treatment arms
</p>
</li>
<li><p><code>ATE.RMT.CI.L</code> a bootstrap-based quantile estimate of a lower bound of a <code>conf.level</code>% confidence
interval for the restricted mean time difference between two treatment arms
</p>
</li>
<li><p><code>ATE.RMT.CI.U</code> a bootstrap-based quantile estimate of an upper bound of a <code>conf.level</code>% confidence
interval for the restricted mean time difference between two treatment arms</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+fit.cox">fit.cox</a></code>, <code><a href="#topic+fit.nonpar">fit.nonpar</a></code>, <code><a href="#topic+causalCmprsk">causalCmprsk</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># create a data set
n &lt;- 1000
set.seed(7)
c1 &lt;-  runif(n)
c2 &lt;- as.numeric(runif(n)&lt; 0.2)
set.seed(77)
cf.m.T1 &lt;- rweibull(n, shape=1, scale=exp(-(-1 + 2*c1)))
cf.m.T2 &lt;-  rweibull(n, shape=1, scale=exp(-(1 + 1*c2)))
cf.m.T &lt;- pmin( cf.m.T1, cf.m.T2)
cf.m.E &lt;- rep(0, n)
cf.m.E[cf.m.T1&lt;=cf.m.T2] &lt;- 1
cf.m.E[cf.m.T2&lt;cf.m.T1] &lt;- 2
set.seed(77)
cf.s.T1 &lt;- rweibull(n, shape=1, scale=exp(-1*c1 ))
cf.s.T2 &lt;-  rweibull(n, shape=1, scale=exp(-2*c2))
cf.s.T &lt;- pmin( cf.s.T1, cf.s.T2)
cf.s.E &lt;- rep(0, n)
cf.s.E[cf.s.T1&lt;=cf.s.T2] &lt;- 1
cf.s.E[cf.s.T2&lt;cf.s.T1] &lt;- 2
exp.z &lt;- exp(0.5 + 1*c1 - 1*c2)
pr &lt;- exp.z/(1+exp.z)
TRT &lt;- ifelse(runif(n)&lt; pr, 1, 0)
X &lt;- ifelse(TRT==1, cf.m.T, cf.s.T)
E &lt;- ifelse(TRT==1, cf.m.E, cf.s.E)
covs.names &lt;- c("c1", "c2")
data &lt;- data.frame(X=X, E=E, TRT=TRT, c1=c1, c2=c2)
form.txt &lt;- paste0("TRT", " ~ ", paste0(c("c1", "c2"), collapse = "+"))
trt.formula &lt;- as.formula(form.txt)
wei &lt;- get.weights(formula=trt.formula, data=data, wtype = "overlap")
hist(wei$ps[data$TRT==1], col="red", breaks = seq(0,1,0.05))
par(new=TRUE)
hist(wei$ps[data$TRT==0], col="blue", breaks = seq(0,1,0.05))
# Nonparametric estimation:
res.ATE &lt;- fit.nonpar(df=data, X="X", E="E", trt.formula=trt.formula, wtype="stab.ATE")
nonpar.pe &lt;- get.pointEst(res.ATE, 0.5)
nonpar.pe$trt.eff[[1]]$RD
# Cox-based estimation:
res.cox.ATE &lt;- fit.cox(df=data, X="X", E="E", trt.formula=trt.formula, wtype="stab.ATE")
cox.pe &lt;- get.pointEst(res.cox.ATE, 0.5)
cox.pe$trt.eff[[1]]$RD

# please see our package vignette for practical examples

</code></pre>

<hr>
<h2 id='get.weights'>Fitting a logistic regression model for propensity scores and estimating weights</h2><span id='topic+get.weights'></span>

<h3>Description</h3>

<p>Fits a propensity scores model by logistic regression and returns both estimated propensity scores
and requested weights. The estimated propensity scores can be used
for further diagnostics, e.g. for testing a positivity assumption and covariate balance.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get.weights(formula, data, A, C = NULL, wtype = "unadj", case.w = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get.weights_+3A_formula">formula</code></td>
<td>
<p>a formula expression, of the form <code>response ~ predictors</code>.
The <code>response</code> is a binary treatment/exposure variable,
for which a logistic regression model (a  Propensity Scores model) will be fit using <code>glm</code>.
See the documentation of <code>glm</code> and <code>formula</code> for details. As an alternative to specifying <code>formula</code>,
arguments <code>A</code> and <code>C</code>, defined below, can be specified.</p>
</td></tr>
<tr><td><code id="get.weights_+3A_data">data</code></td>
<td>
<p>a data frame that includes a treatment indicator <code>A</code> and covariates <code>C</code> appearing in <code>formula</code>.</p>
</td></tr>
<tr><td><code id="get.weights_+3A_a">A</code></td>
<td>
<p>a character specifying the name of the treatment/exposure variable.
It is assumed that <code>A</code> is a numeric binary indicator with 0/1 values, where <code>A</code>=1
is assumed a treatment group, and <code>A</code>=0 a control group.</p>
</td></tr>
<tr><td><code id="get.weights_+3A_c">C</code></td>
<td>
<p>a vector of character strings with variable names (potential confounders)
in the logistic regression model for Propensity Scores, i.e. P(A=1|C=c).
The default value of <code>C</code> is NULL corresponding to <code>wtype</code>=&quot;unadj&quot;
that will estimate treatment effects in the raw (observed) data.</p>
</td></tr>
<tr><td><code id="get.weights_+3A_wtype">wtype</code></td>
<td>
<p>a character string variable indicating the type of weights that will define the target
population for which the ATE will be estimated.
The default is &quot;unadj&quot; - this will not adjust for possible
treatment selection bias and will not use propensity scores weighting. It can be used, for example,
in data from a randomized controlled trial (RCT) where there is no need for emulation of baseline randomization.
Other possible values are &quot;stab.ATE&quot;, &quot;ATE&quot;, &quot;ATT&quot;, &quot;ATC&quot; and &quot;overlap&quot;.
See Table 1 from Li, Morgan, and Zaslavsky (2018).</p>
</td></tr>
<tr><td><code id="get.weights_+3A_case.w">case.w</code></td>
<td>
<p>a vector of case weights.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with the following fields:
</p>

<ul>
<li><p><code>wtype</code> a character string indicating the type of the estimated weights
</p>
</li>
<li><p><code>ps</code> a vector of estimated propensity scores P(A=a|C=c)
</p>
</li>
<li><p><code>w</code> a vector of estimated weights
</p>
</li>
<li><p><code>summary.glm</code> a summary of the logistic regression fit which is done
using <code>stats::glm</code></p>
</li></ul>
<p> function
</p>


<h3>References</h3>

<p>F. Li, K.L. Morgan, and A.M. Zaslavsky. 2018. Balancing Covariates via Propensity Score Weighting. Journal of the American Statistical Association 113 (521): 390–400.
</p>
<p>M.A. Hernán, B. Brumback, and J.M. Robins. 2000. Marginal structural models and to estimate the causal effect of zidovudine on the survival of HIV-positive men. Epidemiology, 11 (5): 561-570.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fit.nonpar">fit.nonpar</a></code>, <code><a href="#topic+fit.cox">fit.cox</a></code>, <code><a href="#topic+causalCmprsk">causalCmprsk</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># create a data set
n &lt;- 1000
set.seed(7)
c1 &lt;- runif(n)
c2 &lt;- as.numeric(runif(n)&lt; 0.2)
set.seed(77)
cf.m.T1 &lt;- rweibull(n, shape=1, scale=exp(-(-1 + 2*c1)))
cf.m.T2 &lt;-  rweibull(n, shape=1, scale=exp(-(1 + 1*c2)))
cf.m.T &lt;- pmin( cf.m.T1, cf.m.T2)
cf.m.E &lt;- rep(0, n)
cf.m.E[cf.m.T1&lt;=cf.m.T2] &lt;- 1
cf.m.E[cf.m.T2&lt;cf.m.T1] &lt;- 2
set.seed(77)
cf.s.T1 &lt;- rweibull(n, shape=1, scale=exp(-1*c1 ))
cf.s.T2 &lt;-  rweibull(n, shape=1, scale=exp(-2*c2))
cf.s.T &lt;- pmin( cf.s.T1, cf.s.T2)
cf.s.E &lt;- rep(0, n)
cf.s.E[cf.s.T1&lt;=cf.s.T2] &lt;- 1
cf.s.E[cf.s.T2&lt;cf.s.T1] &lt;- 2
exp.z &lt;- exp(0.5 + 1*c1 - 1*c2)
pr &lt;- exp.z/(1+exp.z)
TRT &lt;- ifelse(runif(n)&lt; pr, 1, 0)
X &lt;- ifelse(TRT==1, cf.m.T, cf.s.T)
E &lt;- ifelse(TRT==1, cf.m.E, cf.s.E)
covs.names &lt;- c("c1", "c2")
data &lt;- data.frame(X=X, E=E, TRT=TRT, c1=c1, c2=c2)
form.txt &lt;- paste0("TRT", " ~ ", paste0(c("c1", "c2"), collapse = "+"))
trt.formula &lt;- as.formula(form.txt)
wei &lt;- get.weights(formula=trt.formula, data=data, wtype = "overlap")
hist(wei$ps[data$TRT==1], col="red", breaks = seq(0,1,0.05))
par(new=TRUE)
hist(wei$ps[data$TRT==0], col="blue", breaks = seq(0,1,0.05))

# please see our package vignette for practical examples

</code></pre>

<hr>
<h2 id='summary.cmprsk'>Summary of Event-specific Cumulative Hazards, Cumulative Incidence Functions and Various Treatment Effects</h2><span id='topic+summary.cmprsk'></span>

<h3>Description</h3>

<p>Returns an object of class <code>data.frame</code> containing the summary extracted from the <code>cmprsk</code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'cmprsk'
summary(object, event, estimand = "CIF", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.cmprsk_+3A_object">object</code></td>
<td>
<p>an object of class <code>cmprsk</code> (output from <code>fit.nonpar</code> or <code>fit.cox</code> functions)</p>
</td></tr>
<tr><td><code id="summary.cmprsk_+3A_event">event</code></td>
<td>
<p>an integer number (a code) of an event of interest</p>
</td></tr>
<tr><td><code id="summary.cmprsk_+3A_estimand">estimand</code></td>
<td>
<p>a character string naming the type of estimand to extract from <code>object</code>. <code>estimand</code> can be one of the following: &quot;CumHaz&quot; (Cumulative Hazard function),
&quot;CIF&quot; (Cumulative Incidence Function), &quot;RMT&quot; (Restricted Mean Time),
&quot;logHR&quot; (logarithm of the ratio of Cumulative Hazards in two treatment arms),
&quot;RD&quot; (Risk Difference, or the difference between the CIFs in two treatment arms),
&quot;RR&quot; (Risk Ratio, or the ratio of CIFs in two treatment arms),
&quot;ATE.RMT&quot; (Restricted mean time gained/lost due to treatment, or the difference between RMTs in two treatment arms).
The default value is &quot;CIF&quot;.</p>
</td></tr>
<tr><td><code id="summary.cmprsk_+3A_...">...</code></td>
<td>
<p>This is not currently used, included for future methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>summary.cmprsk</code> returns a <code>data.frame</code> object with 7 or 6 columns:
the time vector, an indicator of the treatment arm
(if the requested <code>estimand</code> is one of c(&quot;logHR&quot;, &quot;RD&quot;, &quot;RR&quot;, &quot;ATE.RMT&quot;), this column is omitted),
an indicator of the type of event,
the point estimate for the requested <code>estimand</code>, the lower and upper bounds of the
confidence interval (for <code>conf.level</code> % of the confidence level),
and the standard error of the point estimate. For example, if <code>estimand="CIF"</code>,
the returned <code>data.frame</code> will include the following columns:
<code>time</code>, <code>TRT</code>, <code>Event</code>, <code>CIF</code>, <code>CIL.CIF</code>, <code>CIU.CIF</code>, <code>SE.CIF</code>.
</p>


<h3>References</h3>

<p>M.-L. Charpignon, B. Vakulenko-Lagun, B. Zheng, C. Magdamo, B. Su, K.E. Evans, S. Rodriguez, et al. 2022. Causal inference in medical records and complementary systems pharmacology for metformin drug repurposing towards dementia. Nature Communications 13:7652.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fit.cox">fit.cox</a></code>, <code><a href="#topic+fit.nonpar">fit.nonpar</a></code>, <code><a href="#topic+causalCmprsk">causalCmprsk</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># create a data set
n &lt;- 1000
set.seed(7)
c1 &lt;-  runif(n)
c2 &lt;- as.numeric(runif(n)&lt; 0.2)
set.seed(77)
cf.m.T1 &lt;- rweibull(n, shape=1, scale=exp(-(-1 + 2*c1)))
cf.m.T2 &lt;-  rweibull(n, shape=1, scale=exp(-(1 + 1*c2)))
cf.m.T &lt;- pmin( cf.m.T1, cf.m.T2)
cf.m.E &lt;- rep(0, n)
cf.m.E[cf.m.T1&lt;=cf.m.T2] &lt;- 1
cf.m.E[cf.m.T2&lt;cf.m.T1] &lt;- 2
set.seed(77)
cf.s.T1 &lt;- rweibull(n, shape=1, scale=exp(-1*c1 ))
cf.s.T2 &lt;-  rweibull(n, shape=1, scale=exp(-2*c2))
cf.s.T &lt;- pmin( cf.s.T1, cf.s.T2)
cf.s.E &lt;- rep(0, n)
cf.s.E[cf.s.T1&lt;=cf.s.T2] &lt;- 1
cf.s.E[cf.s.T2&lt;cf.s.T1] &lt;- 2
exp.z &lt;- exp(0.5 + c1 - c2)
pr &lt;- exp.z/(1+exp.z)
TRT &lt;- ifelse( runif(n)&lt; pr, 1, 0)
X &lt;- ifelse(TRT==1, cf.m.T, cf.s.T)
E &lt;- ifelse(TRT==1, cf.m.E, cf.s.E)
covs.names &lt;- c("c1", "c2")
data &lt;- data.frame(X=X, E=E, TRT=TRT, c1=c1, c2=c2)
# Nonparametric estimation:
form.txt &lt;- paste0("TRT", " ~ ", paste0(c("c1", "c2"), collapse = "+"))
trt.formula &lt;- as.formula(form.txt)
res.ATE &lt;- fit.nonpar(df=data, X="X", E="E", trt.formula=trt.formula, wtype="stab.ATE")
# summarizing results on the Risk Difference for event=2
fit.summary &lt;- summary(object=res.ATE, event = 2, estimand="RD")
head(fit.summary)
# summarizing results on the CIFs for event=1
fit.summary &lt;- summary(object=res.ATE, event = 1, estimand="CIF")
head(fit.summary)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
