<!DOCTYPE html><html><head><title>Help for package PAMmisc</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {PAMmisc}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#addPgAnno'><p>Add Spectrogram Annotations to Pamguard Database</p></a></li>
<li><a href='#addPgEvent'><p>Add Pamguard Event to Database</p></a></li>
<li><a href='#addPgGps'><p>Add GPS to a Pamguard Database</p></a></li>
<li><a href='#browseEdinfo'><p>Browse a List of Environmental Datasets</p></a></li>
<li><a href='#createSSP'><p>Create Sound Speed Profiles</p></a></li>
<li><a href='#dataToRanges'><p>Create List of the Ranges of Coordinates</p></a></li>
<li><a href='#decimateWavFiles'><p>Decimate Wave Files</p></a></li>
<li><a href='#downloadEnv'><p>Download Environmental Data</p></a></li>
<li><a href='#edinfoToURL'><p>Create a URL for Downloading Data from a edinfo Object</p></a></li>
<li><a href='#erddapList'><p>A list of edinfo objects from ERDDAP data sources</p></a></li>
<li><a href='#erddapToEdinfo'><p>Create an edinfo Object from an ERDDAP Dataset Id</p></a></li>
<li><a href='#formatURL'><p>Format URL for Environmental Data Download</p></a></li>
<li><a href='#getEdinfo'><p>Browse a List of Curated Environmental Datasets</p></a></li>
<li><a href='#getFigshareInfo'><p>getFigshareInfo</p></a></li>
<li><a href='#hycomList'><p>A list of edinfo objects from HYCOM data sources</p></a></li>
<li><a href='#matchEnvData'><p>Match Data From an Existing Netcdf File or Download and Match</p></a></li>
<li><a href='#ncToData'><p>Match Data From a Netcdf File</p></a></li>
<li><a href='#peakTrough'><p>Find Peaks and Troughs in a Spectrum</p></a></li>
<li><a href='#plotPresBar'><p>plotPresBar</p></a></li>
<li><a href='#plotPresGrid'><p>plotPresGrid</p></a></li>
<li><a href='#raytrace'><p>Raytrace Through a Soundspeed Profile</p></a></li>
<li><a href='#readGPXTrack'><p>Read Tracks from a GPX File</p></a></li>
<li><a href='#readSpecAnno'><p>Read Pamguard Spectrogram Annotation Table</p></a></li>
<li><a href='#soundtrapQAQC'><p>Perform QA/QC on Soundtrap Files</p></a></li>
<li><a href='#squishList'><p>Compress a List by Name</p></a></li>
<li><a href='#straightPath'><p>Mark Straight Path Segments in GPS Track</p></a></li>
<li><a href='#trainSplitPermute'><p>trainSplitPermute</p></a></li>
<li><a href='#updateUID'><p>Update Detection UIDs</p></a></li>
<li><a href='#varSelect'><p>Utility for Selecting Variables to Download</p></a></li>
<li><a href='#wignerTransform'><p>Calculate the Wigner-Ville Transform of a Signal</p></a></li>
<li><a href='#writeAMWave'><p>Write Amplitude Modulated Waveform</p></a></li>
<li><a href='#writeClickWave'><p>Write Click Waveform</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Miscellaneous Functions for Passive Acoustic Analysis</td>
</tr>
<tr>
<td>Version:</td>
<td>1.11.6</td>
</tr>
<tr>
<td>Description:</td>
<td>A collection of miscellaneous functions for passive acoustics. 
    Much of the content here is adapted to R from code written by other people.
    If you have any ideas of functions to add, please contact Taiki Sakai.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GNU General Public License]</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Imports:</td>
<td>ggplot2, tuneR, seewave, dplyr, magrittr, RcppRoll,
PamBinaries, RSQLite, lubridate, rerddap, ncdf4, httr, purrr,
xml2, hoardr, methods, geosphere, tcltk, scales, suncalc, rjson</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10)</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-08-16 20:35:31 UTC; tnsak</td>
</tr>
<tr>
<td>Author:</td>
<td>Taiki Sakai [aut, cre],
  Jay Barlow [ctb],
  Julie Oswald [ctb],
  Val Schmidt [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Taiki Sakai &lt;taiki.sakai@noaa.gov&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-08-16 21:34:34 UTC</td>
</tr>
</table>
<hr>
<h2 id='addPgAnno'>Add Spectrogram Annotations to Pamguard Database</h2><span id='topic+addPgAnno'></span>

<h3>Description</h3>

<p>Add new annotations to an existing Pamguard Spectrogram Annotations
table
</p>


<h3>Usage</h3>

<pre><code class='language-R'>addPgAnno(
  db,
  anno,
  tableName = NULL,
  channel = 1,
  source = c("manual", "aplose", "pammisc", "annomate", "raven"),
  format = c("%m/%d/%Y %H:%M:%OS", "%m-%d-%Y %H:%M:%OS",
    "%Y/%m/%d %H:%M:%OS", "%Y-%m-%d %H:%M:%OS"),
  tz = "UTC"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="addPgAnno_+3A_db">db</code></td>
<td>
<p>database file to add annotations to</p>
</td></tr>
<tr><td><code id="addPgAnno_+3A_anno">anno</code></td>
<td>
<p>annotations to add, must contain columns <code>UTC</code>, <code>Duration</code> (seconds),
<code>f1</code> (min freq Hz), and <code>f2</code> (max freq Hz). Any other columns matching columns in the database
will also be added</p>
</td></tr>
<tr><td><code id="addPgAnno_+3A_tablename">tableName</code></td>
<td>
<p>name of the annotation table in the database</p>
</td></tr>
<tr><td><code id="addPgAnno_+3A_channel">channel</code></td>
<td>
<p>channel to display the annotations on</p>
</td></tr>
<tr><td><code id="addPgAnno_+3A_source">source</code></td>
<td>
<p>annotation source. If <code>'manual'</code>, columns <code>UTC</code>, <code>DUration</code>,
<code>f1</code>, and <code>f2</code> must be present. Other options will attempt to automate
conversion to these column names from specific output sources</p>
</td></tr>
<tr><td><code id="addPgAnno_+3A_format">format</code></td>
<td>
<p>date format, default will try two variations of MDY HMS and YMD HMS</p>
</td></tr>
<tr><td><code id="addPgAnno_+3A_tz">tz</code></td>
<td>
<p>timezone of provided date</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a dataframe of the rows added to the database
</p>


<h3>Author(s)</h3>

<p>Taiki Sakai <a href="mailto:taiki.sakai@noaa.gov">taiki.sakai@noaa.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
myDb &lt;- 'PamguardDatabase.sqlite3'
myAnno &lt;- data.frame(UTC = '2021/10/23 12:10:10', Duration = .563, f1=2300, f2=3600)
addPgAnno(myDb, myAnno, tableName='Spectrogram_Annotation', source='manual')

## End(Not run)

</code></pre>

<hr>
<h2 id='addPgEvent'>Add Pamguard Event to Database</h2><span id='topic+addPgEvent'></span>

<h3>Description</h3>

<p>Add a new event to an existing Pamguard database in the &quot;OfflineEvents&quot;
table. If the specified <code>eventType</code> does not exist in the database, it will
be added to the &quot;Lookup&quot; table.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>addPgEvent(
  db,
  UIDs = NULL,
  binary,
  eventType,
  comment = NA,
  tableName = NULL,
  start = NULL,
  end = NULL,
  type = c("click", "dg")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="addPgEvent_+3A_db">db</code></td>
<td>
<p>database file to add an event to</p>
</td></tr>
<tr><td><code id="addPgEvent_+3A_uids">UIDs</code></td>
<td>
<p>vector of the UIDs of the individual detections to add to the event</p>
</td></tr>
<tr><td><code id="addPgEvent_+3A_binary">binary</code></td>
<td>
<p>binary file(s) containing the detections from <code>UIDs</code></p>
</td></tr>
<tr><td><code id="addPgEvent_+3A_eventtype">eventType</code></td>
<td>
<p>the name of the event type to add. If this is not already
present in the database, it will be added to the &quot;Lookup&quot; table</p>
</td></tr>
<tr><td><code id="addPgEvent_+3A_comment">comment</code></td>
<td>
<p>(optional) a comment for the event</p>
</td></tr>
<tr><td><code id="addPgEvent_+3A_tablename">tableName</code></td>
<td>
<p>(optional) specify the name of the Click Detector that generated the
event table you want to add to. This only needs to be specified if you have
more than one click detector, it defaults to the first &quot;NAME_OfflineEvents&quot;
table in the database.</p>
</td></tr>
<tr><td><code id="addPgEvent_+3A_start">start</code></td>
<td>
<p>(optional) start time of event. Mandatory if no detections are added</p>
</td></tr>
<tr><td><code id="addPgEvent_+3A_end">end</code></td>
<td>
<p>(optional) end time of event. Mandatory if no detections are added</p>
</td></tr>
<tr><td><code id="addPgEvent_+3A_type">type</code></td>
<td>
<p>type of event data to add, either <code>'click'</code> to add event data using
the Click Detector module, or <code>'dg'</code> to add event data using the Detection
Grouper module</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Adds to the database <code>db</code>, invisibly returns <code>TRUE</code> if successful
</p>


<h3>Author(s)</h3>

<p>Taiki Sakai <a href="mailto:taiki.sakai@noaa.gov">taiki.sakai@noaa.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
myDb &lt;- 'PamguardDatabase.sqlite3'
myBinaries &lt;- c('./Binaries/Bin1.pgdf', './Binaries/Bin2.pgdf')
addUIDs &lt;- c(10000001, 10000002, 20000007, 20000008)
addPgEvent(db = myDb, UIDs = addUIDs, binary = myBinaries, eventType = 'MyNewEvent')

## End(Not run)
</code></pre>

<hr>
<h2 id='addPgGps'>Add GPS to a Pamguard Database</h2><span id='topic+addPgGps'></span>

<h3>Description</h3>

<p>Add GPS data to an existing Pamguard database
</p>


<h3>Usage</h3>

<pre><code class='language-R'>addPgGps(
  db,
  gps,
  source = c("csv", "SPOTcsv", "SPOTgpx"),
  format = c("%m/%d/%Y %H:%M:%S", "%m-%d-%Y %H:%M:%S",
    "%Y/%m/%d %H:%M:%S", "%Y-%m-%d %H:%M:%S"),
  tz = "UTC"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="addPgGps_+3A_db">db</code></td>
<td>
<p>database file to add gps data to</p>
</td></tr>
<tr><td><code id="addPgGps_+3A_gps">gps</code></td>
<td>
<p>data.frame of gps data or a character of the file name to be read. If a
data.frame or non-SPOT csv file, needs columns <code>UTC</code>, <code>Latitude</code>, and <code>Longitude</code>.
If multiple separate tracks are present in the same dataset, this should be marked with
a column labeled <code>Name</code></p>
</td></tr>
<tr><td><code id="addPgGps_+3A_source">source</code></td>
<td>
<p>one of <code>SPOTcsv</code>, <code>SPOTgpx</code>, or <code>csv</code>. Describes the
source of the GPS data, not needed if <code>gps</code> is a data.frame</p>
</td></tr>
<tr><td><code id="addPgGps_+3A_format">format</code></td>
<td>
<p>date format for converting to POSIXct, only needed for <code>source='csv'</code>.
See <a href="base.html#topic+strptime">strptime</a></p>
</td></tr>
<tr><td><code id="addPgGps_+3A_tz">tz</code></td>
<td>
<p>timezone of gps source being added, will be converted to UTC</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Adds to the database <code>db</code>, invisibly returns the <code>Name</code> of the GPS track
if successful (<code>NA</code> if not named)
</p>


<h3>Author(s)</h3>

<p>Taiki Sakai <a href="mailto:taiki.sakai@noaa.gov">taiki.sakai@noaa.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# not run because example files don't exist
myDb &lt;- 'PamguardDatabase.sqlite3'
# adding from a .gpx file downloaded from SPOT
spotGpx &lt;- 'SpotGPX.gpx'
addPgGps(myDb, spotGpx, source='SPOTgpx')
# adding from a csv file with a Y-M-D H:M date format
gpsCsv &lt;- 'GPS.csv'
addPgGps(myDb, gpsCsv, source='csv', format='%Y-%m-%d %H:%M')

## End(Not run)

</code></pre>

<hr>
<h2 id='browseEdinfo'>Browse a List of Environmental Datasets</h2><span id='topic+browseEdinfo'></span>

<h3>Description</h3>

<p>This function browses the list of selected environmental datasets
that are recommended as a starting point, and prompts the user to select one to use,
returning an edinfo object. Also allows user to filter by variable name, matching
will be attempted using regex
</p>


<h3>Usage</h3>

<pre><code class='language-R'>browseEdinfo(var = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="browseEdinfo_+3A_var">var</code></td>
<td>
<p>the name or partial name of a variable to filter the available datasets by</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns an <code>edinfo</code> class object that can be used to get environmental
data with other functions
</p>


<h3>Author(s)</h3>

<p>Taiki Sakai <a href="mailto:taiki.sakai@noaa.gov">taiki.sakai@noaa.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 
# browse the full list (interactive)
edi &lt;- browseEdinfo()

# search for sst datasets (interactive)
edi &lt;- browseEdinfo(var='sst')

## End(Not run)

</code></pre>

<hr>
<h2 id='createSSP'>Create Sound Speed Profiles</h2><span id='topic+createSSP'></span>

<h3>Description</h3>

<p>Creates sound speed profiles (Depth vs Sound Speed) using temperature
and salinity data downloaded from HYCOM data servers
</p>


<h3>Usage</h3>

<pre><code class='language-R'>createSSP(
  x,
  f = 30000,
  nc = NULL,
  ncVars = c("salinity", "water_temp"),
  dropNA = TRUE,
  progress = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="createSSP_+3A_x">x</code></td>
<td>
<p>a data.frame with columns <code>UTC</code>, <code>Longitude</code>, and
<code>Latitude</code> to create sound speed profiles for</p>
</td></tr>
<tr><td><code id="createSSP_+3A_f">f</code></td>
<td>
<p>the frequency (Hz) to generate the profile for</p>
</td></tr>
<tr><td><code id="createSSP_+3A_nc">nc</code></td>
<td>
<p>netcdf file containing salinity and temperature data at depth, if
<code>NULL</code> (default) these will be downloaded from HYCOM servers</p>
</td></tr>
<tr><td><code id="createSSP_+3A_ncvars">ncVars</code></td>
<td>
<p>names of the salinity and temperature variables (in that order)
in your netcdf file, only change these if you are providing your own file
to <code>nc</code></p>
</td></tr>
<tr><td><code id="createSSP_+3A_dropna">dropNA</code></td>
<td>
<p>logical flag to drop NA values from soundspeeed profile from outputs.
SSP will be calculated up to the maximum depth at each coordinate, which can vary.
Setting this option to <code>FALSE</code> ensures that outputs are the same length for
each coordinate, which can be useful</p>
</td></tr>
<tr><td><code id="createSSP_+3A_progress">progress</code></td>
<td>
<p>logical flag to show progress bar for SST download</p>
</td></tr>
<tr><td><code id="createSSP_+3A_...">...</code></td>
<td>
<p>additional arguments to pass to <a href="#topic+matchEnvData">matchEnvData</a></p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list with one element for each row of <code>x</code>, each element is a list
containing <code>speed</code>, the sound speed (m/s), and <code>depth</code> (m)
</p>


<h3>Author(s)</h3>

<p>Taiki Sakai <a href="mailto:taiki.sakai@noaa.gov">taiki.sakai@noaa.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# examples not run because they require internet connection
coords &lt;- data.frame(UTC=as.POSIXct('2014-07-15 01:00:00', tz='UTC'),
                     Longitude = -119, Latitude = 33)
ssp &lt;- createSSP(coords)
plot(x=ssp[[1]]$speed, y=-ssp[[1]]$depth, type='l')

## End(Not run)

</code></pre>

<hr>
<h2 id='dataToRanges'>Create List of the Ranges of Coordinates</h2><span id='topic+dataToRanges'></span>

<h3>Description</h3>

<p>Creates a named list with the ranges of Longitude, Latitude,
and Time (UTC) data for use in functions like <a href="#topic+formatURL">formatURL</a>. Can also
specify an amount to buffer the min and max values by for each coordinate
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dataToRanges(data, buffer = c(0, 0, 0))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dataToRanges_+3A_data">data</code></td>
<td>
<p>a data frame with longitude, latitude, and time (UTC) columns</p>
</td></tr>
<tr><td><code id="dataToRanges_+3A_buffer">buffer</code></td>
<td>
<p>a vector of the amount to buffer the min and max values of
Longitude, Latitude, and UTC by (in that order)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list with the ranges of coordinates for Longitude, Latitude, and
UTC. Ranges are listed as c(left, right), so if your data spans across the
dateline
</p>


<h3>Author(s)</h3>

<p>Taiki Sakai <a href="mailto:taiki.sakai@noaa.gov">taiki.sakai@noaa.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
gps &lt;- data.frame(Latitude = c(32, 32.1, 32.2, 32.2, 32.2),
                  Longitude = c(-110, -110.1, -110.2, -110.3, -110.4),
                  UTC = as.POSIXct(c('2000-01-01 00:00:00', '2000-01-01 00:00:10',
                                     '2000-01-01 00:00:20', '2000-01-01 00:00:30',
                                     '2000-01-01 00:00:40')))
dataToRanges(gps)

dataToRanges(gps, buffer = c(.05, .05, 86400))

</code></pre>

<hr>
<h2 id='decimateWavFiles'>Decimate Wave Files</h2><span id='topic+decimateWavFiles'></span>

<h3>Description</h3>

<p>Decimate a folder of .wav files or a single .wav file
to a new sample rate.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>decimateWavFiles(inDir, outDir, newSr, progress = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="decimateWavFiles_+3A_indir">inDir</code></td>
<td>
<p>directory of wave files to decimate. Can also be a single .wav file.</p>
</td></tr>
<tr><td><code id="decimateWavFiles_+3A_outdir">outDir</code></td>
<td>
<p>directory to write wave files to</p>
</td></tr>
<tr><td><code id="decimateWavFiles_+3A_newsr">newSr</code></td>
<td>
<p>sample rate to decimate the files to</p>
</td></tr>
<tr><td><code id="decimateWavFiles_+3A_progress">progress</code></td>
<td>
<p>logical flag to show progress bar</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This code is based on R code written by Jay Barlow.
</p>


<h3>Value</h3>

<p>Invisibly returns the names of all files that were successfully
decimated
</p>


<h3>Author(s)</h3>

<p>Taiki Sakai <a href="mailto:taiki.sakai@noaa.gov">taiki.sakai@noaa.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
origDir &lt;- file.path(tempdir(), 'origSR')
decDir &lt;- file.path(tempdir(), 'decSR')
writeClickWave('origWav.wav', outDir=origDir, signalLength = 1, clickLength = 100,
               clicksPerSecond = 200, frequency = 20000, sampleRate = 100000)
decWavs &lt;- decimateWavFiles(origDir, decDir, 50000)
file.remove(paste0(origDir, 'origWav.wav'))
file.remove(decWavs)

</code></pre>

<hr>
<h2 id='downloadEnv'>Download Environmental Data</h2><span id='topic+downloadEnv'></span>

<h3>Description</h3>

<p>Downloads environmental data matching the coordinates in a set of data
</p>


<h3>Usage</h3>

<pre><code class='language-R'>downloadEnv(
  data,
  edinfo,
  fileName = NULL,
  buffer = c(0, 0, 0),
  timeout = 120,
  progress = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="downloadEnv_+3A_data">data</code></td>
<td>
<p>Data containing Longitude, Latitude, and UTC to download matching
environmental data for</p>
</td></tr>
<tr><td><code id="downloadEnv_+3A_edinfo">edinfo</code></td>
<td>
<p>either a edinfo object from <a href="#topic+getEdinfo">getEdinfo</a> or <a href="#topic+erddapToEdinfo">erddapToEdinfo</a>
or an ERDDAP dataset ID</p>
</td></tr>
<tr><td><code id="downloadEnv_+3A_filename">fileName</code></td>
<td>
<p>name of the file to save downloaded data. If left as the default
<code>NULL</code>, data will be saved to a temporary folder</p>
</td></tr>
<tr><td><code id="downloadEnv_+3A_buffer">buffer</code></td>
<td>
<p>numeric vector of the amount to buffer the Longitude, Latitude, and
UTC coordinates by</p>
</td></tr>
<tr><td><code id="downloadEnv_+3A_timeout">timeout</code></td>
<td>
<p>number of seconds before timeout stops download attempt</p>
</td></tr>
<tr><td><code id="downloadEnv_+3A_progress">progress</code></td>
<td>
<p>logical flag to show download progress</p>
</td></tr>
<tr><td><code id="downloadEnv_+3A_...">...</code></td>
<td>
<p>not used</p>
</td></tr>
</table>


<h3>Value</h3>

<p>if download is successful, invisibly returns the filename. If it fails returns
<code>FALSE</code>.
</p>
<p>If successful, the file name of downloaded data. If not, returns <code>FALSE</code>
</p>


<h3>Author(s)</h3>

<p>Taiki Sakai <a href="mailto:taiki.sakai@noaa.gov">taiki.sakai@noaa.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data &lt;- data.frame(Latitude = 32, Longitude = -117,
                   UTC = as.POSIXct('2000-01-01 00:00:00', tz='UTC'))
## Not run: 
# not run because download could take time
# download jplMURSST41 dataset
edi &lt;- erddapToEdinfo('jplMURSST41')
ncFile &lt;- downloadEnv(data, edi, 'sstData.nc')

# browse suggested sst datasets, then download
edi &lt;- browseEdinfo(var='sst')
ncFile &lt;- downloadEnv(data, edi, 'sstData.nc')

## End(Not run)


</code></pre>

<hr>
<h2 id='edinfoToURL'>Create a URL for Downloading Data from a edinfo Object</h2><span id='topic+edinfoToURL'></span>

<h3>Description</h3>

<p>Creates a properly formatted URL (see <a href="#topic+formatURL">formatURL</a>) from
a datalist either from the package's recommended sources or an ERDDAP
dataset id
</p>


<h3>Usage</h3>

<pre><code class='language-R'>edinfoToURL(edinfo, ranges)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="edinfoToURL_+3A_edinfo">edinfo</code></td>
<td>
<p>a edinfo class object, either from <a href="#topic+getEdinfo">getEdinfo</a> or created by
<a href="#topic+erddapToEdinfo">erddapToEdinfo</a></p>
</td></tr>
<tr><td><code id="edinfoToURL_+3A_ranges">ranges</code></td>
<td>
<p>list of ranges for Longitude, Latitude, and UTC. Must be a
named list with a vector of min/max values for each of the three dimensions</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a properly formatted URL that can be used to download environmental data
</p>


<h3>Author(s)</h3>

<p>Taiki Sakai <a href="mailto:taiki.sakai@noaa.gov">taiki.sakai@noaa.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>sstEdi &lt;- getEdinfo()[['jplMURSST41']]
# select all variables for download
sstEdi &lt;- varSelect(sstEdi, TRUE)
edinfoToURL(sstEdi, ranges = list(Latitude = c(32, 33),
                                  Longitude = c(-118, -117),
                                  UTC = as.POSIXct(c('2000-01-01 00:00:00',
                                                     '2000-01-02 00:00:00'), tz='UTC')))
</code></pre>

<hr>
<h2 id='erddapList'>A list of edinfo objects from ERDDAP data sources</h2><span id='topic+erddapList'></span>

<h3>Description</h3>

<p>A list of edinfo objects, mostly used internally for functions. These objects
represent different environmental data sources from ERDDAP servers and are
used to download environmental data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>erddapList
</code></pre>


<h3>Format</h3>

<p>A list with objects of class edinfo
</p>


<h3>Source</h3>

<p>Southwest Fisheries Science Center / NMFS / NOAA
</p>

<hr>
<h2 id='erddapToEdinfo'>Create an edinfo Object from an ERDDAP Dataset Id</h2><span id='topic+erddapToEdinfo'></span><span id='topic+hycomToEdinfo'></span>

<h3>Description</h3>

<p>Creates an edinfo object that can be used to create a URL for
downloading environmental data using <a href="#topic+edinfoToURL">edinfoToURL</a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>erddapToEdinfo(
  dataset,
  baseurl = "https://upwell.pfeg.noaa.gov/erddap/",
  chooseVars = TRUE
)

hycomToEdinfo(
  dataset = "GLBy0.08/expt_93.0",
  baseurl = "https://ncss.hycom.org/thredds/ncss/",
  chooseVars = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="erddapToEdinfo_+3A_dataset">dataset</code></td>
<td>
<p>an ERDDAP or HYCOM dataset id, or the result from <a href="rerddap.html#topic+info">info</a></p>
</td></tr>
<tr><td><code id="erddapToEdinfo_+3A_baseurl">baseurl</code></td>
<td>
<p>the base URL of an ERDDAP/HYCOM server</p>
</td></tr>
<tr><td><code id="erddapToEdinfo_+3A_choosevars">chooseVars</code></td>
<td>
<p>logical flag whether or not to select which variables you want now
or character vector naming variables to select</p>
</td></tr>
</table>


<h3>Value</h3>

<p>an edinfo list object that can be used to download environmental data
</p>


<h3>Author(s)</h3>

<p>Taiki Sakai <a href="mailto:taiki.sakai@noaa.gov">taiki.sakai@noaa.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# examples not run because they require internet connection
sstEdi &lt;- erddapToEdinfo('jplMURSST41')
# dataset from a diferent erddap server
sshEdi &lt;- erddapToEdinfo('hawaii_soest_2ee3_0bfa_a8d6',
                          baseurl = 'http://apdrc.soest.hawaii.edu/erddap/')
# THese work the same - erddap function will pass to hycom if appears to be hycom dataset
hycomEdi &lt;- hycomToEdinfo('GLBy0.08/expt_93.0')
hycomEdi &lt;- erddapToEdinfo('GLBy0.08/expt_93.0')

## End(Not run)

</code></pre>

<hr>
<h2 id='formatURL'>Format URL for Environmental Data Download</h2><span id='topic+formatURL'></span>

<h3>Description</h3>

<p>This creates a properly formatted URL for downloading environmental
data either from an ERDDAP or HYCOM server. This URL can be pasted into a browser
or submitted to something like httr::GET to actually download the data. Also see
<a href="#topic+edinfoToURL">edinfoToURL</a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>formatURL(
  base,
  dataset,
  fileType,
  vars,
  ranges,
  stride = 1,
  style = c("erddap", "hycom")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="formatURL_+3A_base">base</code></td>
<td>
<p>the base URL to download from</p>
</td></tr>
<tr><td><code id="formatURL_+3A_dataset">dataset</code></td>
<td>
<p>the specific datased ID to download</p>
</td></tr>
<tr><td><code id="formatURL_+3A_filetype">fileType</code></td>
<td>
<p>the type of file to download, usually a netcdf</p>
</td></tr>
<tr><td><code id="formatURL_+3A_vars">vars</code></td>
<td>
<p>a vector of variables to download</p>
</td></tr>
<tr><td><code id="formatURL_+3A_ranges">ranges</code></td>
<td>
<p>a list of three vectors specifying the range of data to download,
must a list with named vectors <code>Longitude</code>, <code>Latitude</code>, and <code>UTC</code>
where each vector is <code>c(min, max)</code> (Note: even if the time is something like
&quot;dayOfYear&quot; this should still be called 'UTC' for the purpose of this list).
(see <a href="#topic+dataToRanges">dataToRanges</a>).</p>
</td></tr>
<tr><td><code id="formatURL_+3A_stride">stride</code></td>
<td>
<p>the stride for all dimensions, a value of 1 gets every data point,
2 gets every other, etc.</p>
</td></tr>
<tr><td><code id="formatURL_+3A_style">style</code></td>
<td>
<p>either <code>'erddap'</code> or <code>'hycom'</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>a properly formatted URL that can be used to download environmental data
</p>


<h3>Author(s)</h3>

<p>Taiki Sakai <a href="mailto:taiki.sakai@noaa.gov">taiki.sakai@noaa.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
formatURL(
    base = "https://upwell.pfeg.noaa.gov/erddap/griddap/",
    dataset = "jplMURSST41",
    fileType = "nc",
    vars = "analysed_sst",
    ranges = list(
               Latitude = c(30, 31),
               Longitude = c(-118, -117),
               UTC = as.POSIXct(c('2005-01-01 00:00:00', '2005-01-02 00:00:00'), tz='UTC')
             ),
    stride=1,
    style = 'erddap'
)

</code></pre>

<hr>
<h2 id='getEdinfo'>Browse a List of Curated Environmental Datasets</h2><span id='topic+getEdinfo'></span>

<h3>Description</h3>

<p>This function gets the list of environmental datasets provided
as a recommended starting point for various measures
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getEdinfo()
</code></pre>


<h3>Value</h3>

<p>a list of edinfo list objects
</p>


<h3>Author(s)</h3>

<p>Taiki Sakai <a href="mailto:taiki.sakai@noaa.gov">taiki.sakai@noaa.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
ediList &lt;- getEdinfo()
ediList[[1]]
ediList[['jplMURSST41']]

</code></pre>

<hr>
<h2 id='getFigshareInfo'>getFigshareInfo</h2><span id='topic+getFigshareInfo'></span>

<h3>Description</h3>

<p>downloads filename and recording URL information from a Figshare
article. Requires a users API token from their figshare account
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getFigshareInfo(token, id)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getFigshareInfo_+3A_token">token</code></td>
<td>
<p>Personal API token from users Figshare account, see
<a href="https://help.figshare.com/article/how-to-get-a-personal-token">here</a>
for information on creating a token</p>
</td></tr>
<tr><td><code id="getFigshareInfo_+3A_id">id</code></td>
<td>
<p>Figshare article ID to download information for</p>
</td></tr>
</table>


<h3>Value</h3>

<p>dataframe with columns <code>filename</code> and <code>recording_url</code>
</p>


<h3>Author(s)</h3>

<p>Taiki Sakai <a href="mailto:taiki.sakai@noaa.gov">taiki.sakai@noaa.gov</a>
</p>

<hr>
<h2 id='hycomList'>A list of edinfo objects from HYCOM data sources</h2><span id='topic+hycomList'></span>

<h3>Description</h3>

<p>A list of edinfo objects, mostly used internally for functions. These objects
represent different environmental data sources from HYCOM servers and are
used to download environmental data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>hycomList
</code></pre>


<h3>Format</h3>

<p>A list with objects of class edinfo
</p>


<h3>Source</h3>

<p>Southwest Fisheries Science Center / NMFS / NOAA
</p>

<hr>
<h2 id='matchEnvData'>Match Data From an Existing Netcdf File or Download and Match</h2><span id='topic+matchEnvData'></span><span id='topic+matchEnvData+2Cdata.frame-method'></span>

<h3>Description</h3>

<p>Extracts all variables from a netcdf file matching Longitude,
Latitude, and UTC coordinates in given dataframe
</p>


<h3>Usage</h3>

<pre><code class='language-R'>matchEnvData(
  data,
  nc = NULL,
  var = NULL,
  buffer = c(0, 0, 0),
  FUN = c(mean),
  fileName = NULL,
  progress = TRUE,
  depth = 0,
  ...
)

## S4 method for signature 'data.frame'
matchEnvData(
  data,
  nc = NULL,
  var = NULL,
  buffer = c(0, 0, 0),
  FUN = c(mean),
  fileName = NULL,
  progress = TRUE,
  depth = 0,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="matchEnvData_+3A_data">data</code></td>
<td>
<p>dataframe containing Longitude, Latitude, and UTC to extract matching
variables from the netcdf file</p>
</td></tr>
<tr><td><code id="matchEnvData_+3A_nc">nc</code></td>
<td>
<p>name of a netcdf file, ERDDAP dataset id, or an edinfo object</p>
</td></tr>
<tr><td><code id="matchEnvData_+3A_var">var</code></td>
<td>
<p>(optional) vector of variable names</p>
</td></tr>
<tr><td><code id="matchEnvData_+3A_buffer">buffer</code></td>
<td>
<p>vector of Longitude, Latitude, and Time (seconds) to buffer around
each datapoint. All values within the buffer will be used to report the mean,
median, and standard deviation</p>
</td></tr>
<tr><td><code id="matchEnvData_+3A_fun">FUN</code></td>
<td>
<p>a vector or list of functions to apply to the data. Default is to apply
mean, median, and standard deviation calculations</p>
</td></tr>
<tr><td><code id="matchEnvData_+3A_filename">fileName</code></td>
<td>
<p>(optional) file name to save downloaded nc file to. If not provided,
then no nc files will be stored, instead small temporary files will be downloaded
and then deleted. This can be much faster, but means that the data will need to be
downloaded again in the future. If <code>fileName</code> is provided, then the function
will attempt to download a single nc file covering the entire range of your data.
If your data spans a large amount of time and space this can be problematic.</p>
</td></tr>
<tr><td><code id="matchEnvData_+3A_progress">progress</code></td>
<td>
<p>logical flag to show progress bar</p>
</td></tr>
<tr><td><code id="matchEnvData_+3A_depth">depth</code></td>
<td>
<p>depth values (meters) to use for matching, overrides any <code>Depth</code> column
in the data or can be used to specify desired depth range when not present in data.
Variables will be summarised over the range of these depth values. <code>NULL</code>
uses all available depth values</p>
</td></tr>
<tr><td><code id="matchEnvData_+3A_...">...</code></td>
<td>
<p>other parameters to pass to <a href="#topic+ncToData">ncToData</a></p>
</td></tr>
</table>


<h3>Value</h3>

<p>original dataframe with three attached columns for each variable in the netcdf
file, one for each of mean, median, and standard deviation of all values within the buffer
</p>


<h3>Author(s)</h3>

<p>Taiki Sakai <a href="mailto:taiki.sakai@noaa.gov">taiki.sakai@noaa.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data &lt;- data.frame(Latitude = 32, Longitude = -117,
                   UTC = as.POSIXct('2004-12-31 09:00:00', tz='UTC'))
## Not run: 
# Not run because downloads files
# default calculates mean, median, and standard deviation
matchEnvData(data, nc='jplMURSST41', var=c('analysed_sst', 'analysis_error'))
# get just mean within a buffer around coordinates
matchEnvData(data, nc='jplMURSST41', var=c('analysed_sst', 'analysis_error'),
             FUN = mean, buffer = c(.01, .01, 86400))

## End(Not run)
# Can also work from an existing nc file
nc &lt;- system.file('extdata', 'sst.nc', package='PAMmisc')
matchEnvData(data, nc = nc)
# Using a custom function
meanPlusOne &lt;- function(x) {
  mean(x, na.rm=TRUE) + 1
}
matchEnvData(data, nc=nc, FUN=c(mean, meanPlusOne))


</code></pre>

<hr>
<h2 id='ncToData'>Match Data From a Netcdf File</h2><span id='topic+ncToData'></span>

<h3>Description</h3>

<p>Extracts all variables from a netcdf file matching Longitude,
Latitude, and UTC coordinates in given dataframe
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ncToData(
  data,
  nc,
  var = NULL,
  buffer = c(0, 0, 0),
  FUN = c(mean),
  raw = FALSE,
  keepMatch = TRUE,
  progress = TRUE,
  depth = 0,
  verbose = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ncToData_+3A_data">data</code></td>
<td>
<p>dataframe containing Longitude, Latitude, and UTC to extract matching
variables from the netcdf file</p>
</td></tr>
<tr><td><code id="ncToData_+3A_nc">nc</code></td>
<td>
<p>name of a netcdf file</p>
</td></tr>
<tr><td><code id="ncToData_+3A_var">var</code></td>
<td>
<p>(optional) character vector of variable names to match. If <code>NULL</code>, all
variables present in <code>nc</code> will be used</p>
</td></tr>
<tr><td><code id="ncToData_+3A_buffer">buffer</code></td>
<td>
<p>vector of Longitude, Latitude, and Time (seconds) to buffer around
each datapoint. All values within the buffer will be used to report the mean,
median, and standard deviation</p>
</td></tr>
<tr><td><code id="ncToData_+3A_fun">FUN</code></td>
<td>
<p>a vector or list of functions to apply to the data. Default is to apply
mean, median, and standard deviation calculations</p>
</td></tr>
<tr><td><code id="ncToData_+3A_raw">raw</code></td>
<td>
<p>logical flag to return only the raw values of the variables. If <code>TRUE</code>
the output will be changed to a list with length equal to the number of data points.
Each item in the list will have separate named entries for each variable that will have
all values within the given buffer and all values for any Z coordinates present.</p>
</td></tr>
<tr><td><code id="ncToData_+3A_keepmatch">keepMatch</code></td>
<td>
<p>logical flag to keep the matched coordinates, these are useful to make sure
the closest point is actually close to your XYZT</p>
</td></tr>
<tr><td><code id="ncToData_+3A_progress">progress</code></td>
<td>
<p>logical flag to show progress bar for matching data</p>
</td></tr>
<tr><td><code id="ncToData_+3A_depth">depth</code></td>
<td>
<p>depth values (meters) to use for matching, overrides any <code>Depth</code> column
in the data or can be used to specify desired depth range when not present in data.
Variables will be summarised over the range of these depth values. <code>NULL</code>
uses all available depth values</p>
</td></tr>
<tr><td><code id="ncToData_+3A_verbose">verbose</code></td>
<td>
<p>logical flag to show warning messages for possible coordinate mismatch</p>
</td></tr>
<tr><td><code id="ncToData_+3A_...">...</code></td>
<td>
<p>not used</p>
</td></tr>
</table>


<h3>Value</h3>

<p>original dataframe with three attached columns for each variable in the netcdf
file, one for each of mean, median, and standard deviation of all values within the buffer
</p>


<h3>Author(s)</h3>

<p>Taiki Sakai <a href="mailto:taiki.sakai@noaa.gov">taiki.sakai@noaa.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data &lt;- data.frame(Latitude = 32, Longitude = -117,
                   UTC = as.POSIXct('2005-01-01 00:00:00', tz='UTC'))
nc &lt;- system.file('extdata', 'sst.nc', package='PAMmisc')
# default calculates mean
ncToData(data, nc = nc)
# calculate mean, median, and sd
ncToData(data, nc=nc, FUN=c(mean, median, sd), buffer = c(.01, .01, 86400))
# custom function
meanPlusOne &lt;- function(x) {
    mean(x, na.rm=TRUE) + 1
}
ncToData(data, nc=nc, FUN=c(mean, meanPlusOne))

</code></pre>

<hr>
<h2 id='peakTrough'>Find Peaks and Troughs in a Spectrum</h2><span id='topic+peakTrough'></span>

<h3>Description</h3>

<p>Finds up to three peaks in a spectrum, as well as the troughs
between those peaks.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>peakTrough(spec, freqBounds = c(10, 30), dbMin = -15, smooth = 5, plot = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="peakTrough_+3A_spec">spec</code></td>
<td>
<p>the spectrum of a signal, the first column must be frequency in
kilohertz, the second column must be dB</p>
</td></tr>
<tr><td><code id="peakTrough_+3A_freqbounds">freqBounds</code></td>
<td>
<p>a two element vector specifying the frequency range around
the highest peak to search for a second/third peak. Units are in kHz, a
value of c(f1, f2) requires a second peak to be at least f1 kHz away from
the first peak, but no further than f2 kHz away.</p>
</td></tr>
<tr><td><code id="peakTrough_+3A_dbmin">dbMin</code></td>
<td>
<p>minimum dB level for second / third peaks, relative to maximum
dB. Any points lower than this dB level will not be considered a candidate
peak.</p>
</td></tr>
<tr><td><code id="peakTrough_+3A_smooth">smooth</code></td>
<td>
<p>the amount to smooth the spectrum before attempting to find
second / third peaks. Uses a simple local average, smooth is the total
number of points to use. A value of 1 applies no smoothing.</p>
</td></tr>
<tr><td><code id="peakTrough_+3A_plot">plot</code></td>
<td>
<p>logical flag to plot image of peak/trough locations on spectrum.
Useful for finding appropriate settings for freqBounds and dbMin</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The first peak is the frequency with the highest dB level (first and
last frequency points are ignored). Then this uses a very simple algorithm to
find second and third peaks
in a spectrum. Peak candidates are identified with a few simple steps:
</p>

<dl>
<dt>Step 1</dt><dd><p>Use a local average of (<code>smooth</code>) points to smooth the
spectrum.</p>
</dd>
<dt>Step 2</dt><dd><p>Check if a point is larger than both its neighbors.</p>
</dd>
<dt>Step 3</dt><dd><p>Check if points are within the frequency range specified by
<code>freqBounds</code>. Points must be at least f1 kHz away from the frequency
, but no further than f2 kHz away.</p>
</dd>
<dt>Step 4</dt><dd><p>Check if points are above the minimum dB level specified by
<code>dbMin</code>.</p>
</dd>
</dl>

<p>From the remaining points the point with the highest dB level is selected
as the second peak, then the frequency range filter of Step 3 is applied
again around this second peak before attempting to find a third peak. If
no second or third peak is found (ie. no values fall within the specified
frequency and dB search ranges), then it will be set to 0. The trough
values are set as the frequency with the lowest dB level between any peaks
that were found. The trough values will be 0 for any peaks that were not
found.
</p>
<p>If you are unsure of what levels to specify for <code>freqBounds</code> and
<code>dbMin</code>, setting <code>plot=TRUE</code> will show a visualization of the
search range and selected peaks so you can easily see if the selected
parameters are capturing the behavior you want.
</p>


<h3>Value</h3>

<p>a dataframe with the frequencies (in kHz) of up to 3 peaks and 2
troughs between those peaks. Also reports the peak-to-peak distance. Any
peaks / troughs that were not able to be found (based on <code>freqBounds</code>
and <code>dbMin</code> parameters) will be 0.
</p>


<h3>Author(s)</h3>

<p>Taiki Sakai <a href="mailto:taiki.sakai@noaa.gov">taiki.sakai@noaa.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
clickWave &lt;- createClickWave(signalLength = .1, clickLength = 1000, clicksPerSecond = 200,
                             frequency = 3e3, sampleRate = 10e3)
peakTrough(seewave::spec(clickWave, plot=FALSE), plot=TRUE)

</code></pre>

<hr>
<h2 id='plotPresBar'>plotPresBar</h2><span id='topic+plotPresBar'></span>

<h3>Description</h3>

<p>Creates a bar plot of the presence or density of detections across time
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotPresBar(
  x,
  start = NULL,
  end = NULL,
  bin = "hour/day",
  by = NULL,
  title = TRUE,
  fill = "grey35",
  format = c("%m/%d/%Y %H:%M:%S", "%m-%d-%Y %H:%M:%S",
    "%Y/%m/%d %H:%M:%S", "%Y-%m-%d %H:%M:%S"),
  plotTz = "UTC"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plotPresBar_+3A_x">x</code></td>
<td>
<p>a data.frame of detections, must have a column <code>UTC</code> that contains the
time of detection as a POSIXct object in UTC timezone</p>
</td></tr>
<tr><td><code id="plotPresBar_+3A_start">start</code></td>
<td>
<p>the beginning datetime of the plot, if <code>NULL</code> will be set to the minimum
time in <code>x</code></p>
</td></tr>
<tr><td><code id="plotPresBar_+3A_end">end</code></td>
<td>
<p>the ending datetime of the plot, if <code>NULL</code> will be set to the maximum
time in <code>x</code></p>
</td></tr>
<tr><td><code id="plotPresBar_+3A_bin">bin</code></td>
<td>
<p>string identifying how to bin detections. Acceptable time units are
<code>c('minute', 'hour', 'day', 'week', 'month')</code>. For presence, <code>bin</code>
should be of the form <code>'unit1/unit2'</code>, e.g. <code>'hour/day'</code> will show
the hours per day with detections. For call density, <code>bin</code> is a single
time unit, e.g. <code>'hour'</code> will show the number of calls per hour. Call
density can also be specified as <code>'call/hour'</code>. Note that plural forms
of all units are accepted.</p>
</td></tr>
<tr><td><code id="plotPresBar_+3A_by">by</code></td>
<td>
<p>(optional) if not <code>NULL</code>, specifies the name of a column in <code>x</code> to split and
color the bars by</p>
</td></tr>
<tr><td><code id="plotPresBar_+3A_title">title</code></td>
<td>
<p>if <code>TRUE</code>, a title will automatically created. If any other value, that will be
used for the title of the plot.</p>
</td></tr>
<tr><td><code id="plotPresBar_+3A_fill">fill</code></td>
<td>
<p>the fill color for the bars, only used if <code>by</code> is <code>NULL</code>, otherwise bars are
colored by species using the default <a href="ggplot2.html#topic+ggplot2">ggplot2</a> palette</p>
</td></tr>
<tr><td><code id="plotPresBar_+3A_format">format</code></td>
<td>
<p>date format if <code>UTC</code> column of <code>x</code> is a character</p>
</td></tr>
<tr><td><code id="plotPresBar_+3A_plottz">plotTz</code></td>
<td>
<p>the timezone to use for plotting the data. Note that inputs must still be in UTC,
this option allows you to create plots scaled to local time. Valid values come from
<a href="base.html#topic+OlsonNames">OlsonNames</a></p>
</td></tr>
</table>


<h3>Value</h3>

<p>a ggplot2 object
</p>


<h3>Author(s)</h3>

<p>Taiki Sakai <a href="mailto:taiki.sakai@noaa.gov">taiki.sakai@noaa.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
df &lt;- data.frame(UTC = as.POSIXct(runif(1e2, min=0, max=7*24*3600),
                                  origin='1970-01-01 00:00:00', tz='UTC'),
                 label = sample(letters[1:3], 1e2, replace=TRUE))
# hours per day with detections
plotPresBar(df, bin='hour/day')
# calls per day - these options are identical
plotPresBar(df, bin='day')
plotPresBar(df, bin='call/day')
plotPresBar(df, bin='calls/day')
# calls per day, colored by 'label'
plotPresBar(df, bin='day', by='label')

</code></pre>

<hr>
<h2 id='plotPresGrid'>plotPresGrid</h2><span id='topic+plotPresGrid'></span>

<h3>Description</h3>

<p>Creates a grid plot of the presence or density of detections across time
where the x-axis is the hour of the day and the y-axis is the date
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotPresGrid(
  x,
  start = NULL,
  end = NULL,
  bin = c("hour", "minute", "30min", "15min"),
  type = c("presence", "density"),
  by = NULL,
  alpha = 0.5,
  gps = NULL,
  format = c("%m/%d/%Y %H:%M:%S", "%m-%d-%Y %H:%M:%S",
    "%Y/%m/%d %H:%M:%S", "%Y-%m-%d %H:%M:%S"),
  fill = "blue",
  color = NA,
  cmap = viridis_pal()(25),
  title = TRUE,
  plotTz = "UTC"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plotPresGrid_+3A_x">x</code></td>
<td>
<p>a data.frame of detections, must have a column <code>UTC</code> that contains the
time of detection as a POSIXct object in UTC timezone</p>
</td></tr>
<tr><td><code id="plotPresGrid_+3A_start">start</code></td>
<td>
<p>the beginning datetime of the plot, if <code>NULL</code> will be set to the minimum
time in <code>x</code></p>
</td></tr>
<tr><td><code id="plotPresGrid_+3A_end">end</code></td>
<td>
<p>the ending datetime of the plot, if <code>NULL</code> will be set to the maximum
time in <code>x</code></p>
</td></tr>
<tr><td><code id="plotPresGrid_+3A_bin">bin</code></td>
<td>
<p>the unit of time for each rectangle in the grid, must be one of &quot;hour&quot;, &quot;minute&quot;,
&quot;30min&quot;, or &quot;15min&quot;</p>
</td></tr>
<tr><td><code id="plotPresGrid_+3A_type">type</code></td>
<td>
<p>one of either &quot;presence&quot; or &quot;density&quot;. If &quot;density&quot;, then boxes will be colored according
to the number of detections in each <code>timeBin</code> will be plotted. If &quot;presence&quot;, then each box
will be colored by <code>fill</code></p>
</td></tr>
<tr><td><code id="plotPresGrid_+3A_by">by</code></td>
<td>
<p>(optional) if not <code>NULL</code>, specifies the name of a column in <code>x</code> to split and
color the rectangles by. Only valid for presence plots.</p>
</td></tr>
<tr><td><code id="plotPresGrid_+3A_alpha">alpha</code></td>
<td>
<p>opacity of rectangles, only used if <code>by</code> is not <code>NULL</code></p>
</td></tr>
<tr><td><code id="plotPresGrid_+3A_gps">gps</code></td>
<td>
<p>(optional) if not <code>NULL</code>, a data.frame of GPS coordinates covering the date range
of <code>x</code>. These are used to calculate sunrise and sunset information which is shown as a
shaded dark region in the background of the plot. The data.frame must have columns &quot;UTC&quot;,
&quot;Latitude&quot;, and &quot;Longitude&quot;. If columns &quot;Latitude&quot; and &quot;Longitude&quot; are present in <code>x</code>,
then these values will be used and you do not need to provide separate GPS data here</p>
</td></tr>
<tr><td><code id="plotPresGrid_+3A_format">format</code></td>
<td>
<p>date format if <code>UTC</code> column of <code>x</code> is a character</p>
</td></tr>
<tr><td><code id="plotPresGrid_+3A_fill">fill</code></td>
<td>
<p>the fill color for the boxes, only used if <code>type</code> is &quot;presence&quot;</p>
</td></tr>
<tr><td><code id="plotPresGrid_+3A_color">color</code></td>
<td>
<p>the outline color for the boxes, only used if <code>type</code> is &quot;presence&quot;</p>
</td></tr>
<tr><td><code id="plotPresGrid_+3A_cmap">cmap</code></td>
<td>
<p>the colormap to use for the boxes, only used if <code>type</code> is &quot;density&quot;</p>
</td></tr>
<tr><td><code id="plotPresGrid_+3A_title">title</code></td>
<td>
<p>if <code>TRUE</code>, a title will automatically created. If any other value, that will be
used for the title of the plot.</p>
</td></tr>
<tr><td><code id="plotPresGrid_+3A_plottz">plotTz</code></td>
<td>
<p>the timezone to use for plotting the data. Note that inputs must still be in UTC,
this option allows you to create plots scaled to local time. Valid values come from
<a href="base.html#topic+OlsonNames">OlsonNames</a></p>
</td></tr>
</table>


<h3>Value</h3>

<p>a ggplot2 object
</p>


<h3>Author(s)</h3>

<p>Taiki Sakai <a href="mailto:taiki.sakai@noaa.gov">taiki.sakai@noaa.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
df &lt;- data.frame(UTC = as.POSIXct(runif(1e2, min=0, max=7*24*3600),
                                  origin='1970-01-01 00:00:00', tz='UTC'),
                 label = sample(letters[1:3], 1e2, replace=TRUE))
plotPresGrid(df, type='presence', bin='hour')
plotPresGrid(df, type='density', bin='hour')
plotPresGrid(df, type='density', bin='30min')
gps &lt;- data.frame(UTC = as.POSIXct('1970-01-01 00:00:00', tz='UTC'),
                 Latitude=32.4,
                 Longitude = -118)
plotPresGrid(df, gps=gps, bin='hour')
# coloring presence grid by label column
plotPresGrid(df, gps=gps, by='label')
# can be confusing if there is a lot of overlap, ggplot output can be split
library(ggplot2)
plotPresGrid(df, gps=gps, by='label') + facet_wrap(vars(label), ncol=2)
# using "by" with type="density" defaults to this facet_wrap behavior
# since color is already being used to represent density
plotPresGrid(df, gps=gps, by='label', type='density')
# can adjust facet_wrap parameters by adding it again
plotPresGrid(df, gps=gps, by='label', type='density') + facet_wrap(vars(label), ncol=2)

</code></pre>

<hr>
<h2 id='raytrace'>Raytrace Through a Soundspeed Profile</h2><span id='topic+raytrace'></span>

<h3>Description</h3>

<p>Traces the ray of a sound through a varying soundspeed profile
for a fixed amount of time. Also plots the provided sound speed profile and
all traces generated. All code here is based on MATLAB code originally
written by Val Schmidt from the University of New Hampshire
Val Schmidt (2021). raytrace
https://www.mathworks.com/matlabcentral/fileexchange/26253-raytrace), MATLAB Central File Exchange. Retrieved June 29, 2021.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>raytrace(x0, z0, theta0, tt, zz, cc, plot = TRUE, progress = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="raytrace_+3A_x0">x0</code></td>
<td>
<p>starting horizontal coordinate in meters</p>
</td></tr>
<tr><td><code id="raytrace_+3A_z0">z0</code></td>
<td>
<p>starting vertical coordinate in meters</p>
</td></tr>
<tr><td><code id="raytrace_+3A_theta0">theta0</code></td>
<td>
<p>starting angle(s) of ray in degrees</p>
</td></tr>
<tr><td><code id="raytrace_+3A_tt">tt</code></td>
<td>
<p>max travel time of ray in seconds</p>
</td></tr>
<tr><td><code id="raytrace_+3A_zz">zz</code></td>
<td>
<p>vertical coordinates of sound speed profile (positive values are down)</p>
</td></tr>
<tr><td><code id="raytrace_+3A_cc">cc</code></td>
<td>
<p>sound speed measurements at <code>zz</code> locations, meters / second</p>
</td></tr>
<tr><td><code id="raytrace_+3A_plot">plot</code></td>
<td>
<p>logical flag to plot. Can be a vector of length two to individually
select plotting one of the two plots generated</p>
</td></tr>
<tr><td><code id="raytrace_+3A_progress">progress</code></td>
<td>
<p>logical flag to show progress bar</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with four elements: <code>x</code>, the horizontal
coordinates of ray path, <code>z</code> the vertical coordinates of ray path,
<code>t</code> actual travel time of ray in seconds,
and <code>d</code> the total distance the ray traveled. Each individual item
in the output is a list with one entry for each <code>theta0</code> provided.
</p>


<h3>Author(s)</h3>

<p>Taiki Sakai <a href="mailto:taiki.sakai@noaa.gov">taiki.sakai@noaa.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
#  Setup the sound speed profile
zz &lt;- seq(from=0, to=5000, by=1)
cc &lt;- 1520 + zz * -.05
cc[751:length(cc)] &lt;- cc[750] + (zz[751:length(zz)] - zz[750])*.014
rt &lt;- raytrace(0, 0, 5, 120, zz, cc, TRUE)

</code></pre>

<hr>
<h2 id='readGPXTrack'>Read Tracks from a GPX File</h2><span id='topic+readGPXTrack'></span>

<h3>Description</h3>

<p>Read in a GPX file and convert the tracks to a dataframe
</p>


<h3>Usage</h3>

<pre><code class='language-R'>readGPXTrack(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="readGPXTrack_+3A_x">x</code></td>
<td>
<p>a path to a .gpx file</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a dataframe with columns <code>Latitude</code>, <code>Longitude</code>,
<code>UTC</code>, and <code>Name</code>
</p>


<h3>Author(s)</h3>

<p>Taiki Sakai <a href="mailto:taiki.sakai@noaa.gov">taiki.sakai@noaa.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
gpxFile &lt;- system.file('extdata', 'GPX.gpx', package='PAMmisc')
gpxData &lt;- readGPXTrack(gpxFile)
str(gpxData)

</code></pre>

<hr>
<h2 id='readSpecAnno'>Read Pamguard Spectrogram Annotation Table</h2><span id='topic+readSpecAnno'></span>

<h3>Description</h3>

<p>Reads the Spectrogram Annotation table from a PAMGuard database
and applies some minor formatting
</p>


<h3>Usage</h3>

<pre><code class='language-R'>readSpecAnno(db, table = "Spectrogram_Annotation")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="readSpecAnno_+3A_db">db</code></td>
<td>
<p>database file to read data from</p>
</td></tr>
<tr><td><code id="readSpecAnno_+3A_table">table</code></td>
<td>
<p>name of the Spectrogram Annotation table to read</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a dataframe containing spectrogram annotation data
</p>


<h3>Author(s)</h3>

<p>Taiki Sakai <a href="mailto:taiki.sakai@noaa.gov">taiki.sakai@noaa.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
myDb &lt;- 'PamguardDatabase.sqlite3'
specAnno &lt;- readSpecAnno(db)

## End(Not run)
</code></pre>

<hr>
<h2 id='soundtrapQAQC'>Perform QA/QC on Soundtrap Files</h2><span id='topic+soundtrapQAQC'></span>

<h3>Description</h3>

<p>Gathers data from Soundtrap XML log files to perform QA/QC on
a set of recordings.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>soundtrapQAQC(
  dir,
  outDir = NULL,
  xlim = NULL,
  label = NULL,
  voltSelect = c("internal", "external"),
  plot = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="soundtrapQAQC_+3A_dir">dir</code></td>
<td>
<p>directory containing Soundtrap XML logs, wav files, and SUD files.
Can either be a single directory containing folders with all files (will
search recursively), or a vector of three directories containing the SUD files,
wav files, and XML files (in that order - alphabetical S-W-X)</p>
</td></tr>
<tr><td><code id="soundtrapQAQC_+3A_outdir">outDir</code></td>
<td>
<p>if provided, output plots and data will be written to this folder</p>
</td></tr>
<tr><td><code id="soundtrapQAQC_+3A_xlim">xlim</code></td>
<td>
<p>date limit for plots</p>
</td></tr>
<tr><td><code id="soundtrapQAQC_+3A_label">label</code></td>
<td>
<p>label to be used for plots and names of exported files</p>
</td></tr>
<tr><td><code id="soundtrapQAQC_+3A_voltselect">voltSelect</code></td>
<td>
<p>one of &quot;internal&quot; or &quot;external&quot; to select which battery voltage to use</p>
</td></tr>
<tr><td><code id="soundtrapQAQC_+3A_plot">plot</code></td>
<td>
<p>logical flag to create output plots</p>
</td></tr>
</table>


<h3>Value</h3>

<p>list of dataframes with summary data for <code>$xmlInfo</code>, <code>$sudInfo</code>,
and <code>$wavInfo</code>
</p>


<h3>Author(s)</h3>

<p>Taiki Sakai <a href="mailto:taiki.sakai@noaa.gov">taiki.sakai@noaa.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 
# not run
stDir &lt;- './Data/SoundtrapFiles/'
stData &lt;- soundtrapQAQC(stDir, plot=TRUE)
# save data
stData &lt;- soundtrapQAQC(stDir, outDir='./Data/SoundtrapFiles/QAQC', plot=TRUE)
# or provide separate folders of data
stDirs &lt;- c('./Data/SoundtrapFiles/SUDFiles',
            './Data/SoundtrapFiles/WavFiles',
            './Data/SoundtrapFiles/XMLFiles')
stData &lt;- soundtrapQAQC(stDirs, plot=TRUE)

## End(Not run)

</code></pre>

<hr>
<h2 id='squishList'>Compress a List by Name</h2><span id='topic+squishList'></span>

<h3>Description</h3>

<p>Attempts to compress a list by combining elements with
the same name, searching recursively if there are lists in your
list
</p>


<h3>Usage</h3>

<pre><code class='language-R'>squishList(myList, unique = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="squishList_+3A_mylist">myList</code></td>
<td>
<p>a list with named elements to be compressed</p>
</td></tr>
<tr><td><code id="squishList_+3A_unique">unique</code></td>
<td>
<p>logical flag to try and reduce result to only unique values</p>
</td></tr>
</table>


<h3>Details</h3>

<p>items with the same name are assumed to have the same structure
and will be combined. Dataframes will be combined with bind_rows, vectors
just be collapsed into one vector, matrices will be combined with rbind,
lists will be combined recursively with another call to <code>squishList</code>
</p>


<h3>Value</h3>

<p>a list with one element for every unique name in the original list
</p>


<h3>Author(s)</h3>

<p>Taiki Sakai <a href="mailto:taiki.sakai@noaa.gov">taiki.sakai@noaa.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
myList &lt;- list(a=1:3, b=letters[1:4], a=5:6, b=letters[4:10])
squishList(myList)

myList &lt;- list(a=1:3, b=data.frame(x=1:3, y=4:6), b=data.frame(x=10:14, y=1:5))
squishList(myList)

myList &lt;- list(a=list(c=1:2, d=2), b=letters[1:3], a=list(c=4:5, d=6:9))
squishList(myList)

</code></pre>

<hr>
<h2 id='straightPath'>Mark Straight Path Segments in GPS Track</h2><span id='topic+straightPath'></span>

<h3>Description</h3>

<p>This function attempts to mark portions of a GPS track where a
ship is traveling in a straight line by comparing the recent average
heading with a longer term average heading. If these are different, then the
ship should be turning. Note this currently does not take in to account time,
only number of points
</p>


<h3>Usage</h3>

<pre><code class='language-R'>straightPath(gps, nSmall = 10, nLarge = 60, thresh = 10, plot = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="straightPath_+3A_gps">gps</code></td>
<td>
<p>gps data with columns Longitude, Latitude, and UTC (POSIX format).
Usually this has been read in from a Pamguard database, in which case columns
Heading and Speed will also be used.</p>
</td></tr>
<tr><td><code id="straightPath_+3A_nsmall">nSmall</code></td>
<td>
<p>number of points to average to get ship's current heading</p>
</td></tr>
<tr><td><code id="straightPath_+3A_nlarge">nLarge</code></td>
<td>
<p>number of points to average to get ship's longer trend heading</p>
</td></tr>
<tr><td><code id="straightPath_+3A_thresh">thresh</code></td>
<td>
<p>the amount which <code>nSmall</code> and <code>nBig</code> should differ by to
call this a turn</p>
</td></tr>
<tr><td><code id="straightPath_+3A_plot">plot</code></td>
<td>
<p>logical flag to plot result, <code>gps</code> must also have columns
Latitude and Longitude</p>
</td></tr>
</table>


<h3>Value</h3>

<p>the original dataframe <code>gps</code> with an added logical column
<code>straight</code> indicating which portions are approximately straight
</p>


<h3>Author(s)</h3>

<p>Taiki Sakai <a href="mailto:taiki.sakai@noaa.gov">taiki.sakai@noaa.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
gps &lt;- data.frame(Latitude = c(32, 32.1, 32.2, 32.2, 32.2),
                  Longitude = c(-110, -110.1, -110.2, -110.3, -110.4),
                  UTC = as.POSIXct(c('2000-01-01 00:00:00', '2000-01-01 00:00:10',
                                     '2000-01-01 00:00:20', '2000-01-01 00:00:30',
                                     '2000-01-01 00:00:40')),
                  Heading = c(320, 320, 270, 270, 270),
                  Speed = c(.8, .8, .5, .5, .5))

straightPath(gps, nSmall=1, nLarge=2)

straightPath(gps, nSmall=1, nLarge=4)

</code></pre>

<hr>
<h2 id='trainSplitPermute'>trainSplitPermute</h2><span id='topic+trainSplitPermute'></span>

<h3>Description</h3>

<p>Find a desired train/val/test split of a dataset through random
permutation. Uses a variable in your dataset to randomly split by (for example,
could be the location of different sites, or different months of data), then
tries to find the split that most closesly matches your desired distribution
of data for a set of labels. It can often be difficult to find a good split
if the distribution of your labels is not consistent across sites, so this
function tries a bunch of random splits then uses a score to find the best
one.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>trainSplitPermute(
  x,
  probs = c(0.7, 0.15, 0.15),
  n = 1000,
  splitBy = "drift",
  label = "species",
  countCol = NULL,
  minCount = c(1, 1, 1),
  top = 3,
  seed = 112188
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="trainSplitPermute_+3A_x">x</code></td>
<td>
<p>a dataframe of data you want to find splits for</p>
</td></tr>
<tr><td><code id="trainSplitPermute_+3A_probs">probs</code></td>
<td>
<p>a vector of 3 values that sum to one defining what percentage
of data should be in your training, validation, and test sets (respectively)</p>
</td></tr>
<tr><td><code id="trainSplitPermute_+3A_n">n</code></td>
<td>
<p>number of random samples to try. If your labels are fairly evenly distributed
this can be smaller, but needs to be larger for more uneven distributions</p>
</td></tr>
<tr><td><code id="trainSplitPermute_+3A_splitby">splitBy</code></td>
<td>
<p>name of column containing the variable you want to split by</p>
</td></tr>
<tr><td><code id="trainSplitPermute_+3A_label">label</code></td>
<td>
<p>name of the column containing your dataset labels</p>
</td></tr>
<tr><td><code id="trainSplitPermute_+3A_countcol">countCol</code></td>
<td>
<p>the names of any additional columns in your dataset defining
the quantities you want to count (see example for why this is useful)</p>
</td></tr>
<tr><td><code id="trainSplitPermute_+3A_mincount">minCount</code></td>
<td>
<p>minimum count for each split category, usually safe to leave 
this as the default of 1 for all splits</p>
</td></tr>
<tr><td><code id="trainSplitPermute_+3A_top">top</code></td>
<td>
<p>the number of results to return. Usually you want to use just the
best scoring result, but this can occasionally result in splits that are 
distributed in an undesirable way by random chance (eg maybe all sites in 
your validation data are unintentionally clustered together)</p>
</td></tr>
<tr><td><code id="trainSplitPermute_+3A_seed">seed</code></td>
<td>
<p>random seed to set for reproducibility</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list of the <code>top</code> results. Each
individual result contains <code>$splitMap</code> containing the random split marked 
as integer 1, 2, 3 corresponding to train, val, test and <code>$splitVec</code> a vector 
marking each row of <code>x</code> with its category. These two results are named by
the levels of <code>splitBy</code>. <code>$distribution</code> a table of the distribution of <code>label</code>
in the split, and <code>$score</code> the split score (lower is closer to desired 
<code>probs</code>)
</p>


<h3>Author(s)</h3>

<p>Taiki Sakai <a href="mailto:taiki.sakai@noaa.gov">taiki.sakai@noaa.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# making some dummy data
df &lt;- data.frame(
    species = sample(letters[1:5], prob=c(.4, .2, .1, .1, .2), 1e3, replace=TRUE),
    site = sample(LETTERS[1:12], 1e3, replace=TRUE),
    event = 1:1e3
)
# try a split with n=3
split &lt;- trainSplitPermute(df, probs=c(.7, .15, .15), n=3, label='species', splitBy='site')
# assign the best split as the split cateogry
df$split &lt;- split[[1]]$splitVec
# distribution is not close to our desired .7, .15, .15 split because n is too low
round(table(df$species, df$split) /
    matrix(rep(table(df$species), 3), nrow=5), 2)

# rerun with higher n to get closer to desired distribution
split &lt;- trainSplitPermute(df, probs=c(.7, .15, .15), n=1e3, label='species', splitBy='site')
df$split &lt;- split[[1]]$splitVec
round(table(df$species, df$split) /
    matrix(rep(table(df$species), 3), nrow=5), 2)
    
# adding a new site that has significantly more detections than others
addSite &lt;- data.frame(
    species = sample(letters[1:5], 500, replace=TRUE),
    site = rep(LETTERS[13], 500),
    event = 1001:1500)
df$split &lt;- NULL
df &lt;- rbind(df, addSite)

# now just splitting by site does not result in a balanced split for our number of species
# it splits the sites to approx .7, .15, .15 but this does not result in balanced species
split &lt;- trainSplitPermute(df, probs=c(.7, .15, .15), n=1e3, label='species', splitBy='site')
df$split &lt;- split[[1]]$splitVec
round(table(df$species, df$split) /
    matrix(rep(table(df$species), 3), nrow=5), 2)

# adding 'event' as a countCol fixes this
split &lt;- trainSplitPermute(df, probs=c(.7, .15, .15), n=1e3, label='species', 
    splitBy='site', countCol='event')
df$split &lt;- split[[1]]$splitVec
round(table(df$species, df$split) /
    matrix(rep(table(df$species), 3), nrow=5), 2)


</code></pre>

<hr>
<h2 id='updateUID'>Update Detection UIDs</h2><span id='topic+updateUID'></span>

<h3>Description</h3>

<p>Update the UIDs of detections in a Pamguard database.
UIDs can become mismatched when re-running data, this will attempt
to re-associate the new UIDs in binary files with detections in the
database
</p>


<h3>Usage</h3>

<pre><code class='language-R'>updateUID(db, binaries, verbose = TRUE, progress = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="updateUID_+3A_db">db</code></td>
<td>
<p>database file to update UIDs</p>
</td></tr>
<tr><td><code id="updateUID_+3A_binaries">binaries</code></td>
<td>
<p>folder of binary files to use for updating</p>
</td></tr>
<tr><td><code id="updateUID_+3A_verbose">verbose</code></td>
<td>
<p>logical flag to show summary messages</p>
</td></tr>
<tr><td><code id="updateUID_+3A_progress">progress</code></td>
<td>
<p>logical flag to show progress bars</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Same database as <code>db</code>, but with an additional column
&quot;newUID&quot; added to each detection table with updated UIDs if found.
&quot;newUID&quot; will be -1 for any detections where no match was found
</p>


<h3>Author(s)</h3>

<p>Taiki Sakai <a href="mailto:taiki.sakai@noaa.gov">taiki.sakai@noaa.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 
# not run because sample data does not exist
db &lt;- 'MismatchedUid.sqlite3'
bin &lt;- './BinaryFolder'
updateUID(db, bin)

## End(Not run)

</code></pre>

<hr>
<h2 id='varSelect'>Utility for Selecting Variables to Download</h2><span id='topic+varSelect'></span>

<h3>Description</h3>

<p>Loops through the available variables in an edinfo object and asks
whether or not each should be downloaded, then stores the result for
passing on to <a href="#topic+formatURL">formatURL</a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>varSelect(edinfo, select = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="varSelect_+3A_edinfo">edinfo</code></td>
<td>
<p>a datalist, either from <a href="#topic+getEdinfo">getEdinfo</a> or created by
<a href="#topic+erddapToEdinfo">erddapToEdinfo</a></p>
</td></tr>
<tr><td><code id="varSelect_+3A_select">select</code></td>
<td>
<p>(optional) logical vector of which variables to select.
If left as default <code>NULL</code>, user will be prompted to select which
variables to keep. If not <code>NULL</code>, can either be a single <code>TRUE</code>
to select all variables, or a logical vector of length equal to the number
of variables in <code>edinfo</code>. Can also be a vector of variable names to
select.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>the same object as <code>edinfo</code> with an updated <code>varSelect</code> field
</p>


<h3>Author(s)</h3>

<p>Taiki Sakai <a href="mailto:taiki.sakai@noaa.gov">taiki.sakai@noaa.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
sstEdi &lt;- getEdinfo()[['jplMURSST41']]
## Not run: 
# interactively select
sstEdi &lt;- varSelect(sstEdi)

## End(Not run)
# select all variables
sstEdi &lt;- varSelect(sstEdi, TRUE)
# select the first two of four
sstEdi &lt;- varSelect(sstEdi, c(TRUE, TRUE, FALSE, FALSE))

</code></pre>

<hr>
<h2 id='wignerTransform'>Calculate the Wigner-Ville Transform of a Signal</h2><span id='topic+wignerTransform'></span>

<h3>Description</h3>

<p>Calculates the Wigner-Ville transform a signal. By default, the
signal will be zero-padded to the next power of two before computing the
transform, and creates an NxN matrix where N is the zero-padded length.
Note that this matrix can get very large for larger N, consider shortening
longer signals.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>wignerTransform(signal, n = NULL, sr, plot = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="wignerTransform_+3A_signal">signal</code></td>
<td>
<p>input signal waveform</p>
</td></tr>
<tr><td><code id="wignerTransform_+3A_n">n</code></td>
<td>
<p>number of frequency bins of the output, if NULL will be the next power of two
from the length of the input signal (recommended)</p>
</td></tr>
<tr><td><code id="wignerTransform_+3A_sr">sr</code></td>
<td>
<p>the sample rate of the data</p>
</td></tr>
<tr><td><code id="wignerTransform_+3A_plot">plot</code></td>
<td>
<p>logical flag whether or not to plot the result</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This code mostly follows Pamguard's Java code for computing the
Wigner-Ville and Hilbert transforms.
</p>


<h3>Value</h3>

<p>a list with three items. <code>tfr</code>, the real values of the wigner
transform as a matrix with <code>n</code> rows and number of columns equal to the next
power of two from the length of the input signal. <code>f</code> and <code>t</code>
the values of the frequency and time axes.
</p>


<h3>Author(s)</h3>

<p>Taiki Sakai <a href="mailto:taiki.sakai@noaa.gov">taiki.sakai@noaa.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>clickWave &lt;- createClickWave(signalLength = .05, clickLength = 1000, clicksPerSecond = 200,
                             frequency = 3e3, sampleRate = 10e3)
wt &lt;- wignerTransform(clickWave@left, n = 1000, sr = 10e3, plot=TRUE)

</code></pre>

<hr>
<h2 id='writeAMWave'>Write Amplitude Modulated Waveform</h2><span id='topic+writeAMWave'></span><span id='topic+createAMWave'></span>

<h3>Description</h3>

<p>Write a wave file for a synthesized amplitude modulated call
</p>


<h3>Usage</h3>

<pre><code class='language-R'>writeAMWave(
  fileName,
  outDir,
  signalLength,
  modFrequency,
  frequency,
  sampleRate,
  window = c(0.55, 0.45),
  silence = c(0, 0),
  gainFactor = 0.1
)

createAMWave(
  signalLength,
  modFrequency,
  frequency,
  sampleRate,
  window = c(0.55, 0.45),
  silence = c(0, 0),
  gainFactor = 0.1
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="writeAMWave_+3A_filename">fileName</code></td>
<td>
<p>name of the file to write. If missing, the file be named
usign signalLength, modFrequency, frequency, and sampleRate</p>
</td></tr>
<tr><td><code id="writeAMWave_+3A_outdir">outDir</code></td>
<td>
<p>directory to write wave files to</p>
</td></tr>
<tr><td><code id="writeAMWave_+3A_signallength">signalLength</code></td>
<td>
<p>length of signal to create in seconds</p>
</td></tr>
<tr><td><code id="writeAMWave_+3A_modfrequency">modFrequency</code></td>
<td>
<p>modulation frequency in Hz of the amplitude modulation</p>
</td></tr>
<tr><td><code id="writeAMWave_+3A_frequency">frequency</code></td>
<td>
<p>frequency of the AM call</p>
</td></tr>
<tr><td><code id="writeAMWave_+3A_samplerate">sampleRate</code></td>
<td>
<p>sample rate for the wave file to create</p>
</td></tr>
<tr><td><code id="writeAMWave_+3A_window">window</code></td>
<td>
<p>window constants for applying the amplitude modulation. See details.</p>
</td></tr>
<tr><td><code id="writeAMWave_+3A_silence">silence</code></td>
<td>
<p>silence to pad before and after signal in seconds</p>
</td></tr>
<tr><td><code id="writeAMWave_+3A_gainfactor">gainFactor</code></td>
<td>
<p>scaling factor between 0 and 1. Low numbers are recommended (default 0.1)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Amplitude modulated signals are modelled as an ideal sinusoid multiplied by a
window function. The window function is an offset sinusoid with frequency equal to the
modulation frequency:
</p>
<p style="text-align: center;"><code class="reqn">W = .5 + .45 * sin(2 \pi mf t)</code>
</p>

<p>See <code>example(writeAMWave)</code> for a plot showing how this works.
</p>


<h3>Value</h3>

<p><code>writeAMWave</code> invisibly returns the file name, <code>createAMWave</code>
returns a <a href="tuneR.html#topic+Wave-class">Wave</a> class object
</p>


<h3>Author(s)</h3>

<p>Taiki Sakai <a href="mailto:taiki.sakai@noaa.gov">taiki.sakai@noaa.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Visualisation of modelled AM wave
signal &lt;- sin(2*pi*100*(1:1000)/1000)
window &lt;- .55 + .45 * sin(2*pi*15*(1:1000)/1000)
oldMf &lt;- par()$mfrow
par(mfrow=c(3,1))
plot(signal, type='l')
plot(window, type='l')
plot(window*signal, type='l')
tmpFile &lt;- file.path(tempdir(), 'tempWav.wav')
writeAMWave(tmpFile, signalLength = 1, modFrequency = 1000,
               frequency = 30000, sampleRate = 100000)
file.remove(tmpFile)
amWave &lt;- createAMWave(signalLength = 1, modFrequency = 1000,
                             frequency = 30e3, sampleRate = 100e3)
par(mfrow=oldMf)
</code></pre>

<hr>
<h2 id='writeClickWave'>Write Click Waveform</h2><span id='topic+writeClickWave'></span><span id='topic+createClickWave'></span>

<h3>Description</h3>

<p>Write a wave file for a synthesized delphinid click
</p>


<h3>Usage</h3>

<pre><code class='language-R'>writeClickWave(
  fileName,
  outDir,
  signalLength,
  clickLength,
  clicksPerSecond,
  frequency,
  sampleRate,
  silence = c(0, 0),
  gainFactor = 0.1
)

createClickWave(
  signalLength,
  clickLength,
  clicksPerSecond,
  frequency,
  sampleRate,
  silence = c(0, 0),
  gainFactor = 0.1
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="writeClickWave_+3A_filename">fileName</code></td>
<td>
<p>name of the file to write. If missing, the file be named
usign signalLength, clickLength, clicksPerSecond, frequency, and sampleRate</p>
</td></tr>
<tr><td><code id="writeClickWave_+3A_outdir">outDir</code></td>
<td>
<p>directory to write wave files to</p>
</td></tr>
<tr><td><code id="writeClickWave_+3A_signallength">signalLength</code></td>
<td>
<p>length of signal to create in seconds</p>
</td></tr>
<tr><td><code id="writeClickWave_+3A_clicklength">clickLength</code></td>
<td>
<p>length of each click in microseconds</p>
</td></tr>
<tr><td><code id="writeClickWave_+3A_clickspersecond">clicksPerSecond</code></td>
<td>
<p>number of clicks per second</p>
</td></tr>
<tr><td><code id="writeClickWave_+3A_frequency">frequency</code></td>
<td>
<p>frequency of the clicks</p>
</td></tr>
<tr><td><code id="writeClickWave_+3A_samplerate">sampleRate</code></td>
<td>
<p>sample rate for the wave file to create</p>
</td></tr>
<tr><td><code id="writeClickWave_+3A_silence">silence</code></td>
<td>
<p>silence to pad before and after signal in seconds</p>
</td></tr>
<tr><td><code id="writeClickWave_+3A_gainfactor">gainFactor</code></td>
<td>
<p>scaling factor between 0 and 1. Low numbers are recommended (default 0.1)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This code is based on Matlab code by Julie Oswald (2004). Clicks are
simulated as an exponentially damped sinusoid.
</p>


<h3>Value</h3>

<p><code>writeClickWave</code> invisibly returns the file name, <code>createClickWave</code>
returns a <a href="tuneR.html#topic+Wave-class">Wave</a> class object
</p>


<h3>Author(s)</h3>

<p>Taiki Sakai <a href="mailto:taiki.sakai@noaa.gov">taiki.sakai@noaa.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
tmpFile &lt;- file.path(tempdir(), 'tempWav.wav')
writeClickWave(tmpFile, signalLength = 1, clickLength = 100, clicksPerSecond = 200,
               frequency = 30000, sampleRate = 100000)
file.remove(tmpFile)
clickWave &lt;- createClickWave(signalLength = 1, clickLength = 100, clicksPerSecond = 200,
                             frequency = 30e3, sampleRate = 100e3)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
