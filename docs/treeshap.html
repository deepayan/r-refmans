<!DOCTYPE html><html lang="en"><head><title>Help for package treeshap</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {treeshap}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#colors_discrete_drwhy'><p>DrWhy color palettes for ggplot objects</p></a></li>
<li><a href='#fifa20'><p>Attributes of all players in FIFA 20</p></a></li>
<li><a href='#gbm.unify'><p>Unify GBM model</p></a></li>
<li><a href='#is.model_unified'><p>Check whether object is a valid model_unified object</p></a></li>
<li><a href='#is.treeshap'><p>Check whether object is a valid treeshap object</p></a></li>
<li><a href='#lightgbm.unify'><p>Unify LightGBM model</p></a></li>
<li><a href='#model_unified_multioutput.object'><p>Unified model representations for multi-output model</p></a></li>
<li><a href='#model_unified.object'><p>Unified model representation</p></a></li>
<li><a href='#plot_contribution'><p>SHAP value based Break-Down plot</p></a></li>
<li><a href='#plot_feature_dependence'><p>SHAP value based Feature Dependence plot</p></a></li>
<li><a href='#plot_feature_importance'><p>SHAP value based Feature Importance plot</p></a></li>
<li><a href='#plot_interaction'><p>SHAP Interaction value plot</p></a></li>
<li><a href='#predict.model_unified'><p>Predict</p></a></li>
<li><a href='#print.model_unified'><p>Prints model_unified objects</p></a></li>
<li><a href='#print.model_unified_multioutput'><p>Prints model_unified_multioutput objects</p></a></li>
<li><a href='#print.treeshap'><p>Prints treeshap objects</p></a></li>
<li><a href='#print.treeshap_multioutput'><p>Prints treeshap_multioutput objects</p></a></li>
<li><a href='#randomForest.unify'><p>Unify randomForest model</p></a></li>
<li><a href='#ranger_surv.unify'><p>Unify ranger survival model</p></a></li>
<li><a href='#ranger.unify'><p>Unify ranger model</p></a></li>
<li><a href='#set_reference_dataset'><p>Set reference dataset</p></a></li>
<li><a href='#theme_drwhy'><p>DrWhy Theme for ggplot objects</p></a></li>
<li><a href='#treeshap'><p>Calculate SHAP values of a tree ensemble model.</p></a></li>
<li><a href='#treeshap_multioutput.object'><p>treeshap results for multi-output model</p></a></li>
<li><a href='#treeshap.object'><p>treeshap results</p></a></li>
<li><a href='#unify'><p>Unify tree-based model</p></a></li>
<li><a href='#xgboost.unify'><p>Unify XGBoost model</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Compute SHAP Values for Your Tree-Based Models Using the
'TreeSHAP' Algorithm</td>
</tr>
<tr>
<td>Version:</td>
<td>0.3.1</td>
</tr>
<tr>
<td>Description:</td>
<td>An efficient implementation of the 'TreeSHAP' algorithm
    introduced by Lundberg et al., (2020) &lt;<a href="https://doi.org/10.1038%2Fs42256-019-0138-9">doi:10.1038/s42256-019-0138-9</a>&gt;.
    It is capable of calculating SHAP (SHapley Additive exPlanations) values 
    for tree-based models in polynomial time.  Currently supported models include 
    'gbm', 'randomForest', 'ranger', 'xgboost', 'lightgbm'.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://modeloriented.github.io/treeshap/">https://modeloriented.github.io/treeshap/</a>,
<a href="https://github.com/ModelOriented/treeshap">https://github.com/ModelOriented/treeshap</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/ModelOriented/treeshap/issues">https://github.com/ModelOriented/treeshap/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10)</td>
</tr>
<tr>
<td>Imports:</td>
<td>data.table, ggplot2, Rcpp</td>
</tr>
<tr>
<td>Suggests:</td>
<td>gbm, jsonlite, lightgbm, randomForest, ranger, scales,
survival, testthat, xgboost</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-01-22 13:05:31 UTC; krzyzinskim</td>
</tr>
<tr>
<td>Author:</td>
<td>Konrad Komisarczyk [aut],
  Pawel Kozminski [aut],
  Szymon Maksymiuk <a href="https://orcid.org/0000-0002-3120-1601"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Lorenz A. Kapsner <a href="https://orcid.org/0000-0003-1866-860X"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb],
  Mikolaj Spytek <a href="https://orcid.org/0000-0001-7111-2286"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb],
  Mateusz Krzyzinski
    <a href="https://orcid.org/0000-0001-6143-488X"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [ctb, cre],
  Przemyslaw Biecek <a href="https://orcid.org/0000-0001-8423-1823"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cph]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Mateusz Krzyzinski &lt;krzyzinskimateusz23@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-01-22 15:20:06 UTC</td>
</tr>
</table>
<hr>
<h2 id='colors_discrete_drwhy'>DrWhy color palettes for ggplot objects</h2><span id='topic+colors_discrete_drwhy'></span><span id='topic+colors_breakdown_drwhy'></span>

<h3>Description</h3>

<p>DrWhy color palettes for ggplot objects
</p>


<h3>Usage</h3>

<pre><code class='language-R'>colors_discrete_drwhy(n = 2)

colors_breakdown_drwhy()
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="colors_discrete_drwhy_+3A_n">n</code></td>
<td>
<p>number of colors for color palette</p>
</td></tr>
</table>


<h3>Value</h3>

<p>color palette as vector of characters
</p>

<hr>
<h2 id='fifa20'>Attributes of all players in FIFA 20</h2><span id='topic+fifa20'></span>

<h3>Description</h3>

<p>Dataset consists of 56 columns, 55 numeric and one of type factor <code>'work_rate'</code>.
<code>value_eur</code> is a potential target feature.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fifa20
</code></pre>


<h3>Format</h3>

<p>A data frame with 18278 rows and 56 columns.
Most of variables representing skills are in range from 0 to 100 and will not be described here.
To list non obvious features:
</p>

<dl>
<dt>overall</dt><dd><p>Overall score of player's skills</p>
</dd>
<dt>potential</dt><dd><p>Potential of a player, younger players tend to have higher level of potential</p>
</dd>
<dt>value_eur</dt><dd><p>Market value of a player (in mln EUR)</p>
</dd>
<dt>international_reputation</dt><dd><p>Range 1 to 5</p>
</dd>
<dt>weak_foot</dt><dd><p>Range 1 to 5</p>
</dd>
<dt>skill_moves</dt><dd><p>Range 1 to 5</p>
</dd>
<dt>work_rate</dt><dd><p>Divided by slash levels of willingness to work in offense and defense respectively</p>
</dd>
</dl>



<h3>Source</h3>

<p>&quot;Data has been scraped from the publicly available website <a href="https://sofifa.com">https://sofifa.com</a>&quot;
<a href="https://www.kaggle.com/stefanoleone992/fifa-20-complete-player-dataset">https://www.kaggle.com/stefanoleone992/fifa-20-complete-player-dataset</a>
</p>

<hr>
<h2 id='gbm.unify'>Unify GBM model</h2><span id='topic+gbm.unify'></span>

<h3>Description</h3>

<p>Convert your GBM model into a standardized representation.
The returned representation is easy to be interpreted by the user and ready to be used as an argument in <code>treeshap()</code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gbm.unify(gbm_model, data)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gbm.unify_+3A_gbm_model">gbm_model</code></td>
<td>
<p>An object of <code>gbm</code> class. At the moment, models built on data with categorical features
are not supported - please encode them before training.</p>
</td></tr>
<tr><td><code id="gbm.unify_+3A_data">data</code></td>
<td>
<p>Reference dataset. A <code>data.frame</code> or <code>matrix</code> with the same columns as in the training set of the model. Usually dataset used to train model.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a unified model representation - a <code><a href="#topic+model_unified.object">model_unified.object</a></code> object
</p>


<h3>See Also</h3>

<p><code><a href="#topic+lightgbm.unify">lightgbm.unify</a></code> for <code><a href="lightgbm.html#topic+lightgbm">LightGBM models</a></code>
</p>
<p><code><a href="#topic+xgboost.unify">xgboost.unify</a></code> for <code><a href="xgboost.html#topic+xgboost">XGBoost models</a></code>
</p>
<p><code><a href="#topic+ranger.unify">ranger.unify</a></code> for <code><a href="ranger.html#topic+ranger">ranger models</a></code>
</p>
<p><code><a href="#topic+randomForest.unify">randomForest.unify</a></code> for <code><a href="randomForest.html#topic+randomForest">randomForest models</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(gbm)
data &lt;- fifa20$data[colnames(fifa20$data) != 'work_rate']
data['value_eur'] &lt;- fifa20$target
gbm_model &lt;- gbm::gbm(
             formula = value_eur ~ .,
             data = data,
             distribution = "gaussian",
             n.trees = 20,
             interaction.depth = 4,
             n.cores = 1)
unified_model &lt;- gbm.unify(gbm_model, data)
shaps &lt;- treeshap(unified_model, data[1:2,])
plot_contribution(shaps, obs = 1)

</code></pre>

<hr>
<h2 id='is.model_unified'>Check whether object is a valid model_unified object</h2><span id='topic+is.model_unified'></span>

<h3>Description</h3>

<p>Does not check correctness of representation, only basic checks
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is.model_unified(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="is.model_unified_+3A_x">x</code></td>
<td>
<p>an object to check</p>
</td></tr>
</table>


<h3>Value</h3>

<p>boolean
</p>

<hr>
<h2 id='is.treeshap'>Check whether object is a valid treeshap object</h2><span id='topic+is.treeshap'></span>

<h3>Description</h3>

<p>Does not check correctness of result, only basic checks
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is.treeshap(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="is.treeshap_+3A_x">x</code></td>
<td>
<p>an object to check</p>
</td></tr>
</table>


<h3>Value</h3>

<p>boolean
</p>

<hr>
<h2 id='lightgbm.unify'>Unify LightGBM model</h2><span id='topic+lightgbm.unify'></span>

<h3>Description</h3>

<p>Convert your LightGBM model into a standardized representation.
The returned representation is easy to be interpreted by the user and ready to be used as an argument in <code>treeshap()</code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lightgbm.unify(lgb_model, data, recalculate = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="lightgbm.unify_+3A_lgb_model">lgb_model</code></td>
<td>
<p>A lightgbm model - object of class <code>lgb.Booster</code></p>
</td></tr>
<tr><td><code id="lightgbm.unify_+3A_data">data</code></td>
<td>
<p>Reference dataset. A <code>data.frame</code> or <code>matrix</code> with the same columns as in the training set of the model. Usually dataset used to train model.</p>
</td></tr>
<tr><td><code id="lightgbm.unify_+3A_recalculate">recalculate</code></td>
<td>
<p>logical indicating if covers should be recalculated according to the dataset given in data. Keep it <code>FALSE</code> if training data are used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a unified model representation - a <code><a href="#topic+model_unified.object">model_unified.object</a></code> object
</p>


<h3>See Also</h3>

<p><code><a href="#topic+gbm.unify">gbm.unify</a></code> for <code><a href="gbm.html#topic+gbm">GBM models</a></code>
</p>
<p><code><a href="#topic+xgboost.unify">xgboost.unify</a></code> for <code><a href="xgboost.html#topic+xgboost">XGBoost models</a></code>
</p>
<p><code><a href="#topic+ranger.unify">ranger.unify</a></code> for <code><a href="ranger.html#topic+ranger">ranger models</a></code>
</p>
<p><code><a href="#topic+randomForest.unify">randomForest.unify</a></code> for <code><a href="randomForest.html#topic+randomForest">randomForest models</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(lightgbm)
param_lgbm &lt;- list(objective = "regression", max_depth = 2,
                   force_row_wise = TRUE, num_iterations = 20)
data_fifa &lt;- fifa20$data[!colnames(fifa20$data) %in%
             c('work_rate', 'value_eur', 'gk_diving', 'gk_handling',
             'gk_kicking', 'gk_reflexes', 'gk_speed', 'gk_positioning')]
data &lt;- na.omit(cbind(data_fifa, fifa20$target))
sparse_data &lt;- as.matrix(data[,-ncol(data)])
x &lt;- lightgbm::lgb.Dataset(sparse_data, label = as.matrix(data[,ncol(data)]))
lgb_data &lt;- lightgbm::lgb.Dataset.construct(x)
lgb_model &lt;- lightgbm::lightgbm(data = lgb_data, params = param_lgbm,
                                verbose = -1, num_threads = 0)
unified_model &lt;- lightgbm.unify(lgb_model, sparse_data)
shaps &lt;- treeshap(unified_model, data[1:2, ])
plot_contribution(shaps, obs = 1)

</code></pre>

<hr>
<h2 id='model_unified_multioutput.object'>Unified model representations for multi-output model</h2><span id='topic+model_unified_multioutput.object'></span>

<h3>Description</h3>

<p><code>model_unified_multioutput</code> object produced by <code>*.unify</code> or <code>unify</code> function.
</p>


<h3>Value</h3>

<p>List consisting of <code>model_unified</code> objects, one for each individual output of a model. For survival models, the list is named using the time points, for which predictions are calculated.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+unify">unify</a></code>
</p>

<hr>
<h2 id='model_unified.object'>Unified model representation</h2><span id='topic+model_unified.object'></span>

<h3>Description</h3>

<p><code>model_unified</code> object produced by <code>*.unify</code> or <code>unify</code> function.
</p>


<h3>Value</h3>

<p>List consisting of two elements:
</p>
<p><strong>model</strong> - A <code>data.frame</code> representing model with following columns:
</p>
<table role = "presentation">
<tr><td><code>Tree</code></td>
<td>
<p>0-indexed ID of a tree</p>
</td></tr>
<tr><td><code>Node</code></td>
<td>
<p>0-indexed ID of a node in a tree. In a tree the root always has ID 0</p>
</td></tr>
<tr><td><code>Feature</code></td>
<td>
<p>In case of an internal node - name of a feature to split on. Otherwise - NA</p>
</td></tr>
<tr><td><code>Decision.type</code></td>
<td>
<p>A factor with two levels: &quot;&lt;&quot; and &quot;&lt;=&quot;. In case of an internal node - predicate used for splitting observations. Otherwise - NA</p>
</td></tr>
<tr><td><code>Split</code></td>
<td>
<p>For internal nodes threshold used for splitting observations. All observations that satisfy the predicate Decision.type(Split) ('&lt; Split' / '&lt;= Split') are proceeded to the node marked as 'Yes'. Otherwise to the 'No' node. For leaves - NA</p>
</td></tr>
<tr><td><code>Yes</code></td>
<td>
<p>Index of a row containing a child Node. Thanks to explicit indicating the row it is much faster to move between nodes</p>
</td></tr>
<tr><td><code>No</code></td>
<td>
<p>Index of a row containing a child Node</p>
</td></tr>
<tr><td><code>Missing</code></td>
<td>
<p>Index of a row containing a child Node where are proceeded all observations with no value of the dividing feature</p>
</td></tr>
<tr><td><code>Prediction</code></td>
<td>
<p>For leaves: Value of prediction in the leaf. For internal nodes: NA</p>
</td></tr>
<tr><td><code>Cover</code></td>
<td>
<p>Number of observations seen by the internal node or collected by the leaf for the reference dataset</p>
</td></tr>
</table>
<p><strong>data</strong> - Dataset used as a reference for calculating SHAP values. A dataset passed to the <code>*.unify</code>, <code>unify</code> or <code><a href="#topic+set_reference_dataset">set_reference_dataset</a></code> function with <code>data</code> argument. A <code>data.frame</code>.
</p>
<p>Object has two also attributes set:
</p>
<table role = "presentation">
<tr><td><code>model</code></td>
<td>
<p>A string. By what package the model was produced.</p>
</td></tr>
<tr><td><code>missing_support</code></td>
<td>
<p>A boolean. Whether the model allows missing values to be present in explained dataset.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+unify">unify</a></code>
</p>

<hr>
<h2 id='plot_contribution'>SHAP value based Break-Down plot</h2><span id='topic+plot_contribution'></span>

<h3>Description</h3>

<p>This function plots contributions of features into the prediction for a single observation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_contribution(
  treeshap,
  obs = 1,
  max_vars = 5,
  min_max = NA,
  digits = 3,
  explain_deviation = FALSE,
  title = "SHAP Break-Down",
  subtitle = ""
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_contribution_+3A_treeshap">treeshap</code></td>
<td>
<p>A treeshap object produced with the <code><a href="#topic+treeshap">treeshap</a></code> function. <code><a href="#topic+treeshap.object">treeshap.object</a></code>.</p>
</td></tr>
<tr><td><code id="plot_contribution_+3A_obs">obs</code></td>
<td>
<p>A numeric indicating which observation should be plotted. Be default it's first observation.</p>
</td></tr>
<tr><td><code id="plot_contribution_+3A_max_vars">max_vars</code></td>
<td>
<p>maximum number of variables that shall be presented. Variables with the highest importance will be presented.
Remaining variables will be summed into one additional contribution. By default <code>5</code>.</p>
</td></tr>
<tr><td><code id="plot_contribution_+3A_min_max">min_max</code></td>
<td>
<p>a range of OX axis. By default <code>NA</code>, therefore it will be extracted from the contributions of <code>x</code>.
But it can be set to some constants, useful if these plots are to be used for comparisons.</p>
</td></tr>
<tr><td><code id="plot_contribution_+3A_digits">digits</code></td>
<td>
<p>number of decimal places (<code><a href="base.html#topic+round">round</a></code>) to be used.</p>
</td></tr>
<tr><td><code id="plot_contribution_+3A_explain_deviation">explain_deviation</code></td>
<td>
<p>if <code>TRUE</code> then instead of explaining prediction and plotting intercept bar, only deviation from mean prediction of the reference dataset will be explained. By default <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="plot_contribution_+3A_title">title</code></td>
<td>
<p>the plot's title, by default <code>'SHAP Break-Down'</code>.</p>
</td></tr>
<tr><td><code id="plot_contribution_+3A_subtitle">subtitle</code></td>
<td>
<p>the plot's subtitle. By default no subtitle.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>ggplot2</code> object
</p>


<h3>See Also</h3>

<p><code><a href="#topic+treeshap">treeshap</a></code> for calculation of SHAP values
</p>
<p><code><a href="#topic+plot_feature_importance">plot_feature_importance</a></code>, <code><a href="#topic+plot_feature_dependence">plot_feature_dependence</a></code>, <code><a href="#topic+plot_interaction">plot_interaction</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(xgboost)
data &lt;- fifa20$data[colnames(fifa20$data) != 'work_rate']
target &lt;- fifa20$target
param &lt;- list(objective = "reg:squarederror", max_depth = 3)
xgb_model &lt;- xgboost::xgboost(as.matrix(data), params = param, label = target,
                              nrounds = 20, verbose = FALSE)
unified_model &lt;- xgboost.unify(xgb_model, as.matrix(data))
x &lt;- head(data, 1)
shap &lt;- treeshap(unified_model, x)
plot_contribution(shap, 1,  min_max = c(0, 120000000))

</code></pre>

<hr>
<h2 id='plot_feature_dependence'>SHAP value based Feature Dependence plot</h2><span id='topic+plot_feature_dependence'></span>

<h3>Description</h3>

<p>Depending on the value of a variable: how does it contribute into the prediction?
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_feature_dependence(
  treeshap,
  variable,
  title = "Feature Dependence",
  subtitle = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_feature_dependence_+3A_treeshap">treeshap</code></td>
<td>
<p>A treeshap object produced with the <code><a href="#topic+treeshap">treeshap</a></code> function. <code><a href="#topic+treeshap.object">treeshap.object</a></code>.</p>
</td></tr>
<tr><td><code id="plot_feature_dependence_+3A_variable">variable</code></td>
<td>
<p>name or index of variable for which feature dependence will be plotted.</p>
</td></tr>
<tr><td><code id="plot_feature_dependence_+3A_title">title</code></td>
<td>
<p>the plot's title, by default <code>'Feature Dependence'</code>.</p>
</td></tr>
<tr><td><code id="plot_feature_dependence_+3A_subtitle">subtitle</code></td>
<td>
<p>the plot's subtitle. By default no subtitle.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>ggplot2</code> object
</p>


<h3>See Also</h3>

<p><code><a href="#topic+treeshap">treeshap</a></code> for calculation of SHAP values
</p>
<p><code><a href="#topic+plot_contribution">plot_contribution</a></code>, <code><a href="#topic+plot_feature_importance">plot_feature_importance</a></code>, <code><a href="#topic+plot_interaction">plot_interaction</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(xgboost)
data &lt;- fifa20$data[colnames(fifa20$data) != 'work_rate']
target &lt;- fifa20$target
param &lt;- list(objective = "reg:squarederror", max_depth = 3)
xgb_model &lt;- xgboost::xgboost(as.matrix(data), params = param, label = target,
                              nrounds = 20, verbose = FALSE)
unified_model &lt;- xgboost.unify(xgb_model, as.matrix(data))
x &lt;- head(data, 100)
shaps &lt;- treeshap(unified_model, x)
plot_feature_dependence(shaps, variable = "overall")

</code></pre>

<hr>
<h2 id='plot_feature_importance'>SHAP value based Feature Importance plot</h2><span id='topic+plot_feature_importance'></span>

<h3>Description</h3>

<p>This function plots feature importance calculated as means of absolute values of SHAP values of variables (average impact on model output magnitude).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_feature_importance(
  treeshap,
  desc_sorting = TRUE,
  max_vars = ncol(shaps),
  title = "Feature Importance",
  subtitle = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_feature_importance_+3A_treeshap">treeshap</code></td>
<td>
<p>A treeshap object produced with the <code><a href="#topic+treeshap">treeshap</a></code> function. <code><a href="#topic+treeshap.object">treeshap.object</a></code>.</p>
</td></tr>
<tr><td><code id="plot_feature_importance_+3A_desc_sorting">desc_sorting</code></td>
<td>
<p>logical. Should the bars be sorted descending? By default TRUE.</p>
</td></tr>
<tr><td><code id="plot_feature_importance_+3A_max_vars">max_vars</code></td>
<td>
<p>maximum number of variables that shall be presented. By default all are presented.</p>
</td></tr>
<tr><td><code id="plot_feature_importance_+3A_title">title</code></td>
<td>
<p>the plot's title, by default <code>'Feature Importance'</code>.</p>
</td></tr>
<tr><td><code id="plot_feature_importance_+3A_subtitle">subtitle</code></td>
<td>
<p>the plot's subtitle. By default no subtitle.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>ggplot2</code> object
</p>


<h3>See Also</h3>

<p><code><a href="#topic+treeshap">treeshap</a></code> for calculation of SHAP values
</p>
<p><code><a href="#topic+plot_contribution">plot_contribution</a></code>, <code><a href="#topic+plot_feature_dependence">plot_feature_dependence</a></code>, <code><a href="#topic+plot_interaction">plot_interaction</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(xgboost)
data &lt;- fifa20$data[colnames(fifa20$data) != 'work_rate']
target &lt;- fifa20$target
param &lt;- list(objective = "reg:squarederror", max_depth = 3)
xgb_model &lt;- xgboost::xgboost(as.matrix(data), params = param, label = target,
                              nrounds = 20, verbose = FALSE)
unified_model &lt;- xgboost.unify(xgb_model, as.matrix(data))
shaps &lt;- treeshap(unified_model, as.matrix(head(data, 3)))
plot_feature_importance(shaps, max_vars = 4)

</code></pre>

<hr>
<h2 id='plot_interaction'>SHAP Interaction value plot</h2><span id='topic+plot_interaction'></span>

<h3>Description</h3>

<p>This function plots SHAP Interaction value for two variables depending on the value of the first variable.
Value of the second variable is marked with the color.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_interaction(
  treeshap,
  var1,
  var2,
  title = "SHAP Interaction Value Plot",
  subtitle = ""
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_interaction_+3A_treeshap">treeshap</code></td>
<td>
<p>A treeshap object produced with <code><a href="#topic+treeshap">treeshap</a>(interactions = TRUE)</code> function. <code><a href="#topic+treeshap.object">treeshap.object</a></code>.</p>
</td></tr>
<tr><td><code id="plot_interaction_+3A_var1">var1</code></td>
<td>
<p>name or index of the first variable - plotted on x axis.</p>
</td></tr>
<tr><td><code id="plot_interaction_+3A_var2">var2</code></td>
<td>
<p>name or index of the second variable - marked with color.</p>
</td></tr>
<tr><td><code id="plot_interaction_+3A_title">title</code></td>
<td>
<p>the plot's title, by default <code>'SHAP Interaction Value Plot'</code>.</p>
</td></tr>
<tr><td><code id="plot_interaction_+3A_subtitle">subtitle</code></td>
<td>
<p>the plot's subtitle. By default no subtitle.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>ggplot2</code> object
</p>


<h3>See Also</h3>

<p><code><a href="#topic+treeshap">treeshap</a></code> for calculation of SHAP Interaction values
</p>
<p><code><a href="#topic+plot_contribution">plot_contribution</a></code>, <code><a href="#topic+plot_feature_importance">plot_feature_importance</a></code>, <code><a href="#topic+plot_feature_dependence">plot_feature_dependence</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data &lt;- fifa20$data[colnames(fifa20$data) != 'work_rate']
target &lt;- fifa20$target
param2 &lt;- list(objective = "reg:squarederror", max_depth = 5)
xgb_model2 &lt;- xgboost::xgboost(as.matrix(data), params = param2, label = target, nrounds = 10)
unified_model2 &lt;- xgboost.unify(xgb_model2, data)
inters &lt;- treeshap(unified_model2, as.matrix(data[1:50, ]), interactions = TRUE)
plot_interaction(inters, "dribbling", "defending")

</code></pre>

<hr>
<h2 id='predict.model_unified'>Predict</h2><span id='topic+predict.model_unified'></span>

<h3>Description</h3>

<p>Predict using unified_model representation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'model_unified'
predict(object, x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="predict.model_unified_+3A_object">object</code></td>
<td>
<p>Unified model representation of the model created with a (model).unify function. <code><a href="#topic+model_unified.object">model_unified.object</a></code></p>
</td></tr>
<tr><td><code id="predict.model_unified_+3A_x">x</code></td>
<td>
<p>Observations to predict. A <code>data.frame</code> or <code>matrix</code> with the same columns as in the training set of the model.</p>
</td></tr>
<tr><td><code id="predict.model_unified_+3A_...">...</code></td>
<td>
<p>other parameters</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a vector of predictions.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(gbm)
data &lt;- fifa20$data[colnames(fifa20$data) != 'work_rate']
data['value_eur'] &lt;- fifa20$target
gbm_model &lt;- gbm::gbm(
  formula = value_eur ~ .,
  data = data,
  distribution = "laplace",
  n.trees = 20,
  interaction.depth = 4,
  n.cores = 1)
  unified &lt;- gbm.unify(gbm_model, data)
  predict(unified, data[2001:2005, ])
  
</code></pre>

<hr>
<h2 id='print.model_unified'>Prints model_unified objects</h2><span id='topic+print.model_unified'></span>

<h3>Description</h3>

<p>Prints model_unified objects
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'model_unified'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.model_unified_+3A_x">x</code></td>
<td>
<p>a model_unified object</p>
</td></tr>
<tr><td><code id="print.model_unified_+3A_...">...</code></td>
<td>
<p>other arguments</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value, called for printing
</p>

<hr>
<h2 id='print.model_unified_multioutput'>Prints model_unified_multioutput objects</h2><span id='topic+print.model_unified_multioutput'></span>

<h3>Description</h3>

<p>Prints model_unified_multioutput objects
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'model_unified_multioutput'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.model_unified_multioutput_+3A_x">x</code></td>
<td>
<p>a model_unified_multioutput object</p>
</td></tr>
<tr><td><code id="print.model_unified_multioutput_+3A_...">...</code></td>
<td>
<p>other arguments</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value, called for printing
</p>

<hr>
<h2 id='print.treeshap'>Prints treeshap objects</h2><span id='topic+print.treeshap'></span>

<h3>Description</h3>

<p>Prints treeshap objects
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'treeshap'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.treeshap_+3A_x">x</code></td>
<td>
<p>a treeshap object</p>
</td></tr>
<tr><td><code id="print.treeshap_+3A_...">...</code></td>
<td>
<p>other arguments</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value, called for printing
</p>

<hr>
<h2 id='print.treeshap_multioutput'>Prints treeshap_multioutput objects</h2><span id='topic+print.treeshap_multioutput'></span>

<h3>Description</h3>

<p>Prints treeshap_multioutput objects
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'treeshap_multioutput'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.treeshap_multioutput_+3A_x">x</code></td>
<td>
<p>a treeshap_multioutput object</p>
</td></tr>
<tr><td><code id="print.treeshap_multioutput_+3A_...">...</code></td>
<td>
<p>other arguments</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value, called for printing
</p>

<hr>
<h2 id='randomForest.unify'>Unify randomForest model</h2><span id='topic+randomForest.unify'></span>

<h3>Description</h3>

<p>Convert your randomForest model into a standardized representation.
The returned representation is easy to be interpreted by the user and ready to be used as an argument in <code>treeshap()</code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>randomForest.unify(rf_model, data)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="randomForest.unify_+3A_rf_model">rf_model</code></td>
<td>
<p>An object of <code>randomForest</code> class. At the moment, models built on data with categorical features
are not supported - please encode them before training.</p>
</td></tr>
<tr><td><code id="randomForest.unify_+3A_data">data</code></td>
<td>
<p>Reference dataset. A <code>data.frame</code> or <code>matrix</code> with the same columns as in the training set of the model. Usually dataset used to train model.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Binary classification models with a target variable that is a factor with two levels, 0 and 1, are supported
</p>


<h3>Value</h3>

<p>a unified model representation - a <code><a href="#topic+model_unified.object">model_unified.object</a></code> object
</p>


<h3>See Also</h3>

<p><code><a href="#topic+lightgbm.unify">lightgbm.unify</a></code> for <code><a href="lightgbm.html#topic+lightgbm">LightGBM models</a></code>
</p>
<p><code><a href="#topic+gbm.unify">gbm.unify</a></code> for <code><a href="gbm.html#topic+gbm">GBM models</a></code>
</p>
<p><code><a href="#topic+xgboost.unify">xgboost.unify</a></code> for <code><a href="xgboost.html#topic+xgboost">XGBoost models</a></code>
</p>
<p><code><a href="#topic+ranger.unify">ranger.unify</a></code> for <code><a href="ranger.html#topic+ranger">ranger models</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(randomForest)
data_fifa &lt;- fifa20$data[!colnames(fifa20$data) %in%
                           c('work_rate', 'value_eur', 'gk_diving', 'gk_handling',
                             'gk_kicking', 'gk_reflexes', 'gk_speed', 'gk_positioning')]
data &lt;- na.omit(cbind(data_fifa, target = fifa20$target))

rf &lt;- randomForest::randomForest(target~., data = data, maxnodes = 10, ntree = 10)
unified_model &lt;- randomForest.unify(rf, data)
shaps &lt;- treeshap(unified_model, data[1:2,])
# plot_contribution(shaps, obs = 1)

</code></pre>

<hr>
<h2 id='ranger_surv.unify'>Unify ranger survival model</h2><span id='topic+ranger_surv.unify'></span>

<h3>Description</h3>

<p>Convert your ranger model into a standardized representation.
The returned representation is easy to be interpreted by the user and ready to be used as an argument in <code>treeshap()</code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ranger_surv.unify(
  rf_model,
  data,
  type = c("risk", "survival", "chf"),
  times = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ranger_surv.unify_+3A_rf_model">rf_model</code></td>
<td>
<p>An object of <code>ranger</code> class. At the moment, models built on data with categorical features
are not supported - please encode them before training.</p>
</td></tr>
<tr><td><code id="ranger_surv.unify_+3A_data">data</code></td>
<td>
<p>Reference dataset. A <code>data.frame</code> or <code>matrix</code> with the same columns as in the training set of the model. Usually dataset used to train model.</p>
</td></tr>
<tr><td><code id="ranger_surv.unify_+3A_type">type</code></td>
<td>
<p>A character to define the type of model prediction to use. Either <code>"risk"</code> (default), which uses the risk score calculated as a sum of cumulative hazard function values, <code>"survival"</code>, which uses the survival probability at certain time-points for each observation, or <code>"chf"</code>, which used the cumulative hazard values at certain time-points for each observation.</p>
</td></tr>
<tr><td><code id="ranger_surv.unify_+3A_times">times</code></td>
<td>
<p>A numeric vector of unique death times at which the prediction should be evaluated. By default <code>unique.death.times</code> from model are used.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The survival forest implemented in the <code>ranger</code> package stores cumulative hazard
functions (CHFs) in the leaves of survival trees, as proposed for Random Survival Forests
(Ishwaran et al. 2008). The final model prediction is made by averaging these CHFs
from all the trees. To provide explanations in the form of a survival function,
the CHFs from the leaves are converted into survival functions (SFs) using
the formula SF(t) = exp(-CHF(t)).
However, it is important to note that averaging these SFs does not yield the correct
model prediction as the model prediction is the average of CHFs transformed in the same way.
Therefore, when you obtain explanations based on the survival function,
they are only proxies and may not be fully consistent with the model predictions
obtained using for example <code>predict</code> function.
</p>


<h3>Value</h3>

<p>For <code>type = "risk"</code> a unified model representation is returned - a <code><a href="#topic+model_unified.object">model_unified.object</a></code> object. For <code>type = "survival"</code> or <code>type = "chf"</code> - a <code><a href="#topic+model_unified_multioutput.object">model_unified_multioutput.object</a></code> object is returned, which is a list that contains unified model representation (<code><a href="#topic+model_unified.object">model_unified.object</a></code> object) for each time point. In this case, the list names are time points at which the survival function was evaluated.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ranger.unify">ranger.unify</a></code> for regression and classification <code><a href="ranger.html#topic+ranger">ranger models</a></code>
</p>
<p><code><a href="#topic+lightgbm.unify">lightgbm.unify</a></code> for <code><a href="lightgbm.html#topic+lightgbm">LightGBM models</a></code>
</p>
<p><code><a href="#topic+gbm.unify">gbm.unify</a></code> for <code><a href="gbm.html#topic+gbm">GBM models</a></code>
</p>
<p><code><a href="#topic+xgboost.unify">xgboost.unify</a></code> for <code><a href="xgboost.html#topic+xgboost">XGBoost models</a></code>
</p>
<p><code><a href="#topic+randomForest.unify">randomForest.unify</a></code> for <code><a href="randomForest.html#topic+randomForest">randomForest models</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(ranger)
data_colon &lt;- data.table::data.table(survival::colon)
data_colon &lt;- na.omit(data_colon[get("etype") == 2, ])
surv_cols &lt;- c("status", "time", "rx")

feature_cols &lt;- colnames(data_colon)[3:(ncol(data_colon) - 1)]

train_x &lt;- model.matrix(
  ~ -1 + .,
  data_colon[, .SD, .SDcols = setdiff(feature_cols, surv_cols[1:2])]
)
train_y &lt;- survival::Surv(
  event = (data_colon[, get("status")] |&gt;
             as.character() |&gt;
             as.integer()),
  time = data_colon[, get("time")],
  type = "right"
)

rf &lt;- ranger::ranger(
  x = train_x,
  y = train_y,
  data = data_colon,
  max.depth = 10,
  num.trees = 10
)
unified_model_risk &lt;- ranger_surv.unify(rf, train_x, type = "risk")
shaps &lt;- treeshap(unified_model_risk, train_x[1:2,])

# compute shaps for 3 selected time points
unified_model_surv &lt;- ranger_surv.unify(rf, train_x, type = "survival", times = c(23, 50, 73))
shaps_surv &lt;- treeshap(unified_model_surv, train_x[1:2,])

</code></pre>

<hr>
<h2 id='ranger.unify'>Unify ranger model</h2><span id='topic+ranger.unify'></span>

<h3>Description</h3>

<p>Convert your ranger model into a standardized representation.
The returned representation is easy to be interpreted by the user and ready to be used as an argument in <code>treeshap()</code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ranger.unify(rf_model, data)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ranger.unify_+3A_rf_model">rf_model</code></td>
<td>
<p>An object of <code>ranger</code> class. At the moment, models built on data with categorical features
are not supported - please encode them before training.</p>
</td></tr>
<tr><td><code id="ranger.unify_+3A_data">data</code></td>
<td>
<p>Reference dataset. A <code>data.frame</code> or <code>matrix</code> with the same columns as in the training set of the model. Usually dataset used to train model.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a unified model representation - a <code><a href="#topic+model_unified.object">model_unified.object</a></code> object
</p>


<h3>See Also</h3>

<p><code><a href="#topic+lightgbm.unify">lightgbm.unify</a></code> for <code><a href="lightgbm.html#topic+lightgbm">LightGBM models</a></code>
</p>
<p><code><a href="#topic+gbm.unify">gbm.unify</a></code> for <code><a href="gbm.html#topic+gbm">GBM models</a></code>
</p>
<p><code><a href="#topic+xgboost.unify">xgboost.unify</a></code> for <code><a href="xgboost.html#topic+xgboost">XGBoost models</a></code>
</p>
<p><code><a href="#topic+randomForest.unify">randomForest.unify</a></code> for <code><a href="randomForest.html#topic+randomForest">randomForest models</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
 library(ranger)
 data_fifa &lt;- fifa20$data[!colnames(fifa20$data) %in%
                            c('work_rate', 'value_eur', 'gk_diving', 'gk_handling',
                             'gk_kicking', 'gk_reflexes', 'gk_speed', 'gk_positioning')]
 data &lt;- na.omit(cbind(data_fifa, target = fifa20$target))

 rf &lt;- ranger::ranger(target~., data = data, max.depth = 10, num.trees = 10)
 unified_model &lt;- ranger.unify(rf, data)
 shaps &lt;- treeshap(unified_model, data[1:2,])
 plot_contribution(shaps, obs = 1)
</code></pre>

<hr>
<h2 id='set_reference_dataset'>Set reference dataset</h2><span id='topic+set_reference_dataset'></span>

<h3>Description</h3>

<p>Change a dataset used as reference for calculating SHAP values.
Reference dataset is initially set with <code>data</code> argument in unifying function.
Usually reference dataset is dataset used to train the model.
Important property of reference dataset is that SHAP values for each observation add up to its deviation from mean prediction for a reference dataset.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_reference_dataset(unified_model, x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="set_reference_dataset_+3A_unified_model">unified_model</code></td>
<td>
<p>Unified model representation of the model created with a (model).unify function. (<code><a href="#topic+model_unified.object">model_unified.object</a></code>).</p>
</td></tr>
<tr><td><code id="set_reference_dataset_+3A_x">x</code></td>
<td>
<p>Reference dataset. A <code>data.frame</code> or <code>matrix</code> with the same columns as in the training set of the model.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code><a href="#topic+model_unified.object">model_unified.object</a></code>. Unified representation of the model as created with a (model).unify function,
but with changed reference dataset (Cover column containing updated values).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+lightgbm.unify">lightgbm.unify</a></code> for <code><a href="lightgbm.html#topic+lightgbm">LightGBM models</a></code>
</p>
<p><code><a href="#topic+gbm.unify">gbm.unify</a></code> for <code><a href="gbm.html#topic+gbm">GBM models</a></code>
</p>
<p><code><a href="#topic+xgboost.unify">xgboost.unify</a></code> for <code><a href="xgboost.html#topic+xgboost">XGBoost models</a></code>
</p>
<p><code><a href="#topic+ranger.unify">ranger.unify</a></code> for <code><a href="ranger.html#topic+ranger">ranger models</a></code>
</p>
<p><code><a href="#topic+randomForest.unify">randomForest.unify</a></code> for <code><a href="randomForest.html#topic+randomForest">randomForest models</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(gbm)
data &lt;- fifa20$data[colnames(fifa20$data) != 'work_rate']
data['value_eur'] &lt;- fifa20$target
gbm_model &lt;- gbm::gbm(
formula = value_eur ~ .,
  data = data,
  distribution = "laplace",
  n.trees = 20,
  interaction.depth = 4,
  n.cores = 1)
unified &lt;- gbm.unify(gbm_model, data)
set_reference_dataset(unified, data[200:700, ])

</code></pre>

<hr>
<h2 id='theme_drwhy'>DrWhy Theme for ggplot objects</h2><span id='topic+theme_drwhy'></span><span id='topic+theme_drwhy_vertical'></span>

<h3>Description</h3>

<p>DrWhy Theme for ggplot objects
</p>


<h3>Usage</h3>

<pre><code class='language-R'>theme_drwhy()

theme_drwhy_vertical()
</code></pre>


<h3>Value</h3>

<p>theme for ggplot2 objects
</p>

<hr>
<h2 id='treeshap'>Calculate SHAP values of a tree ensemble model.</h2><span id='topic+treeshap'></span>

<h3>Description</h3>

<p>Calculate SHAP values and optionally SHAP Interaction values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>treeshap(unified_model, x, interactions = FALSE, verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="treeshap_+3A_unified_model">unified_model</code></td>
<td>
<p>Unified data.frame representation of the model created with a (model).unify function. A <code><a href="#topic+model_unified.object">model_unified.object</a></code> object.</p>
</td></tr>
<tr><td><code id="treeshap_+3A_x">x</code></td>
<td>
<p>Observations to be explained. A <code>data.frame</code> or <code>matrix</code> object with the same columns as in the training set of the model. Keep in mind that objects different than <code>data.frame</code> or plain <code>matrix</code> will cause an error or unpredictable behavior.</p>
</td></tr>
<tr><td><code id="treeshap_+3A_interactions">interactions</code></td>
<td>
<p>Whether to calculate SHAP interaction values. By default is <code>FALSE</code>. Basic SHAP values are always calculated.</p>
</td></tr>
<tr><td><code id="treeshap_+3A_verbose">verbose</code></td>
<td>
<p>Whether to print progress bar to the console. Should be logical. Progress bar will not be displayed on Windows.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code><a href="#topic+treeshap.object">treeshap.object</a></code> object (for single-output models) or <code><a href="#topic+treeshap_multioutput.object">treeshap_multioutput.object</a></code>, which is a list of <code><a href="#topic+treeshap.object">treeshap.object</a></code> objects (for multi-output models). SHAP values can be accessed from <code><a href="#topic+treeshap.object">treeshap.object</a></code> with <code>$shaps</code>, and interaction values can be accessed with <code>$interactions</code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+xgboost.unify">xgboost.unify</a></code> for <code>XGBoost models</code>
<code><a href="#topic+lightgbm.unify">lightgbm.unify</a></code> for <code>LightGBM models</code>
<code><a href="#topic+gbm.unify">gbm.unify</a></code> for <code>GBM models</code>
<code><a href="#topic+randomForest.unify">randomForest.unify</a></code> for <code>randomForest models</code>
<code><a href="#topic+ranger.unify">ranger.unify</a></code> for <code>ranger models</code>
<code><a href="#topic+ranger_surv.unify">ranger_surv.unify</a></code> for <code>ranger survival models</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(xgboost)
data &lt;- fifa20$data[colnames(fifa20$data) != 'work_rate']
target &lt;- fifa20$target

# calculating simple SHAP values
param &lt;- list(objective = "reg:squarederror", max_depth = 3)
xgb_model &lt;- xgboost::xgboost(as.matrix(data), params = param, label = target,
                              nrounds = 20, verbose = FALSE)
unified_model &lt;- xgboost.unify(xgb_model, as.matrix(data))
treeshap1 &lt;- treeshap(unified_model, head(data, 3))
plot_contribution(treeshap1, obs = 1)
treeshap1$shaps

# It's possible to calcualte explanation over different part of the data set

unified_model_rec &lt;- set_reference_dataset(unified_model, data[1:1000, ])
treeshap_rec &lt;- treeshap(unified_model, head(data, 3))
plot_contribution(treeshap_rec, obs = 1)

# calculating SHAP interaction values
param2 &lt;- list(objective = "reg:squarederror", max_depth = 7)
xgb_model2 &lt;- xgboost::xgboost(as.matrix(data), params = param2, label = target, nrounds = 10)
unified_model2 &lt;- xgboost.unify(xgb_model2, as.matrix(data))
treeshap2 &lt;- treeshap(unified_model2, head(data, 3), interactions = TRUE)
treeshap2$interactions

</code></pre>

<hr>
<h2 id='treeshap_multioutput.object'>treeshap results for multi-output model</h2><span id='topic+treeshap_multioutput.object'></span>

<h3>Description</h3>

<p><code>treeshap_multioutput</code> object produced by <code>treeshap</code> function.
</p>


<h3>Value</h3>

<p>List consisting of <code>treeshap</code> objects, one for each individual output of a model. For survival models, the list is named using the time points, for which TreeSHAP values are calculated.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+treeshap">treeshap</a></code>,
</p>
<p><code><a href="#topic+treeshap.object">treeshap.object</a></code>
</p>

<hr>
<h2 id='treeshap.object'>treeshap results</h2><span id='topic+treeshap.object'></span>

<h3>Description</h3>

<p><code>treeshap</code> object produced by <code>treeshap</code> function.
</p>


<h3>Value</h3>

<p>List consisting of four elements:
</p>

<dl>
<dt>shaps</dt><dd><p>A <code>data.frame</code> with M columns, X rows (M - number of features, X - number of explained observations). Every row corresponds to SHAP values for a observation. </p>
</dd>
<dt>interactions</dt><dd><p>An <code>array</code> with dimensions (M, M, X) (M - number of features, X - number of explained observations). Every <code>[, , i]</code> slice is a symmetric matrix - SHAP Interaction values for a observation. <code>[a, b, i]</code> element is SHAP Interaction value of features <code>a</code> and <code>b</code> for observation <code>i</code>. Is <code>NULL</code> if interactions where not calculated (parameter <code>interactions</code> set <code>FALSE</code>.) </p>
</dd>
<dt>unified_model</dt><dd><p>An object of type <code><a href="#topic+model_unified.object">model_unified.object</a></code>. Unified representation of a model for which SHAP values were calculated. It is used by some of the plotting functions.</p>
</dd>
<dt>observations</dt><dd><p>Explained dataset. <code>data.frame</code> or <code>matrix</code>. It is used by some of the plotting functions.</p>
</dd>
</dl>



<h3>See Also</h3>

<p><code><a href="#topic+treeshap">treeshap</a></code>,
</p>
<p><code><a href="#topic+plot_contribution">plot_contribution</a></code>, <code><a href="#topic+plot_feature_importance">plot_feature_importance</a></code>, <code><a href="#topic+plot_feature_dependence">plot_feature_dependence</a></code>, <code><a href="#topic+plot_interaction">plot_interaction</a></code>
</p>

<hr>
<h2 id='unify'>Unify tree-based model</h2><span id='topic+unify'></span>

<h3>Description</h3>

<p>Convert your tree-based model into a standardized representation.
The returned representation is easy to be interpreted by the user and ready to be used as an argument in <code>treeshap()</code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>unify(model, data, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="unify_+3A_model">model</code></td>
<td>
<p>A tree-based model object of any supported class (<code>gbm</code>, <code>lgb.Booster</code>, <code>randomForest</code>, <code>ranger</code>, or <code>xgb.Booster</code>).</p>
</td></tr>
<tr><td><code id="unify_+3A_data">data</code></td>
<td>
<p>Reference dataset. A <code>data.frame</code> or <code>matrix</code> with the same columns as in the training set of the model. Usually dataset used to train model.</p>
</td></tr>
<tr><td><code id="unify_+3A_...">...</code></td>
<td>
<p>Additional parameters passed to the model-specific unification functions.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A unified model representation - a <code><a href="#topic+model_unified.object">model_unified.object</a></code> object (for single-output models) or <code><a href="#topic+model_unified_multioutput.object">model_unified_multioutput.object</a></code>, which is a list of <code><a href="#topic+model_unified.object">model_unified.object</a></code> objects (for multi-output models).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+lightgbm.unify">lightgbm.unify</a></code> for <code><a href="lightgbm.html#topic+lightgbm">LightGBM models</a></code>
</p>
<p><code><a href="#topic+gbm.unify">gbm.unify</a></code> for <code><a href="gbm.html#topic+gbm">GBM models</a></code>
</p>
<p><code><a href="#topic+xgboost.unify">xgboost.unify</a></code> for <code><a href="xgboost.html#topic+xgboost">XGBoost models</a></code>
</p>
<p><code><a href="#topic+ranger.unify">ranger.unify</a></code> for <code><a href="ranger.html#topic+ranger">ranger models</a></code>
</p>
<p><code><a href="#topic+randomForest.unify">randomForest.unify</a></code> for <code><a href="randomForest.html#topic+randomForest">randomForest models</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
 library(ranger)
 data_fifa &lt;- fifa20$data[!colnames(fifa20$data) %in%
                            c('work_rate', 'value_eur', 'gk_diving', 'gk_handling',
                             'gk_kicking', 'gk_reflexes', 'gk_speed', 'gk_positioning')]
 data &lt;- na.omit(cbind(data_fifa, target = fifa20$target))

 rf1 &lt;- ranger::ranger(target~., data = data, max.depth = 10, num.trees = 10)
 unified_model1 &lt;- unify(rf1, data)
 shaps1 &lt;- treeshap(unified_model1, data[1:2,])
 plot_contribution(shaps1, obs = 1)

 rf2 &lt;- randomForest::randomForest(target~., data = data, maxnodes = 10, ntree = 10)
 unified_model2 &lt;- unify(rf2, data)
 shaps2 &lt;- treeshap(unified_model2, data[1:2,])
 plot_contribution(shaps2, obs = 1)
</code></pre>

<hr>
<h2 id='xgboost.unify'>Unify XGBoost model</h2><span id='topic+xgboost.unify'></span>

<h3>Description</h3>

<p>Convert your XGBoost model into a standardized representation.
The returned representation is easy to be interpreted by the user and ready to be used as an argument in <code>treeshap()</code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>xgboost.unify(xgb_model, data, recalculate = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="xgboost.unify_+3A_xgb_model">xgb_model</code></td>
<td>
<p>A XGBoost model - object of class <code>xgb.Booster</code></p>
</td></tr>
<tr><td><code id="xgboost.unify_+3A_data">data</code></td>
<td>
<p>Reference dataset. A <code>data.frame</code> or <code>matrix</code> with the same columns as in the training set of the model. Usually dataset used to train model.</p>
</td></tr>
<tr><td><code id="xgboost.unify_+3A_recalculate">recalculate</code></td>
<td>
<p>logical indicating if covers should be recalculated according to the dataset given in data. Keep it <code>FALSE</code> if training data are used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a unified model representation - a <code><a href="#topic+model_unified.object">model_unified.object</a></code> object
</p>


<h3>See Also</h3>

<p><code><a href="#topic+lightgbm.unify">lightgbm.unify</a></code> for <code><a href="lightgbm.html#topic+lightgbm">LightGBM models</a></code>
</p>
<p><code><a href="#topic+gbm.unify">gbm.unify</a></code> for <code><a href="gbm.html#topic+gbm">GBM models</a></code>
</p>
<p><code><a href="#topic+ranger.unify">ranger.unify</a></code> for <code><a href="ranger.html#topic+ranger">ranger models</a></code>
</p>
<p><code><a href="#topic+randomForest.unify">randomForest.unify</a></code> for <code><a href="randomForest.html#topic+randomForest">randomForest models</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(xgboost)
data &lt;- fifa20$data[colnames(fifa20$data) != 'work_rate']
target &lt;- fifa20$target
param &lt;- list(objective = "reg:squarederror", max_depth = 3)
xgb_model &lt;- xgboost::xgboost(as.matrix(data), params = param, label = target,
                              nrounds = 20, verbose = 0)
unified_model &lt;- xgboost.unify(xgb_model, as.matrix(data))
shaps &lt;- treeshap(unified_model, data[1:2,])
plot_contribution(shaps, obs = 1)


</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
