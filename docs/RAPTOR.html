<!DOCTYPE html><html><head><title>Help for package RAPTOR</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {RAPTOR}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#align'><p>Data alignment</p></a></li>
<li><a href='#anatomy.data'><p>Anatomical measurements</p></a></li>
<li><a href='#batch.mode'><p>Automatic rows and position detection</p></a></li>
<li><a href='#example.data'><p>Species-specific anatomy input</p></a></li>
<li><a href='#first.cell'><p>Detection of the first cells</p></a></li>
<li><a href='#graph.cells'><p>Data visualization</p></a></li>
<li><a href='#is.raptor'><p>Testing and preparing input data</p></a></li>
<li><a href='#pos.det'><p>Determining the cell position</p></a></li>
<li><a href='#write.output'><p>Output generation and visualization</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Row and Position Tracheid Organizer</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.1</td>
</tr>
<tr>
<td>Date:</td>
<td>2020-02-19</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Richard L. Peters &lt;richardlouispeters3@hotmail.com&gt;</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.4.0)</td>
</tr>
<tr>
<td>Description:</td>
<td>Performs wood cell anatomical data analyses on spatially explicit xylem (tracheids) datasets 
                  derived from thin sections of woody tissue. The package includes functions for visualisation, 
                  detection and alignment of continuous tracheid radial file (defined as rows) and individual tracheid position 
                  within an annual ring of coniferous species. This package is designed to be used with elaborate cell output, 
                  e.g. as provided with ROXAS (von Arx &amp; Carrer, 2014 &lt;<a href="https://doi.org/10.1016%2Fj.dendro.2013.12.001">doi:10.1016/j.dendro.2013.12.001</a>&gt;). The package has been validated for Picea abies, 
                  Larix Siberica, Pinus cembra and Pinus sylvestris.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Imports:</td>
<td>mgcv, stats, utils, graphics, grDevices</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.0.2</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://the-hull.github.io/raptor/">https://the-hull.github.io/raptor/</a>,
<a href="https://github.com/the-hull/RAPTOR">https://github.com/the-hull/RAPTOR</a></td>
</tr>
<tr>
<td>Packaged:</td>
<td>2020-03-08 11:42:05 UTC; ahurl</td>
</tr>
<tr>
<td>Author:</td>
<td>Richard L. Peters [aut, cre, cph],
  Daniel Balanzategui [ctr],
  Alexander Hurley [ctr],
  Georg von Arx [ctr],
  Angela Luisa Prendin [ctr],
  Henri E. Cuny [ctr],
  Jesper Bjoerklund [ctr],
  David C. Frank [ctr],
  Patrick Fonti [ths, ctr, fnd]</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2020-03-09 15:40:05 UTC</td>
</tr>
</table>
<hr>
<h2 id='align'>Data alignment</h2><span id='topic+align'></span>

<h3>Description</h3>

<p>Provides a re-aligned <code><a href="#topic+is.raptor">is.raptor</a></code> file, where new x- and y-coordinates (XCAL and YCAL values, respectively) are calculated according to a specified rotation. Appropriate alignment is achieved when the first row of earlywood cells are positioned along an approximately horizontal axis and the radial files of tracheids are positioned along a vertical axis.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>align(input, year = FALSE, list = FALSE, interact = TRUE, make.plot = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="align_+3A_input">input</code></td>
<td>
<p>an <code><a href="#topic+is.raptor">is.raptor</a></code> file.</p>
</td></tr>
<tr><td><code id="align_+3A_year">year</code></td>
<td>
<p>a numeric vector specifying the year of interest. The default (<code><a href="base.html#topic+FALSE">FALSE</a></code>) applies the function on all years present in the input.</p>
</td></tr>
<tr><td><code id="align_+3A_list">list</code></td>
<td>
<p>a <code><a href="base.html#topic+vector">vector</a></code> of numeric values indicating the rotation slope for each year.</p>
</td></tr>
<tr><td><code id="align_+3A_interact">interact</code></td>
<td>
<p>a logical flag. If <code><a href="base.html#topic+TRUE">TRUE</a></code>, the user can manually assign the degree of rotation for each annual ring in an interactive session. The user will have to select among the options (along the horizontal axis, along the vertical axis, manually define the degree of reorientation based on a set of slopes overlaid on the plot). If <code><a href="base.html#topic+FALSE">FALSE</a></code>, the rotation is optimized automatically using a simple linear regression through all points along the horizontal axis (default = <code><a href="base.html#topic+FALSE">FALSE</a></code>).</p>
</td></tr>
<tr><td><code id="align_+3A_make.plot">make.plot</code></td>
<td>
<p>logical flag indicating whether to make a plot (default =  <code><a href="base.html#topic+FALSE">FALSE</a></code>).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Correct alignment of cells/tracheids is important for detecting the first cells and assigning cells to a radial file. This function provides the option to align your cell data (XCAL and YCAL). This function provides and interactive procedure to improve the alignment by presenting a crosshair with slopes with which the sample should be rotated. Proper alignment is obtain when the first cells are approximately aligned on a horizontal line and the upward cells are propagated vertically. Either interactively or with predefined slopes, the user can rotate the sample orientation. An automatic option is also available where a simple linear regression is fitted through all points to adjust the rotation. The plot shows the original position of the cells (black dots) and lines that can be selected to rotate the sample. After correction the new position of the cells is presented (red dots).
</p>


<h3>Value</h3>

<p>An aligned <code><a href="#topic+is.raptor">is.raptor</a></code> file.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#rotating example data
input&lt;-is.raptor(example.data(species="LOT_PICEA"), str=FALSE)
input&lt;-align(input, year=2007, list=FALSE,interact=FALSE, make.plot=TRUE)
</code></pre>

<hr>
<h2 id='anatomy.data'>Anatomical measurements</h2><span id='topic+anatomy.data'></span>

<h3>Description</h3>

<p>This example dataset includes ROXAS output files (cf. von Arx &amp; Carrer, 2014) with lumen area and cell wall thickness measurements from;
i) Norway Spruce (<em>Picea abies</em>) from the Loetschental, Switzerland (2007-2013),
ii) Siberian larch (<em>Larix siberica</em>) from Siberia, Russia (2007-2010),
iii) Stone pine (<em>Pinus cembra</em>) from the Dolomite mountains, Italy (2007-2010), and
iv) Scots pine (<em>Pinus sylvestris</em>) from the eastern lowlands, Germany (2007-2010).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>anatomy.data

anatomy.data
</code></pre>


<h3>Format</h3>

<p>Provides a <code><a href="base.html#topic+data.frame">data.frame</a></code> with 18838 rows and 7 columns containing data on:
</p>
<p>[ ,1] <strong>ID</strong> = Site and species id <em>&lt;factor&gt;</em><br />
[ ,2] <strong>CID</strong>  = Unique cell id <em>&lt;integer&gt;</em><br />
[ ,3] <strong>YEAR</strong> = Year of the ring <em>&lt;integer&gt;</em><br />
[ ,4] <strong>CA</strong> = Lumen size (micron) <em>&lt;numeric&gt;</em><br />
[ ,5] <strong>XCAL</strong> = X-value of cell center in calibrated coordinate system (micron) <em>&lt;numeric&gt;</em><br />
[ ,6] <strong>YCAL</strong> = Y-value of cell center in calibrated coordinate system (micron) <em>&lt;numeric&gt;</em><br />
[ ,7] <strong>CWTALL</strong> = Mean thickness of all cell walls (micron) <em>&lt;numeric&gt;</em></p>


<h3>References</h3>

<p>von Arx, G., &amp; Carrer, M. (2014) ROXAS - A new tool to build centuries-long tracheid-lumen chronologies in conifers. Dendrochronologia 32, 290-293.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#viewing anatomy data
head(anatomy.data)
</code></pre>

<hr>
<h2 id='batch.mode'>Automatic rows and position detection</h2><span id='topic+batch.mode'></span>

<h3>Description</h3>

<p>Batch.mode applies all functionalities described in <code><a href="#topic+is.raptor">is.raptor</a></code>,
<code><a href="#topic+align">align</a></code>,
<code><a href="#topic+first.cell">first.cell</a></code>,
<code><a href="#topic+pos.det">pos.det</a></code> and
<code><a href="#topic+write.output">write.output</a></code>.
Multiple input datasets (sample specific) can be provided in a folder and automatically
used within this function. Input data should be checked for all requirements described
in <code><a href="#topic+is.raptor">is.raptor</a></code> and preferably adjusted with <code><a href="#topic+align">align</a></code>.
See <code><a href="#topic+pos.det">pos.det</a></code> for a detailed description of arguments.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>batch.mode(location, files = FALSE,
           interact = TRUE, make.plot = TRUE,
           aligning = TRUE, frac.small=0.5, swe=0.5, sle=3,
           ec=3, swl=0.5, sll=5, lc=10, prof.co=6, max.cells=0.5,
           list = FALSE, flip = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="batch.mode_+3A_location">location</code></td>
<td>
<p>a character string containing the location of input files and where the outputs (.pdf and .txt files) should be stored.</p>
</td></tr>
<tr><td><code id="batch.mode_+3A_files">files</code></td>
<td>
<p>a vector of files for the analyses (defaults to all files present in the folder). Text files should agree with all criteria presented in <code><a href="#topic+is.raptor">is.raptor</a></code>.</p>
</td></tr>
<tr><td><code id="batch.mode_+3A_interact">interact</code></td>
<td>
<p>a logical flag. If <code><a href="base.html#topic+TRUE">TRUE</a></code>, the user will have the options to manually assign the degree of rotation for each annual ring. See <code><a href="#topic+align">align</a></code> for rotation options. If <code><a href="base.html#topic+FALSE">FALSE</a></code>, the rotation is optimized automatically using a simple linear regression through all points along the horizontal axis (default = <code><a href="base.html#topic+FALSE">FALSE</a></code>).</p>
</td></tr>
<tr><td><code id="batch.mode_+3A_make.plot">make.plot</code></td>
<td>
<p>logical flag indicating whether to make a plot (default =  <code><a href="base.html#topic+FALSE">FALSE</a></code>).</p>
</td></tr>
<tr><td><code id="batch.mode_+3A_aligning">aligning</code></td>
<td>
<p>logical flag indicating whether a second alignment has to be performed based upon the cells detected within <code><a href="#topic+first.cell">first.cell</a></code> (default = <code><a href="base.html#topic+TRUE">TRUE</a></code>).</p>
</td></tr>
<tr><td><code id="batch.mode_+3A_frac.small">frac.small</code></td>
<td>
<p>a numeric value (between 0 and 1) that is multiplied by the average cell lumen size of the ring, determining the minimal threshold used to filter out too small first row tracheids (default = 0.5).</p>
</td></tr>
<tr><td><code id="batch.mode_+3A_swe">swe</code></td>
<td>
<p>a numeric value that is multiplied by the square-rooted cell lumen area (l) of the target cell and used to determine the width of the rectangular search area which locates the next earlywood cell in the row (default = 0.5).</p>
</td></tr>
<tr><td><code id="batch.mode_+3A_sle">sle</code></td>
<td>
<p>a numeric value that is multiplied by the square rooted cell lumen area (l) of the target cell to determine the length of the rectangle search area which locates the next earlywood cell in the row (default = 3).</p>
</td></tr>
<tr><td><code id="batch.mode_+3A_ec">ec</code></td>
<td>
<p>threshold ratio between the lumen area of two consecutive earlywood cells to determine the end of the earlywood search (default = 1.75). The default setting indicates that the earlywood search ends when the next cell lumen area is at least 1.75 times smaller than the target cell.</p>
</td></tr>
<tr><td><code id="batch.mode_+3A_swl">swl</code></td>
<td>
<p>a numeric value that is multiplied by the square rooted cell lumen area (l) of the target cell to determine the width of the rectangle search area which locates the next latewood cell in the row (default = 0.25).</p>
</td></tr>
<tr><td><code id="batch.mode_+3A_sll">sll</code></td>
<td>
<p>a numeric value that is multiplied by the square rooted cell lumen area (l) of the target cell to determine the length of the rectangle search area which locates the next earlywood cell in the row (default = 5).</p>
</td></tr>
<tr><td><code id="batch.mode_+3A_lc">lc</code></td>
<td>
<p>threshold ratio between the lumen area of two consecutive latewood cells to determine the end of the radial file (default = 10). The default setting indicates that the latewood search ends when the next cell lumen area is at least 10 times smaller than the target cell.</p>
</td></tr>
<tr><td><code id="batch.mode_+3A_prof.co">prof.co</code></td>
<td>
<p>threshold ratio between the distance to the previous and consecutive cell to determine if the row (or radial file) should be excluded (default = 6).</p>
</td></tr>
<tr><td><code id="batch.mode_+3A_max.cells">max.cells</code></td>
<td>
<p>threshold proportion of the maximum number of cells to determine if the radial file has to be excluded (default = 0.6).</p>
</td></tr>
<tr><td><code id="batch.mode_+3A_list">list</code></td>
<td>
<p>a <code><a href="base.html#topic+data.frame">data.frame</a></code> with the individual &quot;ID&quot; and in sequence the slopes as described in <code><a href="#topic+pos.det">pos.det</a></code>. Cannot be activated when interact = <code><a href="base.html#topic+TRUE">TRUE</a></code>.</p>
</td></tr>
<tr><td><code id="batch.mode_+3A_flip">flip</code></td>
<td>
<p>logical flag indicating whether to plot the data with earlywood downwards (default; flip = <code><a href="base.html#topic+FALSE">FALSE</a></code>) or upwards (flip = <code><a href="base.html#topic+TRUE">TRUE</a></code>).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function aids in applying all described functions on a large dataset composed of multiple files, including multiple individuals and years. It will generate output graphs as described in <code><a href="#topic+is.raptor">is.raptor</a></code>, <code><a href="#topic+align">align</a></code>, <code><a href="#topic+first.cell">first.cell</a></code>, <code><a href="#topic+pos.det">pos.det</a></code> and <code><a href="#topic+write.output">write.output</a></code> in a .pdf file. Additionally, output text files are written. All output files are exported into the directory specified in the location argument.
</p>


<h3>Value</h3>

<p>Plots the detected radial files and writes output according the the
<code><a href="#topic+write.output">write.output</a></code> format.
</p>

<hr>
<h2 id='example.data'>Species-specific anatomy input</h2><span id='topic+example.data'></span>

<h3>Description</h3>

<p>This function provides a <code><a href="base.html#topic+data.frame">data.frame</a></code> containing standard anatomical measurements from xylem cross-sections images analysed with ROXAS (version 3.0). From the dataset described in <code><a href="#topic+anatomy.data">anatomy.data</a></code>, multiple input examples can be provided, including; 1) Norway Spruce (<em>Picea abies</em>) from the Loetschental, Switzerland, 2) Siberian larch (<em>Larix siberica</em>) from Siberia, Russia, 3) Stone pine (<em>Pinus cembra</em>) from the Dolomite mountains, Italy, and 4) Scots pine (<em>Pinus sylvestris</em>) from the eastern lowlands, Germany.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>example.data(species = "LOT_PICEA")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="example.data_+3A_species">species</code></td>
<td>
<p>a character string specifying the species from which the example data should be loaded. Valid options include; <em>Picea abies</em> = &quot;LOT_PICEA&quot;, <em>Larix siberica</em> = &quot;SIB_LARIX&quot;, <em>Pinus cembra</em> = &quot;MOUNT_PINUS&quot;, <em>Pinus sylvestris</em> = &quot;LOW_PINUS&quot;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This datasets can be applied as an example to test functions provided in the package. Other examples of ROXAS output can be obtained via: <a href="http://www.wsl.ch//roxas/">WSL - ROXAS</a>.
</p>


<h3>Value</h3>

<p>A <code><a href="base.html#topic+data.frame">data.frame</a></code> containing anatomical measurements from the selected species.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#loading example data
input&lt;-example.data(species="LOT_PICEA")
input
str(input)
</code></pre>

<hr>
<h2 id='first.cell'>Detection of the first cells</h2><span id='topic+first.cell'></span>

<h3>Description</h3>

<p>This function uses an <code><a href="#topic+is.raptor">is.raptor</a></code> file (preferably obtained from <code><a href="#topic+align">align</a></code>) and adds a column with the first cells detected within radial files (i.e. first cell formed in the growing season). The value indicates to which radial file the first cell belongs to (counting from left to right). All cells with <code><a href="base.html#topic+NA">NA</a></code> are not considered as first row cells and are excluded in further analyses.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>first.cell(input, frac.small, yrs, make.plot = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="first.cell_+3A_input">input</code></td>
<td>
<p>an <code><a href="#topic+is.raptor">is.raptor</a></code> file.</p>
</td></tr>
<tr><td><code id="first.cell_+3A_frac.small">frac.small</code></td>
<td>
<p>a numeric value (between 0 and 1) that is multiplied by the average cell lumen size of the ring, determining the minimum threshold used to exclude cells in the first row that are too small (default = 0.5).</p>
</td></tr>
<tr><td><code id="first.cell_+3A_yrs">yrs</code></td>
<td>
<p>either a numeric vector providing the year(s) of interest or <code><a href="base.html#topic+FALSE">FALSE</a></code> to select all years included in input (default = <code><a href="base.html#topic+FALSE">FALSE</a></code>).</p>
</td></tr>
<tr><td><code id="first.cell_+3A_make.plot">make.plot</code></td>
<td>
<p>logical flag indicating whether to make a plot (default =  <code><a href="base.html#topic+FALSE">FALSE</a></code>).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The first row of cells is detected by using a local search algorithm, where the first cell is indicated by a green box when make.plot = <code><a href="base.html#topic+TRUE">TRUE</a></code>, and the last by a red box. Values within the graph indicate the row numbers that have been detected. The output adds a column to the input data which indicates the first row of cells. The frac.small argument allows the user to filter out unrealistically small cells.
</p>


<h3>Value</h3>

<p>An <code><a href="#topic+is.raptor">is.raptor</a></code> file with an added column describing the first cells.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
#first row detection example
input&lt;-is.raptor(example.data(species="LOT_PICEA"), str = FALSE)
input&lt;-input[which(input[,"YEAR"]&gt;2006 &amp; input[,"YEAR"]&lt;2011),]
aligned&lt;-align(input,list=c(0.04,0.04,0,0))
first&lt;-first.cell(aligned, frac.small = 0.5, yrs = FALSE, make.plot = TRUE)

## End(Not run)
</code></pre>

<hr>
<h2 id='graph.cells'>Data visualization</h2><span id='topic+graph.cells'></span>

<h3>Description</h3>

<p>This function uses <code><a href="#topic+is.raptor">is.raptor</a></code> files to create a two panel <code><a href="graphics.html#topic+plot">plot</a></code> including; 1) a schematic overview of the ring width sequence and 2) a graphical representation of the cell size and position within a specific year (highlighted in the ring width sequence).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>graph.cells(input, year=FALSE, interact=FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="graph.cells_+3A_input">input</code></td>
<td>
<p>an <code><a href="#topic+is.raptor">is.raptor</a></code> file.</p>
</td></tr>
<tr><td><code id="graph.cells_+3A_year">year</code></td>
<td>
<p>a numerical value specifying the year of interest. Default starts with the first year and plots the other years in sequence.</p>
</td></tr>
<tr><td><code id="graph.cells_+3A_interact">interact</code></td>
<td>
<p>a logical flag. If <code><a href="base.html#topic+TRUE">TRUE</a></code>, the user can interactively cycle through plots of annual rings (default = <code><a href="base.html#topic+FALSE">FALSE</a></code>).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This graphical interface aids in exploring the cell position and cell size. The upper <code><a href="graphics.html#topic+plot">plot</a></code> provides and overview of the available years within the <code><a href="base.html#topic+data.frame">data.frame</a></code>. Grey shading indicates the year that is presented in the lower panel. The italic value in the upper panel presents the number of cells within the selected year. The lower panel shows the position of the cells with their unique &quot;CID&quot;. XCAL and YCAL positions are standardized to the minimum occurring coordinates. Within the lower panel, the grey boxes represent the cells, derived from the lumen area (&quot;CA&quot;) assuming a square. When &quot;interact = <code><a href="base.html#topic+TRUE">TRUE</a></code>&quot;, <code><a href="base.html#topic+readline">readline</a></code> messages will be presented with multiple options to create a new <code><a href="graphics.html#topic+plot">plot</a></code> while moving along the years (including selecting the previous, next year or selecting a specific year). Stopping the interact function is done by typing &quot;x&quot;. Terminate this function before continuing with other functions.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#' #plotting example data
input&lt;-example.data(species="LOT_PICEA")
input&lt;-is.raptor(input, str=TRUE)
graph.cells(input, year=2010)
</code></pre>

<hr>
<h2 id='is.raptor'>Testing and preparing input data</h2><span id='topic+is.raptor'></span>

<h3>Description</h3>

<p>Testing if the structure of the input matches the requirements for the RAPTOR functions. The input has to be presented in a <code><a href="base.html#topic+data.frame">data.frame</a></code> including the following columns; 1) sample id <em>&lt;<code><a href="base.html#topic+as.character">as.character</a></code>/<code><a href="base.html#topic+as.factor">as.factor</a></code>&gt;</em>, 2) tracheid id <em>&lt;<code><a href="base.html#topic+as.integer">as.integer</a></code>&gt;</em>, 3) tree-ring year <em>&lt;<code><a href="base.html#topic+as.numeric">as.numeric</a></code>&gt;</em>, 4) lumen size <em>&lt;<code><a href="base.html#topic+as.numeric">as.numeric</a></code>&gt;</em>, 5) x-coordinate of the cell <em>&lt;<code><a href="base.html#topic+as.numeric">as.numeric</a></code>&gt;</em> and 6) y-coordinate of the cell <em>&lt;<code><a href="base.html#topic+as.numeric">as.numeric</a></code>&gt;</em>. The anatomical data should be oriented with the latewood cells on the upper section of the image. For this function either the order or the columns has to be respected or the following column names have to be present within the <code><a href="base.html#topic+data.frame">data.frame</a></code>: &quot;ID&quot; = sample id, &quot;CID&quot; = tracheid id, &quot;YEAR&quot; = year, &quot;CA&quot; = lumen size (micron), &quot;XCAL&quot; = x coordinate, &quot;YCAL&quot; = y coordinate. Additionally, at least 50 tracheid's (or cells) have to be present in each year.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is.raptor(data, str = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="is.raptor_+3A_data">data</code></td>
<td>
<p>a <code><a href="base.html#topic+data.frame">data.frame</a></code> where tracheids are ordered in rows and the columns contain the variables; sample id, cell id, year, tracheid lumen area, x coordinates and y coordinates. The name of the columns (<code><a href="base.html#topic+colnames">colnames</a></code>) have to either be named as &quot;ID&quot;,&quot;CID&quot;,&quot;YEAR&quot;,&quot;CA&quot;,&quot;XCAL&quot; and &quot;YCAL&quot; or properly ordered.</p>
</td></tr>
<tr><td><code id="is.raptor_+3A_str">str</code></td>
<td>
<p>a logical flag. If <code><a href="base.html#topic+TRUE">TRUE</a></code> the structure of the data will be printed (default = <code><a href="base.html#topic+FALSE">FALSE</a></code>).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>To prevent errors occurring in the other reported functions, it is advised to run this function for checking the data structure and preparing it for further analyses.
</p>


<h3>Value</h3>

<p>A <code><a href="base.html#topic+data.frame">data.frame</a></code> in the appropriate format for other functionalities.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+anatomy.data">anatomy.data</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#validating example data
input&lt;-example.data(species="LOT_PICEA")
input&lt;-is.raptor(input, str=TRUE)
input
</code></pre>

<hr>
<h2 id='pos.det'>Determining the cell position</h2><span id='topic+pos.det'></span>

<h3>Description</h3>

<p>Returns a <code><a href="base.html#topic+data.frame">data.frame</a></code>, similar as produced by <code><a href="#topic+first.cell">first.cell</a></code>, but with added columns providing ROW and POSITION which indicate the radial files number (ROW, from left to right) and radial cell position (from earlywood to latewood) of each tracheid. <code><a href="base.html#topic+NA">NA</a></code> is assigned to cells not belonging to recognized radial files. A MARKER column is added to indicate the last detected cell in the earlywood search (indicated with 1), latewood search (2), the last detected cell (3), rows that are removed due to gaps (4, see prof.co) and rows that are removed due to limited amount of cells (5, see max.cells).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pos.det(input, swe = 0.5, sle = 3, ec = 1.75 , swl = 0.25, sll = 5, lc = 5,
        prof.co = 6, max.cells = 0.5, list=FALSE, yrs = FALSE,
        aligning = TRUE, make.plot = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pos.det_+3A_input">input</code></td>
<td>
<p>an input file as produced by <code><a href="#topic+first.cell">first.cell</a></code>.</p>
</td></tr>
<tr><td><code id="pos.det_+3A_swe">swe</code></td>
<td>
<p>a numeric value that is multiplied by the square-rooted cell lumen area (l) of the target cell and used to determine the width of the rectangular search area which locates the next earlywood cell in the row (default = 0.5).</p>
</td></tr>
<tr><td><code id="pos.det_+3A_sle">sle</code></td>
<td>
<p>a numeric value that is multiplied by the square rooted cell lumen area (l) of the target cell to determine the length of the rectangle search area which locates the next earlywood cell in the row (default = 3).</p>
</td></tr>
<tr><td><code id="pos.det_+3A_ec">ec</code></td>
<td>
<p>threshold ratio between the lumen area of two consecutive earlywood cells to determine the end of the earlywood search (default = 1.75). The default setting indicates that the earlywood search ends when the next cell lumen area is at least 1.75 times smaller than the target cell.</p>
</td></tr>
<tr><td><code id="pos.det_+3A_swl">swl</code></td>
<td>
<p>a numeric value that is multiplied by the square rooted cell lumen area (l) of the target cell to determine the width of the rectangle search area which locates the next latewood cell in the row (default = 0.25).</p>
</td></tr>
<tr><td><code id="pos.det_+3A_sll">sll</code></td>
<td>
<p>a numeric value that is multiplied by the square rooted cell lumen area (l) of the target cell to determine the length of the rectangle search area which locates the next earlywood cell in the row (default = 5).</p>
</td></tr>
<tr><td><code id="pos.det_+3A_lc">lc</code></td>
<td>
<p>threshold ratio between the lumen area of two consecutive latewood cells to determine the end of the radial file (default = 10). The default setting indicates that the latewood search ends when the next cell lumen area is at least 10 times smaller than the target cell.</p>
</td></tr>
<tr><td><code id="pos.det_+3A_prof.co">prof.co</code></td>
<td>
<p>threshold ratio between the distance to the previous and consecutive cell to determine if the row (or radial file) should be excluded (default = 6).</p>
</td></tr>
<tr><td><code id="pos.det_+3A_max.cells">max.cells</code></td>
<td>
<p>threshold proportion of the maximum number of cells to determine if the radial file has to be excluded (default = 0.6).</p>
</td></tr>
<tr><td><code id="pos.det_+3A_list">list</code></td>
<td>
<p>a <code><a href="base.html#topic+data.frame">data.frame</a></code> of &quot;CID&quot; (unique cell ID) from cells which should be considered as first row cells. Should be filled if <code><a href="#topic+first.cell">first.cell</a></code> output is not used as input. The vector should be ordered to years and present specific &quot;CID&quot; which is considered the first cell.</p>
</td></tr>
<tr><td><code id="pos.det_+3A_yrs">yrs</code></td>
<td>
<p>either a vector providing the year(s) of interest or <code><a href="base.html#topic+FALSE">FALSE</a></code> to select all years included in the input file (default = <code><a href="base.html#topic+FALSE">FALSE</a></code>).</p>
</td></tr>
<tr><td><code id="pos.det_+3A_aligning">aligning</code></td>
<td>
<p>logical flag indicating whether a second alignment has to be performed based upon the cells detected within <code><a href="#topic+first.cell">first.cell</a></code> (default = <code><a href="base.html#topic+TRUE">TRUE</a></code>).</p>
</td></tr>
<tr><td><code id="pos.det_+3A_make.plot">make.plot</code></td>
<td>
<p>logical flag indicating whether to make a plot (default =  <code><a href="base.html#topic+FALSE">FALSE</a></code>).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>After the identification of the first cells (with <code><a href="#topic+first.cell">first.cell</a></code>) within a radial file, this function assigns remaining cells to a corresponding radial file based on various search criteria. A local search algorithm is applied which searches cells above a specified target cell (n; starts with first cell of the radial file detected by <code><a href="#topic+first.cell">first.cell</a></code>). First the &quot;earlywood&quot; search process projects a search area from the selected cell with a specific width (x-axis) and length (y-axis). The search length and width is based on the length of the target cell (l_n) determined with size of the cell (where l_n= <code><a href="base.html#topic+sqrt">sqrt</a></code>(CA_n) ) and multiplied by a factor (sle = search length earlywood, for the search length and swe = search width earlywood, for the search width). This initial search grid is presented in &quot;orange&quot;(if make.plot = <code><a href="base.html#topic+TRUE">TRUE</a></code>), where the width can be adjusted by changing swe and the length by sle. When no cells are detected (last detected cells are indicated with orange circles), caused in most cases by the small size of latewood cells, a second search grid is established with an altered length and width (sll = search length latewood and swl = search width latewood; presented in &quot;red&quot; if make.plot = <code><a href="base.html#topic+TRUE">TRUE</a></code>; last detected cell are indicates with red circles). Due to smaller fragments of erroneously detected cells, for both search grids a cut-off value is added where the next cell should not be smaller than the lumen area of the target cell (CA_n) times a factor (ec = earlywood cut off and lc = latewood cut off). Finally, a flexible spline is fitted through the selected cells within a row to detect missing cells. Once all cells are detected (last cell is indicated with a red square), the distance between the cells is analysed and depending upon a profile cut-off factor (prof.co) the row is omitted, if the distance difference between n+1 and n+2 times prof.co is bigger than the distance of n and n+1 (which could present a gap often caused by resin ducts; omitted rows are indicated with a &quot;+&quot; symbol). Also, rows that have less cells then the maximum cell count times a factor (max.cells) are removed, as the row might be incomplete (omitted rows are indicated with a &quot;x&quot; symbol).
</p>


<h3>Value</h3>

<p>An <code><a href="#topic+is.raptor">is.raptor</a></code> file with an added column describing the position within the radial file.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
#example of position detection
input&lt;-is.raptor(example.data(species="MOUNT_PINUS"), str = FALSE)
aligned&lt;-align(input, list=c("h", "h", "h", 0.03), make.plot = FALSE)
first&lt;-first.cell(aligned, frac.small = 0.2, yrs = FALSE, make.plot = FALSE)
output&lt;-pos.det(first, swe = 0.7, sle = 3, ec = 1.75, swl = 0.5, sll = 5, lc = 10,
                prof.co = 1.7, max.cells = 0.7, yrs = FALSE, aligning = FALSE, make.plot = TRUE)

## End(Not run)
</code></pre>

<hr>
<h2 id='write.output'>Output generation and visualization</h2><span id='topic+write.output'></span>

<h3>Description</h3>

<p>Generating final output graphs and files for the row and position detection. Input data should be provided as produced by <code><a href="#topic+pos.det">pos.det</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>write.output(input, location, flip = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="write.output_+3A_input">input</code></td>
<td>
<p>a <code><a href="base.html#topic+data.frame">data.frame</a></code> produced by <code><a href="#topic+pos.det">pos.det</a></code>.</p>
</td></tr>
<tr><td><code id="write.output_+3A_location">location</code></td>
<td>
<p>an optional character string containing the location where the output .pdf and .txt file should be stored. If not supplied, the function returns the computed output, which can be stored in an object.</p>
</td></tr>
<tr><td><code id="write.output_+3A_flip">flip</code></td>
<td>
<p>logical flag indicating in which direction to plot the cells, i.e. with earlywood at the bottom (default; flip = <code><a href="base.html#topic+FALSE">FALSE</a></code>) or at the top (flip = <code><a href="base.html#topic+TRUE">TRUE</a></code>).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Function that aids in graphing the output and writing output tables. The generated <code><a href="graphics.html#topic+plot">plot</a></code> provides an overview of the detected cells, rows, and the position of the cells within each radial file. The output table provides the standard output table with three additional columns containing; the &quot;ROW&quot; number and &quot;POSITION&quot; within the row and the &quot;MARKER&quot; column (cf. <code><a href="#topic+pos.det">pos.det</a></code>. This output can provide crucial information that can be used with other packages to generate tracheidograms (cf. de la Cruz &amp; DeSoto, 2015) and link the output to xylogenesis data (cf. Rathgeber et al., 2011).
</p>


<h3>Value</h3>

<p>Plots the detected radial files and writes output according to the <code><a href="#topic+is.raptor">is.raptor</a></code> format.
</p>


<h3>References</h3>

<p>de la Cruz, M., &amp; DeSoto, L. (2015) tgram: Functions to compute and plot tracheidograms. CRAN: https://cran.r-project.org/web/packages/tgram/tgram.pdf.<br />
<br />
Rathgeber, C.B.K., Longuetaud, F., Mothe, F., Cuny, H., &amp; Le Moguedec, G. (2011) Phenology of wood formation: Data processing, analysis and visualisation using R (package CAVIAR). Dendrochronologia 29, 139-149.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
#example to write output
input&lt;-is.raptor(example.data(species="SIB_LARIX"), str = FALSE)
aligned&lt;-align(input)
first&lt;-first.cell(aligned, frac.small = 0.5, yrs = FALSE, make.plot = FALSE)
output&lt;-pos.det(first, swe = 0.3, sle = 3, ec = 1.5, swl = 0.5, sll = 5, lc = 15,
                prof.co = 4, max.cells = 0.5, yrs = FALSE, aligning = FALSE, make.plot = FALSE)
sib_larix&lt;-write.output(output)

#removing rows which are unsuitable
corrections&lt;-data.frame(year=c(2010,2010,2010,2009,2009,2009,2009,2008,2008,
                        2008,2008,2008,2008,2007,2007,2007),
                        row=c(19,15,9,6,11,14,17,5,6,14,17,24,15,2,8,14))
for(i in c(1:nrow(corrections))){
sib_larix[which(sib_larix[,"YEAR"]==corrections[i,1]  &amp;
          sib_larix[,"ROW"]==corrections[i,2] ),"POSITION"]&lt;-rep(NA,length(sib_larix[
          which(sib_larix[,"YEAR"]==corrections[i,1]&amp; sib_larix[,"ROW"]==corrections[i,2] ),
          "POSITION"]))
sib_larix[which(sib_larix[,"YEAR"]==corrections[i,1]  &amp;
          sib_larix[,"ROW"]==corrections[i,2] ),"ROW"]&lt;-rep(NA,length(sib_larix[
          which(sib_larix[,"YEAR"]==corrections[i,1]&amp;sib_larix[,"ROW"]==corrections[i,2] ),
          "POSITION"]))}
SIB_LARIX&lt;-write.output(sib_larix)
for(i in c(1:length(unique(SIB_LARIX[,"YEAR"])))){
row_id&lt;-unique(SIB_LARIX[which(SIB_LARIX[,"YEAR"]==unique(SIB_LARIX[,"YEAR"])[i]),"ROW"],
               na.rm=TRUE)
row_id&lt;-na.omit(row_id[order(row_id)])
for(j in c(1:length(row_id))){
SIB_LARIX[which(SIB_LARIX[,"YEAR"]==unique(SIB_LARIX[,"YEAR"])[i] &amp;
          SIB_LARIX[,"ROW"]==row_id[j]), "ROW"]&lt;-j
}}

## End(Not run)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
