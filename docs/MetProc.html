<!DOCTYPE html><html lang="en"><head><title>Help for package MetProc</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {MetProc}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#MetProc-package'><p>Separate Untargeted Metabolites into Likely Artifacts and Likely True Metabolites</p></a></li>
<li><a href='#corr_metric'><p>Calculate Correlation of Missing Rates between Pooled Plasma and Biological Samples</p></a></li>
<li><a href='#get_group'><p>Retrieve Index of Biological Samples and Pooled Plasma Samples</p></a></li>
<li><a href='#get_missing'><p>Compute Missing Rates of Biological Samples and Pooled Plasma Samples</p></a></li>
<li><a href='#heatmap_res'><p>Plot Patterns of Missing Data Across Metabolites</p></a></li>
<li><a href='#met_proc'><p>Separates Metabolites into Likely True Metabolites and Likely Measurement Artifacts</p></a></li>
<li><a href='#plot_metric'><p>Plot Distribution of Metabolite Quality Metrics for Each Split of Data</p></a></li>
<li><a href='#plot_pp_sample_missing'><p>Plot Pooled Plasma and Biological Sample Missing Rates</p></a></li>
<li><a href='#read.met'><p>Read in a Metabolomics Dataset of Standard Structure</p></a></li>
<li><a href='#run_metric'><p>Calculate Longest Run of Blocks where Data is Present</p></a></li>
<li><a href='#sampledata'><p>Simulated Metabolomics Data</p></a></li>
<li><a href='#subset_met'><p>Group Metabolites based on Pooled Plasma Missing Rate</p></a></li>
<li><a href='#write.met'><p>Write Metabolomics Dataset of Standard Structure</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Separate Metabolites into Likely Measurement Artifacts and True
Metabolites</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.1</td>
</tr>
<tr>
<td>Date:</td>
<td>2016-05-18</td>
</tr>
<tr>
<td>Author:</td>
<td>Mark Chaffin</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Mark Chaffin &lt;mac8278@mail.harvard.edu&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Split an untargeted metabolomics data set into a set of likely true 
    metabolites and a set of likely measurement artifacts. This process involves 
    comparing missing rates of pooled plasma samples and biological samples. The 
    functions assume a fixed injection order of samples where biological samples are 
    randomized and processed between intermittent pooled plasma samples. By comparing 
    patterns of missing data across injection order, metabolites that appear in blocks
    and are likely artifacts can be separated from metabolites that seem to have 
    random dispersion of missing data. The two main metrics used are: 1. the number of 
    consecutive blocks of samples with present data and 2. the correlation of missing rates 
    between biological samples and flanking pooled plasma samples.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.1.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>gplots, fastcluster</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>LazyLoad:</td>
<td>true</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2016-05-18 17:39:01 UTC; Mark</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2016-05-19 05:46:39</td>
</tr>
</table>
<hr>
<h2 id='MetProc-package'>Separate Untargeted Metabolites into Likely Artifacts and Likely True Metabolites</h2><span id='topic+MetProc-package'></span><span id='topic+MetProc'></span>

<h3>Description</h3>

<p>Package to separate metabolites from an untargeted metabolomics experiment into likely artifacts versus likely true metabolites. The general strategy is to compare missing rates of pooled plasma samples and missing rates of biological samples across an injection order. With a randomized injection order for biological samples, generally metabolites that are present for only certain sections of the entire run (exhibiting a block structure) are likely artifacts whereas metabolites with random patterns of missingness are likely true metabolites. The package uses 3 main metrics to separate metabolites and provides tools to plot patterns of missing data across injection order to visualize differences in likely artifacts compared to true metabolites. Details of the separation process and applied metrics can be found in the details section of <code><a href="#topic+met_proc">met_proc</a></code>.</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> MetProc</td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 1.0</td>
</tr>
<tr>
 <td style="text-align: left;">
Date: </td><td style="text-align: left;"> 2016-05-18</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> GPL (&gt;= 2)</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

<p>If data is formatted appropriately (see <code><a href="#topic+sampledata">sampledata</a></code> for an example), generally only need to use the <code><a href="#topic+read.met">read.met</a></code> function followed by the <code><a href="#topic+met_proc">met_proc</a></code> function to output a separate dataframe for likely true metabolites and likely measurement artifacts.
</p>


<h3>Author(s)</h3>

<p>Mark Chaffin
</p>
<p>Maintainer: Mark Chaffin &lt;mac8278@mail.harvard.edu&gt;
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(MetProc)
#Read in metabolomics dataset
metdata &lt;- read.met(system.file("extdata/sampledata.csv", package="MetProc"),
headrow = 3, metidcol = 1, fvalue = 8, sep = ",", ppkey = "PPP", ippkey = "BPP") 

#Separate likely artifacts from true signal using default settings
results &lt;- met_proc(metdata,plot=FALSE)

#Separate likely artifacts from true signal using custom cutoffs and criteria
#Uses 5 groups of metabolites based on the pooled plasma missing rate, applies
#custom metric thersholds, sets the minimum pooled plasma missing rate to 0.05,
#sets the maximum pooled plasma missing rate to 0.95, sets the missing rate
#to consider a block of samples present at 0.6
results &lt;- met_proc(metdata, numsplit = 5, cor_rates = c(0.4,.7,.75,.7,.4),
runlengths = c(80, 10, 12, 10, 80), mincut = 0.05, maxcut = 0.95, scut = 0.6,
ppkey = 'PPP', sidkey = 'X', plot = FALSE)

#Uses default criteria for running met_proc, but plots the results
#and saves them in a PDF in the current directory. Adding plots
#may substantially increase running time if many samples are 
#included
results &lt;- met_proc(metdata, plot = TRUE, missratecut = 0.001, 
histcolors = c('red','yellow','green','blue','purple'))

#Write the retained metabolites to current directory
write.met(results,'sample_retained.csv',
system.file("extdata/sampledata.csv", package="MetProc"),
headrow=3,metidcol=1,fvalue=8,sep=",",type='keep')

#Write the removed metabolites to current directory
write.met(results,'sample_removed.csv',
system.file("extdata/sampledata.csv", package="MetProc"),
headrow=3,metidcol=1,fvalue=8,sep=",",type='remove')
</code></pre>

<hr>
<h2 id='corr_metric'>Calculate Correlation of Missing Rates between Pooled Plasma and Biological Samples</h2><span id='topic+corr_metric'></span>

<h3>Description</h3>

<p>Calculates the correlation of missing rates between the two flanking pooled plasma samples and intervening biological samples for each block in the injection order. A block is defined as a set of biological samples and their flanking pooled plasma samples. See <code><a href="#topic+sampledata">sampledata</a></code> for an example of the data format and block structure. Requires 2 arguments as input: 1. The metabolomics dataset formatted from the <code><a href="#topic+read.met">read.met</a></code> function and 2. A list of 2 elements output from the <code><a href="#topic+get_group">get_group</a></code> function containing column indices of pooled plasma samples and biological samples, respectively. If either pooled plasma or biological samples are entirely absent or entirely present, the function will return NA for the metric of that metabolite as the standard deviation of a vector will be 0.</p>


<h3>Usage</h3>

<pre><code class='language-R'>corr_metric(df, grps)</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="corr_metric_+3A_df">df</code></td>
<td>
<p>The metabolomics dataset, ideally read from the <code><a href="#topic+read.met">read.met</a></code> function. Each column represents a sample and each row represents a metabolite. Columns should be labeled with some unique prefix denoting whether the column is from a biological sample or pooled plasma sample. For example, all pooled plasma samples may have columns identified by the prefix &ldquo;PPP&rdquo; and all biological samples may have columns identified by the prefix &ldquo;X&rdquo;. Missing data must be coded as NA. Columns must be ordered by injection order.</p>
</td></tr>
<tr><td><code id="corr_metric_+3A_grps">grps</code></td>
<td>
<p>A list of 2 elements from the <code><a href="#topic+get_group">get_group</a></code> function. Element <code>"pp"</code> should contain indices of pooled plasma columns and <code>"sid"</code> should contain indicies of biological sample columns.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a vector of equal length to the number of rows in <code>df</code> (representing metabolites) with the correlation of missing rates between flanking pooled plasma and intervening biological samples across all blocks.</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+MetProc-package">MetProc-package</a></code> for examples of running the full process.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(MetProc)
#Read metabolomics data
metdata &lt;- read.met(system.file("extdata/sampledata.csv", package="MetProc"),
headrow=3, metidcol=1, fvalue=8, sep=",", ppkey="PPP", ippkey="BPP")

#Get indices of samples and pooled plasma
grps &lt;- get_group(metdata,'PPP','X') 

#get correlation metrics of metabolites
corrs &lt;- corr_metric(metdata,grps) 
</code></pre>

<hr>
<h2 id='get_group'>Retrieve Index of Biological Samples and Pooled Plasma Samples</h2><span id='topic+get_group'></span>

<h3>Description</h3>

<p>Takes a metabolomics data matrix and retrieves the column indices of biological samples and pooled plasma samples. Columns must be ordered by injection order and each column ID should have a unique prefix designating the particular type of sample it is. For example, &ldquo;PPP&rdquo;' to designate pooled plasma samples and &ldquo;X&rdquo; to designate biological samples. Generally if data is read into R using the <code><a href="#topic+read.met">read.met</a></code> function, columns will be labeled appropriately.</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_group(df, ppkey = "PPP", sidkey = "X")</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_group_+3A_df">df</code></td>
<td>
<p>The metabolomics dataset, ideally read from the <code><a href="#topic+read.met">read.met</a></code> function. Each column represents a sample and each row represents a metabolite. Columns should be labeled with some unique prefix denoting whether the column is from a biological sample or pooled plasma sample. For example, all pooled plasma samples may have columns identified by the prefix &ldquo;PPP&rdquo; and all biological samples may have columns identified by the prefix &ldquo;X&rdquo;. Missing data must be coded as NA. Columns must be ordered by injection order.</p>
</td></tr>
<tr><td><code id="get_group_+3A_ppkey">ppkey</code></td>
<td>
<p>The unique prefix of pooled plasma samples. Default is <code>"PPP"</code>.</p>
</td></tr>
<tr><td><code id="get_group_+3A_sidkey">sidkey</code></td>
<td>
<p>The unique prefix of biological samples. Default is <code>"X"</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of length 2 with the following keys:<br />
</p>
<table role = "presentation">
<tr><td><code>pp</code></td>
<td>
<p>A vector with column indices of pooled plasma</p>
</td></tr>
<tr><td><code>sid</code></td>
<td>
<p>A vector with column indices of samples</p>
</td></tr>
</table>


<h3>See Also</h3>

<p>See <code><a href="#topic+MetProc-package">MetProc-package</a></code> for examples of running the full process.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(MetProc)
#Read metabolomics data
metdata &lt;- read.met(system.file("extdata/sampledata.csv", package="MetProc"),
headrow=3, metidcol=1, fvalue=8, sep=",", ppkey="PPP", ippkey="BPP")

#Get groups based on samples and pooled plasma
grps &lt;- get_group(metdata,'PPP','X') 
</code></pre>

<hr>
<h2 id='get_missing'>Compute Missing Rates of Biological Samples and Pooled Plasma Samples</h2><span id='topic+get_missing'></span>

<h3>Description</h3>

<p>Computes two missing rates per metabolite: 1. Missing rate of biological samples and 2. Missing rate of pooled plasma samples. Requires a metabolomics data matrix from <code><a href="#topic+read.met">read.met</a></code> function as well as the indicies of pooled plasma and biological samples from <code><a href="#topic+get_group">get_group</a></code>. Returns a list with the two missing rates across all metabolites</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_missing(df, ppind, sampind)</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_missing_+3A_df">df</code></td>
<td>
<p>The metabolomics dataset, ideally read from the <code><a href="#topic+read.met">read.met</a></code> function. Each column represents a sample and each row represents a metabolite. Columns should be labeled with some unique prefix denoting whether the column is from a biological sample or pooled plasma sample. For example, all pooled plasma samples may have columns identified by the prefix &ldquo;PPP&rdquo; and all biological samples may have columns identified by the prefix &ldquo;X&rdquo;. Missing data must be coded as NA. Columns must be ordered by injection order.</p>
</td></tr>
<tr><td><code id="get_missing_+3A_ppind">ppind</code></td>
<td>
<p>The indices of the pooled plasma samples.</p>
</td></tr>
<tr><td><code id="get_missing_+3A_sampind">sampind</code></td>
<td>
<p>The indices of the biological samples.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with the missing rates of the pooled plasma samples and biological samples for all metabolites in dataframe. The keys are:
</p>
<table role = "presentation">
<tr><td><code>ppmiss</code></td>
<td>
<p>The pooled plasma missing rate for each metabolite</p>
</td></tr>
<tr><td><code>sampmiss</code></td>
<td>
<p>The biological sample missing rate for each metabolite</p>
</td></tr>
</table>


<h3>See Also</h3>

<p>See <code><a href="#topic+MetProc-package">MetProc-package</a></code> for examples of running the full process.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(MetProc)

#Read metabolomics data
metdata &lt;- read.met(system.file("extdata/sampledata.csv", package="MetProc"),
headrow=3, metidcol=1, fvalue=8, sep=",", ppkey="PPP", ippkey="BPP")

#Get groups based on samples and pooled plasma
grps &lt;- get_group(metdata,'PPP','X') 

#Get the missing rates of each category for all metabolites
missrate &lt;- get_missing(metdata,grps[['pp']],grps[['sid']]) 
</code></pre>

<hr>
<h2 id='heatmap_res'>Plot Patterns of Missing Data Across Metabolites</h2><span id='topic+heatmap_res'></span>

<h3>Description</h3>

<p>Generates a heatmap to show patterns of missing data for metabolites. Useful to visualize the block structure of data to compare differences between removed metabolites and retained metabolites.</p>


<h3>Usage</h3>

<pre><code class='language-R'>heatmap_res(df, ppkey = "PPP", sidkey = "X", missratecut = .01,title)</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="heatmap_res_+3A_df">df</code></td>
<td>
<p>The metabolomics dataset, ideally read from the <code><a href="#topic+read.met">read.met</a></code> function. Each column represents a sample and each row represents a metabolite. Columns should be labeled with some unique prefix denoting whether the column is from a biological sample or pooled plasma sample. For example, all pooled plasma samples may have columns identified by the prefix &ldquo;PPP&rdquo; and all biological samples may have columns identified by the prefix &ldquo;X&rdquo;. Missing data must be coded as NA. Columns must be ordered by injection order.</p>
</td></tr>
<tr><td><code id="heatmap_res_+3A_ppkey">ppkey</code></td>
<td>
<p>Unique prefix of pooled plasma columns. Default is <code>"PPP"</code>.</p>
</td></tr>
<tr><td><code id="heatmap_res_+3A_sidkey">sidkey</code></td>
<td>
<p>Unique prefix of biological sample columns. Default is <code>"X"</code>.</p>
</td></tr>
<tr><td><code id="heatmap_res_+3A_missratecut">missratecut</code></td>
<td>
<p>The missing rate limit for displaying a metabolite. Only metabolites with overall missing rates equal to or greater than this cutoff will be plotted. Useful for avoiding plotting too many metabolites as the heatmap generation can be an expensive computation. If a metabolite has a very small missing rate, plotting is uninformative as all data is present. Default set to <code>0.01</code>.</p>
</td></tr>
<tr><td><code id="heatmap_res_+3A_title">title</code></td>
<td>
<p>The title of the heatmap plotted</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a heatmap illustrating the patterns of missing data for metabolites.</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+MetProc-package">MetProc-package</a></code> for examples of running the full process.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(MetProc)

#Read in metabolomics data
metdata &lt;- read.met(system.file("extdata/sampledata.csv", package="MetProc"),
headrow=3, metidcol=1, fvalue=8, sep=",", ppkey="PPP", ippkey="BPP")

#Get the good versus bad metabolites
results &lt;- met_proc(metdata)

#Plot Removed metabolites
#Similarly run for retained metabolites but
#replacing 'remove' with 'keep'
heatmap_res(results[['remove']],missratecut=.02,title='Removed Metabolites')
</code></pre>

<hr>
<h2 id='met_proc'>Separates Metabolites into Likely True Metabolites and Likely Measurement Artifacts</h2><span id='topic+met_proc'></span>

<h3>Description</h3>

<p>Takes a metabolomics data matrix and processes metabolites into likely artifacts versus likely true metabolites. Biological samples should follow a randomized injection order with pooled plasma samples interspersed. Columns of data should be samples and rows are metabolites. Columns must be ordered by injection order. Metabolites are first grouped by missing rate of pooled plasma and then processed based on metrics of blocky structure to identify likely artifacts. Specifically, <code><a href="#topic+corr_metric">corr_metric</a></code> and <code><a href="#topic+run_metric">run_metric</a></code> are used to quantify the degree to which structure is present in the patterns of missing data. Must pass all thresholds to be considered a true metabolite.</p>


<h3>Usage</h3>

<pre><code class='language-R'>met_proc(df, numsplit = 5, cor_rates = c(0.6, 0.65, 0.65, 0.65, 0.6),
runlengths = c(NA, 15, 15, 15, NA), mincut = 0.02, maxcut = 0.95, scut = 0.5,
ppkey = "PPP", sidkey = "X", missratecut=0.01, histcolors=c('white'), plot=TRUE,
outfile='MetProc_output')
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="met_proc_+3A_df">df</code></td>
<td>
<p>The metabolomics dataset, ideally read from the <code><a href="#topic+read.met">read.met</a></code> function. Each column represents a sample and each row represents a metabolite. Columns should be labeled with some unique prefix denoting whether the column is from a biological sample or pooled plasma sample. For example, all pooled plasma samples may have columns identified by the prefix &ldquo;PPP&rdquo; and all biological samples may have columns identified by the prefix &ldquo;X&rdquo;. Missing data must be coded as NA. Columns must be ordered by injection order.</p>
</td></tr>
<tr><td><code id="met_proc_+3A_numsplit">numsplit</code></td>
<td>
<p>The number of equal sized sections to divide metabolites into based on missing rate of pooled plasma columns. Divides the range of missing rates between <code>mincut</code> and <code>maxcut</code> into equal sections. Default is <code>5</code>.</p>
</td></tr>
<tr><td><code id="met_proc_+3A_cor_rates">cor_rates</code></td>
<td>
<p>A vector of length equal to <code>numsplit</code>. Each value represents the cutoff of the correlation metric in that section. Any metabolite with a value greater than or equal to the cutoff is considred an artifact and anything less than the cutoff is considered a true metabolite. If any value is set to NA, the correlation metric will not be considered for that group. One cutoff per group. Default is <code>c(.6, .65, .65, .65, .6)</code>.</p>
</td></tr>
<tr><td><code id="met_proc_+3A_runlengths">runlengths</code></td>
<td>
<p>A vector of length equal to <code>numsplit</code>. Each values represents the cutoff for the longest run metric in that section. Any metabolite with a run greater than or equal to the cutoff is considered an artifact and anything less than the cutoff is considred a true metabolite. If any value is set to NA, the longest run metric will not be considered for that group. One cutoff per group. Default is <code>c(NA, 15, 15, 15, NA)</code>.</p>
</td></tr>
<tr><td><code id="met_proc_+3A_mincut">mincut</code></td>
<td>
<p>A cutoff to specify that any metabolite with pooled plasma missing rate less than or equal to this value should be retained. Default is <code>0.02</code>.</p>
</td></tr>
<tr><td><code id="met_proc_+3A_maxcut">maxcut</code></td>
<td>
<p>A cutoff to specify that any metabolite with pooled plasma missing rate greater than this value should be removed. Default is <code>0.95</code>.</p>
</td></tr>
<tr><td><code id="met_proc_+3A_scut">scut</code></td>
<td>
<p>The cutoff of missingness to consider a metabolite as having data present in a given biological sample block. Relevant only to <code><a href="#topic+run_metric">run_metric</a></code> computation. Default is <code>0.5</code>.</p>
</td></tr>
<tr><td><code id="met_proc_+3A_ppkey">ppkey</code></td>
<td>
<p>The unique prefix of pooled plasma columns. Default is <code>"PPP"</code>.</p>
</td></tr>
<tr><td><code id="met_proc_+3A_sidkey">sidkey</code></td>
<td>
<p>The unique prefix of biological samples columns. Default is <code>"X"</code>.</p>
</td></tr>
<tr><td><code id="met_proc_+3A_missratecut">missratecut</code></td>
<td>
<p>A parameter for heatmap plots when <code>plot=TRUE</code>. Only metabolites with missing rates (across pooled plasma and biological samples) equal to or greater than this cutoff will be plotted. Useful to avoid plotting too may metabolites in an effort to save time. If a metabolite has a very small missing rate, plotting is uninformative as all data is present. Default is <code>0.01</code>.</p>
</td></tr>
<tr><td><code id="met_proc_+3A_plot">plot</code></td>
<td>
<p>Indicate whether you would like to obtain plots of missingness patterns and distributions of calculated metrics. Plots will be output as a PDF. Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="met_proc_+3A_histcolors">histcolors</code></td>
<td>
<p>A vector of length equal to <code>numsplit</code>. Each value represents the color to use for that group in the histograms of the longest run and correlation metrics for each subset of metabolites. If no color is provided, they will be colored white.</p>
</td></tr>
<tr><td><code id="met_proc_+3A_outfile">outfile</code></td>
<td>
<p>Name and path of the file to store images if <code>plot=TRUE</code>. Do not include file extension in the name. Default is <code>"MetProc_output"</code> which will save a file called MetProc_output.pdf in the current working directory.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function uses a four step process:<br /><br />
1. Retain all metabolites with pooled plasma missing rate below <code>mincut</code> and remove all metabolites with pooled plasma missing rate above <code>maxcut</code>.<br />
2. Split the remaining metabolites into <code>numsplit</code> groups that are defined by pooled plasma missing rates. The <code>numsplit</code> groups will divide the range of pooled plasma missing rates evenly.<br />
3. For each group of metabolites based on pooled plasma missing rates from step 2, calculate the correlation metric with <code><a href="#topic+corr_metric">corr_metric</a></code>. Any metabolite below the cutoff for that group, defined by <code>cor_rates</code>, will be retained and any metabolite above will be removed.<br />
4. For each group of metabolites based on pooled plasma missing rates from step 2, calculate the longest run metric with <code><a href="#topic+run_metric">run_metric</a></code>. Any metabolite below the cutoff for that group, defined by <code>runlengths</code>, will be retained and any metabolite above will be removed.
</p>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>keep</code></td>
<td>
<p>A dataframe of the retained metabolites</p>
</td></tr>
<tr><td><code>remove</code></td>
<td>
<p>A dataframe of the removed metabolites</p>
</td></tr>
</table>
<p>If <code>plot = True</code>, a PDF file will be saved containing the correspondence between pooled plasma missing rate and sample missing rate, the distribution of the correlation metric and longest run metric in each of the groups based on pooled plasma missing rates, and heatmaps displaying the patterns of present/missing data for both the removed and retained metabolites.
</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+run_metric">run_metric</a></code> for details on the longest run metric.<br /> See <code><a href="#topic+corr_metric">corr_metric</a></code> for details on the correlation metric.<br /> See <code><a href="#topic+MetProc-package">MetProc-package</a></code> for examples of running the full process.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(MetProc)

#Read in metabolomics data
metdata &lt;- read.met(system.file("extdata/sampledata.csv", package="MetProc"),
headrow=3, metidcol=1, fvalue=8, sep=",", ppkey="PPP", ippkey="BPP")

#Separate likely artifacts from true signal using default settings
results &lt;- met_proc(metdata,plot=FALSE)

#Separate likely artifacts from true signal using custom cutoffs and criteria
#Uses 5 groups of metabolites based on the pooled plasma missing rate, applies
#custom metric thersholds, sets the minimum pooled plasma missing rate to 0.05,
#sets the maximum pooled plasma missing rate to 0.95, sets the missing rate
#to consider a block of samples present at 0.6
results &lt;- met_proc(metdata, numsplit = 5, cor_rates = c(0.4,.7,.75,.7,.4),
runlengths = c(80, 10, 12, 10, 80), mincut = 0.05, maxcut = 0.95, scut = 0.6,
ppkey = 'PPP', sidkey = 'X', plot = FALSE)

#Uses default criteria for running met_proc, but plots the results
#and saves them in a PDF in the current directory.
#Colors of the histograms set by histcolors.
#Adding plots may substantially increase running time if many
#samples are included
results &lt;- met_proc(metdata, plot = TRUE, missratecut = 0.001, 
histcolors = c('red','yellow','green','blue','purple'))
</code></pre>

<hr>
<h2 id='plot_metric'>Plot Distribution of Metabolite Quality Metrics for Each Split of Data</h2><span id='topic+plot_metric'></span>

<h3>Description</h3>

<p>For a given number of splits of data based on pooled plasma missing rate, calculate the longest run metric (<code><a href="#topic+run_metric">run_metric</a></code>) and the correlation metric (<code><a href="#topic+corr_metric">corr_metric</a></code>) for metabolites in each group. Plot the distribution of these metrics for each group color coding those that exceed thresholds.</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_metric(df,ppkey='PPP',sidkey='X',numsplit=5,mincut=.02,maxcut=0.95,
scut=0.5,cor_rates=c(.6,.65,.65,.65,.6),runlengths=c(NA,15,15,15,NA),
histcolors=c('white'))
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_metric_+3A_df">df</code></td>
<td>
<p>The metabolomics dataset, ideally read from the <code><a href="#topic+read.met">read.met</a></code> function. Each column represents a sample and each row represents a metabolite. Columns should be labeled with some unique prefix denoting whether the column is from a biological sample or pooled plasma sample. For example, all pooled plasma samples may have columns identified by the prefix &ldquo;PPP&rdquo; and all biological samples may have columns identified by the prefix &ldquo;X&rdquo;. Missing data must be coded as NA. Columns must be ordered by injection order.</p>
</td></tr>
<tr><td><code id="plot_metric_+3A_ppkey">ppkey</code></td>
<td>
<p>The unique prefix of pooled plasma samples. Default is <code>"PPP"</code>.</p>
</td></tr>
<tr><td><code id="plot_metric_+3A_sidkey">sidkey</code></td>
<td>
<p>The unique prefix of biological samples. Default is <code>"X"</code>.</p>
</td></tr>
<tr><td><code id="plot_metric_+3A_numsplit">numsplit</code></td>
<td>
<p>The number of equal sized sections to divide metabolites into based on missing rate of pooled plasma columns. Divides the range of missing rates between <code>mincut</code> and <code>maxcut</code> into equal sections. Default is <code>5</code>.</p>
</td></tr>
<tr><td><code id="plot_metric_+3A_mincut">mincut</code></td>
<td>
<p>A cutoff to specify that any metabolite with pooled plasma missing rate less than or equal to this value should be retained. Default is <code>0.02</code>.</p>
</td></tr>
<tr><td><code id="plot_metric_+3A_maxcut">maxcut</code></td>
<td>
<p>A cutoff to specify that any metabolite with pooled plasma missing rate greater than this value should be removed. Default is <code>0.95</code>.</p>
</td></tr>
<tr><td><code id="plot_metric_+3A_scut">scut</code></td>
<td>
<p>The cutoff of missingness to consider a metabolite as having data present in a given biological sample block. Relevant only to <code><a href="#topic+run_metric">run_metric</a></code> computation. Default is <code>0.5</code>.</p>
</td></tr>
<tr><td><code id="plot_metric_+3A_cor_rates">cor_rates</code></td>
<td>
<p>A vector of length equal to <code>numsplit</code>. Each value represents the cutoff of the correlation metric in that section. Any metabolite with a value greater than or equal to the cutoff is deemed an artifact and anything less than the cutoff is deemed a true metabolite. If any value is set to NA, the correlation metric will not be considered for that group. Default is <code>c(.6, .65, .65, .65, .6)</code>.</p>
</td></tr>
<tr><td><code id="plot_metric_+3A_runlengths">runlengths</code></td>
<td>
<p>A vector of length equal to <code>numsplit</code>. Each values represents the cutoff for the longest run metric in that section. Any metabolite with a run greater than or equal to the cutoff is an artifact and anything less than the cutoff is a true metabolite. If any value is set to NA, the longest run metric will not be considered for that group. Default is <code>c(NA, 15, 15, 15, NA)</code>.</p>
</td></tr>
<tr><td><code id="plot_metric_+3A_histcolors">histcolors</code></td>
<td>
<p>A vector of length equal to <code>numsplit</code>. Each value represents the color to use for that group. If no color is provided, they will be colored white.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns histograms showing the correlation metric and longest run metric distributions for each group of the metabolites based on pooled plasma missing rate.</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+MetProc-package">MetProc-package</a></code> for examples of running the full process.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(MetProc)

#Read in metabolomics data
metdata &lt;- read.met(system.file("extdata/sampledata.csv", package="MetProc"),
headrow=3, metidcol=1, fvalue=8, sep=",", ppkey="PPP", ippkey="BPP")

#Plot distributions of the two metrics for each group
plot_metric(metdata,ppkey='PPP',sidkey='X',numsplit=5,mincut=0.02,maxcut=0.95,
scut=0.5,cor_rates=c(.6,.65,.65,.65,.6),runlengths=c(NA,15,15,15,NA),
histcolors=c('red','yellow','green','blue','purple'))
</code></pre>

<hr>
<h2 id='plot_pp_sample_missing'>Plot Pooled Plasma and Biological Sample Missing Rates</h2><span id='topic+plot_pp_sample_missing'></span>

<h3>Description</h3>

<p>Calculates the missing rate of the pooled plasma columns and biological sample columns for each metabolite. Plots a scatterplot showing the correspondence between the two.</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_pp_sample_missing(df, ppkey = "PPP", sidkey = "X")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_pp_sample_missing_+3A_df">df</code></td>
<td>
<p>The metabolomics dataset, ideally read from the <code><a href="#topic+read.met">read.met</a></code> function. Each column represents a sample and each row represents a metabolite. Columns should be labeled with some unique prefix denoting whether the column is from a biological sample or pooled plasma sample. For example, all pooled plasma samples may have columns identified by the prefix &ldquo;PPP&rdquo; and all biological samples may have columns identified by the prefix &ldquo;X&rdquo;. Missing data must be coded as NA. Columns must be ordered by injection order.</p>
</td></tr>
<tr><td><code id="plot_pp_sample_missing_+3A_ppkey">ppkey</code></td>
<td>
<p>The unique prefix of pooled plasma samples. Default is <code>"PPP"</code>.</p>
</td></tr>
<tr><td><code id="plot_pp_sample_missing_+3A_sidkey">sidkey</code></td>
<td>
<p>The unique prefix of biological samples. Default is <code>"X"</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a scatterplot comparing the pooled plasma missing rate to the sample missing rate</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+MetProc-package">MetProc-package</a></code> for examples of running the full process.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(MetProc)

#Read in metabolomics data
metdata &lt;- read.met(system.file("extdata/sampledata.csv", package="MetProc"),
headrow=3, metidcol=1, fvalue=8, sep=",", ppkey="PPP", ippkey="BPP")

#Plot the pooled plasma missing rate against the sample missing rate
plot_pp_sample_missing(metdata,ppkey='PPP',sidkey='X')
</code></pre>

<hr>
<h2 id='read.met'>Read in a Metabolomics Dataset of Standard Structure</h2><span id='topic+read.met'></span>

<h3>Description</h3>

<p>Read a metabolomics file. The file must be structured in a specific way. The columns of the file designate samples and the rows designate metabolites. The first n rows may contain any information. However, starting at row n+1 there must be a header line with column labels. The remaining rows are designated as one per metabolite. One column should contain the ID of each metabolite. Other columns can be included, but starting at some column, and continuously after this point, each sample or pooled plasma sample should be given its own column sorted by injection order. All pooled plasma columns should have a unique prefix differentiating them from biological samples. Up to 2 types of pooled plasma samples can be included in the file &ndash; each with a unique prefix. This may be useful when both a pooled plasma control generated from biological samples and a commercially available pooled plasma standard are used. All biological samples may have a designating prefix or simply lack a prefix designating pooled plasma samples. If no prefix designates the biological samples, a prefix of &ldquo;X&rdquo; will be used for biological samples in subsequent analysis. Missing data must be coded as NA.</p>


<h3>Usage</h3>

<pre><code class='language-R'>read.met(data, headrow = 3, metidcol=1, fvalue=8, sep=",", ppkey='PPP',
ippkey = 'BPP', sidkey="none")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="read.met_+3A_data">data</code></td>
<td>
<p>The metabolomics dataset file. The columns of the file designate samples and the rows designate metabolites. The first n rows can contain any information. However, starting at row n+1 there must be a header line with column labels. The remaining rows are designated as one per metabolite. One column should contain the ID of each metabolite. Other columns can be included, but starting at some column, and continuously after this point, each biological sample or pooled plasma sample should be given it's own column sorted by injection order. All pooled plasma columns should have a unique prefix differentiating them from samples. Up to 2 types of pooled plasma samples can be included in the file &ndash; each with a unique prefix. All biological samples may have a designated prefix or simply lack the the prefix designating pooled plasma samples. If no prefix designates the biological samples, a prefix of &ldquo;X&rdquo; will be used for biological samples in subsequent analysis. Missing data must be coded as NA. See file <code><a href="#topic+sampledata">sampledata</a></code> for an example.</p>
</td></tr>
<tr><td><code id="read.met_+3A_headrow">headrow</code></td>
<td>
<p>The row number that contains the header line. Default is <code>3</code>.</p>
</td></tr>
<tr><td><code id="read.met_+3A_metidcol">metidcol</code></td>
<td>
<p>The column number that contains the metabolite ID. Default is <code>1</code>.</p>
</td></tr>
<tr><td><code id="read.met_+3A_fvalue">fvalue</code></td>
<td>
<p>The column number where data begins. Default is <code>8</code>.</p>
</td></tr>
<tr><td><code id="read.met_+3A_sep">sep</code></td>
<td>
<p>File delimiter. Default is <code>","</code>.</p>
</td></tr>
<tr><td><code id="read.met_+3A_ppkey">ppkey</code></td>
<td>
<p>The unique prefix of biological sample-based pooled plasma columns. Default is <code>"PPP"</code>.</p>
</td></tr>
<tr><td><code id="read.met_+3A_ippkey">ippkey</code></td>
<td>
<p>The unique prefix of standard pooled plasma columns. Default is <code>"BPP"</code>.</p>
</td></tr>
<tr><td><code id="read.met_+3A_sidkey">sidkey</code></td>
<td>
<p>The unique prefix of biological samples in the csv file. If &lsquo;none&rsquo; provided as value, any column that does not contain the prefix of <code>ppkey</code> or <code>ippkey</code> will be considered a biological sample and given the prefix &lsquo;X&rsquo; for subsequent use. Default is <code>"none"</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A matrix with the metabolomics data fully loaded. Should have the number of rows equal to the number of metabolites and columns equal to the number of samples + pooled plasma samples.
</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+MetProc-package">MetProc-package</a></code> for examples of running the full process.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(MetProc)

#Read in metabolomics data
metdata &lt;- read.met(system.file("extdata/sampledata.csv", package="MetProc"),
headrow=3, metidcol=1, fvalue=8, sep=",", ppkey="PPP", ippkey="BPP")
</code></pre>

<hr>
<h2 id='run_metric'>Calculate Longest Run of Blocks where Data is Present</h2><span id='topic+run_metric'></span>

<h3>Description</h3>

<p>For each metabolite, data is split into blocks that consist of the preceding pooled plasma sample and following biological samples in an injection order. For each block, data is deemed present in biological samples if the missing rate is less than <code>scut</code>. An entire block is deemed to have data present if both the preceding pooled plasma and folllowing biolgical samples are both considered to have data present. The length of the longest consecutive run of blocks with data present is returned for each metabolite.</p>


<h3>Usage</h3>

<pre><code class='language-R'>run_metric(df, grps, scut = 0.5)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="run_metric_+3A_df">df</code></td>
<td>
<p>The metabolomics dataset, ideally read from the <code><a href="#topic+read.met">read.met</a></code> function. Each column represents a sample and each row represents a metabolite. Columns should be labeled with some unique prefix denoting whether the column is from a biological sample or pooled plasma sample. For example, all pooled plasma samples may have columns identified by the prefix &ldquo;PPP&rdquo; and all biological samples may have columns identified by the prefix &ldquo;X&rdquo;. Missing data must be coded as NA. Columns must be ordered by injection order.</p>
</td></tr>
<tr><td><code id="run_metric_+3A_grps">grps</code></td>
<td>
<p>A group list from the <code><a href="#topic+get_group">get_group</a></code> function</p>
</td></tr>
<tr><td><code id="run_metric_+3A_scut">scut</code></td>
<td>
<p>The cutoff missing rate to determine if data is present in a group of biological samples. If the missing rate of the biological samples is greater than or equal to this missing rate threshold, data will be considered absent from the block of biological samples. Default is <code>0.5</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a vector containing the longest consecutive run of blocks with data present for each metabolite</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+MetProc-package">MetProc-package</a></code> for examples of running the full process.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(MetProc)

#Read in metabolomics data
metdata &lt;- read.met(system.file("extdata/sampledata.csv", package="MetProc"),
headrow=3, metidcol=1, fvalue=8, sep=",", ppkey="PPP", ippkey="BPP")

#Get indices of pooled plasma and samples
grps &lt;- get_group(metdata,'PPP','X')

#Get the longest run metric for each metabolite
runs &lt;- run_metric(metdata,grps,scut=.5)
</code></pre>

<hr>
<h2 id='sampledata'>Simulated Metabolomics Data</h2><span id='topic+sampledata'></span>

<h3>Description</h3>

<p>This is a simulated dataset to show the format of the metabolomics data; patterns of missing data are generated roughly from a real metabolomics experiment. Rows represent metabolites and columns represent samples. The file contains 100 metabolites (rows) and 505 samples (480 biological sample columns and 25 pooled plasma columns) sorted by injection order. There are 20 biological samples between pooled plasma runs. Pooled plasma columns have prefix &lsquo;PPP&rsquo; and biological samples are simple integers with no prefix. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sampledata</code></pre>


<h3>Format</h3>

<p>The first row (Date) contains the date of processing. The second row (Inject) contains the injection number and is ordered from 1 to 505. The third row contains the column headers:<br /><br />
<code>Metab</code> is the metabolite ID.<br />
<code>Meth</code> is the type of metabolite.<br />
<code>HMDB</code> is the HMDB ID of the metabolite, if it exists.<br />
<code>m/z</code> is the mass-to-charge ratio of the metabolite.<br />
<code>rt</code> is the retention time.<br />
<code>Com</code> contains any comments.<br />
<code>ProcID</code> is the processing ID of the metabolite.<br /><br />
The remaining columns are either pooled plasma samples (prefix: &lsquo;PPP&rsquo;) or biological samples (prefix: No prefix). The basic structure of the csv file is as follows:<br />
</p>

<table>
<tr>
 <td style="text-align: left;">
     </td><td style="text-align: left;">  </td><td style="text-align: left;">  </td><td style="text-align: left;">  </td><td style="text-align: left;">  </td><td style="text-align: left;">  </td><td style="text-align: left;"> Date </td><td style="text-align: left;"> 415 </td><td style="text-align: left;"> 415 </td><td style="text-align: left;"> .. </td><td style="text-align: left;"> 415 </td><td style="text-align: left;"> 415 </td><td style="text-align: left;"> 415 </td><td style="text-align: left;"> ..</td>
</tr>
<tr>
 <td style="text-align: left;">
     </td><td style="text-align: left;">  </td><td style="text-align: left;">  </td><td style="text-align: left;">  </td><td style="text-align: left;">  </td><td style="text-align: left;">  </td><td style="text-align: left;"> Inject </td><td style="text-align: left;"> 1 </td><td style="text-align: left;"> 2 </td><td style="text-align: left;"> .. </td><td style="text-align: left;"> 21 </td><td style="text-align: left;"> 22 </td><td style="text-align: left;"> 23 </td><td style="text-align: left;"> ..</td>
</tr>
<tr>
 <td style="text-align: left;">
    Metab </td><td style="text-align: left;"> Meth </td><td style="text-align: left;"> HMDB </td><td style="text-align: left;"> m/z </td><td style="text-align: left;"> rt </td><td style="text-align: left;"> Com </td><td style="text-align: left;"> ProcID </td><td style="text-align: left;"> PPP1 </td><td style="text-align: left;"> 1 </td><td style="text-align: left;"> .. </td><td style="text-align: left;"> 20 </td><td style="text-align: left;"> PPP2 </td><td style="text-align: left;"> 21 </td><td style="text-align: left;"> ..</td>
</tr>
<tr>
 <td style="text-align: left;">
    M1 </td><td style="text-align: left;"> Lipid </td><td style="text-align: left;"> H1 </td><td style="text-align: left;"> 304 </td><td style="text-align: left;"> 8.7 </td><td style="text-align: left;">  </td><td style="text-align: left;"> 1 </td><td style="text-align: left;"> 6.7 </td><td style="text-align: left;"> 6.7 </td><td style="text-align: left;"> .. </td><td style="text-align: left;"> 5.0 </td><td style="text-align: left;"> 6.7 </td><td style="text-align: left;"> 4.6 </td><td style="text-align: left;"> ..</td>
</tr>
<tr>
 <td style="text-align: left;"> 
    M2 </td><td style="text-align: left;"> Lipid </td><td style="text-align: left;"> H2 </td><td style="text-align: left;"> 309 </td><td style="text-align: left;"> 7.6 </td><td style="text-align: left;">  </td><td style="text-align: left;"> 2 </td><td style="text-align: left;"> 1.0 </td><td style="text-align: left;"> 1.1 </td><td style="text-align: left;"> .. </td><td style="text-align: left;"> 1.1 </td><td style="text-align: left;"> 1.0 </td><td style="text-align: left;"> 1.2 </td><td style="text-align: left;"> ..</td>
</tr>
<tr>
 <td style="text-align: left;">
    .. </td><td style="text-align: left;"> .. </td><td style="text-align: left;"> .. </td><td style="text-align: left;"> .. </td><td style="text-align: left;"> .. </td><td style="text-align: left;"> .. </td><td style="text-align: left;"> .. </td><td style="text-align: left;"> .. </td><td style="text-align: left;"> .. </td><td style="text-align: left;"> .. </td><td style="text-align: left;"> .. </td><td style="text-align: left;"> .. </td><td style="text-align: left;"> .. </td><td style="text-align: left;"> .. </td>
</tr>
<tr>
 <td style="text-align: left;">
    M100 </td><td style="text-align: left;"> Lipid </td><td style="text-align: left;"> H100 </td><td style="text-align: left;"> 249 </td><td style="text-align: left;"> 6.2 </td><td style="text-align: left;">  </td><td style="text-align: left;"> 100 </td><td style="text-align: left;"> 2.4 </td><td style="text-align: left;"> 1.9 </td><td style="text-align: left;"> .. </td><td style="text-align: left;"> 2.2 </td><td style="text-align: left;"> 2.4 </td><td style="text-align: left;"> 1.6 </td><td style="text-align: left;"> ..</td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>



<h3>See Also</h3>

<p>See <code><a href="#topic+read.met">read.met</a></code> for example of reading this csv file for use.<br /> See <code><a href="#topic+MetProc-package">MetProc-package</a></code> for examples of running the full process.
</p>

<hr>
<h2 id='subset_met'>Group Metabolites based on Pooled Plasma Missing Rate</h2><span id='topic+subset_met'></span>

<h3>Description</h3>

<p>Separates metabolites into groups based on pooled plasma missing rates so that different thresholds of metrics can be applied to each group.</p>


<h3>Usage</h3>

<pre><code class='language-R'>subset_met(df, miss, numsplit = 5, mincut = 0.02, maxcut = 0.95)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="subset_met_+3A_df">df</code></td>
<td>
<p>The metabolomics dataset, ideally read from the <code><a href="#topic+read.met">read.met</a></code> function. Each column represents a sample and each row represents a metabolite. Columns should be labeled with some unique prefix denoting whether the column is from a biological sample or pooled plasma sample. For example, all pooled plasma samples may have columns identified by the prefix &ldquo;PPP&rdquo; and all biological samples may have columns identified by the prefix &ldquo;X&rdquo;. Missing data must be coded as NA. Columns must be ordered by injection order.</p>
</td></tr>
<tr><td><code id="subset_met_+3A_miss">miss</code></td>
<td>
<p>Vector of missing rates of equal length to number of rows in <code>df</code> representing the pooled plasma missing rate for each metabolite.</p>
</td></tr>
<tr><td><code id="subset_met_+3A_numsplit">numsplit</code></td>
<td>
<p>The number of equal sized sections to divide metabolites into based on missing rate of pooled plasma columns. Divides the range of missing rates between <code>mincut</code> and <code>maxcut</code> into equal sections. Default is <code>5</code>.</p>
</td></tr>
<tr><td><code id="subset_met_+3A_mincut">mincut</code></td>
<td>
<p>A cutoff to specify that any metabolite with pooled plasma missing rate less than or equal to this value should be retained. Default is <code>0.02</code>.</p>
</td></tr>
<tr><td><code id="subset_met_+3A_maxcut">maxcut</code></td>
<td>
<p>A cutoff to specify that any metabolite with pooled plasma missing rate greater than this values should be removed. Default is <code>0.95</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list consisting of a number of elements equal to <code>numsplit</code>. Each element contains a matrix of the given metabolite group based on the pooled plasma missing rate. The list keys are simple integers corresponding to the split number.</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+MetProc-package">MetProc-package</a></code> for examples of running the full process.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(MetProc)

#Read in metabolomics data
metdata &lt;- read.met(system.file("extdata/sampledata.csv", package="MetProc"),
headrow=3, metidcol=1, fvalue=8, sep=",", ppkey="PPP", ippkey="BPP")

#Get indices of pooled plasma and samples
groups &lt;- get_group(metdata,"PPP","X")

#Calculate a pooled plasma missing rate and sample missing rate
#for each metabolite in data
missrate &lt;- get_missing(metdata,groups[['pp']],groups[['sid']])

#Group metabolites into 5 groups based on pooled plasma
#missing rate
subsets &lt;- subset_met(metdata,missrate[['ppmiss']],5,.02,.95)
</code></pre>

<hr>
<h2 id='write.met'>Write Metabolomics Dataset of Standard Structure</h2><span id='topic+write.met'></span>

<h3>Description</h3>

<p>Write a metabolomics file based on the metabolites identified to be retained or removed using <code><a href="#topic+met_proc">met_proc</a></code>. Requires the filepath for the original metabolomics file in order to extract row and column information. Will take in this original file and the results of the <code><a href="#topic+met_proc">met_proc</a></code> function to write a file that contains only the retained or removed metabolites.</p>


<h3>Usage</h3>

<pre><code class='language-R'>write.met(res, filename, origfile, headrow = 3, metidcol=1, fvalue=8, 
sep=",", type="keep")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="write.met_+3A_res">res</code></td>
<td>
<p>The result output from <code><a href="#topic+met_proc">met_proc</a></code> function.</p>
</td></tr>
<tr><td><code id="write.met_+3A_filename">filename</code></td>
<td>
<p>The name and path for new metabolomics file.</p>
</td></tr>
<tr><td><code id="write.met_+3A_origfile">origfile</code></td>
<td>
<p>The name and path for the original metabolomics file.</p>
</td></tr>
<tr><td><code id="write.met_+3A_headrow">headrow</code></td>
<td>
<p>The row number that contains the header line in the original metabolomics file. Default is <code>3</code>.</p>
</td></tr>
<tr><td><code id="write.met_+3A_metidcol">metidcol</code></td>
<td>
<p>The column number that contains the metabolite ID in the original metabolomics file. Default is <code>1</code>.</p>
</td></tr>
<tr><td><code id="write.met_+3A_fvalue">fvalue</code></td>
<td>
<p>The column number where data begins in the original metabolomics file. Default is <code>8</code>.</p>
</td></tr>
<tr><td><code id="write.met_+3A_sep">sep</code></td>
<td>
<p>File delimiter for both the original metabolomics file and the new file. Default is <code>","</code>.</p>
</td></tr>
<tr><td><code id="write.met_+3A_type">type</code></td>
<td>
<p>Either &lsquo;keep&rsquo; or &lsquo;remove&rsquo; to determine whether the retained metabolites or removed metabolites should be written to the file. Default is <code>"keep"</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Writes a file to <code>filename</code> that is of the same structure as the original metabolomics file but only containing either the retained or removed metabolites.
</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+MetProc-package">MetProc-package</a></code> for examples of running the full process.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(MetProc)
#Read in metabolomics data
metdata &lt;- read.met(system.file("extdata/sampledata.csv", package="MetProc"),
headrow=3, metidcol=1, fvalue=8, sep=",", ppkey="PPP", ippkey="BPP")

#Separate likely artifacts from true signal using default settings
results &lt;- met_proc(metdata,plot=FALSE)

#Write the retained metabolites to current directory
write.met(results,'sample_retained.csv',
system.file("extdata/sampledata.csv", package="MetProc"),
headrow=3,metidcol=1,fvalue=8,sep=",",type='keep')
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
