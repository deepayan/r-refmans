<!DOCTYPE html><html lang="en"><head><title>Help for package connectcreds</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {connectcreds}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#connectcreds-package'><p>connectcreds: Manage 'OAuth' Credentials from 'Posit Connect'</p></a></li>
<li><a href='#connect_viewer_token'><p>Viewer-based credentials on Posit Connect</p></a></li>
<li><a href='#with_mocked_connect_responses'><p>Mock responses from the Posit Connect server</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Manage 'OAuth' Credentials from 'Posit Connect'</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.0</td>
</tr>
<tr>
<td>Description:</td>
<td>A toolkit for making use of credentials mediated by 'Posit
  Connect'. It handles the details of communicating with the Connect API
  correctly, 'OAuth' token caching, and refresh behaviour.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Imports:</td>
<td>cli, httr2 (&ge; 1.1.0), rlang (&ge; 1.1.0)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat (&ge; 3.0.0), withr</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/posit-dev/connectcreds">https://github.com/posit-dev/connectcreds</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/posit-dev/connectcreds/issues">https://github.com/posit-dev/connectcreds/issues</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-01-30 02:24:37 UTC; aaron</td>
</tr>
<tr>
<td>Author:</td>
<td>Aaron Jacobs [aut, cre],
  Posit Software, PBC [cph, fnd]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Aaron Jacobs &lt;aaron.jacobs@posit.co&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-01-31 11:00:11 UTC</td>
</tr>
</table>
<hr>
<h2 id='connectcreds-package'>connectcreds: Manage 'OAuth' Credentials from 'Posit Connect'</h2><span id='topic+connectcreds'></span><span id='topic+connectcreds-package'></span>

<h3>Description</h3>

<p>A toolkit for making use of credentials mediated by 'Posit Connect'. It handles the details of communicating with the Connect API correctly, 'OAuth' token caching, and refresh behaviour.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Aaron Jacobs <a href="mailto:aaron.jacobs@posit.co">aaron.jacobs@posit.co</a>
</p>
<p>Other contributors:
</p>

<ul>
<li><p> Posit Software, PBC [copyright holder, funder]
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://github.com/posit-dev/connectcreds">https://github.com/posit-dev/connectcreds</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/posit-dev/connectcreds/issues">https://github.com/posit-dev/connectcreds/issues</a>
</p>
</li></ul>


<hr>
<h2 id='connect_viewer_token'>Viewer-based credentials on Posit Connect</h2><span id='topic+connect_viewer_token'></span><span id='topic+has_viewer_token'></span>

<h3>Description</h3>

<p>Request an OAuth access token for a third-party resource belonging to the
user associated with a given Shiny session. This works by exchanging a
short-lived session credential for OAuth tokens issued to the client managed
by the Connect server, without the Shiny app in question having to manage the
user's authentication flow (or the associated client credentials) itself.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>connect_viewer_token(
  resource = NULL,
  scope = NULL,
  session = get_connect_session(),
  server_url = Sys.getenv("CONNECT_SERVER"),
  api_key = Sys.getenv("CONNECT_API_KEY")
)

has_viewer_token(..., session = get_connect_session())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="connect_viewer_token_+3A_resource">resource</code></td>
<td>
<p>The URI that identifies the resource that the client is
trying to access, if applicable.</p>
</td></tr>
<tr><td><code id="connect_viewer_token_+3A_scope">scope</code></td>
<td>
<p>Scopes to be requested from the resource owner.</p>
</td></tr>
<tr><td><code id="connect_viewer_token_+3A_session">session</code></td>
<td>
<p>A Shiny session object. By default, this grabs the Shiny
session of the parent environment (if any), provided we are also running on
Connect.</p>
</td></tr>
<tr><td><code id="connect_viewer_token_+3A_server_url">server_url</code></td>
<td>
<p>The Connect server to exchange credentials with. Defaults
to the value of the <code>CONNECT_SERVER</code> environment variable, which is set
automatically when running on Connect.</p>
</td></tr>
<tr><td><code id="connect_viewer_token_+3A_api_key">api_key</code></td>
<td>
<p>An API key for the Connect server. Defaults to the value of
the <code>CONNECT_API_KEY</code> environment variable, which is set automatically when
running on Connect.</p>
</td></tr>
<tr><td><code id="connect_viewer_token_+3A_...">...</code></td>
<td>
<p>Further arguments passed on to <code><a href="#topic+connect_viewer_token">connect_viewer_token()</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>connect_viewer_token()</code> handles caching automatically.
</p>


<h3>Value</h3>

<p><code><a href="#topic+connect_viewer_token">connect_viewer_token()</a></code> returns an <a href="httr2.html#topic+oauth_token">httr2::oauth_token</a>.
</p>
<p><code><a href="#topic+has_viewer_token">has_viewer_token()</a></code> returns <code>TRUE</code> if the session has a viewer
token and <code>FALSE</code> otherwise.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>token &lt;- "default-token"
if (has_viewer_token()) {
  token &lt;- connect_viewer_token()
}
</code></pre>

<hr>
<h2 id='with_mocked_connect_responses'>Mock responses from the Posit Connect server</h2><span id='topic+with_mocked_connect_responses'></span><span id='topic+local_mocked_connect_responses'></span>

<h3>Description</h3>

<p>These functions can be used to temporarily mock responses from the Connect
server, which is useful for writing tests that verify the behaviour of
viewer-based credentials.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>with_mocked_connect_responses(
  code,
  mock = NULL,
  token = NULL,
  error = FALSE,
  env = caller_env()
)

local_mocked_connect_responses(
  mock = NULL,
  token = NULL,
  error = FALSE,
  env = caller_env()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="with_mocked_connect_responses_+3A_code">code</code></td>
<td>
<p>Code to execute in the temporary environment.</p>
</td></tr>
<tr><td><code id="with_mocked_connect_responses_+3A_mock">mock</code></td>
<td>
<p>A function, a list, or <code>NULL</code>.
</p>

<ul>
<li> <p><code>NULL</code> disables mocking and returns httr2 to regular operation.
</p>
</li>
<li><p> A list of responses will be returned in sequence. After all responses
have been used up, will return 503 server errors.
</p>
</li>
<li><p> For maximum flexibility, you can supply a function that that takes a
single argument, <code>req</code>, and returns either <code>NULL</code> (if it doesn't want to
handle the request) or a <a href="httr2.html#topic+response">response</a> (if it does).
</p>
</li></ul>
</td></tr>
<tr><td><code id="with_mocked_connect_responses_+3A_token">token</code></td>
<td>
<p>When not <code>NULL</code>, return this token from the Connect server.</p>
</td></tr>
<tr><td><code id="with_mocked_connect_responses_+3A_error">error</code></td>
<td>
<p>When <code>TRUE</code>, return an error from the Connect server.</p>
</td></tr>
<tr><td><code id="with_mocked_connect_responses_+3A_env">env</code></td>
<td>
<p>Environment to use for scoping changes.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code><a href="#topic+with_mocked_connect_responses">with_mocked_connect_responses()</a></code> returns the result of evaluating
<code>code</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>with_mocked_connect_responses(
  connect_viewer_token(),
  token = "test"
)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
