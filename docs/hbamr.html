<!DOCTYPE html><html><head><title>Help for package hbamr</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {hbamr}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#fbam'><p>Fit an FBAM model using optimization</p></a></li>
<li><a href='#get_est'><p>Extract point estimates or other summaries of marginal posterior distributions</p></a></li>
<li><a href='#get_plot_data'><p>Extract data for plotting results from an HBAM model.</p></a></li>
<li><a href='#hbam'><p>Fit an HBAM model</p></a></li>
<li><a href='#hbam_cv'><p>Perform K-fold cross-validation</p></a></li>
<li><a href='#hbamr-package'><p>Hierarchical Bayesian Aldrich-McKelvey Scaling via Stan</p></a></li>
<li><a href='#LC1980'><p>1980 Liberal-Conservative Scales</p></a></li>
<li><a href='#LC2012'><p>2012 Liberal-Conservative Scales</p></a></li>
<li><a href='#plot_by_group'><p>Plot posterior densities of parameter averages by group</p></a></li>
<li><a href='#plot_over_self'><p>Plot individual parameter estimates over self-placements</p></a></li>
<li><a href='#plot_respondents'><p>Plot estimated respondent positions</p></a></li>
<li><a href='#plot_stimuli'><p>Plot estimated stimulus positions</p></a></li>
<li><a href='#prep_data'><p>Prepare data to fit an HBAM or FBAM model</p></a></li>
<li><a href='#prep_data_cv'><p>Prepare data for a K-fold cross-validation of an HBAM model</p></a></li>
<li><a href='#show_code'><p>Show the code for an HBAM or FBAM model</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Hierarchical Bayesian Aldrich-McKelvey Scaling via 'Stan'</td>
</tr>
<tr>
<td>Version:</td>
<td>2.2.1</td>
</tr>
<tr>
<td>Description:</td>
<td>Perform hierarchical Bayesian Aldrich-McKelvey scaling using Hamiltonian Monte
    Carlo via 'Stan'. Aldrich-McKelvey ('AM') scaling is a method for estimating the ideological 
    positions of survey respondents and political actors on a common scale using positional survey 
    data. The hierarchical versions of the Bayesian 'AM' model included in this package outperform 
    other versions both in terms of yielding meaningful posterior distributions for respondent 
    positions and in terms of recovering true respondent positions in simulations. The package 
    contains functions for preparing data, fitting models, extracting estimates, plotting key 
    results, and comparing models using cross-validation. The original version of the default 
    model is described in Bølstad (2024) &lt;<a href="https://doi.org/10.1017%2Fpan.2023.18">doi:10.1017/pan.2023.18</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://jbolstad.github.io/hbamr/">https://jbolstad.github.io/hbamr/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/jbolstad/hbamr/issues">https://github.com/jbolstad/hbamr/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.4.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>dplyr, future, future.apply, ggplot2, loo, matrixStats,
methods, parallel, plyr, progressr, RColorBrewer, Rcpp (&ge;
1.0.7), RcppParallel (&ge; 5.1.4), rlang, rstan (&ge; 2.26.1),
rstantools (&ge; 2.2.0), stats, tidyr</td>
</tr>
<tr>
<td>Suggests:</td>
<td>data.table, knitr, rmarkdown</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>BH (&ge; 1.66.0), Rcpp (&ge; 1.0.7), RcppEigen (&ge; 0.3.3.9.1),
RcppParallel (&ge; 5.1.4), rstan (&ge; 2.26.1), StanHeaders (&ge;
2.26.22)</td>
</tr>
<tr>
<td>Biarch:</td>
<td>true</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>SystemRequirements:</td>
<td>GNU make</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-02-23 11:53:34 UTC; boelstad</td>
</tr>
<tr>
<td>Author:</td>
<td>Jørgen Bølstad <a href="https://orcid.org/0000-0002-7623-5741"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Jørgen Bølstad &lt;jorgen.bolstad@stv.uio.no&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-02-23 12:30:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='fbam'>Fit an FBAM model using optimization</h2><span id='topic+fbam'></span>

<h3>Description</h3>

<p>Fit a simplified Bayesian Aldrich-McKelvey model with fixed hyperparameters using optimization via <code>rstan</code>. Users may replace the default priors by supplying their own values for the hyperparameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fbam(
  self = NULL,
  stimuli = NULL,
  model = "FBAM_MINI",
  allow_miss = 2,
  req_valid = NA,
  req_unique = 2,
  group_id = NULL,
  data = NULL,
  seed = sample.int(.Machine$integer.max, 1),
  sigma_alpha = NULL,
  sigma_beta = 0.35,
  sigma_mu_alpha = NULL,
  sigma_mu_beta = 0.2,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fbam_+3A_self">self</code></td>
<td>
<p>An optional numerical vector of N ideological self-placements. Any missing data must be coded as NA. If this argument is not supplied (either here or in a previous call to <code>prep_data()</code>), respondent positions will not be estimated. If the data have been prepared in advance via the <code>prep_data()</code> function, the argument supplied here will be ignored.</p>
</td></tr>
<tr><td><code id="fbam_+3A_stimuli">stimuli</code></td>
<td>
<p>An N × J matrix of numerical stimulus placements, where J is the number of stimuli. Any missing data must be coded as NA. This argument will not be used if the data have been prepared in advance via the <code>prep_data()</code> function.</p>
</td></tr>
<tr><td><code id="fbam_+3A_model">model</code></td>
<td>
<p>Character: Name of the model to be used. Defaults to FBAM_MINI. The available options are the three models with &quot;FBAM&quot; in their name. See the documentation for the <code>hbam()</code> function for descriptions of the models.</p>
</td></tr>
<tr><td><code id="fbam_+3A_allow_miss">allow_miss</code></td>
<td>
<p>Integer specifying how many missing stimulus positions to be accepted for an individual still to be included in the analysis. This argument will not be used if the data have been prepared in advance via the <code>prep_data()</code> function. Defaults to 2.</p>
</td></tr>
<tr><td><code id="fbam_+3A_req_valid">req_valid</code></td>
<td>
<p>Integer specifying how many valid observations to require for a respondent to be included in the analysis. The default is <code>req_valid = J - allow_miss</code>, but if specified, <code>req_valid</code> takes precedence. This argument will not be used if the data have been prepared in advance via the <code>prep_data()</code> function.</p>
</td></tr>
<tr><td><code id="fbam_+3A_req_unique">req_unique</code></td>
<td>
<p>Integer specifying how may unique positions on the ideological scale each respondent is required to have used when placing the stimuli in order to be included in the analysis. The default is <code>req_unique = 2</code>. This argument will not be used if the data have been prepared in advance via the <code>prep_data()</code> function.</p>
</td></tr>
<tr><td><code id="fbam_+3A_group_id">group_id</code></td>
<td>
<p>Vector of length N identifying which group each respondent belongs to. The format can be factor, character, integer, or numeric. Respondents with NAs on <code>group_id</code> will be dropped when <code>group_id</code> is supplied. These data are only required by models with <code>"MULTI"</code> in their name and will be ignored when fitting other models.</p>
</td></tr>
<tr><td><code id="fbam_+3A_data">data</code></td>
<td>
<p>List of data that have been prepared in advance via the <code>prep_data()</code> function. Not required if the arguments <code>self</code> and <code>stimuli</code> are provided.</p>
</td></tr>
<tr><td><code id="fbam_+3A_seed">seed</code></td>
<td>
<p>A positive integer specifying an optional seed for reproducibility. If this argument is not supplied, a random seed will be generated and the function will produce slightly different results on each run.</p>
</td></tr>
<tr><td><code id="fbam_+3A_sigma_alpha">sigma_alpha</code></td>
<td>
<p>A positive numeric value specifying the standard deviation of the prior on the shift parameters in the FBAM_MINI model, or the standard deviation of the parameters' deviation from the group-means in FBAM_MULTI models. (This argument will be ignored by HBAM models.) Defaults to B / 4, where B measures the length of the survey scale as the number of possible placements on one side of the center.</p>
</td></tr>
<tr><td><code id="fbam_+3A_sigma_beta">sigma_beta</code></td>
<td>
<p>A positive numeric value specifying the standard deviation of the prior on the logged stretch parameters in the FBAM_MINI model, or the standard deviation of the logged parameters' deviation from the group-means in FBAM_MULTI models. (This argument will be ignored by HBAM models.) Defaults to .35.</p>
</td></tr>
<tr><td><code id="fbam_+3A_sigma_mu_alpha">sigma_mu_alpha</code></td>
<td>
<p>A positive numeric value specifying the standard deviation of the prior on the group-means of the shift parameters in MULTI-type models. Defaults to B / 10.</p>
</td></tr>
<tr><td><code id="fbam_+3A_sigma_mu_beta">sigma_mu_beta</code></td>
<td>
<p>A positive numeric value specifying the standard deviation of the prior on the group-means of the logged stretch parameters in MULTI-type models. Defaults to .2.</p>
</td></tr>
<tr><td><code id="fbam_+3A_...">...</code></td>
<td>
<p>Arguments passed to <code>rstan::optimizing()</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list produced by <code>rstan::optimizing()</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Loading ANES 2012 data:
data(LC2012)

self &lt;- LC2012[, 2]
stimuli &lt;- LC2012[, -c(1:2)]

# Fitting the FBAM_MINI model:
fit_fbam_mini &lt;- fbam(self, stimuli)

# Obtaining point estimates for the latent stimulus positions:
theta_est &lt;- get_est(fit_fbam_mini, par = "theta")

</code></pre>

<hr>
<h2 id='get_est'>Extract point estimates or other summaries of marginal posterior distributions</h2><span id='topic+get_est'></span>

<h3>Description</h3>

<p>For objects produced by <code>hbam()</code>, this function is a wrapper for <code>rstan::summary()</code>. For objects produced by <code>fbam()</code> it offers a way to extract point estimates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_est(
  object,
  par = "theta",
  format_orig = FALSE,
  probs = c(0.025, 0.5, 0.975),
  simplify = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_est_+3A_object">object</code></td>
<td>
<p>An instance of class <code>stanfit</code> produced by <code>hbam()</code>, or a list produced by <code>fbam()</code>.</p>
</td></tr>
<tr><td><code id="get_est_+3A_par">par</code></td>
<td>
<p>Character: Name of the parameter type to be extracted. Typically <code>"theta"</code> (stimuli positions) or <code>"chi"</code> (respondent positions).</p>
</td></tr>
<tr><td><code id="get_est_+3A_format_orig">format_orig</code></td>
<td>
<p>Logical: Should individual-level parameters be mapped to the original dataset by returning rows of NAs for respondents who were not included in the analysis? Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="get_est_+3A_probs">probs</code></td>
<td>
<p>A numeric vector of quantiles of interest for summarizing <code>stanfit</code> objects.</p>
</td></tr>
<tr><td><code id="get_est_+3A_simplify">simplify</code></td>
<td>
<p>Logical: Should the returned object be simplified by dropping the Monte Carlo standard error and the posterior standard deviation? Defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="get_est_+3A_...">...</code></td>
<td>
<p>Other arguments are passed on to <code>rstan::summary()</code> when summarizing <code>stanfit</code> objects.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A tibble containing summaries of marginal posterior distributions. For objects produced by <code>fbam()</code>, only maximum a posteriori estimates are returned.
</p>

<hr>
<h2 id='get_plot_data'>Extract data for plotting results from an HBAM model.</h2><span id='topic+get_plot_data'></span>

<h3>Description</h3>

<p>Extract data for plotting results from an HBAM model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_plot_data(object, n_draws = 15, seed = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_plot_data_+3A_object">object</code></td>
<td>
<p>An instance of class <code>stanfit</code> produced by <code>hbam()</code> or a list produced by <code>fbam()</code>.</p>
</td></tr>
<tr><td><code id="get_plot_data_+3A_n_draws">n_draws</code></td>
<td>
<p>Integer specifying the number of posterior draws to use when illustrating the uncertainty of the population distribution. This only applies for <code>stanfit</code> objects.</p>
</td></tr>
<tr><td><code id="get_plot_data_+3A_seed">seed</code></td>
<td>
<p>A positive integer specifying an optional seed for reproducibility. The seed is used to select respondent position draws for illustrating uncertainty. This only applies for <code>stanfit</code> objects.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of three <code>tibble</code>s: The first element contains the posterior mean stimulus positions, as well as the x- and y-values of the posterior modes (which can be useful for labeling the distributions). The second element contains the posterior draws for the stimulus positions (which can be used to calculate marginal posterior densities). The third element contains the selected number of posterior draws for each respondent (which form the key ingredient for <code>plot_respondents</code>).
</p>

<hr>
<h2 id='hbam'>Fit an HBAM model</h2><span id='topic+hbam'></span>

<h3>Description</h3>

<p>Fit a Hierarchical Bayesian Aldrich-McKelvey model using automatically tuned Hamiltonian Monte Carlo sampling (NUTS) via <code>rstan</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>hbam(
  self = NULL,
  stimuli = NULL,
  model = "HBAM",
  allow_miss = 2,
  req_valid = NA,
  req_unique = 2,
  prefs = NULL,
  group_id = NULL,
  data = NULL,
  pars = c("alpha", "beta", "chi", "lambda", "theta"),
  extra_pars = NULL,
  include = TRUE,
  chains = 4,
  cores = parallel::detectCores(logical = FALSE),
  warmup = 1000,
  iter = 2000,
  seed = sample.int(.Machine$integer.max, 1),
  sigma_alpha = NULL,
  sigma_beta = 0.35,
  sigma_mu_alpha = NULL,
  sigma_mu_beta = 0.2,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="hbam_+3A_self">self</code></td>
<td>
<p>An optional numerical vector of N ideological self-placements. Any missing data must be coded as NA. If this argument is not supplied (either here or in a previous call to <code>prep_data()</code>), respondent positions will not be estimated. If the data have been prepared in advance via the <code>prep_data()</code> function, the argument supplied here will be ignored.</p>
</td></tr>
<tr><td><code id="hbam_+3A_stimuli">stimuli</code></td>
<td>
<p>An N × J matrix of numerical stimulus placements, where J is the number of stimuli. Any missing data must be coded as NA. This argument will not be used if the data have been prepared in advance via the <code>prep_data()</code> function.</p>
</td></tr>
<tr><td><code id="hbam_+3A_model">model</code></td>
<td>
<p>Character: Name of the model to be used. Defaults to HBAM. The available models are described under Details.</p>
</td></tr>
<tr><td><code id="hbam_+3A_allow_miss">allow_miss</code></td>
<td>
<p>Integer specifying how many missing stimulus positions to be accepted for an individual still to be included in the analysis. This argument will not be used if the data have been prepared in advance via the <code>prep_data()</code> function. Defaults to 2.</p>
</td></tr>
<tr><td><code id="hbam_+3A_req_valid">req_valid</code></td>
<td>
<p>Integer specifying how many valid observations to require for a respondent to be included in the analysis. The default is <code>req_valid = J - allow_miss</code>, but if specified, <code>req_valid</code> takes precedence. This argument will not be used if the data have been prepared in advance via the <code>prep_data()</code> function.</p>
</td></tr>
<tr><td><code id="hbam_+3A_req_unique">req_unique</code></td>
<td>
<p>Integer specifying how may unique positions on the ideological scale each respondent is required to have used when placing the stimuli in order to be included in the analysis. The default is <code>req_unique = 2</code>. This argument will not be used if the data have been prepared in advance via the <code>prep_data()</code> function.</p>
</td></tr>
<tr><td><code id="hbam_+3A_prefs">prefs</code></td>
<td>
<p>An N × J matrix of numerical stimulus ratings or preference scores. These data are only required by the HBAM_R_MINI model and will be ignored when fitting other models.</p>
</td></tr>
<tr><td><code id="hbam_+3A_group_id">group_id</code></td>
<td>
<p>Vector of length N identifying which group each respondent belongs to. The format can be factor, character, integer, or numeric. Respondents with NAs on <code>group_id</code> will be dropped when <code>group_id</code> is supplied. These data are only required by models with <code>"MULTI"</code> in their name and will be ignored when fitting other models.</p>
</td></tr>
<tr><td><code id="hbam_+3A_data">data</code></td>
<td>
<p>List of data that have been prepared in advance via the <code>prep_data()</code> function. Not required if the arguments <code>self</code> and <code>stimuli</code> are provided.</p>
</td></tr>
<tr><td><code id="hbam_+3A_pars">pars</code></td>
<td>
<p>A vector of character strings specifying parameters of interest. If <code>include = TRUE</code>, only samples for parameters named in pars are stored in the fitted results. Conversely, if <code>include = FALSE</code>, samples for all parameters except those named in pars are stored in the fitted results. The default is to store results for &quot;alpha&quot;, &quot;beta&quot;, &quot;chi&quot;, &quot;lambda&quot;, and &quot;theta&quot;.</p>
</td></tr>
<tr><td><code id="hbam_+3A_extra_pars">extra_pars</code></td>
<td>
<p>A vector of character strings specifying parameters to be added to <code>pars</code>. This makes it easy to add one or several additional parameters of interest, without having to repeat the default <code>pars</code> vector. The default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="hbam_+3A_include">include</code></td>
<td>
<p>Logical scalar defaulting to <code>TRUE</code> indicating whether to include or exclude the parameters given by the pars argument. If <code>FALSE</code>, only entire multidimensional parameters can be excluded, rather than particular elements of them.</p>
</td></tr>
<tr><td><code id="hbam_+3A_chains">chains</code></td>
<td>
<p>A positive integer specifying the number of Markov chains. Defaults to 4.</p>
</td></tr>
<tr><td><code id="hbam_+3A_cores">cores</code></td>
<td>
<p>The number of cores to use when executing the Markov chains in parallel. By default, all detected physical cores will be used if <code>chains</code> is equal to or higher than the number of cores.</p>
</td></tr>
<tr><td><code id="hbam_+3A_warmup">warmup</code></td>
<td>
<p>A positive integer specifying the number of warmup (aka burn-in) iterations per chain. If step-size adaptation is on (which it is by default), this also controls the number of iterations for which adaptation is run (and hence these warmup samples should not be used for inference). The number of warmup iterations should be smaller than <code>iter</code>.</p>
</td></tr>
<tr><td><code id="hbam_+3A_iter">iter</code></td>
<td>
<p>A positive integer specifying the number of iterations for each chain (including warmup).</p>
</td></tr>
<tr><td><code id="hbam_+3A_seed">seed</code></td>
<td>
<p>A positive integer specifying an optional seed for reproducibility. If this argument is not supplied, a random seed will be generated and the function will produce slightly different results on each run.</p>
</td></tr>
<tr><td><code id="hbam_+3A_sigma_alpha">sigma_alpha</code></td>
<td>
<p>A positive numeric value specifying the standard deviation of the prior on the shift parameters in the FBAM_MINI model, or the standard deviation of the parameters' deviation from the group-means in FBAM_MULTI models. (This argument will be ignored by HBAM models.) Defaults to B / 4, where B measures the length of the survey scale as the number of possible placements on one side of the center.</p>
</td></tr>
<tr><td><code id="hbam_+3A_sigma_beta">sigma_beta</code></td>
<td>
<p>A positive numeric value specifying the standard deviation of the prior on the logged stretch parameters in the FBAM_MINI model, or the standard deviation of the logged parameters' deviation from the group-means in FBAM_MULTI models. (This argument will be ignored by HBAM models.) Defaults to .35.</p>
</td></tr>
<tr><td><code id="hbam_+3A_sigma_mu_alpha">sigma_mu_alpha</code></td>
<td>
<p>A positive numeric value specifying the standard deviation of the prior on the group-means of the shift parameters in MULTI-type models. Defaults to B / 10.</p>
</td></tr>
<tr><td><code id="hbam_+3A_sigma_mu_beta">sigma_mu_beta</code></td>
<td>
<p>A positive numeric value specifying the standard deviation of the prior on the group-means of the logged stretch parameters in MULTI-type models. Defaults to .2.</p>
</td></tr>
<tr><td><code id="hbam_+3A_...">...</code></td>
<td>
<p>Arguments passed to <code>rstan::sampling()</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This package provides several alternative models that can be selected using the names below. Users who are unsure which model to use are advised to use the default HBAM model. If speed or sampling diagnostics are an issue, HBAM_MINI may provide a useful alternative.
</p>
<p><strong>HBAM</strong> is the default model, which allows for scale flipping and employs hierarchical priors on the shift and stretch parameters. It also models heteroskedastic errors that vary by both individual and stimuli. Compared to the model in Bølstad (2024), this version has been slightly revised to provide faster sampling. A key difference from the original model is that the respondent positions are not treated as parameters, but rather calculated as a function of self-placements, individual-level parameters, and simulated errors. This makes the model considerably faster, while yielding very similar results. The model simulates errors in the self-placements of the same magnitude as that with which the respondent in question places the stimulus with the smallest errors. All models in the package use this approach.
</p>
<p><strong>HBAM_MULTI</strong> is a version that models differences between groups defined by the user. It requires a vector identifying the groups to be supplied as the argument <code>group_id</code>. The model gives each group separate hyperparameters for the locations of the prior distributions for the shift and stretch parameters. Rather than shrinking the estimates toward the mode for the whole dataset, this model shrinks the estimates toward the mode for the group. The vectors of hyperparameters are called <code>mu_alpha</code> and <code>mu_beta</code> and are constructed to have means of 0. The scales of the priors on these hyperparameters can be set by the user via the arguments <code>sigma_mu_alpha</code> and <code>sigma_mu_beta</code>. The default values are B / 10 and .2, respectively. (Here, B measures the length of the survey scale as the number of possible placements on one side of the center.) One potential use for this model is to supply self-placements as <code>group_id</code>, and thus give each self-placement group its own prior distribution for the shift and stretch parameters.
</p>
<p><strong>HBAM_NF</strong> (formerly HBAM_0) is a version of the HBAM model that does not allow for scale flipping. This may be useful if there are truly zero cases of scale flipping in the data. Such scenarios can be created artificially, but may also arise in real data. For example, expert surveys appear unlikely to contain many instances of scale flipping. For data that contain zero cases of flipping, models that allow for flipping contain superfluous parameters that lead to inefficient sampling. Models that do not allow for flipping will sample faster and typically yield slightly more accurate estimates. Such models are therefore usually preferable when no flipping is present.
</p>
<p><strong>HBAM_MULTI_NF</strong> is a version of the HBAM_MULTI model that does not allow for scale flipping.
</p>
<p><strong>HBAM_MINI</strong> is a version of the HBAM model that assumes the prediction errors in the stimuli placements to be homoskedastic. This model tends to sample faster faster than the standard HBAM model while yielding very similar point estimates. For large datasets, this model may provide a reasonable compromise between model complexity and estimation speed.
</p>
<p><strong>FBAM_MINI</strong> is a version of the HBAM_MINI model with fixed hyperparameters to allow fitting via optimization rather than MCMC &ndash; which can be useful for large data sets. This model allows the user to specify the scales of the priors for the shift and (logged) stretch parameters via the arguments <code>sigma_alpha</code> and <code>sigma_beta</code>. The default values are B / 4 and .35, respectively. These defaults are intended to be realistic and weakly informative. Users who want to control the degree of shrinkage of the individual-level parameters may find it useful to fit this model &ndash; or other FBAM models &ndash; via either MCMC or optimization.
</p>
<p><strong>FBAM_MULTI</strong> is a version of the FBAM_MINI model that shares the group-modeling features of the HBAM_MULTI model. It allows the user to set the scales of the priors for the shift and stretch parameters via the arguments <code>sigma_alpha</code> and <code>sigma_beta</code>, and set the scales of the priors on <code>mu_alpha</code> and <code>mu_beta</code> via the arguments <code>sigma_mu_alpha</code> and <code>sigma_mu_beta</code>.
</p>
<p><strong>FBAM_MULTI_NF</strong> is a version of the FBAM_MULTI model that does not allow for scale flipping.
</p>
<p><strong>HBAM_R_MINI</strong> is a version of the HBAM_MINI model that incorporates the rationalization component of the ISR model by Bølstad (2020). This model requires additional data to be supplied as the argument <code>pref</code>: An N × J matrix of stimuli ratings from the respondents. The rationalization part of the model is simplified relative to the original ISR model: The direction in which respondents move disfavored stimuli is estimated as a common expectation for each possible self-placement on the scale.
</p>
<p><strong>BAM</strong> is an unpooled model with wide uniform priors on the shift and stretch parameters. It is similar to the JAGS version introduced by Hare et al. (2015), although the version included here has been adjusted to yield stretch parameters with an average of approximately one (and thus produce a scale similar to those of the other models in the package). Like the other models, this version of the BAM model also simulates errors in the self-placements to yield a realistic level of uncertainty. While this model is simple and fast, it tends to overfit the data and produce invalid posterior distributions for some respondent positions (see Bølstad 2024). However, it could potentially be useful as a baseline for model comparisons in situations where respondent positions are not of interest.
</p>
<p><strong>HBAM_2</strong> has been replaced by the more general HBAM_MULTI model.
</p>
<p>These models can also be used in situations where self-placements are not available and the only goal is to estimate stimulus positions or respondents' shift and stretch parameters. While the latent respondent positions will not be estimated, all other parameters are unaffected if the argument <code>self</code> is dropped when calling <code>prep_data()</code> or <code>hbam()</code>.
</p>
<p>See the <code>hbamr</code> vignette for a table summarizing the key characteristics of the available models.
</p>
<p>To see the code for any of the models, use the <code>show_code()</code> function.
</p>


<h3>Value</h3>

<p>An object of S4 class <code>stanfit</code>.
</p>


<h3>References</h3>


<ul>
<li><p> Bølstad, Jørgen (2024). Hierarchical Bayesian Aldrich-McKelvey Scaling. <em>Political Analysis</em>. 32(1): 50–64. <a href="https://doi.org/10.1017/pan.2023.18">doi:10.1017/pan.2023.18</a>.
</p>
</li>
<li><p> Bølstad, Jørgen (2020). Capturing Rationalization Bias and Differential Item Functioning: A Unified Bayesian Scaling Approach. <em>Political Analysis</em> 28(3): 340–355.
</p>
</li>
<li><p> Hare, Christopher et al. (2015). Using Bayesian Aldrich-McKelvey Scaling to Study Citizens' Ideological Preferences and Perceptions. <em>American Journal of Political Science</em> 59(3): 759–774.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
# Loading and re-coding ANES 1980 data:
data(LC1980)
LC1980[LC1980 == 0 | LC1980 == 8 | LC1980 == 9] &lt;- NA

# Making a small subset of the data for illustration:
self &lt;- LC1980[1:100, 1]
stimuli &lt;- LC1980[1:100, -1]

# Fitting the HBAM_MINI model, obtaining 1000 draws:
fit_hbam_mini &lt;- hbam(self, stimuli, model = "HBAM_MINI",
                   warmup = 500, iter = 1000, chains = 2)

# Preparing the data before fitting, requiring complete responses:
dat &lt;- prep_data(self, stimuli, allow_miss = 0)
fit_hbam_mini &lt;- hbam(data = dat, model = "HBAM_MINI",
                   warmup = 500, iter = 1000, chains = 2)

# Obtaining posterior summaries for the latent stimulus positions:
theta_est &lt;- get_est(fit_hbam_mini, par = "theta")

# Obtaining posterior summaries for the latent respondent positions
  # in a format matching the rows in the original dataset:
chi_est &lt;- get_est(fit_hbam_mini, par = "chi", format_orig = TRUE)

# Fitting the FBAM_MULTI_NF model with self-placements as group_id:
fit_fbam_multi_nf &lt;- hbam(self, stimuli, group_id = self, model = "FBAM_MULTI_NF",
                       warmup = 500, iter = 1000, chains = 2)

</code></pre>

<hr>
<h2 id='hbam_cv'>Perform K-fold cross-validation</h2><span id='topic+hbam_cv'></span>

<h3>Description</h3>

<p>This function performs K-fold cross-validation for an HBAM or FBAM model in order to estimate the expected log pointwise predictive density for a new dataset (ELPD). Multiple chains for one or more folds can be run in parallel using the <code>future</code> package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>hbam_cv(
  self = NULL,
  stimuli = NULL,
  model = "HBAM",
  allow_miss = 0,
  req_valid = NA,
  req_unique = 2,
  prefs = NULL,
  group_id = NULL,
  prep_data = TRUE,
  data = NULL,
  K = 10,
  chains = 2,
  warmup = 1000,
  iter = 3000,
  seed = 1,
  sigma_alpha = NULL,
  sigma_beta = 0.35,
  sigma_mu_alpha = NULL,
  sigma_mu_beta = 0.3,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="hbam_cv_+3A_self">self</code></td>
<td>
<p>A numerical vector of N ideological self-placements. Any missing data must be coded as NA. This argument will not be used if the data have been prepared in advance via the <code>prep_data()</code> function.</p>
</td></tr>
<tr><td><code id="hbam_cv_+3A_stimuli">stimuli</code></td>
<td>
<p>An N × J matrix of numerical stimulus placements, where J is the number of stimuli. Any missing data must be coded as NA. This argument will not be used if the data have been prepared in advance via the <code>prep_data()</code> function.</p>
</td></tr>
<tr><td><code id="hbam_cv_+3A_model">model</code></td>
<td>
<p>Character: Name of the model to be used. Defaults to HBAM.</p>
</td></tr>
<tr><td><code id="hbam_cv_+3A_allow_miss">allow_miss</code></td>
<td>
<p>Integer specifying how many missing stimulus positions to be accepted for an individual still to be included in the analysis. This argument will not be used if the data have been prepared in advance via the <code>prep_data()</code> function. Defaults to 0.</p>
</td></tr>
<tr><td><code id="hbam_cv_+3A_req_valid">req_valid</code></td>
<td>
<p>Integer specifying how many valid observations to require for a respondent to be included in the analysis. The default is <code>req_valid = J - allow_miss</code>, but if specified, <code>req_valid</code> takes precedence. This argument will not be used if the data have been prepared in advance via the <code>prep_data()</code> function.</p>
</td></tr>
<tr><td><code id="hbam_cv_+3A_req_unique">req_unique</code></td>
<td>
<p>Integer specifying how may unique positions on the ideological scale each respondent is required to have used when placing the stimuli in order to be included in the analysis. The default is <code>req_unique = 2</code>. This argument will not be used if the data have been prepared in advance via the <code>prep_data()</code> function.</p>
</td></tr>
<tr><td><code id="hbam_cv_+3A_prefs">prefs</code></td>
<td>
<p>An N × J matrix of numerical stimulus ratings or preference scores. These data are only required by the HBAM_R and HBAM_R_MINI models and will be ignored when fitting other models.</p>
</td></tr>
<tr><td><code id="hbam_cv_+3A_group_id">group_id</code></td>
<td>
<p>Integer vector of length N identifying which group each respondent belongs to. The supplied vector should range from 1 to the total number of groups in the data, and all integers between these numbers should be represented in the supplied data. These data are only required by models with &quot;MULTI&quot; in their name and will be ignored when fitting other models.</p>
</td></tr>
<tr><td><code id="hbam_cv_+3A_prep_data">prep_data</code></td>
<td>
<p>Logical: Should the data be prepared before fitting the model? (Or have the data been prepared in advance by first running the <code>prep_data()</code> and <code>prep_data_cv()</code> functions)? If so, set <code>prep_data = FALSE</code>.) Defaults to <code>prep_data = TRUE</code>.</p>
</td></tr>
<tr><td><code id="hbam_cv_+3A_data">data</code></td>
<td>
<p>A list of data produced by <code>prep_data()</code> followed by <code>prep_data_cv()</code>.</p>
</td></tr>
<tr><td><code id="hbam_cv_+3A_k">K</code></td>
<td>
<p>An integer above 2, specifying the number of folds to use in the analysis. Defaults to 10.</p>
</td></tr>
<tr><td><code id="hbam_cv_+3A_chains">chains</code></td>
<td>
<p>A positive integer specifying the number of Markov chains to use per fold. Defaults to 2.</p>
</td></tr>
<tr><td><code id="hbam_cv_+3A_warmup">warmup</code></td>
<td>
<p>A positive integer specifying the number of warmup (aka burn-in) iterations per chain. It defaults to 1000. The number of warmup iterations should be smaller than <code>iter</code>.</p>
</td></tr>
<tr><td><code id="hbam_cv_+3A_iter">iter</code></td>
<td>
<p>A positive integer specifying the number of iterations for each chain (including warmup). It defaults to 3000 as running fewer chains for longer is a more efficient way to obtain a certain number of draws (and cross-validation can be computationally expensive).</p>
</td></tr>
<tr><td><code id="hbam_cv_+3A_seed">seed</code></td>
<td>
<p>An integer passed on to <code>set.seed</code> before creating the folds to increase reproducibility and comparability. Defaults to 1 and only applies to fold-creation when the argument <code>prep_data</code> is <code>TRUE</code>. The supplied <code>seed</code> argument is also used to generate seeds for the sampling algorithm.</p>
</td></tr>
<tr><td><code id="hbam_cv_+3A_sigma_alpha">sigma_alpha</code></td>
<td>
<p>A positive numeric value specifying the standard deviation of the prior on the shift parameters in the FBAM_MINI model, or the standard deviation of the parameters' deviation from the group-means in FBAM_MULTI models. (This argument will be ignored by HBAM models.) Defaults to B / 4, where B measures the length of the survey scale as the number of possible placements on one side of the center.</p>
</td></tr>
<tr><td><code id="hbam_cv_+3A_sigma_beta">sigma_beta</code></td>
<td>
<p>A positive numeric value specifying the standard deviation of the prior on the logged stretch parameters in the FBAM_MINI model, or the standard deviation of the logged parameters' deviation from the group-means in FBAM_MULTI models. (This argument will be ignored by HBAM models.) Defaults to .35.</p>
</td></tr>
<tr><td><code id="hbam_cv_+3A_sigma_mu_alpha">sigma_mu_alpha</code></td>
<td>
<p>A positive numeric value specifying the standard deviation of the prior on the group-means of the shift parameters in MULTI-type models. Defaults to B / 5.</p>
</td></tr>
<tr><td><code id="hbam_cv_+3A_sigma_mu_beta">sigma_mu_beta</code></td>
<td>
<p>A positive numeric value specifying the standard deviation of the prior on the group-means of the logged stretch parameters in MULTI-type models. Defaults to .3.</p>
</td></tr>
<tr><td><code id="hbam_cv_+3A_...">...</code></td>
<td>
<p>Arguments passed to <code>rstan::sampling()</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of classes <code>kfold</code> and <code>loo</code>, which contains the following named elements:
</p>

<ul>
<li> <p><code>"estimates"</code>: A <code style="white-space: pre;">&#8288;1x2&#8288;</code> matrix containing the ELPD estimate and its standard error. The columns have names <code>"Estimate"</code> and <code>"SE"</code>.
</p>
</li>
<li> <p><code>"pointwise"</code>: A <code>Nx1</code> matrix with column name <code>"elpd_kfold"</code> containing the pointwise contributions for each data point.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
# Loading and re-coding ANES 1980 data:
data(LC1980)
LC1980[LC1980 == 0 | LC1980 == 8 | LC1980 == 9] &lt;- NA

# Making a small subset of the data for illustration:
self &lt;- LC1980[1:50, 1]
stimuli &lt;- LC1980[1:50, -1]

# Preparing to run chains in parallel using 2 cores via the future package:
  # Note: You would normally want to use all physical cores for this.
future::plan(future::multisession, workers = 2)

# Performing 10-fold cross-validation for the HBAM_MINI model:
  # Note: You would typically want to run the chains for more iterations.
cv_hbam_mini &lt;- hbam_cv(self, stimuli, model = "HBAM_MINI",
                        chains = 1, warmup = 500, iter = 1000)

# Performing 10-fold cross-validation for the FBAM_MINI model:
cv_fbam_mini &lt;- hbam_cv(self, stimuli, model = "FBAM_MINI",
                        chains = 1, warmup = 500, iter = 1000)

# Comparing the results using the loo package:
loo::loo_compare(list(HBAM_MINI = cv_hbam_mini,
                 FBAM_MINI = cv_fbam_mini))

# Stop the cluster of parallel sessions:
future::plan(future::sequential)

</code></pre>

<hr>
<h2 id='hbamr-package'>Hierarchical Bayesian Aldrich-McKelvey Scaling via Stan</h2><span id='topic+hbamr-package'></span><span id='topic+hbamr'></span>

<h3>Description</h3>

<p>Fit hierarchical Bayesian Aldrich-McKelvey (HBAM) models using a form of Hamiltonian Monte Carlo via Stan. Aldrich-McKelvey (AM) scaling is a method for estimating the ideological positions of survey respondents and political actors on a common scale using positional survey data. The hierarchical versions of the Bayesian AM model included in this package outperform other versions both in terms of yielding meaningful posterior distributions for respondent positions and in terms of recovering true respondent positions in simulations. The package contains functions for preparing data, fitting models, extracting estimates, plotting key results, and comparing models using cross-validation.
</p>


<h3>Author(s)</h3>

<p>Jørgen Bølstad
</p>


<h3>References</h3>


<ul>
<li><p> Bølstad, Jørgen (2024). Hierarchical Bayesian Aldrich-McKelvey Scaling. <em>Political Analysis</em>. 32(1): 50–64. <a href="https://doi.org/10.1017/pan.2023.18">doi:10.1017/pan.2023.18</a>.
</p>
</li>
<li><p> Stan Development Team (2024). RStan: the R interface to Stan. R package version 2.32.5. <a href="https://mc-stan.org">https://mc-stan.org</a>.
</p>
</li></ul>



<h3>See Also</h3>

<ul>
<li> <p><a href="https://jbolstad.github.io/hbamr/">https://jbolstad.github.io/hbamr/</a></p>
</li></ul>


<hr>
<h2 id='LC1980'>1980 Liberal-Conservative Scales</h2><span id='topic+LC1980'></span>

<h3>Description</h3>

<p>Liberal-Conservative 7-point scales from the 1980 National Election Study.
Includes (in order) self-placement, and rankings of Carter, Reagan, Kennedy,
Anderson, Republican party, Democratic Party. Stored as a matrix of integers.
The numbers 0, 8, and 9 are considered to be missing values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(LC1980)
</code></pre>


<h3>Format</h3>

<p>An object of class <code>matrix</code> (inherits from <code>array</code>) with 888 rows and 7 columns.
</p>


<h3>Source</h3>

<p>American National Election Studies: <a href="https://electionstudies.org/">www.electionstudies.org/</a>.
</p>
<p>This dataset was originally part of the <code>basicspace</code> package under the same name (&quot;LC1980&quot;).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(LC1980)
LC1980[LC1980 == 0 | LC1980 == 8 | LC1980 == 9] &lt;- NA
head(LC1980)
</code></pre>

<hr>
<h2 id='LC2012'>2012 Liberal-Conservative Scales</h2><span id='topic+LC2012'></span>

<h3>Description</h3>

<p>Liberal-Conservative 7-point scales from the 2012 National Election Study. Includes
(in order) original case id, self-placement, and rankings of Obama, Romney, Democratic Party,
Republican party. Missing values are coded as NA.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(LC2012)
</code></pre>


<h3>Format</h3>

<p>An object of class <code>data.frame</code> with 5914 rows and 6 columns.
</p>


<h3>Source</h3>

<p>American National Election Studies: <a href="https://electionstudies.org/">www.electionstudies.org/</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(LC2012)
head(LC2012)
</code></pre>

<hr>
<h2 id='plot_by_group'>Plot posterior densities of parameter averages by group</h2><span id='topic+plot_by_group'></span>

<h3>Description</h3>

<p>Plot posterior densities of group summaries of individual parameters. The respondents can be grouped by any categorical variable and the function works whether the fitted model is of &quot;MULTI&quot;-type or not.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_by_group(
  object,
  par = "abs_beta",
  group_id = NULL,
  ascending_means = TRUE,
  fill = "#2166AC",
  color = "#053061",
  alpha = 0.5,
  ncol = max(1, round(length(unique(group_id))/10))
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_by_group_+3A_object">object</code></td>
<td>
<p>An instance of class <code>stanfit</code> produced by <code>hbam()</code>.</p>
</td></tr>
<tr><td><code id="plot_by_group_+3A_par">par</code></td>
<td>
<p>Character: Name of the parameter to be plotted. One of the following: <code>"alpha"</code>, <code>"beta"</code>, <code>"abs_beta"</code>, <code>"lambda"</code>, or <code>"chi"</code>. Defaults to <code>"abs_beta"</code>, which means the absolute values of the draws for beta will be used. Further individual-level parameters like <code>"eta"</code> can be specified if these have been passed to <code>hbam()</code> via the argument <code>extra_pars</code> when fitting the model. (Note that homoskedastic models have no <code>"eta"</code> parameters and &quot;NF&quot;-type models have no <code>"lambda"</code> or <code>"kappa"</code> parameters.)</p>
</td></tr>
<tr><td><code id="plot_by_group_+3A_group_id">group_id</code></td>
<td>
<p>An optional vector that will be used to split the respondents into groups. The vector must either be as long as the number of rows in the original dataset, or as long as the number of respondents included in the analysis. If a <code>group_id</code> was previously supplied to <code>prep_data()</code> or <code>hbam()</code> and if no <code>group_id</code> is supplied here, the default is to use the existing <code>group_id</code>. If a <code>group_id</code> is supplied here, it will be used instead of any previously supplied vector. The <code>group_id</code> supplied here does not have to coincide with the <code>group_id</code> used to fit a &quot;MULTI&quot;-type model: Any vector that can be used to group the respondents is allowed.</p>
</td></tr>
<tr><td><code id="plot_by_group_+3A_ascending_means">ascending_means</code></td>
<td>
<p>Logical: Should the groups be placed in ascending order based on their posterior means (<code>TRUE</code>) or should they be ordered based on their names (<code>FALSE</code>)? Defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="plot_by_group_+3A_fill">fill</code></td>
<td>
<p>Fill color. Passed on to <code>ggplot2::geom_density()</code>.</p>
</td></tr>
<tr><td><code id="plot_by_group_+3A_color">color</code></td>
<td>
<p>Color of outer lines. Passed on to <code>ggplot2::geom_density()</code>.</p>
</td></tr>
<tr><td><code id="plot_by_group_+3A_alpha">alpha</code></td>
<td>
<p>Number in [0,1]: Inverse level of transparency.</p>
</td></tr>
<tr><td><code id="plot_by_group_+3A_ncol">ncol</code></td>
<td>
<p>Number of columns. The default uses a formula to have approximately ten subplots per column.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>ggplot</code> object.
</p>

<hr>
<h2 id='plot_over_self'>Plot individual parameter estimates over self-placements</h2><span id='topic+plot_over_self'></span>

<h3>Description</h3>

<p>Create a boxplot of individual parameter point estimates from an HBAM model over self-placements
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_over_self(
  object,
  par = "chi",
  estimate = "median",
  names = NULL,
  parlabel = NULL,
  fill = "#2166AC",
  color = "#053061",
  width = 0.7,
  alpha = 0.5,
  outlier.size = 0.3,
  median_color = "black",
  median_lwd = 0.7
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_over_self_+3A_object">object</code></td>
<td>
<p>An object of class <code>stanfit</code> produced by <code>hbam()</code>, a list produced by <code>fbam()</code>, or a <code>list</code> of such objects, which will produce a faceted plot.</p>
</td></tr>
<tr><td><code id="plot_over_self_+3A_par">par</code></td>
<td>
<p>Character: Name of the parameter to be plotted. One of the following: <code>"alpha"</code>, <code>"beta"</code>, <code>"abs_beta"</code>, <code>"lambda"</code>, or <code>"chi"</code>. Defaults to <code>"chi"</code>. Further individual-level parameters like <code>"eta"</code> can be specified if these have been passed to <code>hbam()</code> via the argument <code>extra_pars</code> when fitting the model. (Note that homoskedastic models have no <code>"eta"</code> parameters and &quot;NF&quot;-type models have no <code>"lambda"</code> or <code>"kappa"</code> parameters.)</p>
</td></tr>
<tr><td><code id="plot_over_self_+3A_estimate">estimate</code></td>
<td>
<p>Character: Specifying which type of posterior point estimate to use. One of <code>"median"</code> and <code>"mean"</code>. Defaults to <code>"median"</code>. This only applies for <code>stanfit</code> objects.</p>
</td></tr>
<tr><td><code id="plot_over_self_+3A_names">names</code></td>
<td>
<p>An optional character vector of model names of same length as the supplied list of models.</p>
</td></tr>
<tr><td><code id="plot_over_self_+3A_parlabel">parlabel</code></td>
<td>
<p>An optional character containing an alternative label for the parameter (will be parsed if passed as an expression).</p>
</td></tr>
<tr><td><code id="plot_over_self_+3A_fill">fill</code></td>
<td>
<p>Fill color of boxes. Passed on to <code>ggplot2::geom_boxplot()</code>.</p>
</td></tr>
<tr><td><code id="plot_over_self_+3A_color">color</code></td>
<td>
<p>Color of outer lines. Passed on to <code>ggplot2::geom_boxplot()</code>.</p>
</td></tr>
<tr><td><code id="plot_over_self_+3A_width">width</code></td>
<td>
<p>Width of boxes. Passed on to <code>ggplot2::geom_boxplot()</code>.</p>
</td></tr>
<tr><td><code id="plot_over_self_+3A_alpha">alpha</code></td>
<td>
<p>Number in [0,1]: Inverse level of transparency for fill color.</p>
</td></tr>
<tr><td><code id="plot_over_self_+3A_outlier.size">outlier.size</code></td>
<td>
<p>Size of dots representing outliers. Passed on to <code>ggplot2::geom_boxplot()</code>.</p>
</td></tr>
<tr><td><code id="plot_over_self_+3A_median_color">median_color</code></td>
<td>
<p>Color of solid line representing the median.</p>
</td></tr>
<tr><td><code id="plot_over_self_+3A_median_lwd">median_lwd</code></td>
<td>
<p>Thickness of solid line representing the median.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>ggplot</code> object.
</p>

<hr>
<h2 id='plot_respondents'>Plot estimated respondent positions</h2><span id='topic+plot_respondents'></span>

<h3>Description</h3>

<p>Plot the distribution of estimated respondent positions from an HBAM model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_respondents(
  object,
  inc_stimuli = TRUE,
  n_draws = 15,
  color = "#053061",
  fill = "#2166AC",
  alpha_color = 0.6,
  alpha_fill = 0.7/n_draws,
  seed = 1
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_respondents_+3A_object">object</code></td>
<td>
<p>An instance of class <code>stanfit</code> produced by <code>hbam()</code>.</p>
</td></tr>
<tr><td><code id="plot_respondents_+3A_inc_stimuli">inc_stimuli</code></td>
<td>
<p>Logical: Should estimated stimulus positions also be shown?</p>
</td></tr>
<tr><td><code id="plot_respondents_+3A_n_draws">n_draws</code></td>
<td>
<p>Integer specifying the number of posterior draws to use when illustrating the uncertainty of the population distribution. Defaults to 15.</p>
</td></tr>
<tr><td><code id="plot_respondents_+3A_color">color</code></td>
<td>
<p>Color of lines illustrating uncertainty.</p>
</td></tr>
<tr><td><code id="plot_respondents_+3A_fill">fill</code></td>
<td>
<p>Fill color for density plots.</p>
</td></tr>
<tr><td><code id="plot_respondents_+3A_alpha_color">alpha_color</code></td>
<td>
<p>Number in [0,1]: Inverse level of transparency for line color.</p>
</td></tr>
<tr><td><code id="plot_respondents_+3A_alpha_fill">alpha_fill</code></td>
<td>
<p>Number in [0,1]: Inverse level of transparency for fill color.</p>
</td></tr>
<tr><td><code id="plot_respondents_+3A_seed">seed</code></td>
<td>
<p>A positive integer specifying an optional seed for reproducibility. The seed is used to select respondent position draws for illustrating uncertainty.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>ggplot</code> object.
</p>

<hr>
<h2 id='plot_stimuli'>Plot estimated stimulus positions</h2><span id='topic+plot_stimuli'></span>

<h3>Description</h3>

<p>Plot marginal posterior distributions of stimulus positions from an HBAM model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_stimuli(object, rev_color = FALSE, alpha = 0.55)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_stimuli_+3A_object">object</code></td>
<td>
<p>An instance of class <code>stanfit</code> produced by <code>hbam()</code>.</p>
</td></tr>
<tr><td><code id="plot_stimuli_+3A_rev_color">rev_color</code></td>
<td>
<p>Logical: Display low positions as red and high positions as blue.</p>
</td></tr>
<tr><td><code id="plot_stimuli_+3A_alpha">alpha</code></td>
<td>
<p>Number in [0,1]: Inverse level of transparency for fill color.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>ggplot</code> object.
</p>

<hr>
<h2 id='prep_data'>Prepare data to fit an HBAM or FBAM model</h2><span id='topic+prep_data'></span>

<h3>Description</h3>

<p>This function prepares data to fit a hierarchical Bayesian Aldrich-McKelvey (HBAM) model. It can be run ahead of fitting the models, or it can be run implicitly as part of a single function call to fit the models using <code>hbam()</code> or <code>fbam()</code>. It applies a set of inclusion criteria, performs any necessary data transformation, and returns a list of data suited for sampling in <code>rstan</code>. The data provided to <code>prep_data()</code> can be centered, but they do not have to be: The function will detect un-centered data and attempt to center these automatically, assuming that the highest and lowest observed values in the data mark the extremes of the scale.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>prep_data(
  self = NULL,
  stimuli,
  prefs = NULL,
  allow_miss = 2,
  req_valid = NA,
  req_unique = 2,
  B = NULL,
  group_id = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="prep_data_+3A_self">self</code></td>
<td>
<p>An optional numerical vector of N ideological self-placements. Any missing data must be coded as NA. If this argument is not supplied, respondent positions will not be estimated.</p>
</td></tr>
<tr><td><code id="prep_data_+3A_stimuli">stimuli</code></td>
<td>
<p>An N × J matrix of numerical stimulus placements, where J is the number of stimuli. Any missing data must be coded as NA.</p>
</td></tr>
<tr><td><code id="prep_data_+3A_prefs">prefs</code></td>
<td>
<p>An N × J matrix of numerical stimulus ratings or preference scores. These data are only required by the <code>"HBAM_R"</code> and <code>"HBAM_R_MINI"</code> models and will be ignored when fitting other models.</p>
</td></tr>
<tr><td><code id="prep_data_+3A_allow_miss">allow_miss</code></td>
<td>
<p>Integer specifying how many missing stimulus positions to be accepted for an individual still to be included in the analysis. This argument will not be used if the data have been prepared in advance via the <code>prep_data()</code> function. Defaults to 2.</p>
</td></tr>
<tr><td><code id="prep_data_+3A_req_valid">req_valid</code></td>
<td>
<p>Integer specifying how many valid observations to require for a respondent to be included in the analysis. The default is <code>req_valid = J - allow_miss</code>, but if specified, <code>req_valid</code> takes precedence.</p>
</td></tr>
<tr><td><code id="prep_data_+3A_req_unique">req_unique</code></td>
<td>
<p>Integer specifying how may unique positions on the ideological scale each respondent is required to have used when placing the stimuli in order to be included in the analysis. The default is <code>req_unique = 2</code>.</p>
</td></tr>
<tr><td><code id="prep_data_+3A_b">B</code></td>
<td>
<p>Integer specifying the upper bound of the survey scale after centering. If not supplied, this information will be inferred from the data.</p>
</td></tr>
<tr><td><code id="prep_data_+3A_group_id">group_id</code></td>
<td>
<p>Vector of length N identifying which group each respondent belongs to. The format can be factor, character, integer, or numeric. Respondents with NAs on <code>group_id</code> will be dropped when <code>group_id</code> is supplied. These data are only required by models with <code>"MULTI"</code> in their name and will be ignored when fitting other models.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of data to be used by <code>hbam()</code> or <code>fbam()</code>. The returned list includes the logical vector <code>keep</code>, which identifies the rows in the original data that have been kept for further analysis. The stimuli data are stored in a vector as a long-form sparse matrix. If the stimuli data include column-names, these will be preserved for later use.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Loading and re-coding ANES 1980 data:
data(LC1980)
LC1980[LC1980 == 0 | LC1980 == 8 | LC1980 == 9] &lt;- NA
self &lt;- LC1980[, 1]
stimuli &lt;- LC1980[, -1]

# Prepare data for model fitting, using defaults:
dat &lt;- prep_data(self, stimuli)

# Prepare data for model fitting, using using alternative settings:
dat2 &lt;- prep_data(self, stimuli, allow_miss = 0, req_unique = 3)

# Obtain the data that are included in the analysis:
self2 &lt;- self[dat2$keep]
stimuli2 &lt;- stimuli[dat2$keep, ]
</code></pre>

<hr>
<h2 id='prep_data_cv'>Prepare data for a K-fold cross-validation of an HBAM model</h2><span id='topic+prep_data_cv'></span>

<h3>Description</h3>

<p>This function turns data prepared for <code>hbam()</code> into a list of K versions, where each version includes a different vector identifying holdout-data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>prep_data_cv(data, K = 10, seed = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="prep_data_cv_+3A_data">data</code></td>
<td>
<p>A list of data produced by <code>prep_data()</code>.</p>
</td></tr>
<tr><td><code id="prep_data_cv_+3A_k">K</code></td>
<td>
<p>An integer above 2, specifying the number of folds to use in the analysis. Defaults to 10.</p>
</td></tr>
<tr><td><code id="prep_data_cv_+3A_seed">seed</code></td>
<td>
<p>An integer passed on to <code>set.seed</code> before creating the folds to increase reproducibility. Defaults to 1.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of K data objects where each version includes a different vector identifying holdout-data.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Loading and re-coding ANES 1980 data:
data(LC1980)
LC1980[LC1980 == 0 | LC1980 == 8 | LC1980 == 9] &lt;- NA
self &lt;- LC1980[, 1]
stimuli &lt;- LC1980[, -1]
dat &lt;- prep_data(self, stimuli)

# Prepare data for cross-validation:
dat_cv &lt;- prep_data_cv(dat, K = 10)

</code></pre>

<hr>
<h2 id='show_code'>Show the code for an HBAM or FBAM model</h2><span id='topic+show_code'></span>

<h3>Description</h3>

<p>Show Stan code for one of the models in the package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>show_code(model = "HBAM")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="show_code_+3A_model">model</code></td>
<td>
<p>Character: Name of the model to show. Defaults to &quot;HBAM&quot;. See the documentation for the <code>hbam()</code> function for a list of the available models.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The function prints Stan code.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>show_code("HBAM")
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
