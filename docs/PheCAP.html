<!DOCTYPE html><html lang="en"><head><title>Help for package PheCAP</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {PheCAP}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#PheCAP-package'>
<p>High-Throughput Phenotyping with EHR using a Common Automated Pipeline</p></a></li>
<li><a href='#ehr_data'><p>A Synthetic EHR Dataset</p></a></li>
<li><a href='#phecap_generate_dictionary_file'>
<p>Generate a Dictionary File for Note Parsing</p></a></li>
<li><a href='#phecap_perform_majority_voting'>
<p>Perform Majority Voting on the CUIs from Multiple Knowledge Sources</p></a></li>
<li><a href='#phecap_plot_roc_curves'>
<p>Plot ROC and Related Curves for Phenotyping Models</p></a></li>
<li><a href='#phecap_predict_phenotype'>
<p>Predict Phenotype</p></a></li>
<li><a href='#phecap_run_feature_extraction'>
<p>Run Surrogate-Assisted Feature Extraction (SAFE)</p></a></li>
<li><a href='#phecap_train_phenotyping_model'>
<p>Train Phenotyping Model using the Training Labels</p></a></li>
<li><a href='#phecap_validate_phenotyping_model'>
<p>Validate the Phenotyping Model using the Validation Labels</p></a></li>
<li><a href='#PhecapData'>
<p>Define or Read Datasets for Phenotyping</p></a></li>
<li><a href='#PhecapSurrogate'>
<p>Define a Surrogate Variable used in</p>
Surrogate-Assisted Feature Extraction (SAFE)</a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>High-Throughput Phenotyping with EHR using a Common Automated
Pipeline</td>
</tr>
<tr>
<td>Version:</td>
<td>1.2.1</td>
</tr>
<tr>
<td>Description:</td>
<td>Implement surrogate-assisted feature extraction (SAFE) and
             common machine learning approaches to train and validate phenotyping models.
             Background and details about the methods can be found at 
             Zhang et al. (2019) &lt;<a href="https://doi.org/10.1038%2Fs41596-019-0227-6">doi:10.1038/s41596-019-0227-6</a>&gt;,
             Yu et al. (2017) &lt;<a href="https://doi.org/10.1093%2Fjamia%2Focw135">doi:10.1093/jamia/ocw135</a>&gt;, and 
             Liao et al. (2015) &lt;<a href="https://doi.org/10.1136%2Fbmj.h1885">doi:10.1136/bmj.h1885</a>&gt;.</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://celehs.github.io/PheCAP/">https://celehs.github.io/PheCAP/</a>, <a href="https://github.com/celehs/PheCAP">https://github.com/celehs/PheCAP</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/celehs/PheCAP/issues">https://github.com/celehs/PheCAP/issues</a></td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>ByteCompile:</td>
<td>yes</td>
</tr>
<tr>
<td>Imports:</td>
<td>graphics, methods, stats, utils, glmnet, RMySQL</td>
</tr>
<tr>
<td>Suggests:</td>
<td>ggplot2, e1071, randomForestSRC, xgboost, knitr, rmarkdown</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.3.0)</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.1</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2020-09-17 08:41:04 UTC; ubuntu</td>
</tr>
<tr>
<td>Author:</td>
<td>Yichi Zhang [aut],
  Chuan Hong [aut],
  Tianxi Cai [aut],
  PARSE LTD [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>PARSE LTD &lt;software@parse-health.org&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2020-09-17 09:30:18 UTC</td>
</tr>
</table>
<hr>
<h2 id='PheCAP-package'>
High-Throughput Phenotyping with EHR using a Common Automated Pipeline
</h2><span id='topic+PheCAP-package'></span><span id='topic+PheCAP'></span>

<h3>Description</h3>

<p>Implement surrogate-assisted feature extraction (SAFE) and
             common machine learning approaches to train and validate phenotyping models.
             Background and details about the methods can be found at 
             Zhang et al. (2019) &lt;doi:10.1038/s41596-019-0227-6&gt;,
             Yu et al. (2017) &lt;doi:10.1093/jamia/ocw135&gt;, and 
             Liao et al. (2015) &lt;doi:10.1136/bmj.h1885&gt;.
</p>


<h3>Details</h3>

<p>The DESCRIPTION file:
</p>

<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> PheCAP</td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
Title: </td><td style="text-align: left;"> High-Throughput Phenotyping with EHR using a Common Automated Pipeline</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 1.2.1</td>
</tr>
<tr>
 <td style="text-align: left;">
Authors@R: </td><td style="text-align: left;"> c(
    person("Yichi", "Zhang", role = "aut"),
    person("Chuan", "Hong", role = "aut"),
    person("Tianxi", "Cai", role = "aut"),
    person(family = "PARSE LTD", role =  c("aut", "cre"), email = "software@parse-health.org")
    )</td>
</tr>
<tr>
 <td style="text-align: left;">
Description: </td><td style="text-align: left;"> Implement surrogate-assisted feature extraction (SAFE) and
             common machine learning approaches to train and validate phenotyping models.
             Background and details about the methods can be found at 
             Zhang et al. (2019) &lt;doi:10.1038/s41596-019-0227-6&gt;,
             Yu et al. (2017) &lt;doi:10.1093/jamia/ocw135&gt;, and 
             Liao et al. (2015) &lt;doi:10.1136/bmj.h1885&gt;.</td>
</tr>
<tr>
 <td style="text-align: left;">
URL: </td><td style="text-align: left;"> https://celehs.github.io/PheCAP/, https://github.com/celehs/PheCAP</td>
</tr>
<tr>
 <td style="text-align: left;">
BugReports: </td><td style="text-align: left;"> https://github.com/celehs/PheCAP/issues</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> GPL-3</td>
</tr>
<tr>
 <td style="text-align: left;">
Encoding: </td><td style="text-align: left;"> UTF-8</td>
</tr>
<tr>
 <td style="text-align: left;">
ByteCompile: </td><td style="text-align: left;"> yes</td>
</tr>
<tr>
 <td style="text-align: left;">
Imports: </td><td style="text-align: left;"> graphics,
methods,
stats,
utils,
glmnet,
RMySQL</td>
</tr>
<tr>
 <td style="text-align: left;">
Suggests: </td><td style="text-align: left;"> ggplot2,
e1071,
randomForestSRC,
xgboost,
knitr,
rmarkdown</td>
</tr>
<tr>
 <td style="text-align: left;">
VignetteBuilder: </td><td style="text-align: left;"> knitr</td>
</tr>
<tr>
 <td style="text-align: left;">
Depends: </td><td style="text-align: left;"> R (&gt;= 3.3.0)</td>
</tr>
<tr>
 <td style="text-align: left;">
RoxygenNote: </td><td style="text-align: left;"> 7.1.1</td>
</tr>
<tr>
 <td style="text-align: left;">
LazyData: </td><td style="text-align: left;"> true</td>
</tr>
<tr>
 <td style="text-align: left;">
Author: </td><td style="text-align: left;"> Yichi Zhang [aut],
  Chuan Hong [aut],
  Tianxi Cai [aut],
  PARSE LTD [aut, cre]</td>
</tr>
<tr>
 <td style="text-align: left;">
Maintainer: </td><td style="text-align: left;"> PARSE LTD &lt;software@parse-health.org&gt;</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>


<p>Index of help topics:
</p>
<pre>
PheCAP-package          High-Throughput Phenotyping with EHR using a
                        Common Automated Pipeline
PhecapData              Define or Read Datasets for Phenotyping
PhecapSurrogate         Define a Surrogate Variable used in
                        Surrogate-Assisted Feature Extraction (SAFE)
ehr_data                A Synthetic EHR Dataset
phecap_generate_dictionary_file
                        Generate a Dictionary File for Note Parsing
phecap_perform_majority_voting
                        Perform Majority Voting on the CUIs from
                        Multiple Knowledge Sources
phecap_plot_roc_curves
                        Plot ROC and Related Curves for Phenotyping
                        Models
phecap_predict_phenotype
                        Predict Phenotype
phecap_run_feature_extraction
                        Run Surrogate-Assisted Feature Extraction
                        (SAFE)
phecap_train_phenotyping_model
                        Train Phenotyping Model using the Training
                        Labels
phecap_validate_phenotyping_model
                        Validate the Phenotyping Model using the
                        Validation Labels
</pre>
<p>PheCAP provides a straightforward interface for conducting
phenotyping on eletronic health records. One can specify the
data via <code><a href="#topic+PhecapData">PhecapData</a></code>, define surrogate using
<code><a href="#topic+PhecapSurrogate">PhecapSurrogate</a></code>. Next, one may run
surrogate-assisted feature extraction (SAFE) by calling
<code><a href="#topic+phecap_run_feature_extraction">phecap_run_feature_extraction</a></code>, and then
train and validate phenotyping models via
<code><a href="#topic+phecap_train_phenotyping_model">phecap_train_phenotyping_model</a></code> and
<code><a href="#topic+phecap_validate_phenotyping_model">phecap_validate_phenotyping_model</a></code>.
The predictive performance can be visualized using
<code><a href="#topic+phecap_plot_roc_curves">phecap_plot_roc_curves</a></code>.
Predicted phenotype is provided by
<code><a href="#topic+phecap_predict_phenotype">phecap_predict_phenotype</a></code>.
</p>


<h3>Author(s)</h3>

<p>NA
</p>
<p>Maintainer: NA
</p>


<h3>References</h3>

<p>Yu, S., Chakrabortty, A., Liao, K. P., Cai, T., Ananthakrishnan, A. N., Gainer, V. S., ... &amp; Cai, T. (2016). Surrogate-assisted feature extraction for high-throughput phenotyping. Journal of the American Medical Informatics Association, 24(e1), e143-e149.
</p>
<p>Liao, K. P., Cai, T., Savova, G. K., Murphy, S. N., Karlson, E. W., Ananthakrishnan, A. N., ... &amp; Churchill, S. (2015). Development of phenotype algorithms using electronic medical records and incorporating natural language processing. bmj, 350, h1885.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Simulate an EHR dataset
size &lt;- 2000
latent &lt;- rgamma(size, 0.3)
latent2 &lt;- rgamma(size, 0.3)
ehr_data &lt;- data.frame(
  ICD1 = rpois(size, 7 * (rgamma(size, 0.2) + latent) / 0.5),
  ICD2 = rpois(size, 6 * (rgamma(size, 0.8) + latent) / 1.1),
  ICD3 = rpois(size, 1 * rgamma(size, 0.5 + latent2) / 0.5),
  ICD4 = rpois(size, 2 * rgamma(size, 0.5) / 0.5),
  NLP1 = rpois(size, 8 * (rgamma(size, 0.2) + latent) / 0.6),
  NLP2 = rpois(size, 2 * (rgamma(size, 1.1) + latent) / 1.5),
  NLP3 = rpois(size, 5 * (rgamma(size, 0.1) + latent) / 0.5),
  NLP4 = rpois(size, 11 * rgamma(size, 1.9 + latent) / 1.9),
  NLP5 = rpois(size, 3 * rgamma(size, 0.5 + latent2) / 0.5),
  NLP6 = rpois(size, 2 * rgamma(size, 0.5) / 0.5),
  NLP7 = rpois(size, 1 * rgamma(size, 0.5) / 0.5),
  HU = rpois(size, 30 * rgamma(size, 0.1) / 0.1),
  label = NA)
ii &lt;- sample.int(size, 400)
ehr_data[ii, "label"] &lt;- with(
  ehr_data[ii, ], rbinom(400, 1, plogis(
    -5 + 1.5 * log1p(ICD1) + log1p(NLP1) +
      0.8 * log1p(NLP3) - 0.5 * log1p(HU))))

# Define features and labels used for phenotyping.
data &lt;- PhecapData(ehr_data, "HU", "label", validation = 0.4)
data

# Specify the surrogate used for
# surrogate-assisted feature extraction (SAFE).
# The typical way is to specify a main ICD code, a main NLP CUI,
# as well as their combination.
# The default lower_cutoff is 1, and the default upper_cutoff is 10.
# In some cases one may want to define surrogate through lab test.
# Feel free to change the cutoffs based on domain knowledge.
surrogates &lt;- list(
  PhecapSurrogate(
    variable_names = "ICD1",
    lower_cutoff = 1, upper_cutoff = 10),
  PhecapSurrogate(
    variable_names = "NLP1",
    lower_cutoff = 1, upper_cutoff = 10))

# Run surrogate-assisted feature extraction (SAFE)
# and show result.
feature_selected &lt;- phecap_run_feature_extraction(
  data, surrogates, num_subsamples = 50, subsample_size = 200)
feature_selected

# Train phenotyping model and show the fitted model,
# with the AUC on the training set as well as random splits.
model &lt;- phecap_train_phenotyping_model(
  data, surrogates, feature_selected, num_splits = 100)
model

# Validate phenotyping model using validation label,
# and show the AUC and ROC.
validation &lt;- phecap_validate_phenotyping_model(data, model)
validation

phecap_plot_roc_curves(validation)

# Apply the model to all the patients to obtain predicted phenotype.
phenotype &lt;- phecap_predict_phenotype(data, model)


# A more complicated example

# Load Data.
data(ehr_data)
data &lt;- PhecapData(ehr_data, "healthcare_utilization", "label", 0.4)
data

# Specify the surrogate used for
# surrogate-assisted feature extraction (SAFE).
# The typical way is to specify a main ICD code, a main NLP CUI,
# as well as their combination.
# In some cases one may want to define surrogate through lab test.
# The default lower_cutoff is 1, and the default upper_cutoff is 10.
# Feel free to change the cutoffs based on domain knowledge.
surrogates &lt;- list(
  PhecapSurrogate(
    variable_names = "main_ICD",
    lower_cutoff = 1, upper_cutoff = 10),
  PhecapSurrogate(
    variable_names = "main_NLP",
    lower_cutoff = 1, upper_cutoff = 10),
  PhecapSurrogate(
    variable_names = c("main_ICD", "main_NLP"),
    lower_cutoff = 1, upper_cutoff = 10))

# Run surrogate-assisted feature extraction (SAFE)
# and show result.
feature_selected &lt;- phecap_run_feature_extraction(data, surrogates)
feature_selected

# Train phenotyping model and show the fitted model,
# with the AUC on the training set as well as random splits
model &lt;- phecap_train_phenotyping_model(data, surrogates, feature_selected)
model

# Validate phenotyping model using validation label,
# and show the AUC and ROC
validation &lt;- phecap_validate_phenotyping_model(data, model)
validation
phecap_plot_roc_curves(validation)

# Apply the model to all the patients to obtain predicted phenotype.
phenotype &lt;- phecap_predict_phenotype(data, model)

</code></pre>

<hr>
<h2 id='ehr_data'>A Synthetic EHR Dataset</h2><span id='topic+ehr_data'></span>

<h3>Description</h3>

<p>This dataset gives a sample dataset for EHR phenotyping.
It contains counts for ICD codes, counts for NLP mentions,
healthcare utilization (HU) features for all observations.
It also contains the accurate phenotypes for 181 observations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(ehr_data)</code></pre>


<h3>Format</h3>

<p>A data.frame with 10000 observations of 588 variables.</p>

<hr>
<h2 id='phecap_generate_dictionary_file'>
Generate a Dictionary File for Note Parsing
</h2><span id='topic+phecap_generate_dictionary_file'></span>

<h3>Description</h3>

<p>Given a list of CUIs,
connect to the UMLS database stored in MySQL,
extract CUIs and associated terms,
and write a dictionary file for use in note parsing.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>phecap_generate_dictionary_file(
  cui_list, dict_file,
  user = "username", password = "password",
  host = "localhost", dbname = "umls", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="phecap_generate_dictionary_file_+3A_cui_list">cui_list</code></td>
<td>

<p>a character vector consisting of CUIs of interest.
</p>
</td></tr>
<tr><td><code id="phecap_generate_dictionary_file_+3A_dict_file">dict_file</code></td>
<td>

<p>a character scalar for the path to the dictionary file that will be generated.
</p>
</td></tr>
<tr><td><code id="phecap_generate_dictionary_file_+3A_user">user</code></td>
<td>

<p>a character scalar for the username for database connection; passed to <code>RMySQL::dbConnect</code> as it is.
</p>
</td></tr>
<tr><td><code id="phecap_generate_dictionary_file_+3A_password">password</code></td>
<td>

<p>a character scalar for the password for database connection; passed to <code>RMySQL::dbConnect</code> as it is.
</p>
</td></tr>
<tr><td><code id="phecap_generate_dictionary_file_+3A_host">host</code></td>
<td>

<p>a character scalar for the host (or URL) for database connection; passed to <code>RMySQL::dbConnect</code> as it is.
</p>
</td></tr>
<tr><td><code id="phecap_generate_dictionary_file_+3A_dbname">dbname</code></td>
<td>

<p>a character scalar for the database name for database connection; passed to <code>RMySQL::dbConnect</code> as it is.
</p>
</td></tr>
<tr><td><code id="phecap_generate_dictionary_file_+3A_...">...</code></td>
<td>

<p>Other arguments passed to <code>RMySQL::dbConnect</code> as they are.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The dictionary will be written to the location given by <code>dict_file</code>.
Return the dictionary invisibly.
</p>

<hr>
<h2 id='phecap_perform_majority_voting'>
Perform Majority Voting on the CUIs from Multiple Knowledge Sources
</h2><span id='topic+phecap_perform_majority_voting'></span>

<h3>Description</h3>

<p>Read parsed knowledge sources and identify CUIs.
Generate a list of CUIs that appear in at least half of the sources.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>phecap_perform_majority_voting(
  input_folder)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="phecap_perform_majority_voting_+3A_input_folder">input_folder</code></td>
<td>

<p>a character scalar for the path to the folder that contains the parsed knowledge sources
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A character vector consisting of CUIs that
pass the majority voting criterion.
</p>

<hr>
<h2 id='phecap_plot_roc_curves'>
Plot ROC and Related Curves for Phenotyping Models
</h2><span id='topic+phecap_plot_roc_curves'></span>

<h3>Description</h3>

<p>Plot ROC-like curves to illustrate phenotyping accuracy.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>phecap_plot_roc_curves(
  x, axis_x = "1 - spec", axis_y = "sen",
  what = c("training", "random-splits", "validation"),
  ggplot = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="phecap_plot_roc_curves_+3A_x">x</code></td>
<td>

<p>either a single object of class PhecapModel or PhecapValidation
(returned from <code>phecap_train_phenotyping_model</code> or
<code>phecap_validate_phenotyping_model</code>), or a named list of such objects
</p>
</td></tr>
<tr><td><code id="phecap_plot_roc_curves_+3A_axis_x">axis_x</code></td>
<td>

<p>an expression that leads to the <code>x</code> coordinate.
Recognized quantities include:
<code>cut</code> (probability cutoff),
<code>pct</code> (percent of predicted cases),
<code>acc</code> (accuracy),
<code>tpr</code> (true positive rate),
<code>fpr</code> (false positive rate),
<code>tnr</code> (true negative rate),
<code>ppv</code> (positive predictive value),
<code>fdr</code> (false discovery rate),
<code>npv</code> (negative predictive value),
<code>sen</code> (sensitivity),
<code>spec</code> (specificity),
<code>prec</code> (precision),
<code>rec</code> (recall),
<code>f1</code> (F1 score).
</p>
</td></tr>
<tr><td><code id="phecap_plot_roc_curves_+3A_axis_y">axis_y</code></td>
<td>

<p>an expression that leads to the <code>y</code> coordinate.
Recognized quantities are the same as those in <code>axis_x</code>.
</p>
</td></tr>
<tr><td><code id="phecap_plot_roc_curves_+3A_what">what</code></td>
<td>

<p>The curves to be included in the figure.
</p>
</td></tr>
<tr><td><code id="phecap_plot_roc_curves_+3A_ggplot">ggplot</code></td>
<td>

<p>if TRUE and ggplot2 is installed, ggplot will be used for the figure.
Otherwise, the base R graphics functions will be used.
</p>
</td></tr>
<tr><td><code id="phecap_plot_roc_curves_+3A_...">...</code></td>
<td>

<p>arguments to be ignored.
</p>
</td></tr>
</table>


<h3>See Also</h3>

<p>See <code><a href="#topic+PheCAP-package">PheCAP-package</a></code> for code examples.
</p>

<hr>
<h2 id='phecap_predict_phenotype'>
Predict Phenotype
</h2><span id='topic+phecap_predict_phenotype'></span>

<h3>Description</h3>

<p>Compute predicted probability of having the phenotype
for each patient in the dataset.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>phecap_predict_phenotype(data, model)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="phecap_predict_phenotype_+3A_data">data</code></td>
<td>

<p>an object of class <code>PhecapData</code>, obtained by calling <code>PhecapData(...)</code>.
</p>
</td></tr>
<tr><td><code id="phecap_predict_phenotype_+3A_model">model</code></td>
<td>

<p>an object of class <code>PhecapModel</code>, probably returned from
<code>phecap_train_phenotyping_model</code>.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>data.frame</code> with two columns:
</p>
<table role = "presentation">
<tr><td><code>patient_index</code></td>
<td>
<p>patient identifier</p>
</td></tr></table>
<p>,
</p>
<table role = "presentation">
<tr><td><code>prediction</code></td>
<td>
<p>predicted phenotype</p>
</td></tr></table>
<p>.
</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+PheCAP-package">PheCAP-package</a></code> for code examples.
</p>

<hr>
<h2 id='phecap_run_feature_extraction'>
Run Surrogate-Assisted Feature Extraction (SAFE)
</h2><span id='topic+phecap_run_feature_extraction'></span>

<h3>Description</h3>

<p>Run surrogate-assisted feature extraction (SAFE)
using unlabeled data and subsampling.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>phecap_run_feature_extraction(
  data, surrogates,
  subsample_size = 1000L, num_subsamples = 200L,
  dropout_proportion = 0, frequency_cutoff = 0.5,
  start_seed = 45600L, verbose = 0L)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="phecap_run_feature_extraction_+3A_data">data</code></td>
<td>

<p>An object of class PhecapData, obtained by calling PhecapData(...)
</p>
</td></tr>
<tr><td><code id="phecap_run_feature_extraction_+3A_surrogates">surrogates</code></td>
<td>

<p>A list of objects of class PhecapSurrogate, obtained by something like
list(PhecapSurrogate(...), PhecapSurrogate(...))
</p>
</td></tr>
<tr><td><code id="phecap_run_feature_extraction_+3A_subsample_size">subsample_size</code></td>
<td>

<p>An integer scalar giving the size of each subsample
</p>
</td></tr>
<tr><td><code id="phecap_run_feature_extraction_+3A_num_subsamples">num_subsamples</code></td>
<td>

<p>The number of subsamples drawn for each surrogate
</p>
</td></tr>
<tr><td><code id="phecap_run_feature_extraction_+3A_dropout_proportion">dropout_proportion</code></td>
<td>

<p>A scalar between 0 and 1. If it is positive,
for each predictor a random subset of observations will be set to zero
</p>
</td></tr>
<tr><td><code id="phecap_run_feature_extraction_+3A_frequency_cutoff">frequency_cutoff</code></td>
<td>

<p>A scalar between 0 and 1.
Variables selected in at least this proportion of the subsamples
are the variables finally selected
</p>
</td></tr>
<tr><td><code id="phecap_run_feature_extraction_+3A_start_seed">start_seed</code></td>
<td>

<p>in the i-th subsample, the seed is set to start_seed + i
</p>
</td></tr>
<tr><td><code id="phecap_run_feature_extraction_+3A_verbose">verbose</code></td>
<td>

<p>print progress every <code>verbose</code> subsample if <code>verbose</code> is positive,
or remain quiet if <code>verbose</code> is zero
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>In this unlabeled setting, the extremes of each surrogate
are used to define cases and controls.
The variables selected are
those selected in at least half (or the proportion specified)
of the subsamples.
</p>


<h3>Value</h3>

<p>An object of class <code>PhecapFeatureExtraction</code>, with components
</p>
<table role = "presentation">
<tr><td><code>selected</code></td>
<td>
<p>the names of selected features</p>
</td></tr>
<tr><td><code>frequency</code></td>
<td>
<p>the proportion of being selected for each feature</p>
</td></tr>
</table>


<h3>See Also</h3>

<p>See <code><a href="#topic+PheCAP-package">PheCAP-package</a></code> for code examples.
</p>

<hr>
<h2 id='phecap_train_phenotyping_model'>
Train Phenotyping Model using the Training Labels
</h2><span id='topic+phecap_train_phenotyping_model'></span>

<h3>Description</h3>

<p>Train the phenotyping model on the training dataset,
and evaluate its performance via random splits of the training dataset.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>phecap_train_phenotyping_model(
  data, surrogates, feature_selected,
  method = "lasso_bic",
  train_percent = 0.7, num_splits = 200L,
  start_seed = 78900L, verbose = 0L)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="phecap_train_phenotyping_model_+3A_data">data</code></td>
<td>

<p>an object of class <code>PhecapData</code>, obtained by calling <code>PhecapData(...)</code>.
</p>
</td></tr>
<tr><td><code id="phecap_train_phenotyping_model_+3A_surrogates">surrogates</code></td>
<td>

<p>a list of objects of class <code>PhecapSurrogate</code>, obtained by something like
<code>list(PhecapSurrogate(...), PhecapSurrogate(...))</code>.
The surrogates used here might be different from
that used in feature extraction.
</p>
</td></tr>
<tr><td><code id="phecap_train_phenotyping_model_+3A_feature_selected">feature_selected</code></td>
<td>

<p>a character vector of the features that should be included in the model,
probably returned by <code>phecap_run_feature_extraction</code>
(but not necessary).
The features listed here might be different from
those returned from feature extraction.
</p>
</td></tr>
<tr><td><code id="phecap_train_phenotyping_model_+3A_method">method</code></td>
<td>

<p>Either a character vector or a list of two components.
If a character vector is used, possible entries are given below.
When at least two methods are specified,
the predicted probability is the simple average of the
predicted probabilities from each method.
</p>

<ul>
<li> <p><code>'plain'</code> (logistic regression without penalty)
</p>
</li>
<li> <p><code>'ridge_cv'</code> (logistic regression with ridge penalty and CV tuning)
</p>
</li>
<li> <p><code>'lasso_cv'</code> (logistic regression with lasso penalty and CV tuning)
</p>
</li>
<li> <p><code>'lasso_bic'</code> (logistic regression with lasso penalty and BIC tuning)
</p>
</li>
<li> <p><code>'alasso_cv'</code> (logistic regression with adaptive lasso penalty and CV tuning)
</p>
</li>
<li> <p><code>'alasso_bic'</code> (logistic regression with adaptive lasso penalty and BIC tuning)
</p>
</li>
<li> <p><code>'svm'</code> (support vector machine with CV tuning, package <code>e1071</code> needed, <code>subject_weight</code> not supported)
</p>
</li>
<li> <p><code>'rf'</code> (random forest with default parameters, package <code>randomForestSRC</code> needed)
</p>
</li>
<li> <p><code>'xgb'</code> (extreme gradient boosting with default parameters, package <code>xgboost</code> needed)
</p>
</li></ul>

<p>If a list is used, it should contain two named components as follows.
</p>

<ul>
<li> <p><code>fit</code> (a function for model fitting, with arguments <code>x</code>, <code>y</code>, <code>subject_weight</code>, <code>penalty_weight</code>)
</p>
</li>
<li> <p><code>predict</code> (a function for prediction, with arguments <code>object</code> which was returned by <code>fit</code>, <code>x</code> which was used as the new data to predict on)
</p>
</li></ul>

</td></tr>
<tr><td><code id="phecap_train_phenotyping_model_+3A_train_percent">train_percent</code></td>
<td>

<p>The percentage (between 0 and 1) of labels that are used for model training
during random splits
</p>
</td></tr>
<tr><td><code id="phecap_train_phenotyping_model_+3A_num_splits">num_splits</code></td>
<td>

<p>The number of random splits.
</p>
</td></tr>
<tr><td><code id="phecap_train_phenotyping_model_+3A_start_seed">start_seed</code></td>
<td>

<p>in the i-th split, the seed is set to start_seed + i.
</p>
</td></tr>
<tr><td><code id="phecap_train_phenotyping_model_+3A_verbose">verbose</code></td>
<td>

<p>print progress every verbose splits if verbose is positive,
or remain quiet if verbose is zero
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code>PhecapModel</code>, with components
</p>
<table role = "presentation">
<tr><td><code>coefficients</code></td>
<td>
<p>the fitted object</p>
</td></tr>
<tr><td><code>method</code></td>
<td>
<p>the method used for model training</p>
</td></tr>
<tr><td><code>feature_selected</code></td>
<td>
<p>the feature selected by SAFE</p>
</td></tr>
<tr><td><code>train_roc</code></td>
<td>
<p>ROC on training dataset</p>
</td></tr>
<tr><td><code>train_auc</code></td>
<td>
<p>AUC on training dataset</p>
</td></tr>
<tr><td><code>split_roc</code></td>
<td>
<p>average ROC on random splits of training dataset</p>
</td></tr>
<tr><td><code>split_auc</code></td>
<td>
<p>average AUC on random splits of training dataset</p>
</td></tr>
<tr><td><code>fit_function</code></td>
<td>
<p>the function used for fitting</p>
</td></tr>
<tr><td><code>predict_function</code></td>
<td>
<p>the function used for prediction</p>
</td></tr>
</table>


<h3>See Also</h3>

<p>See <code><a href="#topic+PheCAP-package">PheCAP-package</a></code> for code examples.
</p>

<hr>
<h2 id='phecap_validate_phenotyping_model'>
Validate the Phenotyping Model using the Validation Labels
</h2><span id='topic+phecap_validate_phenotyping_model'></span>

<h3>Description</h3>

<p>Apply the trained model to all patients in the validation dataset,
and measure the prediction accuracy via ROC and AUC.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>phecap_validate_phenotyping_model(data, model)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="phecap_validate_phenotyping_model_+3A_data">data</code></td>
<td>

<p>an object of class <code>PhecapData</code>, obtained by calling <code>PhecapData(...)
</code></p>
</td></tr>
<tr><td><code id="phecap_validate_phenotyping_model_+3A_model">model</code></td>
<td>

<p>an object of class <code>PhecapModel</code>, obtained by calling
<code>phecap_train_phenotyping_model</code>.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code>PhecapValidation</code>, with components
</p>
<table role = "presentation">
<tr><td><code>method</code></td>
<td>
<p>the method used for model training</p>
</td></tr>
<tr><td><code>train_roc</code></td>
<td>
<p>ROC on training dataset</p>
</td></tr>
<tr><td><code>train_auc</code></td>
<td>
<p>AUC on training dataset</p>
</td></tr>
<tr><td><code>split_roc</code></td>
<td>
<p>average ROC on random splits of training dataset</p>
</td></tr>
<tr><td><code>split_auc</code></td>
<td>
<p>average AUC on random splits of training dataset</p>
</td></tr>
<tr><td><code>valid_roc</code></td>
<td>
<p>ROC on validation dataset</p>
</td></tr>
<tr><td><code>valid_auc</code></td>
<td>
<p>AUC on validation dataset</p>
</td></tr>
</table>


<h3>See Also</h3>

<p>See <code><a href="#topic+PheCAP-package">PheCAP-package</a></code> for code examples.
</p>

<hr>
<h2 id='PhecapData'>
Define or Read Datasets for Phenotyping
</h2><span id='topic+PhecapData'></span>

<h3>Description</h3>

<p>Specify the data to be used for phenotyping.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PhecapData(
  data, hu_feature, label, validation,
  patient_id = NULL, subject_weight = NULL,
  seed = 12300L, feature_transformation = log1p)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="PhecapData_+3A_data">data</code></td>
<td>

<p>A data.frame consisting of all the variables needed for phenotyping,
or a character scalar of the path to the data,
or a list consisting of either character scalar or data.frame.
If a list is given, patient_id cannot be NULL.
All the datasets in the list will be joined into a single dataset
according to the columns specified by patient_id.
</p>
</td></tr>
<tr><td><code id="PhecapData_+3A_hu_feature">hu_feature</code></td>
<td>

<p>A character scalar or vector specifying the names of
one of more healthcare utilization (HU) variables.
There variables are always included in the phenotyping model.
</p>
</td></tr>
<tr><td><code id="PhecapData_+3A_label">label</code></td>
<td>

<p>A character scalar of the column name that gives the phenotype status
(1 or TRUE: present, 0 or FALSE: absent).
If label is not ready yet, just put a column filled with NA in data.
In such cases only the feature extraction step can be done.
</p>
</td></tr>
<tr><td><code id="PhecapData_+3A_validation">validation</code></td>
<td>

<p>A character scalar, a real number strictly between 0 and 1,
or an integer not less than 2.
If a character scalar is used, it is treated as the column name
in the data that specifies whether this observation
belongs to the validation samples
(1 or TRUE: validation, 0 or FALSE: training).
If a real number strictly between 0 and 1 is used, it is treated as
the proportion of the validation samples. The actual validation samples
will be drawn from all labeled samples.
If an integer not less than 2 is used, it is treated as
the size of the validation samples. The actual validation samples
will be drawn from all labeled samples.
</p>
</td></tr>
<tr><td><code id="PhecapData_+3A_patient_id">patient_id</code></td>
<td>

<p>A character vector for the column names, if any, that uniquely identifies
each patient.
Such variables must appear in the data.
patient_id can be NULL if such fields are not contained in the data.
</p>
</td></tr>
<tr><td><code id="PhecapData_+3A_subject_weight">subject_weight</code></td>
<td>

<p>An optional numeric vector of weights for observations.
</p>
</td></tr>
<tr><td><code id="PhecapData_+3A_seed">seed</code></td>
<td>

<p>If validation samples need to be drawn from all labeled samples,
seed specifies the random seed for sampling.
</p>
</td></tr>
<tr><td><code id="PhecapData_+3A_feature_transformation">feature_transformation</code></td>
<td>

<p>A function that will be applied to all the features.
Since count data are typically right-skewed,
by default <code>log1p</code> will be used.
feature_transformation can be NULL, in which case
no transformation will be done on any of the feature.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code>PhecapData</code>.
</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+PheCAP-package">PheCAP-package</a></code> for code examples.
</p>

<hr>
<h2 id='PhecapSurrogate'>
Define a Surrogate Variable used in
Surrogate-Assisted Feature Extraction (SAFE)
</h2><span id='topic+PhecapSurrogate'></span>

<h3>Description</h3>

<p>Define a surrogate varible from existing features, and specify
associated lower and upper cutoffs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PhecapSurrogate(variable_names, lower_cutoff = 1L, upper_cutoff = 10L)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="PhecapSurrogate_+3A_variable_names">variable_names</code></td>
<td>

<p>a character scalar or vector consisting of variable names.
If a vector is given, the value of the surrogate is defined as the sum of
the values of each variable.
</p>
</td></tr>
<tr><td><code id="PhecapSurrogate_+3A_lower_cutoff">lower_cutoff</code></td>
<td>

<p>a numeric scalar. If the surrogate value of a patient is less than or equal to this cutoff,
then this patient is treated as a control in SAFE.
</p>
</td></tr>
<tr><td><code id="PhecapSurrogate_+3A_upper_cutoff">upper_cutoff</code></td>
<td>

<p>a numeric scalar. If the surrogate value of a patient is greater than or equal to this cutoff,
then this patient is treated as a case in SAFE.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function only stores the definition. No calculation is done.
</p>


<h3>Value</h3>

<p>An object of class <code>PhecapSurrogate</code>.
</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+PheCAP-package">PheCAP-package</a></code> for code examples.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
