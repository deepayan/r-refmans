<!DOCTYPE html><html><head><title>Help for package surveil</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {surveil}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#surveil-package'><p>The 'surveil' package</p></a></li>
<li><a href='#apc'><p>Annual and cumulative percent change</p></a></li>
<li><a href='#cancer'><p>US cancer incidence by age, 1999-2017</p></a></li>
<li><a href='#group_diff'><p>Measures of pairwise inequality</p></a></li>
<li><a href='#msa'><p>Colorectal cancer incidence by Texas MSA, 1999-2017, ages 50-79</p></a></li>
<li><a href='#plot.surveil'><p>Methods for fitted <code>surveil</code> models</p></a></li>
<li><a href='#plot.theil'><p>Methods for Theil's index</p></a></li>
<li><a href='#print.apc'><p>Methods for APC objects</p></a></li>
<li><a href='#print.stand_surveil'><p>Methods for age-standardized rates</p></a></li>
<li><a href='#priors'><p>Prior distributions</p></a></li>
<li><a href='#stan_rw'><p>Time series models for mortality and disease incidence</p></a></li>
<li><a href='#standard'><p>2000 U.S. standard million population</p></a></li>
<li><a href='#standardize'><p>Age-standardized rates</p></a></li>
<li><a href='#surveil_diff'><p>Methods for <code>surveil_diff</code> objects</p></a></li>
<li><a href='#theil'><p>Theil's inequality index</p></a></li>
<li><a href='#waic'><p>Widely Applicable Information Criteria</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Time Series Models for Disease Surveillance</td>
</tr>
<tr>
<td>Version:</td>
<td>0.3.0</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-07-07</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://connordonegan.github.io/surveil/">https://connordonegan.github.io/surveil/</a>,
<a href="https://github.com/ConnorDonegan/surveil/">https://github.com/ConnorDonegan/surveil/</a></td>
</tr>
<tr>
<td>Description:</td>
<td>Fits time trend models for routine disease surveillance tasks and returns probability distributions for a variety of quantities of interest, including age-standardized rates, period and cumulative percent change, and measures of health inequality. The models are appropriate for count data such as disease incidence and mortality data, employing a Poisson or binomial likelihood and the first-difference (random-walk) prior for unknown risk. Optionally add a covariance matrix for multiple, correlated time series models. Inference is completed using Markov chain Monte Carlo via the Stan modeling language. References: Donegan, Hughes, and Lee (2022) &lt;<a href="https://doi.org/10.2196%2F34589">doi:10.2196/34589</a>&gt;; Stan Development Team (2021) <a href="https://mc-stan.org">https://mc-stan.org</a>; Theil (1972, ISBN:0-444-10378-3).</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.1</td>
</tr>
<tr>
<td>Biarch:</td>
<td>true</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>rstantools (&ge; 2.1.1), methods, Rcpp (&ge; 0.12.0), RcppParallel
(&ge; 5.0.1), rstan (&ge; 2.26.0), tidybayes (&ge; 3.0.0), dplyr (&ge;
1.0.7), rlang (&ge; 0.4.0), tidyr (&ge; 1.1.0), ggplot2 (&ge; 3.0.0),
gridExtra (&ge; 2.0), scales (&ge; 0.4.0), ggdist (&ge; 3.0.0)</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>BH (&ge; 1.66.0), Rcpp (&ge; 0.12.0), RcppEigen (&ge; 0.3.3.3.0),
RcppParallel (&ge; 5.0.1), rstan (&ge; 2.26.0), StanHeaders (&ge;
2.26.0)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>rmarkdown, knitr, testthat</td>
</tr>
<tr>
<td>SystemRequirements:</td>
<td>GNU make</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-07-08 14:44:26 UTC; connor</td>
</tr>
<tr>
<td>Author:</td>
<td>Connor Donegan <a href="https://orcid.org/0000-0002-9698-5443"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Connor Donegan &lt;connor.donegan@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-07-08 15:30:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='surveil-package'>The 'surveil' package</h2><span id='topic+surveil-package'></span><span id='topic+surveil'></span>

<h3>Description</h3>

<p>Fits time series models for routine disease surveillance tasks and returns probability distributions for a variety of quantities of interest, including measures of health inequality, period and cumulative percent change, and age-standardized rates. Calculates Theil's index to measure inequality among multiple groups, and can be extended to measure inequality across multiple groups nested within geographies. Inference is completed using Markov chain Monte Carlo via the Stan modeling language. The models are appropriate for disease incidence and mortality data, employing a Poisson or binomial likelihood and first-difference (random-walk) prior for unknown risk, and optional covariance matrix for multiple correlated time series models.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Connor Donegan <a href="mailto:connor.donegan@gmail.com">connor.donegan@gmail.com</a> (<a href="https://orcid.org/0000-0002-9698-5443">ORCID</a>)
</p>


<h3>References</h3>

<p>Brandt P, Williams JT. Multiple time series models. Thousand Oaks, CA: SAGE Publications, 2007. ISBN:9781412906562
</p>
<p>Clayton DG. Generalized linear mixed models. In: Gilks WR, Richardson S, Spiegelhalter DJ, editors. Markov chain Monte Carlo in practice. Boca Raton, FL: CRC Press, 1996. p. 275-302. ISBN:9780412055515
</p>
<p>Conceicao P, Galbraith JK, Bradford P. The Theil Index in sequences of nested and hierarchic grouping structures: implications for the measurement of inequality through time, with data aggregated at different levels of industrial classification. Eastern Economic Journal 2001;27(4):491-514.
</p>
<p>Donegan C, Hughes AE, and Lee SC (2022). Colorectal Cancer Incidence, Inequalities, and Prevention Priorities in Urban Texas: Surveillance Study With the &quot;surveil&quot; Software Package. <em>JMIR Public Health &amp; Surveillance</em> 8(8):e34589. <a href="https://doi.org/10.2196/34589">doi:10.2196/34589</a>
</p>
<p>Stan Development Team (2020). RStan: the R interface to Stan. R package version 2.21.2. https://mc-stan.org
</p>
<p>Theil H. Statistical decomposition analysis. Amsterdam, The Netherlands: North-Holland Publishing Company, 1972. ISBN:0444103783
</p>


<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://connordonegan.github.io/surveil/">https://connordonegan.github.io/surveil/</a>
</p>
</li>
<li> <p><a href="https://github.com/ConnorDonegan/surveil/">https://github.com/ConnorDonegan/surveil/</a>
</p>
</li></ul>


<hr>
<h2 id='apc'>Annual and cumulative percent change</h2><span id='topic+apc'></span><span id='topic+apc.surveil'></span><span id='topic+apc.stand_surveil'></span>

<h3>Description</h3>

<p>Summarize annual and cumulative percent change in risk
</p>


<h3>Usage</h3>

<pre><code class='language-R'>apc(x)

## S3 method for class 'surveil'
apc(x)

## S3 method for class 'stand_surveil'
apc(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="apc_+3A_x">x</code></td>
<td>
<p>A fitted <code>surviel</code> model, or standardized rates (a <code>stand_surveil</code> object).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An <code>apc</code> (list) object containing the following data frames:
</p>

<dl>
<dt>apc</dt><dd><p>A data frame containing a summary of the posterior distribution for period-specific percent change. This contains the posterior mean (<code>apc</code>) 95 percent credible intervals (<code>lwr</code> and <code>upr</code> bounds).</p>
</dd>
<dt>cpc</dt><dd><p>A data frame containing a summary of the posterior distribution for the cumulative percent change in risk at each time period. This contains the posterior mean (<code>cpc</code>) and 95 percent credible interval (<code>lwr</code> and <code>upr</code> bounds).</p>
</dd>
<dt>apc_samples</dt><dd><p>MCMC samples from the posterior distribution for period percent change</p>
</dd>
<dt>cpc_samples</dt><dd><p>MCMC samples from the posterior distribution for cumulative percent change</p>
</dd>
</dl>



<h3>See Also</h3>

<p><code><a href="#topic+plot.apc">plot.apc</a></code> <code><a href="#topic+print.apc">print.apc</a></code> <code><a href="#topic+stan_rw">stan_rw</a></code> <code><a href="#topic+standardize">standardize</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(cancer)
cancer2 &lt;- subset(cancer, grepl("55|60|65|70", Age))
fit &lt;- stan_rw(cancer2, time = Year, group = Age,
                iter = 900) # low iter for speed only
 x &lt;- apc(fit)
 print(x)
 plot(x, cumulative = TRUE)
</code></pre>

<hr>
<h2 id='cancer'>US cancer incidence by age, 1999-2017</h2><span id='topic+cancer'></span>

<h3>Description</h3>

<p>Annual cancer cases (all sites) by age group for the United States.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cancer
</code></pre>


<h3>Format</h3>

<p>A data frame with the following columns:
</p>

<dl>
<dt>Year</dt><dd><p>Year of diagnosis</p>
</dd>
<dt>Age</dt><dd><p>Age group</p>
</dd>
<dt>Count</dt><dd><p>Number of cancer cases</p>
</dd>
<dt>Population</dt><dd><p>Age-specific population estimates</p>
</dd>
</dl>



<h3>Source</h3>

<p>United States Cancer Statistics - Incidence: 1999 - 2017, WONDER Online Database. United States Department of Health and Human Services, Centers for Disease Control and Prevention and National Cancer Institute; 2020. Accessed at <a href="http://wonder.cdc.gov/cancer-v2017.html">http://wonder.cdc.gov/cancer-v2017.html</a> on Oct 6, 2021 12:38:09 PM
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(cancer)
head(cancer)
</code></pre>

<hr>
<h2 id='group_diff'>Measures of pairwise inequality</h2><span id='topic+group_diff'></span><span id='topic+group_diff.surveil'></span><span id='topic+group_diff.list'></span>

<h3>Description</h3>

<p>Calculate pairwise measures of health inequality from a fitted <code>surveil</code> time series model, with credible intervals and MCMC samples. Calculates absolute and fractional rate differences (RD and population attributable risk (PAR)), rate ratios, and excess cases.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>group_diff(x, target, reference)

## S3 method for class 'surveil'
group_diff(x, target, reference)

## S3 method for class 'list'
group_diff(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="group_diff_+3A_x">x</code></td>
<td>
<p>Either a fitted <code>surveil</code> time series model, or a list of two <code>stand_surveil</code> objects (i.e., <code>surveil</code> models with age-standardized rates, as returned by <code><a href="#topic+standardize">standardize</a></code>). If <code>x</code> is a list of <code>stand_surveil</code> objects, see details below and note that the models must contain the same number of MCMC samples&mdash;to ensure this is the case, when using <code>stan_rw</code> set <code>iter</code> and <code>chains</code> to the same values for each of the two models.</p>
</td></tr>
<tr><td><code id="group_diff_+3A_target">target</code></td>
<td>
<p>The name (character string) of the disadvantaged group that is the target of inference. If <code>x</code> is a list of <code>stand_surveil</code> objects, the <code>target</code> argument is ignored and the first listed model will serve as the <code>target</code> group.</p>
</td></tr>
<tr><td><code id="group_diff_+3A_reference">reference</code></td>
<td>
<p>The name (character string) of the reference group to which <code>target</code> will be compared. If <code>x</code> is a list of <code>stand_surveil</code> objects, the <code>reference</code> argument is ignored and the second listed model will serve as the <code>reference</code> group.</p>
</td></tr>
<tr><td><code id="group_diff_+3A_...">...</code></td>
<td>
<p>Additional arguments (not used).</p>
</td></tr>
</table>


<h3>Details</h3>



<h4>Comparing incidence rates</h4>

<p>For the following calculations, the terms <code>reference</code> and <code>target</code> refer to incidence rates for the respective groups; <code>p</code> is the size of the target population. (Target is the group that is the 'target' of our inferences, so that it is the numerator in rate ratios, etc.) The following measures are calculated by <code>group_diff</code>:
</p>
<div class="sourceCode"><pre># rate difference
RD = target - reference
# population attributable fraction
PAR = RD/target = (RR - 1)/RR
# rate ratio
RR = target/reference
# excess cases
EC = RD * p
</pre></div>
<p>As the math communicates, the PAR is the rate difference expressed as a fraction of total risk for the target population. This could also be read as the fraction of risk in the target population that would have been removed had the target rate equaled the reference rate (Menvielle et al. 2017).
</p>



<h4>Comparing age-standardized rates</h4>

<p>If the user provides a list of <code>stand_surveil</code> objects with age-standardized rates (instead of a single <code>surveil</code> model), then the exact calculations will be completed as follows. The RR is simply the ratio of age-standardized rates, and the rate difference is similarly the difference between age-standardized rates. However, excess cases is calculated for each age group separately, and the total excess cases across all age groups is returned. Similarly, the attributable risk is calculated by taking the total excess cases across all age groups per year and dividing by the total risk (i.e., by the sum of the whole number of cases across all age groups). Cumulative excess cases is the sum of the time-period specific total number of excess cases. (Notice that the PAR is not equal to (RR-1)/RR when the PAR is derived from a number of age-specific rates and the RR is based on age-standardized rates.)
</p>



<h3>Value</h3>

<p>A list, also of class &quot;surveil_diff&quot;, with the following elements: </p>

<dl>
<dt>summary</dt><dd><p>A tibble with a summary of posterior distributions (mean and 95 percent cred. intervals) for the target group incidence rate, the RD, RR, PAR, and excess cases.</p>
</dd>
<dt>cumulative_cases</dt><dd><p>Summary of the posterior distribution for the cumulative number of excess cases and the PAR (mean and 95 percent cred. intervals)</p>
</dd>
<dt>groups</dt><dd><p>Character string with target and reference population names</p>
</dd>
<dt>samples</dt><dd><p>A data frame of MCMC samples for each quantity of interest (target and reference rates, RD, RR, PAR, and EC, as well as <code>Trend_Cases = Rate * Population</code>). Indexed by time.</p>
</dd>
<dt>cum_samples</dt><dd><p>MCMC samples of the cumulative number of excess cases.</p>
</dd>
</dl>



<h3>Author(s)</h3>

<p>Connor Donegan (Connor.Donegan@UTSouthwestern.edu)
</p>


<h3>Source</h3>

<p>Menvielle, G, Kulhanaova, I, Machenbach, JP. Assessing the impact of a public health intervention to reduce social inequalities in cancer. In: Vaccarella, S, Lortet-Tieulent, J, Saracci, R, Conway, D, Straif, K, Wild, CP, editors. Reducing Social Inequalities in Cancer: Evidence and Priorities for Research. Geneva, Switzerland: WHO Press, 2017:185-192.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+plot.surveil_diff">plot.surveil_diff</a></code> <code><a href="#topic+print.surveil_diff">print.surveil_diff</a></code> <code><a href="#topic+theil">theil</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(msa)
dat = subset(msa, grepl("Houston", MSA) &amp; grepl("Black|White", Race))
fit &lt;- stan_rw(dat, time = Year, group = Race,
               iter = 1e3) # low iter for speed only
gd &lt;- group_diff(fit, "Black or African American", "White")
print(gd, scale = 100e3)
plot(gd, scale = 100e3)

</code></pre>

<hr>
<h2 id='msa'>Colorectal cancer incidence by Texas MSA, 1999-2017, ages 50-79</h2><span id='topic+msa'></span>

<h3>Description</h3>

<p>Annual counts of colorectal cancer (cancer of colon or rectum), ages 50-79, for Texas's top four metropolitan statistical areas (MSAs), with population at risk estimates, by race-ethnicity (non-Hispanic White, non-Hispanic Black, Hispanic/Latino).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>msa
</code></pre>


<h3>Format</h3>

<p>A <code>tibble</code> with the following attributes:
</p>

<dl>
<dt>Year</dt><dd><p>Year of diagnosis</p>
</dd>
<dt>Race</dt><dd><p>Race-ethnicity designation</p>
</dd>
<dt>MSA</dt><dd><p>Metropolitan statistical area</p>
</dd>
<dt>Count</dt><dd><p>Number of CRC cases</p>
</dd>
<dt>Population</dt><dd><p>Age-specific population estimate</p>
</dd>
</dl>



<h3>Source</h3>

<p>United States Cancer Statistics&ndash;Incidence: 1999-2017, WONDER Online Database. United States Department of Health and Human Services, Centers for Disease Control and Prevention and National Cancer Institute; 2020. Accessed at <a href="http://wonder.cdc.gov/cancer-v2017.html">http://wonder.cdc.gov/cancer-v2017.html</a> on Nov 9, 2020 2:59:24 PM.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(msa)
head(msa)
</code></pre>

<hr>
<h2 id='plot.surveil'>Methods for fitted <code>surveil</code> models</h2><span id='topic+plot.surveil'></span><span id='topic+print.surveil'></span><span id='topic+plot.list'></span>

<h3>Description</h3>

<p>Print and plot methods for <code>surveil</code> model results
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'surveil'
print(x, scale = 1, ...)

## S3 method for class 'surveil'
plot(
  x,
  scale = 1,
  style = c("mean_qi", "lines"),
  facet = FALSE,
  facet_scales = c("fixed", "free"),
  ncol = NULL,
  base_size = 14,
  palette = "Dark2",
  M = 250,
  alpha,
  lwd,
  fill = "gray80",
  size = 1.5,
  ...
)

## S3 method for class 'list'
plot(
  x,
  scale = 1,
  style = c("mean_qi", "lines"),
  facet = FALSE,
  ncol,
  facet_scales = c("fixed", "free"),
  M = 250,
  base_size = 14,
  palette = "Dark2",
  fill = "gray80",
  size = 1.5,
  alpha,
  lwd,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.surveil_+3A_x">x</code></td>
<td>
<p>A fitted <code>surveil</code> model, or a list of <code>stand_surveil</code> objects (as produced by <code><a href="#topic+standardize">standardize</a></code>).</p>
</td></tr>
<tr><td><code id="plot.surveil_+3A_scale">scale</code></td>
<td>
<p>Scale the rates by this amount; e.g., <code>scale = 100e3</code> will print rates per 100,000 at risk.</p>
</td></tr>
<tr><td><code id="plot.surveil_+3A_...">...</code></td>
<td>
<p>For the plot method, additional arguments will be passed to '<code><a href="ggplot2.html#topic+theme">theme</a></code>; for the print method, additional arguments will be passed to <code><a href="base.html#topic+print.data.frame">print.data.frame</a></code>.</p>
</td></tr>
<tr><td><code id="plot.surveil_+3A_style">style</code></td>
<td>
<p>If <code>style = "mean_qi"</code>, then the posterior mean and 95 percent credible interval will be plotted; if <code>style = "lines"</code>, then <code>M</code> samples from the joint probability distribution of the annual rates will be plotted.</p>
</td></tr>
<tr><td><code id="plot.surveil_+3A_facet">facet</code></td>
<td>
<p>If <code>facet = TRUE</code>, <code><a href="ggplot2.html#topic+facet_wrap">facet_wrap</a></code> will be used instead of differentiating by line color.</p>
</td></tr>
<tr><td><code id="plot.surveil_+3A_facet_scales">facet_scales</code></td>
<td>
<p>When <code>facet = TRUE</code>, this argument controls behavior of the scales for each sub-plot. See the <code>scales</code> argument to <code><a href="ggplot2.html#topic+facet_wrap">facet_wrap</a></code>.</p>
</td></tr>
<tr><td><code id="plot.surveil_+3A_ncol">ncol</code></td>
<td>
<p>Number of columns for the plotting device; optional and only used if <code>facet = TRUE</code>. If <code>ncol = 1</code>, the three plots will be aligned vertically in one column; if <code>ncol = 3</code> they will b aligned horizontally in one row. Defaults to <code>ncol = NULL</code> to allow <code><a href="ggplot2.html#topic+facet_wrap">facet_wrap</a></code> to automatically determine the number of columns.</p>
</td></tr>
<tr><td><code id="plot.surveil_+3A_base_size">base_size</code></td>
<td>
<p>Passed to <code>theme_classic()</code> to control size of plot components (text).</p>
</td></tr>
<tr><td><code id="plot.surveil_+3A_palette">palette</code></td>
<td>
<p>For multiple groups, choose the color palette. For a list of options, see <code><a href="ggplot2.html#topic+scale_color_brewer">scale_color_brewer</a></code>. The default is <code>palette = "Dark2"</code>. Not used if <code>facet = TRUE</code>.</p>
</td></tr>
<tr><td><code id="plot.surveil_+3A_m">M</code></td>
<td>
<p>If <code>style = "lines"</code>, then <code>M</code> is the number of samples from the posterior distribution that will be plotted; the default is <code>M = 250</code>.</p>
</td></tr>
<tr><td><code id="plot.surveil_+3A_alpha">alpha</code></td>
<td>
<p>Numeric value from zero to one. When <code>style = "lines"</code>,  this controls transparency of lines; passed to <code><a href="ggplot2.html#topic+geom_line">geom_line</a></code>. For 'style = &quot;mean_qi&quot;, this controls the transparency of the shaded credible interval; passed to <code><a href="ggplot2.html#topic+geom_ribbon">geom_ribbon</a></code>.</p>
</td></tr>
<tr><td><code id="plot.surveil_+3A_lwd">lwd</code></td>
<td>
<p>Numeric value indicating linewidth. Passed to <code><a href="ggplot2.html#topic+geom_line">geom_line</a></code></p>
</td></tr>
<tr><td><code id="plot.surveil_+3A_fill">fill</code></td>
<td>
<p>Color for the shaded credible intervals; only used when <code>style = "mean_qi"</code>.</p>
</td></tr>
<tr><td><code id="plot.surveil_+3A_size">size</code></td>
<td>
<p>Positive numeric value. For <code>style = "mean_qi"</code>, this controls the size of the points representing crude rates. To exclude these points from the plot altogether, use <code>size = 0</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The plot method returns a <code>ggplot</code> object; the print method returns nothing but prints a summary of results to the R console. If <code>x</code> is a list of <code>stand_surveil</code> objects, the plotted lines will be labeled using the names returned by <code>names(x)</code>; if elements of the list are not named, plotted lines will simply be numbered.
</p>


<h3>Author(s)</h3>

<p>Connor Donegan (Connor.Donegan@UTSouthwestern.edu)
</p>


<h3>See Also</h3>

<p><code><a href="#topic+stan_rw">stan_rw</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(msa)
dat &lt;- aggregate(cbind(Count, Population) ~ Year + Race, data = msa, FUN = sum)
fit &lt;- stan_rw(dat, time = Year, group = Race,
               iter = 1e3, chains = 2) # for speed only, use 4 chains

print(fit)
plot(fit, facet = TRUE, scale = 100e3)

 ## as a ggplot, you can customize the output
library(ggplot2)
plot(fit) + theme_bw()

</code></pre>

<hr>
<h2 id='plot.theil'>Methods for Theil's index</h2><span id='topic+plot.theil'></span><span id='topic+plot.theil_list'></span><span id='topic+print.theil'></span><span id='topic+print.theil_list'></span>

<h3>Description</h3>

<p>Printing and plotting methods for Theil's inequality index
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'theil'
plot(
  x,
  style = c("mean_qi", "lines"),
  M = 250,
  col = "black",
  fill = "black",
  alpha,
  lwd,
  base_size = 14,
  scale = 100,
  labels = x$summary$time,
  ...
)

## S3 method for class 'theil_list'
plot(
  x,
  style = c("mean_qi", "lines"),
  M = 250,
  col = "black",
  fill = "black",
  alpha,
  lwd,
  between_title = "Between",
  within_title = "Within",
  total_title = "Total",
  scale = 100,
  plot = TRUE,
  ncol = 3,
  base_size = 14,
  ...
)

## S3 method for class 'theil'
print(x, scale = 100, digits = 3, ...)

## S3 method for class 'theil_list'
print(x, scale = 100, digits = 3, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.theil_+3A_x">x</code></td>
<td>
<p>An object of class <code style="white-space: pre;">&#8288;thiel' or &#8288;</code>theil_list<code style="white-space: pre;">&#8288;, as returned by calling &#8288;</code>theil<code style="white-space: pre;">&#8288;on a list of fitted&#8288;</code>surveil' models</p>
</td></tr>
<tr><td><code id="plot.theil_+3A_style">style</code></td>
<td>
<p>If <code>style = "mean_qi"</code>, then the posterior mean and 95 percent credible interval will be plotted; if <code>style = "lines"</code>, then <code>M</code> samples from the joint probability distribution will be plotted.</p>
</td></tr>
<tr><td><code id="plot.theil_+3A_m">M</code></td>
<td>
<p>If <code>style = "lines"</code>, then <code>M</code> is the number of samples from the posterior distribution that will be plotted; the default is <code>M = 250</code>.</p>
</td></tr>
<tr><td><code id="plot.theil_+3A_col">col</code></td>
<td>
<p>Line color</p>
</td></tr>
<tr><td><code id="plot.theil_+3A_fill">fill</code></td>
<td>
<p>Fill color</p>
</td></tr>
<tr><td><code id="plot.theil_+3A_alpha">alpha</code></td>
<td>
<p>For <code>style = "mean_qi"</code>, this controls the transparency for the credible interval (passed to <code><a href="ggplot2.html#topic+geom_ribbon">geom_ribbon</a></code>) and defaults to <code>alpha = 0.5</code>; for <code>style = "lines"</code>, this controls the transparency of the lines and defaults to <code>alpha = 0.7</code>.</p>
</td></tr>
<tr><td><code id="plot.theil_+3A_lwd">lwd</code></td>
<td>
<p>Line width; for <code>style = "mean_qi"</code>, the default is <code>lwd = 1</code>; for <code>style = "lines"</code>, the default is <code>lwd = 0.05</code>.</p>
</td></tr>
<tr><td><code id="plot.theil_+3A_base_size">base_size</code></td>
<td>
<p>Passed to <code>theme_classic</code> to control size of plot elements (e.g., text)</p>
</td></tr>
<tr><td><code id="plot.theil_+3A_scale">scale</code></td>
<td>
<p>Scale Theil's index by <code>scale</code></p>
</td></tr>
<tr><td><code id="plot.theil_+3A_labels">labels</code></td>
<td>
<p>x-axis labels (time periods)</p>
</td></tr>
<tr><td><code id="plot.theil_+3A_...">...</code></td>
<td>
<p>additional arguments</p>
</td></tr>
<tr><td><code id="plot.theil_+3A_between_title">between_title</code></td>
<td>
<p>Plot title for the between geography component of Theil's T; defaults to &quot;Between&quot;.</p>
</td></tr>
<tr><td><code id="plot.theil_+3A_within_title">within_title</code></td>
<td>
<p>Plot title for the within geography component of Theil's T; defaults to &quot;Within&quot;.</p>
</td></tr>
<tr><td><code id="plot.theil_+3A_total_title">total_title</code></td>
<td>
<p>Plot title for Theil's index; defaults to &quot;Total&quot;.</p>
</td></tr>
<tr><td><code id="plot.theil_+3A_plot">plot</code></td>
<td>
<p>If <code>FALSE</code>, return a list of <code>ggplot</code>s. Not used when <code>style = "lines"</code>.</p>
</td></tr>
<tr><td><code id="plot.theil_+3A_ncol">ncol</code></td>
<td>
<p>Number of columns for the plotting device. If <code>ncol = 1</code>, the three plots will be aligned vertically in one column; if <code>ncol = 3</code> they will b aligned horizontally in one row.</p>
</td></tr>
<tr><td><code id="plot.theil_+3A_digits">digits</code></td>
<td>
<p>number of digits to print (passed to <code><a href="base.html#topic+print.data.frame">print.data.frame</a></code>)</p>
</td></tr>
</table>


<h3>Value</h3>



<h4>plot.theil</h4>

<p>The plot method returns an object of class <code>ggplot</code>.
</p>



<h4>plot.theil_list</h4>

<p>If <code>style = "lines"</code>, the plot method for <code>theil_list</code> objects returns a <code>ggplot</code> with facets for each component of inequality (between-areas, within-areas, and total). For <code>style = "mean_qi"</code>, the plot method returns either a list of plots (all of class <code>ggplot</code>) or, when <code>plot = TRUE</code>, it will draw them to current plotting device using <code><a href="gridExtra.html#topic+grid.arrange">grid.arrange</a></code>.
</p>



<h4>print.theil</h4>

<p>The print returns nothing and method prints a summary of results to the R console.
</p>



<h3>See Also</h3>

<p><code><a href="#topic+theil">theil</a></code>
</p>

<hr>
<h2 id='print.apc'>Methods for APC objects</h2><span id='topic+print.apc'></span><span id='topic+plot.apc'></span>

<h3>Description</h3>

<p>Methods for APC objects
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'apc'
print(x, digits = 1, max = 20, ...)

## S3 method for class 'apc'
plot(
  x,
  cumulative = FALSE,
  style = c("mean_qi", "lines"),
  M = 250,
  col = "black",
  fill = "black",
  alpha,
  lwd,
  base_size = 14,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.apc_+3A_x">x</code></td>
<td>
<p>An <code>apc</code> object returned by <code><a href="#topic+apc">apc</a></code></p>
</td></tr>
<tr><td><code id="print.apc_+3A_digits">digits</code></td>
<td>
<p>Print this many digits (passed to <code><a href="base.html#topic+print.data.frame">print.data.frame</a></code>)</p>
</td></tr>
<tr><td><code id="print.apc_+3A_max">max</code></td>
<td>
<p>Maximum number of time periods (rows) to print</p>
</td></tr>
<tr><td><code id="print.apc_+3A_...">...</code></td>
<td>
<p>additional arguments; for the print argument, these will be passed to <code><a href="base.html#topic+print.data.frame">print.data.frame</a></code>. For the plot method, these will be passed to <code><a href="ggplot2.html#topic+theme">theme</a></code>.</p>
</td></tr>
<tr><td><code id="print.apc_+3A_cumulative">cumulative</code></td>
<td>
<p>Plot cumulative percent change? Defaults to <code>cumulative = FALSE</code></p>
</td></tr>
<tr><td><code id="print.apc_+3A_style">style</code></td>
<td>
<p>If <code>style = "mean_qi"</code>, then the posterior mean and 95 percent credible interval will be plotted; if <code>style = "lines"</code>, then <code>M</code> samples from the joint probability distribution will be plotted.</p>
</td></tr>
<tr><td><code id="print.apc_+3A_m">M</code></td>
<td>
<p>If <code>style = "lines"</code>, then <code>M</code> is the number of samples from the posterior distribution that will be plotted; the default is <code>M = 250</code>.</p>
</td></tr>
<tr><td><code id="print.apc_+3A_col">col</code></td>
<td>
<p>Line color</p>
</td></tr>
<tr><td><code id="print.apc_+3A_fill">fill</code></td>
<td>
<p>Fill color for the 95 percent credible interval</p>
</td></tr>
<tr><td><code id="print.apc_+3A_alpha">alpha</code></td>
<td>
<p>For <code>style = "mean_qi"</code>, this controls the transparency for the credible interval (passed to <code><a href="ggplot2.html#topic+geom_ribbon">geom_ribbon</a></code>) and defaults to <code>alpha = 0.5</code>; for <code>style = "lines"</code>, this controls the transparency of the lines and defaults to <code>alpha = 0.7</code>.</p>
</td></tr>
<tr><td><code id="print.apc_+3A_lwd">lwd</code></td>
<td>
<p>Line width</p>
</td></tr>
<tr><td><code id="print.apc_+3A_base_size">base_size</code></td>
<td>
<p>Size of plot attributes, passed to '<code><a href="ggplot2.html#topic+theme_classic">theme_classic</a></code></p>
</td></tr>
</table>


<h3>Value</h3>



<h4>print</h4>

<p>The print method does not have a return value, but prints a summary of results to the R console.
</p>



<h4>Plot</h4>

<p>The plot method returns a <code>ggplot</code>.
</p>



<h3>See Also</h3>

<p><code><a href="#topic+apc">apc</a></code>
</p>

<hr>
<h2 id='print.stand_surveil'>Methods for age-standardized rates</h2><span id='topic+print.stand_surveil'></span><span id='topic+plot.stand_surveil'></span>

<h3>Description</h3>

<p>Print and plot methods for <code>stand_surveil</code> (standardized rates obtained from a fitted <code>surveil</code> model)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'stand_surveil'
print(x, scale = 1, digits = 3, ...)

## S3 method for class 'stand_surveil'
plot(
  x,
  scale = 1,
  style = c("mean_qi", "lines"),
  M = 250,
  base_size = 14,
  col = "black",
  fill = "gray80",
  alpha,
  lwd,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.stand_surveil_+3A_x">x</code></td>
<td>
<p>An object of <code>stand_surveil</code> obtained by calling <code><a href="#topic+standardize">standardize</a></code> on a fitted <code>surveil</code> model</p>
</td></tr>
<tr><td><code id="print.stand_surveil_+3A_scale">scale</code></td>
<td>
<p>Scale the rates by this amount; e.g., <code>scale = 100e3</code> will print rates per 100,000 at risk.</p>
</td></tr>
<tr><td><code id="print.stand_surveil_+3A_digits">digits</code></td>
<td>
<p>Number of digits to print</p>
</td></tr>
<tr><td><code id="print.stand_surveil_+3A_...">...</code></td>
<td>
<p>additional arguments</p>
</td></tr>
<tr><td><code id="print.stand_surveil_+3A_style">style</code></td>
<td>
<p>If <code>style = "mean_qi"</code>, then the posterior means and 95 percent credible intervals will be plotted; if <code>style = "lines"</code>, then <code>M</code> samples from the joint posterior distribution will be plotted.</p>
</td></tr>
<tr><td><code id="print.stand_surveil_+3A_m">M</code></td>
<td>
<p>Number of samples to plot when <code>style = "lines"</code></p>
</td></tr>
<tr><td><code id="print.stand_surveil_+3A_base_size">base_size</code></td>
<td>
<p>Passed to <code>theme_classic()</code> to control size of plot components (text).</p>
</td></tr>
<tr><td><code id="print.stand_surveil_+3A_col">col</code></td>
<td>
<p>Line color</p>
</td></tr>
<tr><td><code id="print.stand_surveil_+3A_fill">fill</code></td>
<td>
<p>Fill color for the 95 percent credible intervals</p>
</td></tr>
<tr><td><code id="print.stand_surveil_+3A_alpha">alpha</code></td>
<td>
<p>For <code>style = "mean_qi"</code>, this controls the transparency for the credible interval (passed to <code><a href="ggplot2.html#topic+geom_ribbon">geom_ribbon</a></code>) and defaults to <code>alpha = 0.5</code>; for <code>style = "lines"</code>, this controls the transparency of the lines and defaults to <code>alpha = 0.7</code>.</p>
</td></tr>
<tr><td><code id="print.stand_surveil_+3A_lwd">lwd</code></td>
<td>
<p>Line width; for <code>style = "mean_qi"</code>, the default is <code>lwd = 1</code>; for <code>style = "lines"</code>, the default is <code>lwd = 0.05</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Calling <code>standardize</code> on a fitted <code>surveil</code> model will create a new object that contains the <code>surveil</code> model results as well standardized rates. This new <code>stand_surveil</code> object has its own methods for printing and plotting.
</p>


<h4>print.stand_surveil</h4>

<p>Any additional arguments (<code>...</code>) will be  passed to <code><a href="base.html#topic+print.data.frame">print.data.frame</a></code>
</p>



<h4>plot.stand_surveil</h4>

<p>Any additional arguments (<code>...</code>) will be passed to '<code><a href="ggplot2.html#topic+theme">theme</a></code>.
</p>



<h3>Value</h3>



<h4>print.stand_surveil</h4>

<p>The print method returns nothing but prints a summary of results to the console.
</p>



<h4>plot.stand_surveil</h4>

<p>The plot method returns an object of class <code>ggplot</code>.
</p>



<h3>See Also</h3>

<p><code><a href="#topic+standardize">standardize</a></code> <code><a href="#topic+stan_rw">stan_rw</a></code>
</p>

<hr>
<h2 id='priors'>Prior distributions</h2><span id='topic+priors'></span><span id='topic+normal'></span><span id='topic+lkj'></span>

<h3>Description</h3>

<p>Prior distributions
</p>


<h3>Usage</h3>

<pre><code class='language-R'>normal(location = 0, scale, k = 1)

lkj(eta)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="priors_+3A_location">location</code></td>
<td>
<p>Location parameter (numeric)</p>
</td></tr>
<tr><td><code id="priors_+3A_scale">scale</code></td>
<td>
<p>Scale parameter (positive numeric)</p>
</td></tr>
<tr><td><code id="priors_+3A_k">k</code></td>
<td>
<p>Optional; number of groups for which priors are needed. This is a shortcut to avoid using the <code>rep</code> function to repeat the same prior for each group, as in: <code style="white-space: pre;">&#8288;normal(location = rep(0, times = 3), scale = rep(1, times = 3)&#8288;</code>. To provide distinct priors for each group, simply specify them individually, as in <code>normal(location = c(-5, -6, -8), scale = c(2, 2, 2))</code>.</p>
</td></tr>
<tr><td><code id="priors_+3A_eta">eta</code></td>
<td>
<p>The shape parameter for the LKJ prior</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The prior distribution functions are used to set the values of prior parameters.
</p>
<p>Users can control the values of the parameters, but the distribution (model) itself is fixed. The first log-rate (<code>eta[t]</code>, <code>t=1</code>) and the scale parameters (sigma) are assigned Gaussian (<code>normal</code>) prior distribution. (The scale parameter, sigma, is constrained to be positive, making it a half-normal prior.) For correlated time series, the correlation matrix is assigned the LKJ prior.
</p>


<h4>Parameterizations</h4>

<p>For details on how any distribution is parameterized, see the Stan Language Functions Reference document: <a href="https://mc-stan.org/users/documentation/">https://mc-stan.org/users/documentation/</a>.
</p>



<h4>LKJ prior</h4>

<p>The LKJ prior for correlation matrix has a single parameter, eta (eta &gt; 0). If <code>eta=1</code>, then you are placing a uniform prior on any K-by-K correlation matrix. For eta &gt; 1, there is a higher probability on the identity matrix, such that as eta increases beyond 1, you are expressing greater skepticism towards large correlations. If 0 &lt; eta &lt; 1, then you will be expressing skepticism towards correlations of zero and favoring non-zero correlations. See Stan documentation: <a href="https://mc-stan.org/docs/2_27/functions-reference/lkj-correlation.html">https://mc-stan.org/docs/2_27/functions-reference/lkj-correlation.html</a>.
</p>



<h3>Value</h3>

<p>An object of class <code>prior</code> which will be used internally by <strong>surveil</strong> to set parameters of prior distributions.
</p>


<h3>Source</h3>

<p>Stan Development Team. Stan Functions Reference Version 2.27. <a href="https://mc-stan.org/docs/2_27/functions-reference/lkj-correlation.html">https://mc-stan.org/docs/2_27/functions-reference/lkj-correlation.html</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# note there are three groups in the data, each requires a prior
prior &lt;- list()
prior$eta_1 &lt;- normal(location = -6, scale = 4, k = 3)
## by default, location = 0
prior$sigma &lt;- normal(scale = 1, k = 3)
prior$omega &lt;- lkj(2)


dfw &lt;- msa[grep("Dallas", msa$MSA), ]
fit &lt;- stan_rw(dfw, time = Year, group = Race, prior = prior,
               chains = 2, iter = 900) # for speed only
plot(fit)


</code></pre>

<hr>
<h2 id='stan_rw'>Time series models for mortality and disease incidence</h2><span id='topic+stan_rw'></span>

<h3>Description</h3>

<p>Model time-varying incidence rates given a time series of case (or death) counts and population at risk.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stan_rw(
  data,
  group,
  time,
  cor = FALSE,
  family = poisson(),
  prior = list(),
  chains = 4,
  cores = 1,
  iter = 3000,
  refresh = 1500,
  control = list(adapt_delta = 0.98),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="stan_rw_+3A_data">data</code></td>
<td>
<p>A <code>data.frame</code> containing the following columns: </p>

<dl>
<dt>Count</dt><dd><p>Number of cases or deaths; this column must be named 'Count'.</p>
</dd>
<dt>Population</dt><dd><p>Size of population at risk; this column must be named 'Population'.</p>
</dd>
<dt>time</dt><dd><p>Time period indicator. (Provide the (unquoted) column name using the <code>time</code> argument.)</p>
</dd>
<dt>group</dt><dd><p>Optional grouping variable. (Provide the (unquoted) column name using the <code>group</code> argument.)</p>
</dd>
</dl>
</td></tr>
<tr><td><code id="stan_rw_+3A_group">group</code></td>
<td>
<p>If <code>data</code> is aggregated by demographic group, provide the (unquoted) name of the column in <code>data</code> containing the grouping structure, such as age brackets or race-ethnicity. E.g., if <code>data</code> has column names <code>Year</code>, <code>Race</code>, <code>Cases</code>, and <code>Population</code>, then you would provide <code>group = Race</code>.</p>
</td></tr>
<tr><td><code id="stan_rw_+3A_time">time</code></td>
<td>
<p>Specify the (unquoted) name of the time variable in <code>data</code>, as in <code>time = Year</code>. This variable must be numeric-alike (i.e., <code>as.numeric(data$time)</code> will not fail).</p>
</td></tr>
<tr><td><code id="stan_rw_+3A_cor">cor</code></td>
<td>
<p>For correlated random walks use <code>cor = TRUE</code>; default value is <code>FALSE</code>. Note this only applies when the <code>group</code> argument is used.</p>
</td></tr>
<tr><td><code id="stan_rw_+3A_family">family</code></td>
<td>
<p>The default specification is a Poisson model with log link function (<code>family = poisson()</code>). For a Binomial model with logit link function, use <code>family = binomial()</code>.</p>
</td></tr>
<tr><td><code id="stan_rw_+3A_prior">prior</code></td>
<td>
<p>Optionally provide a named <code>list</code> with prior parameters. If any of the following items are missing, default priors will be assigned and printed to the console.
</p>

<dl>
<dt>eta_1</dt><dd><p>The first value of log-risk in each series must be assigned a Gaussian prior probability distribution. Provide the location and scale parameters for each demographic group in a list, where each parameter is a <code>k</code>-length vector.
</p>
<p>For example, with <code>k=2</code> demographic groups, the following code will assign priors of <code>normal(-6.5, 5)</code> to the starting values of both series: <code style="white-space: pre;">&#8288;prior = list(eta_1 = normal(location = -6.5, scale = 5, k = 2)&#8288;</code>. Note, <code>eta</code> is the log-rate, so centering the prior for <code>eta_1</code> on <code>-6.5</code> is similar to centering the prior rate on <code style="white-space: pre;">&#8288;exp(-6.5)*100,000 = 150&#8288;</code> cases per 100,000 person-years at risk. Note, however, that the translation from log-rate to rate is non-linear.</p>
</dd>
<dt>sigma</dt><dd><p>Each demographic group has a scale parameter assigned to its log-rate. This is the scale of the annual deviations from the previous year's log-rate. The scale parameters are assigned independent half-normal prior distributions (these <code>half</code> normal distributions are restricted to be positive-valued only).</p>
</dd>
<dt>omega</dt><dd><p>If <code>cor = TRUE</code>, an LKJ prior is assigned to the correlation matrix, Omega.</p>
</dd>
</dl>
</td></tr>
<tr><td><code id="stan_rw_+3A_chains">chains</code></td>
<td>
<p>Number of independent MCMC chains to initiate (passed to <code><a href="rstan.html#topic+sampling">sampling</a></code>).</p>
</td></tr>
<tr><td><code id="stan_rw_+3A_cores">cores</code></td>
<td>
<p>The number of cores to use when executing the Markov chains in parallel (passed to <code><a href="rstan.html#topic+sampling">sampling</a></code>).</p>
</td></tr>
<tr><td><code id="stan_rw_+3A_iter">iter</code></td>
<td>
<p>Total number of MCMC iterations. Warmup draws are automatically half of <code>iter</code>.</p>
</td></tr>
<tr><td><code id="stan_rw_+3A_refresh">refresh</code></td>
<td>
<p>How often to print the MCMC sampling progress to the console.</p>
</td></tr>
<tr><td><code id="stan_rw_+3A_control">control</code></td>
<td>
<p>A named list of parameters to control Stan's sampling behavior. The most common parameters to control are <code>adapt_delta</code>, which may be raised to address divergent transitions, and <code>max_treedepth</code>. For example, <code>control = list(adapt_delta = 0.99, max_treedepth = 13)</code>, may be a reasonable specification to address a divergent transitions or maximum treedepth warning from Stan.</p>
</td></tr>
<tr><td><code id="stan_rw_+3A_...">...</code></td>
<td>
<p>Other arguments passed to <code><a href="rstan.html#topic+sampling">sampling</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>By default, the models have Poisson likelihoods for the case counts, with log link function. Alternatively, a Binomial model with logit link function can be specified using the <code>family</code> argument (<code>family = binomial()</code>).
</p>
<p>For time t = 1,...n, the models assign Poisson probability distribution to the case counts, given log-risk <code>eta</code> and population at tirks P; the log-risk is modeled using the first-difference (or random-walk) prior:
</p>
<div class="sourceCode"><pre> y_t ~ Poisson(p_t * exp(eta_t))
 eta_t ~ Normal(eta_{t-1}, sigma)
 eta_1 ~ Normal(-6, 5) (-Inf, 0)
 sigma ~ Normal(0, 1) (0, Inf)
</pre></div>
<p>This style of model has been discussed in Bayesian (bio)statistics for quite some time. See Clayton (1996).
</p>
<p>The above model can be used for multiple distinct groups; in that case, each group will have its own independent time series model.
</p>
<p>It is also possible to add a correlation structure to that set of models. Let <code>Y_t</code> be a k-length vector of observations for each of k groups at time t (the capital letter now indicates a vector), then:
</p>
<div class="sourceCode"><pre> Y_t ~ Poisson(P_t * exp(Eta_t))
 Eta_t ~ MVNormal(Eta_{t-1}, Sigma)
 Eta_1 ~ Normal(-6, 5)  (-Inf, 0)
 Sigma = diag(sigma) * Omega * diag(sigma)
 Omega ~ LKJ(2)
 sigma ~ Normal(0, 1) (0, Inf)
</pre></div>
<p>where <code>Omega</code> is a correlation matrix and <code>diag(sigma)</code> is a diagonal matrix with scale parameters on the diagonal. This was adopted from Brandt and Williams (2007); for the LKJ prior, see the Stan Users Guide and Reference Manual.
</p>
<p>If the binomial model is used instead of the Poisson, then the first line of the model specifications will be:
</p>
<div class="sourceCode"><pre> y_t ~ binomial(P_t, inverse_logit(eta_t))
</pre></div>
<p>All else is remains the same. The logit function is <code>log(r/(1-r))</code>, where <code>r</code> is a rate between zero and one; the inverse-logit function is <code>exp(x)/(1 + exp(x))</code>.
</p>


<h3>Value</h3>

<p>The function returns a list, also of class <code>surveil</code>, containing the following elements:
</p>

<dl>
<dt>summary</dt><dd><p>A <code>data.frame</code> with posterior means and 95 percent credible intervals, as well as the raw data (Count, Population,  time period, grouping variable if any, and crude rates).</p>
</dd>
<dt>samples</dt><dd><p>A <code>stanfit</code> object returned by <code><a href="rstan.html#topic+sampling">sampling</a></code>. This contains the MCMC samples from the posterior distribution of the fitted model.</p>
</dd>
<dt>cor</dt><dd><p>Logical value indicating if the model included a correlation structure.</p>
</dd>
<dt>time</dt><dd><p>A list containing the name of the time-period column in the user-provided data and a <code>data.frame</code> of observed time periods and their index.</p>
</dd>
<dt>group</dt><dd><p>If a grouping variable was used, this will be a list containing the name of the grouping variable and a <code>data.frame</code> with group labels and index values.</p>
</dd>
<dt>family</dt><dd><p>The user-provided <code>family</code> argument.</p>
</dd>
</dl>



<h3>Author(s)</h3>

<p>Connor Donegan (Connor.Donegan@UTSouthwestern.edu)
</p>


<h3>Source</h3>

<p>Brandt P and Williams JT. Multiple time series models. Thousand Oaks, CA: SAGE Publications, 2007.
</p>
<p>Clayton, DG. Generalized linear mixed models. In: Gilks WR, Richardson S, Spiegelhalter DJ, editors. Markov Chain Monte Carlo in Practice: Interdisciplinary Statistics. Boca Raton, FL: CRC Press, 1996. p. 275-302.
</p>
<p>Donegan C, Hughes AE, and Lee SC (2022). Colorectal Cancer Incidence, Inequalities, and Prevention Priorities in Urban Texas: Surveillance Study With the &quot;surveil&quot; Software Package. <em>JMIR Public Health &amp; Surveillance</em> 8(8):e34589. <a href="https://doi.org/10.2196/34589">doi:10.2196/34589</a>
</p>
<p>Stan Development Team. Stan Modeling Language Users Guide and Reference Manual, 2.28. 2021. https://mc-stan.org
</p>


<h3>See Also</h3>

<p><code>vignette("demonstration", package = "surveil")</code> <code>vignette("age-standardization", package = "surveil")</code> <code><a href="#topic+apc">apc</a></code> <code><a href="#topic+standardize">standardize</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(msa)
dat &lt;- aggregate(cbind(Count, Population) ~ Year, data = msa, FUN = sum)

fit &lt;- stan_rw(dat, time = Year)

## print summary of results
print(fit)
print(fit$summary)

## plot time trends (rates per 10,000)
plot(fit, scale = 10e3)
plot(fit, style = 'lines', scale = 10e3)

## Summary with MCMC diagnostics (n_eff, Rhat; from Rstan)
print(fit$samples)

## cumulative percent change
fit_pc &lt;- apc(fit)
print(fit_pc$cpc)
plot(fit_pc, cumulative = TRUE)


## age-specific rates 
data(cancer)
cancer2 &lt;- subset(cancer, grepl("55-59|60-64|65-69", Age))
fit &lt;- stan_rw(cancer2, time = Year, group = Age,
               chains = 3, iter = 1e3) # for speed only

## plot trends 
plot(fit, scale = 10e3)

## age-standardized rates
data(standard)
fit_stands &lt;- standardize(fit,
                          label = standard$age,
                          standard_pop = standard$standard_pop)
print(fit_stands)
plot(fit_stands)

## percent change for age-standardized rates
fit_stands_apc &lt;- apc(fit_stands)
plot(fit_stands_apc)
print(fit_stands_apc)


</code></pre>

<hr>
<h2 id='standard'>2000 U.S. standard million population</h2><span id='topic+standard'></span>

<h3>Description</h3>

<p>2000 U.S. standard million population
</p>


<h3>Usage</h3>

<pre><code class='language-R'>standard
</code></pre>


<h3>Format</h3>

<p>An object of class <code>data.frame</code> with 19 rows and 3 columns.
</p>


<h3>Source</h3>

<p>National Cancer Institute. Standard Populations - 19 Age Groups. Accessed at <a href="https://seer.cancer.gov/stdpopulations/stdpop.19ages.html">https://seer.cancer.gov/stdpopulations/stdpop.19ages.html</a> on Oct. 8, 2021.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(standard)
head(standard)
</code></pre>

<hr>
<h2 id='standardize'>Age-standardized rates</h2><span id='topic+standardize'></span>

<h3>Description</h3>

<p>Convert <code>surveil</code> model results to age standardized rates using a fixed age distribution
</p>


<h3>Usage</h3>

<pre><code class='language-R'>standardize(x, label, standard_pop)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="standardize_+3A_x">x</code></td>
<td>
<p>A fitted <code>surveil</code> model</p>
</td></tr>
<tr><td><code id="standardize_+3A_label">label</code></td>
<td>
<p>Labels (character strings) for the age groups that correspond to the values of <code>stand_pop</code>. All levels of the grouping variable used to fit the model (i.e., <code>names(x$data$cases)</code>) must be present in <code>label</code>.</p>
</td></tr>
<tr><td><code id="standardize_+3A_standard_pop">standard_pop</code></td>
<td>
<p>Standard population values corresponding to the age groups specified by <code>label</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list, also of class &quot;stand_surveil&quot;, containing the entire contents of the user-provided <code>surveil</code> model plus the following:
</p>

<dl>
<dt>standard_summary</dt><dd><p>summary data frame of standardized rates (means and 95 percent credible intervals)</p>
</dd>
<dt>standard_samples</dt><dd><p>a data frame of Markov chain Monte Carlo (MCMC) samples from the posterior probability distribution for the standardized rates</p>
</dd>
<dt>standard_label</dt><dd><p>user-provided age-group labels</p>
</dd>
<dt>standard_pop</dt><dd><p>user-provided standardized population sizes (ordered as <code>standard_label</code>)</p>
</dd>
</dl>



<h3>See Also</h3>

<p><code>vignette("age-standardization", package = "surveil")</code> <code><a href="#topic+stan_rw">stan_rw</a></code>  <code><a href="#topic+plot.stand_surveil">plot.stand_surveil</a></code> <code><a href="#topic+print.stand_surveil">print.stand_surveil</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(cancer)
data(standard)

head(standard)
head(cancer)

cancer2 &lt;- subset(cancer, grepl("55-59|60-64|65-69", Age))
fit &lt;- stan_rw(cancer2, time = Year, group = Age,
              chains = 2, iter = 1e3) # for speed only

stands &lt;- standardize(fit,
                      label = standard$age,
                      standard_pop = standard$standard_pop)
print(stands)
plot(stands, style = "lines")

</code></pre>

<hr>
<h2 id='surveil_diff'>Methods for <code>surveil_diff</code> objects</h2><span id='topic+surveil_diff'></span><span id='topic+plot.surveil_diff'></span><span id='topic+print.surveil_diff'></span>

<h3>Description</h3>

<p>Methods for <code>surveil_diff</code> objects
</p>
<p>print surveil_diff objects for analyses of inequality
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'surveil_diff'
plot(
  x,
  style = c("mean_qi", "lines"),
  M = 250,
  col = "black",
  fill = "gray80",
  lwd,
  alpha,
  plot = TRUE,
  scale = 1e+05,
  PAR = TRUE,
  ncol = 3,
  base_size = 14,
  ...
)

## S3 method for class 'surveil_diff'
print(x, scale = 1, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="surveil_diff_+3A_x">x</code></td>
<td>
<p>Object of class <code>surveil_diff</code>, as returned by calling <code>group_diff</code> on a fitted <code>surveil</code> model</p>
</td></tr>
<tr><td><code id="surveil_diff_+3A_style">style</code></td>
<td>
<p>If <code>style = "mean_qi"</code>, then the posterior mean and 95 percent credible interval will be plotted; if <code>style = "lines"</code>, then <code>M</code> samples from the joint probability distribution of the annual rates will be plotted.</p>
</td></tr>
<tr><td><code id="surveil_diff_+3A_m">M</code></td>
<td>
<p>If <code>style = "lines"</code>, then <code>M</code> is the number of samples from the posterior distribution that will be plotted; the default is <code>M = 250</code>.</p>
</td></tr>
<tr><td><code id="surveil_diff_+3A_col">col</code></td>
<td>
<p>Line color</p>
</td></tr>
<tr><td><code id="surveil_diff_+3A_fill">fill</code></td>
<td>
<p>Fill color for credible intervals, passed to <code>geom_ribbon</code></p>
</td></tr>
<tr><td><code id="surveil_diff_+3A_lwd">lwd</code></td>
<td>
<p>Linewidth</p>
</td></tr>
<tr><td><code id="surveil_diff_+3A_alpha">alpha</code></td>
<td>
<p>transparency; for <code style="white-space: pre;">&#8288;style = "mean_qi", controls the credible interval shading; for &#8288;</code>style = &quot;lines&quot;', this is applied to the lines</p>
</td></tr>
<tr><td><code id="surveil_diff_+3A_plot">plot</code></td>
<td>
<p>If <code>plot = FALSE</code>, a list of <code>ggplot</code>s will be returned</p>
</td></tr>
<tr><td><code id="surveil_diff_+3A_scale">scale</code></td>
<td>
<p>Print rates and rate differences as per <code>scale</code> at risk, e.g., per 10,000 at risk.</p>
</td></tr>
<tr><td><code id="surveil_diff_+3A_par">PAR</code></td>
<td>
<p>Return population attributable risk? IF <code>FALSE</code>, then the rate ratio will be used instead of PAR.</p>
</td></tr>
<tr><td><code id="surveil_diff_+3A_ncol">ncol</code></td>
<td>
<p>Number of columns for the plotting device. If <code>ncol = 1</code>, the three plots will be aligned vertically in one column; if <code>ncol = 3</code> they will b aligned horizontally in one row.</p>
</td></tr>
<tr><td><code id="surveil_diff_+3A_base_size">base_size</code></td>
<td>
<p>Passed to <code>theme_classic</code> to control size of plot elements (e.g., text)</p>
</td></tr>
<tr><td><code id="surveil_diff_+3A_...">...</code></td>
<td>
<p>additional print arguments</p>
</td></tr>
</table>


<h3>Value</h3>



<h4>plot.surveil_diff</h4>

<p>By default or whenever <code>plot = TRUE</code>, the plot method draws a series of plots to the current plotting device using <code><a href="gridExtra.html#topic+grid.arrange">grid.arrange</a></code>. If <code>plot = FALSE</code>, then a list of <code>ggplot</code>s is returned.
</p>



<h4>print.surveil_diff</h4>

<p>The print method returns nothing and prints a summary of results to the console.
</p>


<hr>
<h2 id='theil'>Theil's inequality index</h2><span id='topic+theil'></span><span id='topic+theil2'></span><span id='topic+theil.surveil'></span><span id='topic+theil.list'></span>

<h3>Description</h3>

<p>Theil's entropy-based index of inequality
</p>


<h3>Usage</h3>

<pre><code class='language-R'>theil(x)

theil2(Count, Population, rates, total = TRUE)

## S3 method for class 'surveil'
theil(x)

## S3 method for class 'list'
theil(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="theil_+3A_x">x</code></td>
<td>
<p>A fitted <code>surveil</code> model, from <code><a href="#topic+stan_rw">stan_rw</a></code>; or, a list of fitted <code>surveil</code> models, where each model represents a different geographic area (e.g., states).</p>
</td></tr>
<tr><td><code id="theil_+3A_count">Count</code></td>
<td>
<p>Case counts, integers</p>
</td></tr>
<tr><td><code id="theil_+3A_population">Population</code></td>
<td>
<p>Population at risk, integers</p>
</td></tr>
<tr><td><code id="theil_+3A_rates">rates</code></td>
<td>
<p>If <code>Count</code> is not provided, then <code>rates</code> must be provided (<code>Count = rates * Population</code>).</p>
</td></tr>
<tr><td><code id="theil_+3A_total">total</code></td>
<td>
<p>If <code>total = TRUE</code>, Theil's index will be returned. Each unit contributes to Theil's index; if <code>total = FALSE</code>, all of the elements that sum to Theil's index will be returned.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Theil's index is a good index of inequality in disease and mortality burdens when multiple groups are being considered. It provides a summary measure of inequality across a set of demographic groups that may be tracked over time (and/or space). Also, it is interesting because it is additive, and thus admits of simple decompositions.
</p>
<p>The index measures discrepancies between a population's share of the disease burden, <code>omega</code>, and their share of the population, <code>eta</code>. A situation of zero inequality would imply that each population's share of cases is equal to its population share, or, <code>omega=eta</code>. Each population's contribution to total inequality is calculated as:
</p>
<div class="sourceCode"><pre>             T_i = omega_i * [log(omega_i/eta_i)],
</pre></div>
<p>the log-ratio of case-share to population-share, weighted by their share of cases. Theil's index for all areas is the sum of each area's T_i:
</p>
<div class="sourceCode"><pre>             T = sum_(i=1)^n T_i.
</pre></div>
<p>Theil's T is thus a weighted mean of log-ratios of case shares to population shares, where each log-ratio (which we may describe as a raw inequality score) is weighted by its share of total cases. The index has a minimum of zero and a maximum of <code>log(N)</code>, where <code>N</code> is the number of units (e.g., number of states).
</p>
<p>Theil's index, which is based on Shannon's information theory, can be extended to measure inequality across multiple groups nested within non-overlapping geographies (e.g., states).
</p>


<h3>Value</h3>



<h4>theil2</h4>

<p>If <code>total = TRUE</code> (the default), <code>theil2</code> returns Theil's index as a numeric value. Else, <code>theil2</code> returns a vector of values that sum to Theil's index.
</p>



<h4>theil.surveil</h4>

<p>A named list with the following elements: </p>

<dl>
<dt>summary</dt><dd><p> A <code>data.frame</code> summarizing the posterior probability distribution for Theil's T, including the mean and 95 percent credible interval for each time period</p>
</dd>
<dt>samples</dt><dd><p>A <code>data.frame</code> with MCMC samples for Theil's T</p>
</dd>
</dl>




<h4>theil.list</h4>

<p>A list (also of class <code>theil_list</code>) containing a summary data frame and a <code>tbl_df</code> containing MCMC samples for Theil's index at each time period.
</p>
<p>The summary data frame includes the following columns:
</p>

<dl>
<dt>time</dt><dd><p>time period</p>
</dd>
<dt>Theil</dt><dd><p>Posterior mean for Theil's index; equal to the sum of <code>Theil_between</code> and <code>Theil_within</code>.</p>
</dd>
<dt>Theil_between</dt><dd><p>The between-areas component to Theil's inequality index</p>
</dd>
<dt>Theil_within</dt><dd><p>The within-areas component to Theil's inequality index</p>
</dd>
</dl>

<p>Additional columns contain the upper and lower limits of the 95 percent credible intervals for each component of Theil's index.
</p>
<p>The data frame of samples contains the following columns: </p>

<dl>
<dt>time</dt><dd><p>Time period indicator</p>
</dd>
<dt>.draw</dt><dd><p>An id for each MCMC sample; note that samples are from the joint distribution</p>
</dd>
<dt>Theil_between</dt><dd><p>The between-geographies component of Theil's index</p>
</dd>
<dt>Theil_within</dt><dd><p>The within-geographies component of Theil's index</p>
</dd>
<dt>Theil</dt><dd><p>Theil's inequality index (T = Between + Within)</p>
</dd></dl>
<p>.

</p>



<h3>Source</h3>

<p>Conceicao, P. and P. Ferreira (2000). The young person's guide to the Theil Index: Suggesting intuitive interpretations and exploring analytical applications. University of Texas Inequality Project. UTIP Working Paper Number 14. Accessed May 1, 2021 from <a href="https://utip.gov.utexas.edu/papers.html">https://utip.gov.utexas.edu/papers.html</a>
</p>
<p>Conceicao, P, Galbraith, JK, Bradford, P. (2001). The Theil Index in sequences of nested and hierarchic grouping structures: implications for the measurement of inequality through time, with data aggregated at different levels of industrial classification. <em>Eastern Economic Journal</em>. 27(4): 491-514.
</p>
<p>Theil, Henri (1972). <em>Statistical Decomposition Analysis.</em> Amsterdam, The Netherlands and London, UK: North-Holland Publishing Company.
</p>
<p>Shannon, Claude E. and Weaver, Warren (1963). <em>The Mathematical Theory of Communication</em>. Urbana and Chicago, USA: University if Illinois Press.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+plot.theil">plot.theil</a></code> <code><a href="#topic+print.theil">print.theil</a></code> <code><a href="#topic+plot.theil_list">plot.theil_list</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'> houston &lt;- subset(msa, grepl("Houston", MSA))
 fit &lt;- stan_rw(houston, time = Year, group = Race,
               chains = 2, iter = 900) # for speed only
 theil_dfw &lt;- theil(fit)
 plot(theil_dfw)


Count &lt;- c(10, 12, 3, 111)
Pop &lt;- c(1000, 1200, 4000, 9000)
theil2(Count, Pop)
theil2(Count, Pop, total = FALSE)

</code></pre>

<hr>
<h2 id='waic'>Widely Applicable Information Criteria</h2><span id='topic+waic'></span>

<h3>Description</h3>

<p>Widely Application Information Criteria (WAIC) for model comparison
</p>


<h3>Usage</h3>

<pre><code class='language-R'>waic(fit, pointwise = FALSE, digits = 2)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="waic_+3A_fit">fit</code></td>
<td>
<p>An <code>surveil</code> object</p>
</td></tr>
<tr><td><code id="waic_+3A_pointwise">pointwise</code></td>
<td>
<p>Logical (defaults to <code>FALSE</code>); if <code>pointwise = TRUE</code>, a vector of values for each observation will be returned.</p>
</td></tr>
<tr><td><code id="waic_+3A_digits">digits</code></td>
<td>
<p>Round results to this many digits.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A vector of length 3 with <code>WAIC</code>, a rough measure of the effective number of parameters estimated by the model <code>Eff_pars</code>, and log predictive density <code>Lpd</code>. If <code>pointwise = TRUE</code>, results are returned in a <code>data.frame</code>.
</p>


<h3>Source</h3>

<p>Watanabe, S. (2010). Asymptotic equivalence of Bayes cross validation and widely application information criterion in singular learning theory. Journal of Machine Learning Research 11, 3571-3594.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(msa)
austin_w &lt;- subset(msa, grepl("Austin", MSA) &amp; Race == "White")
fit &lt;- stan_rw(austin_w, time = Year)
waic(fit)
 
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
